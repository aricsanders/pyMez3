<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <title>pyMez.Code.InstrumentControl.Instruments API documentation</title>
    <meta name="description" content="The Module Instruments Contains Classes and functions to control 
instruments; GPIB,RS232 and other ..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
	word-wrap: break-word;
  }
  
  .toggleButton {
      background-color: white;
      border: 2px solid black;
       border-radius: 8px;
       color:red;
	   }
   .toggleButton:hover {
    box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);
	}
	
	#functionsNavigation, #classesNavigation, #variablesNavigation {
	display:none;
	}
  
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
	
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  

    function toggleId(id,$link){
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.value = '-';
    } else {
    $node.style.display = 'none';
    $link.value = '+';
    }
  }
  </script>
</head>
<body>
<a id="top"></a>
        <table style='border-style:none;'>
        <tr style="border-style:none;">
        <td style="border-style:none;">
        <a href='../../../pyMez_Documentation.html'><button type="button" class='btn btn-primary'>
        <span style="font-size:20px">Documentation Home</span></button></a>
        </td>
        <td style="border-style:none;">
        <a href='../../index.html'><button type="button" class='btn btn-primary'>
        <span style="font-size:20px">API Documentation</span></button></a>
        </td>
        <td style="border-style:none;">
        <a href='../../../Examples/html/Examples_Home.html'>
        <button type="button" class='btn btn-primary'>
        <span style="font-size:20px">Examples</span></button></a>
        </td>
        <td style="border-style:none;">
        <a href='../../../Reference_Index.html'>
        <button type="button" class='btn btn-primary'>
        <span style="font-size:20px">Index</span></button></a>
        </td>
        </tr>
        </table><a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a>
	<input type="button" class="toggleButton"  value="+" onclick="toggleId('functionsNavigation',this)">
	</h3>
	<div id="functionsNavigation">
      
  <ul>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.determine_instrument_type">determine_instrument_type</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.determine_instrument_type_from_string">determine_instrument_type_from_string</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.find_description">find_description</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.fix_segment_table">fix_segment_table</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.test_VisaInstrument">test_VisaInstrument</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.test_determine_instrument_type">test_determine_instrument_type</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.test_find_description">test_find_description</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.whos_there">whos_there</a></li>
  </ul>

	 </div>
    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a>
	<input type="button" class="toggleButton"  value="+" onclick="toggleId('classesNavigation',this)"></h3>
      <ul id="classesNavigation">
        <li class="mono">
        <span class="class_name"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument">FakeInstrument</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.__init__">__init__</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.add_entry">add_entry</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.ask">ask</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.close">close</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_image_path">get_image_path</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_query_dictionary">get_query_dictionary</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_state">get_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.load_state">load_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.query">query</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.read">read</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save">save</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_HTML">save_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_current_state">save_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_state">save_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.set_state">set_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.show">show</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.to_HTML">to_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_current_state">update_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_document">update_document</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_etree">update_etree</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument.write">write</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope">HighSpeedOscope</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.__init__">__init__</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.add_entry">add_entry</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.ask">ask</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.close">close</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_bandwidth">get_channel_bandwidth</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_offset">get_channel_offset</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_scale">get_channel_scale</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_error_state">get_error_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_image_path">get_image_path</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_number_points">get_number_points</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_query_dictionary">get_query_dictionary</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_state">get_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_time_position">get_time_position</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_timebase_scale">get_timebase_scale</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_level">get_trigger_level</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_slope">get_trigger_slope</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_source">get_trigger_source</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.initialize">initialize</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.load_state">load_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.measure_waves">measure_waves</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.query">query</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.read">read</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save">save</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_HTML">save_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_current_state">save_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_state">save_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_bandwidth">set_channel_bandwidth</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_offset">set_channel_offset</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_scale">set_channel_scale</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_number_points">set_number_points</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_state">set_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_time_position">set_time_position</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_timebase_scale">set_timebase_scale</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_level">set_trigger_level</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_slope">set_trigger_slope</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_source">set_trigger_source</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.show">show</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.to_HTML">to_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_current_state">update_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_document">update_document</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_etree">update_etree</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.write">write</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter">NRPPowerMeter</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.__init__">__init__</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.add_entry">add_entry</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.ask">ask</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.close">close</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_frequency">get_frequency</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_image_path">get_image_path</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_query_dictionary">get_query_dictionary</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_reading">get_reading</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_state">get_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_units">get_units</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.initialize">initialize</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.load_state">load_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.query">query</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.read">read</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save">save</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_HTML">save_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_current_state">save_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_state">save_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_frequency">set_frequency</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_state">set_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_units">set_units</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.show">show</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.to_HTML">to_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_current_state">update_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_document">update_document</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_etree">update_etree</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.write">write</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter">PowerMeter</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.__init__">__init__</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.add_entry">add_entry</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.ask">ask</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.close">close</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_frequency">get_frequency</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_image_path">get_image_path</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_query_dictionary">get_query_dictionary</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_reading">get_reading</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_state">get_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_units">get_units</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.initialize">initialize</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.load_state">load_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.query">query</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.read">read</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.save">save</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_HTML">save_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_current_state">save_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_state">save_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_frequency">set_frequency</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_state">set_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_units">set_units</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.show">show</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.to_HTML">to_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_current_state">update_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_document">update_document</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_etree">update_etree</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.write">write</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA">VNA</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.__init__">__init__</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.add_all_traces">add_all_traces</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.add_entry">add_entry</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.add_segment">add_segment</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.add_trace">add_trace</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.ask">ask</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.clear_window">clear_window</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.close">close</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.get_IFBW">get_IFBW</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.get_frequency">get_frequency</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.get_frequency_list">get_frequency_list</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.get_image_path">get_image_path</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.get_power">get_power</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.get_query_dictionary">get_query_dictionary</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.get_source_output">get_source_output</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.get_state">get_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.get_sweep_type">get_sweep_type</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.initialize">initialize</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.initialize_w1p">initialize_w1p</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.initialize_w2p">initialize_w2p</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.is_busy">is_busy</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.load_state">load_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.measure_sparameters">measure_sparameters</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.measure_switch_terms">measure_switch_terms</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.measure_w1p">measure_w1p</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.measure_w2p">measure_w2p</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.query">query</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.read">read</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.read_trace">read_trace</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.save">save</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.save_HTML">save_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.save_current_state">save_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.save_state">save_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.set_IFBW">set_IFBW</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.set_frequency">set_frequency</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.set_frequency_units">set_frequency_units</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.set_power">set_power</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.set_source_output">set_source_output</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.set_state">set_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.show">show</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.to_HTML">to_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.trigger_sweep">trigger_sweep</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.update_current_state">update_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.update_document">update_document</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.update_etree">update_etree</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.write">write</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA.write_frequency_table">write_frequency_table</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument">VisaInstrument</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.__init__">__init__</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.add_entry">add_entry</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.ask">ask</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.close">close</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_image_path">get_image_path</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_query_dictionary">get_query_dictionary</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_state">get_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.load_state">load_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.query">query</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.read">read</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save">save</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_HTML">save_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_current_state">save_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_state">save_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.set_state">set_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.show">show</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.to_HTML">to_HTML</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_current_state">update_current_state</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_document">update_document</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_etree">update_etree</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.write">write</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrumentError">VisaInstrumentError</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrumentError.__init__">__init__</a></li>
  </ul>

        </li>
      </ul>
    </li>


    
	<li class="set"><h3><a href="#header-variables">Module variables</a>
	<input type="button" class="toggleButton" value="+" onclick="toggleId('variablesNavigation',this)"></h3>
	<div id="variablesNavigation">
      
  <ul>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.ACTIVE_COMPONENTS">ACTIVE_COMPONENTS</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.COMBINE_S11_S22">COMBINE_S11_S22</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.COMMENT_PATTERN">COMMENT_PATTERN</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.CONVERT_S21">CONVERT_S21</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.DATA_SHEETS">DATA_SHEETS</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.DEFAULT_FILE_NAME">DEFAULT_FILE_NAME</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.DEFAULT_MODE">DEFAULT_MODE</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.DUT_COLUMN_NAMES">DUT_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.EXTENSION_PATTERN">EXTENSION_PATTERN</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FORMATS">FORMATS</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.FREQUENCY_UNITS">FREQUENCY_UNITS</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.GENERAL_DESCRIPTORS">GENERAL_DESCRIPTORS</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.INSTRUMENTS_DEFINED">INSTRUMENTS_DEFINED</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.INSTRUMENT_TYPES">INSTRUMENT_TYPES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.METHOD_ALIASES">METHOD_ALIASES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.MINIMUM_DB_ARG_VALUE">MINIMUM_DB_ARG_VALUE</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.MINIMUM_DB_VALUE">MINIMUM_DB_VALUE</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.NUMBER_MATCH_STRING">NUMBER_MATCH_STRING</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.ONE_PORT_COLUMN_NAMES">ONE_PORT_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.OPTION_LINE_PATTERN">OPTION_LINE_PATTERN</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PARAMETERS">PARAMETERS</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PIL_AVAILABLE">PIL_AVAILABLE</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.POWER_3TERM_COLUMN_DESCRIPTIONS">POWER_3TERM_COLUMN_DESCRIPTIONS</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.POWER_3TERM_COLUMN_NAMES">POWER_3TERM_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.POWER_4TERM_COLUMN_DESCRIPTIONS">POWER_4TERM_COLUMN_DESCRIPTIONS</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.POWER_4TERM_COLUMN_NAMES">POWER_4TERM_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.PYMEASURE_ROOT">PYMEASURE_ROOT</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.RESULTS_FILE_ONE_PORT_COLUMN_NAMES">RESULTS_FILE_ONE_PORT_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.RESULTS_FILE_POWER_COLUMN_NAMES">RESULTS_FILE_POWER_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.RESULTS_FILE_TWO_PORT_COLUMN_NAMES">RESULTS_FILE_TWO_PORT_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.RTLD_GLOBAL">RTLD_GLOBAL</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.RTLD_LOCAL">RTLD_LOCAL</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.S1P_DB_COLUMN_NAMES">S1P_DB_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.S1P_MA_COLUMN_NAMES">S1P_MA_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.S1P_RI_COLUMN_NAMES">S1P_RI_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.S2P_COMPLEX_COLUMN_NAMES">S2P_COMPLEX_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.S2P_DB_COLUMN_DESCRIPTION">S2P_DB_COLUMN_DESCRIPTION</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.S2P_DB_COLUMN_NAMES">S2P_DB_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.S2P_MA_COLUMN_DESCRIPTION">S2P_MA_COLUMN_DESCRIPTION</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.S2P_MA_COLUMN_NAMES">S2P_MA_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.S2P_NOISE_PARAMETER_COLUMN_NAMES">S2P_NOISE_PARAMETER_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.S2P_RI_COLUMN_DESCRIPTION">S2P_RI_COLUMN_DESCRIPTION</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.S2P_RI_COLUMN_NAMES">S2P_RI_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.SMITHPLOT">SMITHPLOT</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.TESTS_DIRECTORY">TESTS_DIRECTORY</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.TOUCHSTONE_KEYWORDS">TOUCHSTONE_KEYWORDS</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.TWELVE_TERM_ERROR_COLUMN_NAMES">TWELVE_TERM_ERROR_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.VNA_FREQUENCY_UNIT_MULTIPLIERS">VNA_FREQUENCY_UNIT_MULTIPLIERS</a></li>
    <li class="mono"><a href="#pyMez.Code.InstrumentControl.Instruments.type_names">type_names</a></li>
  </ul>

	  </div>
    </li>
    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">pyMez.Code.InstrumentControl.Instruments</span> module</h1>
  <p>The Module Instruments Contains Classes and functions to control 
instruments; GPIB,RS232 and other visa instruments. Instrument control classes are
wrappers around the pyvisa instrument class with static xml based metadata added in.</p>
<h2>Examples</h2>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pyMez</span> <span class="kn">import</span> <span class="o">*</span>
<span class="o">&gt;&gt;</span> <span class="n">vna</span><span class="o">=</span><span class="n">VNA</span><span class="p">(</span><span class="s2">&quot;GPIB::16&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;</span> <span class="n">vna</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="o">&gt;&gt;</span> <span class="n">s2p</span><span class="o">=</span><span class="n">vna</span><span class="o">.</span><span class="n">measure_sparameters</span><span class="p">()</span>
<span class="o">&gt;&gt;</span> <span class="n">s2p</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><a href="../../../Examples/html/VNA_Measurement_Example_WR15.html">VNA Measurement Examples</a></p>
<h2>Help</h2>
<p><a href="./index.html"><code>pyMez.Code.InstrumentControl</code></a>
<div>
<a href="../../../pyMez_Documentation.html">Documentation Home</a> |
<a href="../../index.html">API Documentation Home</a> |
<a href="../../../Examples/html/Examples_Home.html">Examples Home</a> |
<a href="../../../Reference_Index.html">Index</a>
</div></p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments" class="source">
    <div class="codehilite"><pre><span></span><span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Name:        Instruments.py</span>
<span class="c1"># Purpose:     To deal with controlling instruments</span>
<span class="c1"># Author:      Aric Sanders</span>
<span class="c1"># Created:     2016/06/23</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot; The Module Instruments Contains Classes and functions to control </span>
<span class="sd">instruments; GPIB,RS232 and other visa instruments. Instrument control classes are</span>
<span class="sd">wrappers around the pyvisa instrument class with static xml based metadata added in.</span>


<span class="sd">Examples</span>
<span class="sd">--------</span>
<span class="sd">    #!python</span>
<span class="sd">    &gt;&gt; from pyMez import *</span>
<span class="sd">    &gt;&gt; vna=VNA(&quot;GPIB::16&quot;)</span>
<span class="sd">    &gt;&gt; vna.initialize()</span>
<span class="sd">    &gt;&gt; s2p=vna.measure_sparameters()</span>
<span class="sd">    &gt;&gt; s2p.show()</span>

<span class="sd">&lt;a href=&quot;../../../Examples/html/VNA_Measurement_Example_WR15.html&quot;&gt;VNA Measurement Examples&lt;/a&gt;</span>

<span class="sd">Help</span>
<span class="sd">---------------</span>
<span class="sd">&lt;a href=&quot;./index.html&quot;&gt;`pyMez.Code.InstrumentControl`&lt;/a&gt;</span>
<span class="sd">&lt;div&gt;</span>
<span class="sd">&lt;a href=&quot;../../../pyMez_Documentation.html&quot;&gt;Documentation Home&lt;/a&gt; |</span>
<span class="sd">&lt;a href=&quot;../../index.html&quot;&gt;API Documentation Home&lt;/a&gt; |</span>
<span class="sd">&lt;a href=&quot;../../../Examples/html/Examples_Home.html&quot;&gt;Examples Home&lt;/a&gt; |</span>
<span class="sd">&lt;a href=&quot;../../../Reference_Index.html&quot;&gt;Index&lt;/a&gt;</span>
<span class="sd">&lt;/div&gt;&quot;&quot;&quot;</span>

<span class="c1"># TODO:Fix Save State, and importing from DataHandlers</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1"># Standard Imports-- All in the python standard library</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span><span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1"># Third Party Imports</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span> <span class="vm">__file__</span> <span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span><span class="s1">&#39;..&#39;</span><span class="p">))</span>
<span class="k">try</span><span class="p">:</span> 
    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
    <span class="n">PIL_AVAILABLE</span><span class="o">=</span><span class="mi">1</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;PIL is required for some camera operations&#39;</span><span class="p">)</span>
    <span class="n">PIL_AVAILABLE</span><span class="o">=</span><span class="mi">0</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">visa</span><span class="o">,</span><span class="nn">pyvisa</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;To control comm and gpib instruments this module requires the package PyVisa&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot; Please download it at  http://pyvisa.sourceforge.net/ &quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot; Or add it to the Python Path&quot;</span><span class="p">)</span>
    <span class="k">pass</span> 
<span class="k">try</span><span class="p">:</span>
    <span class="c1">#raise</span>
    <span class="kn">import</span> <span class="nn">Code.DataHandlers.XMLModels</span>
    <span class="n">InstrumentSheet</span><span class="o">=</span><span class="n">Code</span><span class="o">.</span><span class="n">DataHandlers</span><span class="o">.</span><span class="n">XMLModels</span><span class="o">.</span><span class="n">InstrumentSheet</span>
    <span class="n">InstrumentState</span><span class="o">=</span><span class="n">Code</span><span class="o">.</span><span class="n">DataHandlers</span><span class="o">.</span><span class="n">XMLModels</span><span class="o">.</span><span class="n">InstrumentState</span>
    <span class="n">DATA_SHEETS</span><span class="o">=</span><span class="mi">1</span>
    <span class="c1">#print dir(pyMez)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="c1"># If the import of DataHandlers Does not work </span>
    <span class="k">class</span>  <span class="nc">InstrumentSheet</span><span class="p">():</span><span class="k">pass</span>
    <span class="n">DATA_SHEETS</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t Find MySelf&quot;</span><span class="p">)</span>
    <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">Code.Utils.Alias</span> <span class="kn">import</span> <span class="o">*</span>
    <span class="n">METHOD_ALIASES</span><span class="o">=</span><span class="mi">1</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">METHOD_ALIASES</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">pass</span> 
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">Code.Utils.Names</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Could not load pyMez.Code.Utils.Names&quot;</span><span class="p">)</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">Code.DataHandlers.TouchstoneModels</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Could not load Code.DataHandlers.TouchstoneModels&quot;</span><span class="p">)</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">Code.DataHandlers.NISTModels</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Could not load Code.DataHandlers.NISTModels&quot;</span><span class="p">)</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Could not load numpy&quot;</span><span class="p">)</span>
    <span class="k">pass</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1"># Module Constants</span>
<span class="n">ACTIVE_COMPONENTS</span><span class="o">=</span><span class="p">[</span><span class="n">PIL_AVAILABLE</span><span class="p">,</span><span class="n">DATA_SHEETS</span><span class="p">,</span><span class="n">METHOD_ALIASES</span><span class="p">]</span>
<span class="n">INSTRUMENT_TYPES</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GPIB&#39;</span><span class="p">,</span><span class="s1">&#39;COMM&#39;</span><span class="p">,</span><span class="s1">&#39;OCEAN_OPTICS&#39;</span><span class="p">,</span><span class="s1">&#39;MIGHTEX&#39;</span><span class="p">,</span><span class="s1">&#39;LABJACK&#39;</span><span class="p">]</span>
<span class="n">INSTRUMENTS_DEFINED</span><span class="o">=</span><span class="p">[]</span>
<span class="c1">#TODO Make PYMEASURE_ROOT be read from the settings folder</span>
<span class="n">PYMEASURE_ROOT</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span> <span class="vm">__file__</span> <span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
<span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Hz&quot;</span><span class="p">:</span><span class="mf">1.</span><span class="p">,</span><span class="s2">&quot;kHz&quot;</span><span class="p">:</span><span class="mf">10.</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;MHz&quot;</span><span class="p">:</span><span class="mf">10.</span><span class="o">**</span><span class="mi">6</span><span class="p">,</span><span class="s2">&quot;GHz&quot;</span><span class="p">:</span><span class="mf">10.</span><span class="o">**</span><span class="mi">9</span><span class="p">,</span><span class="s2">&quot;THz&quot;</span><span class="p">:</span><span class="mf">10.</span><span class="o">**</span><span class="mi">12</span><span class="p">}</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1"># Module Functions</span>

<span class="c1">#TODO: Move these functions to DataHandlers.Instruments instead</span>
<span class="k">def</span> <span class="nf">whos_there</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Whos_there is a function that prints the idn string for all</span>
<span class="sd">    GPIB instruments connected&quot;&quot;&quot;</span>
    <span class="n">resource_manager</span> <span class="o">=</span> <span class="n">visa</span><span class="o">.</span><span class="n">ResourceManager</span><span class="p">()</span>
    <span class="n">resource_list</span><span class="o">=</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">list_resources</span><span class="p">()</span>
    <span class="n">gpib_resources</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">gpib_idn_dictionary</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">resource_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;GPIB&quot;</span><span class="p">,</span><span class="n">instrument</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">resource</span><span class="o">=</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="n">instrument</span><span class="p">)</span>
            <span class="n">gpib_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
            <span class="n">idn</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;*IDN?&quot;</span><span class="p">)</span>
            <span class="n">gpib_idn_dictionary</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span><span class="o">=</span><span class="n">idn</span>
    <span class="k">if</span> <span class="n">gpib_resources</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">instrument_name</span><span class="p">,</span><span class="n">idn</span> <span class="ow">in</span> <span class="n">gpib_idn_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;{0} is at address {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idn</span><span class="p">,</span><span class="n">instrument_name</span><span class="p">)))</span>
        <span class="c1">#return gpib_idn_dictionary</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;There are no GPIB resources available&quot;</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">determine_instrument_type_from_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Given a string returns the instrument type&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">in</span> <span class="n">StringTypes</span><span class="p">:</span>
         <span class="c1"># Start with the easy ones</span>
         <span class="k">for</span> <span class="n">instrument_type</span> <span class="ow">in</span> <span class="n">INSTRUMENT_TYPES</span><span class="p">:</span>
            <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">instrument_type</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="n">string</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">instrument_type</span>
         <span class="c1"># Now read in all the Instrument sheets and look for a match</span>
         <span class="c1"># Returning the Name in the Instrument_Type Tag</span>
         <span class="n">instrument_folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">instrument_sheet</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">instrument_folder</span><span class="p">):</span>
             <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">,</span><span class="n">instrument_sheet</span><span class="p">)</span>
             <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">text</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
                    <span class="n">tag_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                    <span class="s1">&#39;&lt;Instrument_Type&gt;(?P&lt;instrument_type&gt;\w+)&lt;/Instrument_Type&gt;&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">tag_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;instrument_type&#39;</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span><span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
<span class="k">def</span> <span class="nf">determine_instrument_type</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tries to return an instrument type given an address, name, serial #</span>
<span class="sd">     or class instance&quot;&quot;&quot;</span>
    <span class="c1"># attributes that normally have the type hidden in there</span>
    <span class="c1"># should be in the order of likelyhood </span>
    <span class="n">attritbute_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;instrument_type&#39;</span><span class="p">,</span><span class="s1">&#39;address&#39;</span><span class="p">,</span><span class="s1">&#39;serial&#39;</span><span class="p">,</span><span class="s1">&#39;Id&#39;</span><span class="p">]</span> 
    <span class="c1"># Check to see if it is a string and then go through the possibilities</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span> <span class="ow">in</span> <span class="n">StringTypes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">determine_instrument_type_from_string</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="c1"># If it is a object or class look around in normal names looking for a string</span>
    <span class="c1"># to process</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">InstanceType</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ClassType</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attritbute_names</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                    <span class="n">string</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;object.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">attribute</span><span class="p">)</span>
                    <span class="n">answer</span><span class="o">=</span><span class="n">determine_instrument_type_from_string</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">answer</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span><span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">answer</span> 
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>        
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">string</span><span class="o">=</span><span class="nb">object</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                    <span class="k">return</span> <span class="n">determine_instrument_type_from_string</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span> <span class="k">pass</span> 
                
<span class="k">def</span> <span class="nf">find_description</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;path&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Finds an instrument description in pyMez/Instruments given an identifier, </span>
<span class="sd">    outputs a path or the file. Right now this outputs the first sheet that matches the identifier&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Now read in all the Instrument sheets and look for a match</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">instrument_folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">instrument_folder</span><span class="o">=</span><span class="n">directory</span>
        <span class="k">for</span> <span class="n">instrument_sheet</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">instrument_folder</span><span class="p">):</span>
            <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">,</span><span class="n">instrument_sheet</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">text</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
                    <span class="n">path_out</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;name|path&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
                    <span class="n">file_contents</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;file|xml|node|contents&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">path_out</span><span class="p">,</span><span class="n">output</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">path</span>
                    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">file_contents</span><span class="p">,</span><span class="n">output</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">text</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">fix_segment_table</span><span class="p">(</span><span class="n">segment_table</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a list of dictionaries in the form [{&quot;start&quot;:start_frequency,</span>
<span class="sd">    &quot;stop&quot;:stop_frequency,&quot;number_points&quot;:number_points,&quot;step&quot;:frequency_step}...] returns a table that is ordered by start</span>
<span class="sd">    frequency and has no overlapping points&quot;&quot;&quot;</span>
    <span class="n">segment_table</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">segment_table</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">])</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment_table</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;stop&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]:</span>
            <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;step&quot;</span><span class="p">]</span>
            <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;number_points&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">segment_table</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1"># Class Definitions</span>

<span class="k">class</span> <span class="nc">VisaInstrumentError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FakeInstrument</span><span class="p">(</span><span class="n">InstrumentSheet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; General Class to communicate with COMM and GPIB instruments</span>
<span class="sd">    This is a blend of the pyvisa resource and an xml description. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Intializes the VisaInstrument Class&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                    <span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span> <span class="s1">&#39;Instruments&#39;</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># First we try to look up the description and get info from it</span>
        <span class="k">if</span> <span class="n">DATA_SHEETS</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span> <span class="o">=</span> <span class="n">find_description</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span>
                                                  <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">])</span>
                <span class="n">InstrumentSheet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_query_dictionary</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The information sheet was not found defaulting to address&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span> <span class="o">=</span> <span class="n">resource_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">resource_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span> <span class="o">=</span> <span class="n">resource_name</span>

        <span class="c1"># Create a description for state saving</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_buffer</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_buffer</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">=</span><span class="p">[]</span>
        <span class="c1">#self.resource_manager = visa.ResourceManager()</span>
        <span class="c1"># Call the visa instrument class-- this gives ask,write,read</span>
        <span class="c1">#self.resource = self.resource_manager.open_resource(self.instrument_address)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command to instrument&quot;</span>
        <span class="n">now</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">:</span><span class="n">now</span><span class="p">,</span><span class="s2">&quot;Action&quot;</span><span class="p">:</span><span class="s2">&quot;self.write&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;Argument&quot;</span><span class="p">:</span><span class="n">command</span><span class="p">,</span><span class="s2">&quot;Response&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">})</span>


    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Reads from the instrument&quot;</span>
        <span class="n">now</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">out</span><span class="o">=</span><span class="s2">&quot;Buffer Read at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">001</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">:</span><span class="n">now</span><span class="p">,</span><span class="s2">&quot;Action&quot;</span><span class="p">:</span><span class="s2">&quot;self.read&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;Argument&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Response&quot;</span><span class="p">:</span><span class="n">out</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command and then reads a response&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command and then reads a response&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the instrument to the state specified by Command:Value pairs&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">state_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">state_table</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">state_table</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="c1"># now we need to write the command</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_table</span><span class="p">:</span>
                <span class="c1"># a state row has a set and value</span>
                <span class="n">state_command</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_query_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the current state of the instrument. get_state accepts any query dictionary in</span>
<span class="sd">        the form state_query_dictionary={&quot;GPIB_SET_COMMAND&quot;:&quot;GPIB_QUERY_COMMAND&quot;,...} or any state_query_table</span>
<span class="sd">        in the form [{&quot;Set&quot;:&quot;GPIB_SET_COMMAND&quot;,&quot;Query&quot;:&quot;GPIB_QUERY_COMMAND&quot;,&quot;Index&quot;:Optional_int_ordering commands,</span>
<span class="sd">        if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state_query_table</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state_query_dictionary</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_query_dictionary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">state_query_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span>
            <span class="n">state</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">state_command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span> <span class="n">query</span>
                          <span class="ow">in</span> <span class="n">state_query_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="k">return</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># a state_query_table is a list of dictionaries, each row has at least a Set and Query key but could</span>
            <span class="c1"># have an Index key that denotes order</span>
            <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">state_query_table</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]))</span>
                <span class="n">state</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                    <span class="nb">set</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                    <span class="n">query</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;Index&quot;</span><span class="p">:</span> <span class="n">index</span><span class="p">})</span>
                <span class="k">return</span> <span class="n">state</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                    <span class="nb">set</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                    <span class="n">query</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)})</span>
                <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">update_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves the state in self.current_state attribute &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">state_path</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">general_descriptor</span><span class="o">=</span><span class="s2">&quot;State&quot;</span><span class="p">,</span>
                                   <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;state_directory&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
            <span class="n">new_state</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span> <span class="n">state_dictionary</span><span class="p">,</span>
                                                 <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="n">new_state</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_table&quot;</span><span class="p">:</span> <span class="n">state_table</span><span class="p">,</span>
                                                 <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_state</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
                                                 <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_state</span><span class="o">.</span><span class="n">add_state_description</span><span class="p">()</span>
            <span class="n">new_state</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">description_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>  <span class="c1"># pass</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state_path</span>

    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads a state from a file.&quot;&quot;&quot;</span>
        <span class="c1"># TODO put a UDT to state_table</span>
        <span class="n">state_model</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state_table</span><span class="o">=</span><span class="n">state_model</span><span class="o">.</span><span class="n">get_state_list_dictionary</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes the VISA session&quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Fake Instrument has been closed&quot;</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">VisaInstrument</span><span class="p">(</span><span class="n">InstrumentSheet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; General Class to communicate with COMM and GPIB instruments</span>
<span class="sd">    This is a blend of the pyvisa resource and an xml description. If there is no device connected</span>
<span class="sd">     enters into a fake mode. Where all the commands are logged as .history and the attribute fake_mode=True&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes the VisaInstrument Class&quot;&quot;&quot;</span>
        <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                  <span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
        <span class="c1"># First we try to look up the description and get info from it</span>
        <span class="k">if</span> <span class="n">DATA_SHEETS</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="o">=</span><span class="n">find_description</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span>
                                                <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">])</span>
                <span class="n">InstrumentSheet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_query_dictionary</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The information sheet was not found defaulting to address&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">resource_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
        
        <span class="c1"># Create a description for state saving</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="o">=</span><span class="mi">10</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">=</span><span class="n">visa</span><span class="o">.</span><span class="n">ResourceManager</span><span class="p">()</span>
            <span class="c1"># Call the visa instrument class-- this gives ask,write,read</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Unable to load resource entering fake mode ...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="n">FakeInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">history</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span><span class="o">=</span><span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command to instrument&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Reads from the instrument&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command and then reads a response&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command and then reads a response&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the instrument to the state specified by Command:Value pairs&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">state_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">state_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="c1"># now we need to write the command</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_table</span><span class="p">:</span>
                <span class="c1"># a state row has a set and value</span>
                <span class="n">state_command</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">value</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            
    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_query_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the current state of the instrument. get_state accepts any query dictionary in</span>
<span class="sd">        the form state_query_dictionary={&quot;GPIB_SET_COMMAND&quot;:&quot;GPIB_QUERY_COMMAND&quot;,...} or any state_query_table</span>
<span class="sd">        in the form [{&quot;Set&quot;:&quot;GPIB_SET_COMMAND&quot;,&quot;Query&quot;:&quot;GPIB_QUERY_COMMAND&quot;,&quot;Index&quot;:Optional_int_ordering commands,</span>
<span class="sd">        if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state_query_table</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state_query_dictionary</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_query_dictionary</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
                <span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span>
            <span class="n">state</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">state_command</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">query</span>
            <span class="ow">in</span> <span class="n">state_query_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="k">return</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># a state_query_table is a list of dictionaries, each row has at least a Set and Query key but could</span>
            <span class="c1"># have an Index key that denotes order</span>
            <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">state_query_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]))</span>
                <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                    <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                    <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span><span class="s2">&quot;Index&quot;</span><span class="p">:</span><span class="n">index</span><span class="p">})</span>
                <span class="k">return</span> <span class="n">state</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                    <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                    <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)})</span>
                <span class="k">return</span> <span class="n">state</span>
    
    <span class="k">def</span> <span class="nf">update_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
   
    <span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves the state in self.current_state attribute &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">state_path</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">general_descriptor</span><span class="o">=</span><span class="s2">&quot;State&quot;</span><span class="p">,</span>
                                 <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;state_directory&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
            <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="n">state_dictionary</span><span class="p">,</span>
                                              <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_table&quot;</span><span class="p">:</span><span class="n">state_table</span><span class="p">,</span>
                                              <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
                                              <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_state</span><span class="o">.</span><span class="n">add_state_description</span><span class="p">()</span>
            <span class="n">new_state</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">description_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">raise</span> <span class="c1">#pass</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state_path</span>

    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads a state from a file.&quot;&quot;&quot;</span>
        <span class="c1">#TODO put a UDT to state_table</span>
        <span class="n">state_model</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state_table</span><span class="o">=</span><span class="n">state_model</span><span class="o">.</span><span class="n">get_state_list_dictionary</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes the VISA session&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">VNA</span><span class="p">(</span><span class="n">VisaInstrument</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Control class for a linear VNA.</span>
<span class="sd">    The .measure_sparameters ans .measure_switch_terms return a S2PV1</span>
<span class="sd">    class that can be saved, printed or have a simple plot using show(). The attribute frequency_list</span>
<span class="sd">    stores the frequency points as Hz.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the E8631A control class&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;frequency_units&quot;</span><span class="p">:</span> <span class="s2">&quot;Hz&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">VisaInstrument</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;frequency_units&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># this should be if SENS:SWE:TYPE? is LIN or LOG</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span><span class="s2">&quot;LIN&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_power</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IFBW</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;frequency_units&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># this should be if SENS:SWE:TYPE? is LIN or LOG</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                                     <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                                 <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
                    <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                        <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                        <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">trace_name</span><span class="p">,</span><span class="n">trace_parameter</span><span class="p">,</span><span class="n">drive_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">display_trace</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a single trace to the VNA. Trace parameters vary by instrument and can be ratios of</span>
<span class="sd">        recievers or raw receiver values. For instance, R1 is the a1 wave. Traditional Sparameters</span>
<span class="sd">        do not require the identification of a drive_port. Does not display trace on the front panel&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="n">trace_parameter</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;{0}&#39;,{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">,</span><span class="n">trace_parameter</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;{0}&#39;,{1},{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">,</span> <span class="n">trace_parameter</span><span class="p">,</span><span class="n">drive_port</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">display_trace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">read_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">trace_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a 2-d list of [[reParameter1,imParameter1],..[reParameterN,imParameterN]] where</span>
<span class="sd">         n is the number of points in the sweep. User is responsible for triggering the sweep and retrieving</span>
<span class="sd">          the frequency array vna.get_frequency_list()&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
        <span class="c1"># First get the A and Blists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL &quot;{0}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">out_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
        <span class="n">out_string</span><span class="o">=</span><span class="n">out_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">re_list</span><span class="o">=</span><span class="n">out_string</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">im_list</span><span class="o">=</span><span class="n">out_string</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">out_list</span><span class="o">=</span><span class="p">[[</span><span class="nb">float</span><span class="p">(</span><span class="n">real_parameter</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">im_list</span><span class="p">[</span><span class="n">index</span><span class="p">])]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">real_parameter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">re_list</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">out_list</span>

    <span class="k">def</span> <span class="nf">trigger_sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers a single sweep of the VNA, note you need to wait for the sweep to finish before reading the</span>
<span class="sd">        values. It takes ~ #ports sourced*#points/IFBW &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_source_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets all of the outputs of the VNA to OFF(0) or ON (1). This disables/enables all the source outputs.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;OUTP {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_source_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the state of the outputs. This is equivelent to vna.query(&#39;OUTP?&#39;)&quot;&quot;&quot;</span>
        <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;OUTP?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">add_all_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds all Sparameter and wave parameter traces.</span>
<span class="sd">        Does not initialize the instrument. The trace names match those in the</span>
<span class="sd">        measure methods (S11,S12,..S22) and (A1_D1,B1_D1..B2_D2) by default it</span>
<span class="sd">        assumes port 1 and port 2 are being used. In addition, it assumes the B receiver names are [A,B,C,D].</span>
<span class="sd">         This method will cause an error if the traces are already defined&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;port1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;port2&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]}</span>
        <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
        <span class="n">scattering_parameter_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S11&quot;</span><span class="p">,</span><span class="s2">&quot;S12&quot;</span><span class="p">,</span><span class="s2">&quot;S21&quot;</span><span class="p">,</span><span class="s2">&quot;S22&quot;</span><span class="p">]</span>
        <span class="n">trace_definitions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]),</span>
                           <span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]),</span>
                           <span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]),</span>
                           <span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scattering_parameter_names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;{0}&#39;,{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">trace_definitions</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe{1}:FEED &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">b1_name</span> <span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">b2_name</span><span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Initialize Port 1 traces A1_D1,B1_D1,B2_D1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{0}&#39;,R{0},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe5:FEED &#39;A{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{0}&#39;,{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span><span class="n">b1_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe6:FEED &#39;B{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{0}&#39;,R{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe7:FEED &#39;A{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{0}&#39;,{2},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b2_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe8:FEED &#39;B{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="c1"># Initialize Port 2 Traces A1_D2,B1_D2,</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{1}&#39;,R{0},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe9:FEED &#39;A{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b1_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe10:FEED &#39;B{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{1}&#39;,R{1},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe11:FEED &#39;A{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b2_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe12:FEED &#39;B{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>


    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Intializes the system&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
        <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SYST:FPRESET&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S11&#39;,S11&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;S11&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S12&#39;,S12&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe2:FEED &#39;S12&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S21&#39;,S21&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe3:FEED &#39;S21&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S22&#39;,S22&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe4:FEED &#39;S22&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                                 <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                             <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
                <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                    <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">set_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the power of the Instrument in dbm&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SOUR:POW {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns the power of the instrument in dbm&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;SOUR:POW?&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_sweep_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns the current sweep type. It can be LIN, LOG, or SEG&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:TYPE?&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_IFBW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifbw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the IF Bandwidth of the instrument in Hz&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:BAND {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ifbw</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:BAND:TRAC OFF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="n">ifbw</span>

    <span class="k">def</span> <span class="nf">get_IFBW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the IFBW of the instrument in Hz&quot;&quot;&quot;</span>
        <span class="n">ifbw</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;SENS:BAND?&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="n">ifbw</span>
        <span class="k">return</span> <span class="n">ifbw</span>

    <span class="k">def</span> <span class="nf">set_frequency_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the frequency units of the class, all values are still written to the VNA</span>
<span class="sd">        as Hz and the attrbiute frequncy_list is in Hz,</span>
<span class="sd">        however all commands that deal with sweeps and measurements will be in units&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">frequency_units</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="n">unit</span>

    <span class="k">def</span> <span class="nf">add_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">number_points</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">frequency_units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the VNA to a segment mode and appends a single entry in the frequency table. If start is the only specified</span>
<span class="sd">        parameter sets the entry to start=stop and number_points = 1. If step is specified calculates the number of points</span>
<span class="sd">        and sets start, stop, number_points on the VNA. It also stores the value into the attribute frequency_list.</span>
<span class="sd">        Note this function was primarily tested on an agilent which stores frequency to the nearest mHz.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># first handle the start only case</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># fix the frequency units</span>
        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">frequency_units</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">step</span><span class="p">:</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="c1"># handle creating step and number of points</span>
        <span class="k">if</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">step</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="mi">201</span>  <span class="c1"># I don&#39;t like the default for n_points this far down in the code</span>
            <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># append the new segment to self.frequency_table and fix any strangeness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span> <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:])</span>

        <span class="c1"># update the frequency_list</span>
        <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
            <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>

        <span class="c1"># now we write the segment to the instrument</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">(),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE SEGM&#39;</span><span class="p">)</span>

        <span class="c1"># now get the number of segments and add or delete the right amount to make it line up with self.frequency_table</span>
        <span class="c1"># This routine is broken</span>

        <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">print</span><span class="p">((</span><span class="s2">&quot;{0} is {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;number_segments&quot;</span><span class="p">,</span> <span class="n">number_segments</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">number_segments</span><span class="p">:</span>
            <span class="n">difference</span> <span class="o">=</span> <span class="n">number_segments</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
            <span class="n">max_segment</span> <span class="o">=</span> <span class="n">number_segments</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">difference</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:DEL&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_segment</span><span class="p">))</span>
                <span class="n">max_segment</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">difference</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">number_segments</span><span class="p">:</span>
            <span class="n">difference</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span> <span class="o">-</span> <span class="n">number_segments</span>
            <span class="n">max_segment</span> <span class="o">=</span> <span class="n">number_segments</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;{0} is {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;difference&quot;</span><span class="p">,</span> <span class="n">difference</span><span class="p">)))</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">difference</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:ADD&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_segment</span><span class="p">))</span>
                <span class="n">max_segment</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">difference</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">print</span><span class="p">((</span><span class="s2">&quot;{0} is {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;difference&quot;</span><span class="p">,</span> <span class="n">difference</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]):</span>
            <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]]</span>
            <span class="c1"># SENSe&lt;cnum&gt;:SEGMent&lt;snum&gt;:SWEep:POINts &lt;num&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">number_points</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:STAT ON&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">write_frequency_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes frequency_table to the instrument, the frequency table should be in the form</span>
<span class="sd">        [{start:,stop:,number_points:}..] or None&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">frequency_table</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">frequency_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]</span>
        <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frequency_table</span><span class="p">[:]):</span>
            <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]]</span>
            <span class="c1"># SENSe&lt;cnum&gt;:SEGMent&lt;snum&gt;:SWEep:POINts &lt;num&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">number_points</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:STAT ON&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">number_points</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;LIN&#39;</span><span class="p">,</span> <span class="n">frequency_units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the VNA to a linear mode and creates a single entry in the frequency table. If start is the only specified</span>
<span class="sd">        parameter sets the entry to start=stop and number_points = 1. If step is specified calculates the number of points</span>
<span class="sd">        and sets start, stop, number_points on the VNA. It also stores the value into the attribute frequency_list.</span>
<span class="sd">        Note this function was primarily tested on an agilent which stores frequency to the nearest mHz.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">frequency_units</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">step</span><span class="p">:</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="k">if</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">step</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE LIN&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LOG&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE LOG&#39;</span><span class="p">)</span>
            <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                                 <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE LIN&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stop</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number_points</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns the frequency in python list format&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span>

    <span class="k">def</span> <span class="nf">is_busy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the instrument is currently doing something and returns a boolean value&quot;&quot;&quot;</span>
        <span class="n">opc</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;*OPC?&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">opc</span>

    <span class="k">def</span> <span class="nf">clear_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clears the  window of traces. Does not delete the variables&quot;&quot;&quot;</span>
        <span class="n">string_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow{0}:CATalog?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
        <span class="n">traces</span> <span class="o">=</span> <span class="n">string_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">traces</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISP:WIND{0}:TRAC{1}:DEL&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">trace</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">measure_switch_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Measures switch terms and returns a s2p table in forward and reverse format. To return in port format</span>
<span class="sd">        set the option order= &quot;PORT&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;view_trace&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span><span class="s2">&quot;initialize&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;order&quot;</span><span class="p">:</span><span class="s2">&quot;FR&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># this resets the traces to be based on swith terms</span>
        <span class="c1"># Set VS to be remotely triggered by GPIB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:HOLD:FUNC HOLD&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TRIG:REM:TYP CHAN&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;initialize&quot;</span><span class="p">]:</span>

            <span class="c1"># Set the Channel to have 2 Traces</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:PAR:COUN 2&quot;</span><span class="p">)</span>
            <span class="c1"># Trace 1 This is port 2 or Forward Switch Terms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:PAR:DEF &#39;FWD&#39;,R2B,1&quot;</span><span class="p">)</span>  <span class="c1"># note this command is different for vector star A2,B2</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;view_trace&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe5:FEED &#39;FWD&#39;&quot;</span><span class="p">)</span>
            <span class="c1"># Trace 2 This is port 1 or Reverse Switch Terms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:PAR:DEF &#39;REV&#39;,R1A,2&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;view_trace&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe6:FEED &#39;REV&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Select Channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:SEL;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;TRIG:SING;&quot;</span><span class="p">)</span>
        <span class="c1"># Sleep for the duration of the scan</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.5</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>
        <span class="c1"># wait for other functions to be completed</span>
        <span class="c1"># while self.is_busy():</span>
        <span class="c1">#     time.sleep(.01)</span>
        <span class="c1"># Set the read format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FORM:ASC,0&quot;</span><span class="p">)</span>
        <span class="c1"># Read in the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC:PAR:SEL &#39;FWD&#39;;&quot;</span><span class="p">)</span>
        <span class="n">foward_switch_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CALC:DATA? SDATA&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC:PAR:SEL &#39;REV&#39;;&quot;</span><span class="p">)</span>
        <span class="n">reverse_switch_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CALC:DATA? SDATA&quot;</span><span class="p">)</span>
        <span class="c1"># Now parse the string</span>
        <span class="n">foward_switch_list</span> <span class="o">=</span> <span class="n">foward_switch_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">reverse_switch_list</span> <span class="o">=</span> <span class="n">reverse_switch_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">real_foward</span> <span class="o">=</span> <span class="n">foward_switch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imaginary_forward</span> <span class="o">=</span> <span class="n">foward_switch_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">real_reverse</span> <span class="o">=</span> <span class="n">reverse_switch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imaginary_reverse</span> <span class="o">=</span> <span class="n">reverse_switch_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">switch_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span><span class="p">,</span>
                           <span class="n">real_foward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_forward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                           <span class="n">real_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                           <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
                <span class="n">switch_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span><span class="p">,</span>
                           <span class="n">real_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                           <span class="n">real_foward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_forward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                           <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
                <span class="n">switch_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="n">option_line</span> <span class="o">=</span> <span class="s2">&quot;# Hz S RI R 50&quot;</span>
        <span class="c1"># add some options here about auto saving</span>
        <span class="c1"># do we want comment options?</span>
        <span class="n">s2p</span> <span class="o">=</span> <span class="n">S2PV1</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">option_line</span><span class="o">=</span><span class="n">option_line</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">switch_data</span><span class="p">)</span>
        <span class="n">s2p</span><span class="o">.</span><span class="n">change_frequency_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s2p</span>

    <span class="k">def</span> <span class="nf">measure_sparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers a single sparameter measurement for all 4 parameters and returns a SP2V1 object&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;single&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span><span class="p">[</span><span class="s2">&quot;trigger&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;single&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>
            <span class="c1"># now go to sleep for the time to take the scan</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>

        <span class="c1"># wait for other functions to be completed</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="c1"># Set the format to ascii and set up sweep definitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
        <span class="c1"># First get the Sparameter lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S11&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">s11_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S12&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">s12_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S21&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">s21_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S22&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">s22_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
        <span class="c1"># String Parsing</span>
        <span class="n">s11_list</span> <span class="o">=</span> <span class="n">s11_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">s12_list</span> <span class="o">=</span> <span class="n">s12_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">s21_list</span> <span class="o">=</span> <span class="n">s21_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">s22_list</span> <span class="o">=</span> <span class="n">s22_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="c1"># Construct a list of lists that is data in RI format</span>
        <span class="n">reS11</span> <span class="o">=</span> <span class="n">s11_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imS11</span> <span class="o">=</span> <span class="n">s11_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">reS12</span> <span class="o">=</span> <span class="n">s12_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imS12</span> <span class="o">=</span> <span class="n">s12_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">reS21</span> <span class="o">=</span> <span class="n">s21_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imS21</span> <span class="o">=</span> <span class="n">s21_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">reS22</span> <span class="o">=</span> <span class="n">s22_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imS22</span> <span class="o">=</span> <span class="n">s22_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">sparameter_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span><span class="p">,</span>
                       <span class="n">reS11</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS11</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="n">reS21</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS21</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="n">reS12</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS12</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="n">reS22</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS22</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
            <span class="n">sparameter_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="n">option_line</span> <span class="o">=</span> <span class="s2">&quot;# Hz S RI R 50&quot;</span>
        <span class="c1"># add some options here about auto saving</span>
        <span class="c1"># do we want comment options?</span>
        <span class="n">s2p</span> <span class="o">=</span> <span class="n">S2PV1</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">option_line</span><span class="o">=</span><span class="n">option_line</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sparameter_data</span><span class="p">)</span>
        <span class="n">s2p</span><span class="o">.</span><span class="n">change_frequency_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s2p</span>
    <span class="k">def</span> <span class="nf">initialize_w2p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the system for w2p acquisition&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;port1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;port2&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]}</span>
        <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SYST:FPRESET&quot;</span><span class="p">)</span>
        <span class="n">b1_name</span> <span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">b2_name</span><span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Initialize Port 1 traces A1_D1,B1_D1,B2_D1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{0}&#39;,R{0},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;A{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{0}&#39;,{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span><span class="n">b1_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe2:FEED &#39;B{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{0}&#39;,R{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe3:FEED &#39;A{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{0}&#39;,{2},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b2_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe4:FEED &#39;B{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="c1"># Initialize Port 2 Traces A1_D2,B1_D2,</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{1}&#39;,R{0},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe5:FEED &#39;A{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b1_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe6:FEED &#39;B{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{1}&#39;,R{1},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe7:FEED &#39;A{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b2_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe8:FEED &#39;B{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_frequency_list</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">initialize_w1p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the system for w1p acquisition, default works for ZVA&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span><span class="s2">&quot;source_port&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SYST:FPRESET&quot;</span><span class="p">)</span>
        <span class="n">b_name</span> <span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{0}&#39;,R{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;A{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{0}&#39;,{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">],</span>
                                                                       <span class="n">b_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe2:FEED &#39;B{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                                 <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                             <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
                <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                    <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_frequency_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns the frequency list as read from the VNA&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                                 <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                             <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
                <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                    <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]</span>

    <span class="k">def</span> <span class="nf">measure_w1p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers a single w1p measurement for a specified</span>
<span class="sd">        port and returns a w1p object.&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;w1p_options&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;trigger&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;single&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>
            <span class="c1"># now go to sleep for the time to take the scan</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>

        <span class="c1"># wait for other functions to be completed</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="c1"># Set the format to ascii and set up sweep definitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
        <span class="c1"># First get the A and Blists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL A{0}_D{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">a_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL  B{0}_D{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">b_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
        <span class="c1"># String Parsing</span>
        <span class="n">a_list</span> <span class="o">=</span> <span class="n">a_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">b_list</span> <span class="o">=</span> <span class="n">b_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="c1"># Construct a list of lists that is data in RI format</span>
        <span class="n">re_a</span> <span class="o">=</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">im_a</span> <span class="o">=</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">re_b</span> <span class="o">=</span> <span class="n">b_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">im_b</span> <span class="o">=</span> <span class="n">b_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">wparameter_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span> <span class="o">/</span> <span class="mf">10.</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span>
                       <span class="n">re_a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">im_a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="n">re_b</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">im_b</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
            <span class="n">wparameter_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;reA1_D1&quot;</span><span class="p">,</span> <span class="s2">&quot;imA1_D1&quot;</span><span class="p">,</span> <span class="s2">&quot;reB1_D1&quot;</span><span class="p">,</span> <span class="s2">&quot;imB1_D1&quot;</span><span class="p">]</span>
        <span class="c1"># add some options here about auto saving</span>
        <span class="c1"># do we want comment options?</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;column_names_begin_token&quot;</span><span class="p">:</span> <span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;data_delimiter&quot;</span><span class="p">:</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;column_names&quot;</span><span class="p">:</span> <span class="n">column_names</span><span class="p">,</span>
                   <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">wparameter_data</span><span class="p">,</span> <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Wave_Parameters&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;One_Port&quot;</span><span class="p">,</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="s2">&quot;w1p&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;column_types&quot;</span><span class="p">:[</span><span class="s2">&quot;float&quot;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;w1p_options&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;w1p_options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
        <span class="n">w1p</span> <span class="o">=</span> <span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w1p</span>

    <span class="k">def</span> <span class="nf">measure_w2p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers a single w2p measurement for a specified</span>
<span class="sd">        port and returns a w2p object.&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="s2">&quot;port1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;port2&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                    <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;w2p_options&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;trigger&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;single&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>
            <span class="c1"># now go to sleep for the time to take the scan</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>

        <span class="c1"># wait for other functions to be completed</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="c1"># Set the format to ascii and set up sweep definitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
        <span class="c1"># First get the A and B lists drive port 1</span>
        <span class="c1"># Note this could be a loop over the list = [a1_d1,b1_d1,b2_d1...,b2_d2]</span>
        <span class="n">waveparameter_names</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">drive_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
            <span class="k">for</span> <span class="n">detect_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
                <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">]:</span>
                    <span class="n">waveparameter_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{0}{1}_D{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span><span class="n">detect_port</span><span class="p">,</span><span class="n">drive_port</span><span class="p">))</span>
        <span class="c1"># now get data for all of them</span>
        <span class="n">all_wave_raw_string</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">waveparameter</span> <span class="ow">in</span> <span class="n">waveparameter_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">waveparameter</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
            <span class="n">all_wave_raw_string</span> <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">))</span>

        <span class="c1"># String Parsing</span>
        <span class="n">all_wave_list</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_wave_raw_string</span><span class="p">]</span>
        <span class="c1"># Construct a list of lists that is data in RI format</span>
        <span class="n">re_all_wave_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_list</span> <span class="ow">in</span> <span class="n">all_wave_list</span><span class="p">]</span>
        <span class="n">im_all_wave_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_list</span> <span class="ow">in</span> <span class="n">all_wave_list</span><span class="p">]</span>
        <span class="n">wparameter_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
            <span class="n">re_row</span><span class="o">=</span><span class="p">[</span><span class="n">re</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">re</span> <span class="ow">in</span> <span class="n">re_all_wave_list</span> <span class="p">]</span>
            <span class="n">im_row</span><span class="o">=</span><span class="p">[</span><span class="n">im</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">im_all_wave_list</span><span class="p">]</span>
            <span class="n">wave_row</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">re_row</span><span class="p">):</span>
                <span class="n">wave_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">wave_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im_row</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span> <span class="o">/</span> <span class="mf">10.</span> <span class="o">**</span> <span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="n">wave_row</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
            <span class="n">wparameter_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="n">waveparameter_column_names</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">drive_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
            <span class="k">for</span> <span class="n">detect_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
                <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">complex_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;re&quot;</span><span class="p">,</span><span class="s2">&quot;im&quot;</span><span class="p">]:</span>
                        <span class="n">waveparameter_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{3}{0}{1}_D{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span>
                                                                                  <span class="n">detect_port</span><span class="p">,</span>
                                                                                  <span class="n">drive_port</span><span class="p">,</span>
                                                                                  <span class="n">complex_type</span><span class="p">))</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">waveparameter_column_names</span>
        <span class="c1"># add some options here about auto saving</span>
        <span class="c1"># do we want comment options?</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;column_names_begin_token&quot;</span><span class="p">:</span> <span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;data_delimiter&quot;</span><span class="p">:</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;column_names&quot;</span><span class="p">:</span> <span class="n">column_names</span><span class="p">,</span>
                   <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">wparameter_data</span><span class="p">,</span> <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Wave_Parameters&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Two_Port&quot;</span><span class="p">,</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="s2">&quot;w2p&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;column_types&quot;</span><span class="p">:[</span><span class="s2">&quot;float&quot;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;w2p_options&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;w2p_options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
        <span class="n">w2p</span> <span class="o">=</span> <span class="n">W2P</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w2p</span>

<span class="k">class</span> <span class="nc">PowerMeter</span><span class="p">(</span><span class="n">VisaInstrument</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Controls power meters&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the power meter to a state with W units&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*RST&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;UNIT:POW W&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frequency</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">9</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the frequency of the power meter&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frequency</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns the frequency of the power meter&quot;</span>
        <span class="n">frequency</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes and fetches a reading&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;FETCh?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the power meters units, acceptable units are W or adBM&quot;&quot;&quot;</span>
        <span class="c1"># Todo put an input checker on this to only allow desired commands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;UNIT:POW {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the power meters units&quot;&quot;&quot;</span>
        <span class="c1"># Todo put an input checker on this to only allow desired commands</span>
        <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;UNIT:POW?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unit</span>

<span class="k">class</span> <span class="nc">NRPPowerMeter</span><span class="p">(</span><span class="n">PowerMeter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Controls RS power meters&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the power meter to a state with W units, 10ms aperture and Avgerage power readings&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*RST&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;UNIT:POW W&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FUNC POW:AVG&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:APER 10 MS&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">HighSpeedOscope</span><span class="p">(</span><span class="n">VisaInstrument</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Control Class for high speed oscilloscopes. Based on code from Diogo &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the oscilloscope  for data collection&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
        <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">measure_waves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns data for a measurement in an AsciiDataTable&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;number_frames&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_points</span><span class="p">(),</span>
                    <span class="s2">&quot;timebase_scale&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timebase_scale</span><span class="p">(),</span> <span class="s2">&quot;channels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                    <span class="s2">&quot;initial_time_offset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time_position</span><span class="p">(),</span> <span class="s2">&quot;timeout_measurement&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
                    <span class="s2">&quot;save_data&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;data_format&quot;</span><span class="p">:</span> <span class="s2">&quot;dat&quot;</span><span class="p">,</span> <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                    <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Scope&quot;</span><span class="p">,</span> <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Measurement&quot;</span><span class="p">,</span> <span class="s2">&quot;add_header&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s2">&quot;output_table_options&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;data_delimiter&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;treat_header_as_comment&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
                    <span class="s2">&quot;download_format&quot;</span><span class="p">:</span><span class="s2">&quot;ASCII&quot;</span><span class="p">,</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">start_timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;The .measure_waves method began at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start_timer</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_number_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span>
        <span class="n">channel_string_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CHAN1&quot;</span><span class="p">,</span> <span class="s2">&quot;CHAN2&quot;</span><span class="p">,</span> <span class="s2">&quot;CHAN3&quot;</span><span class="p">,</span> <span class="s2">&quot;CHAN4&quot;</span><span class="p">]</span>

        <span class="c1"># begin by setting timeout to timeout_measurement</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timeout_measurement&quot;</span><span class="p">]</span>

        <span class="c1"># now calculate timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timebase_scale&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span>
        <span class="n">time_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">]</span>

        <span class="c1"># now configure the scope for data transfer</span>
        <span class="c1"># define the way the data is transmitted from the instrument to the PC</span>
        <span class="c1"># Word -&gt; 16bit signed integer</span>
        <span class="c1"># now we choose if you want it to be bin or ASCII</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;asc&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;download_format&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:FORM ASCII&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:FORM WORD&#39;</span><span class="p">)</span>
            <span class="c1"># little-endian</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:BYT LSBF&#39;</span><span class="p">)</span>
        <span class="n">number_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_frames&quot;</span><span class="p">]</span>
        <span class="c1"># this is the way diogo did it</span>
        <span class="c1"># number of points</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">setup_timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">time_difference</span><span class="o">=</span><span class="n">setup_timer</span><span class="o">-</span><span class="n">start_timer</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;The setup of the sweep finished at {0} and took {1} seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">setup_timer</span><span class="p">,</span><span class="n">time_difference</span><span class="p">)))</span>
        <span class="n">frames_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">frame_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_frames&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
                <span class="n">frame_timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">time_difference</span><span class="o">=</span><span class="n">frame_timer</span><span class="o">-</span><span class="n">start_timer</span>
                <span class="k">print</span><span class="p">((</span><span class="s2">&quot; Frame {0} began at {1}, {2} seconds from measure_waves begin &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frame_index</span><span class="p">,</span>
                                                                                              <span class="n">frame_timer</span><span class="p">,</span>
                                                                                              <span class="n">time_difference</span><span class="o">.</span><span class="n">seconds</span><span class="p">)))</span>
            <span class="n">new_frame</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># calculate time position for this frame</span>
            <span class="n">time_position</span> <span class="o">=</span> <span class="n">frame_index</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timebase_scale&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span>
                <span class="s2">&quot;initial_time_offset&quot;</span><span class="p">]</span>

            <span class="c1"># define postion to start the acquisition</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TIM:POS {0}ns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_position</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
                <span class="n">timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Writing Channel Command at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>

            <span class="c1"># acquire channels desired</span>
            <span class="n">channel_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">channel_index</span><span class="p">,</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">channel_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">channel_string</span> <span class="o">=</span> <span class="n">channel_string</span> <span class="o">+</span> <span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_string_list</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">channel_string</span> <span class="o">=</span> <span class="n">channel_string</span> <span class="o">+</span> <span class="s2">&quot;{0},&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_string_list</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">channel_command</span> <span class="o">=</span> <span class="s2">&quot;:DIG {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">channel_command</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
                <span class="n">timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Finished Writing Channel Command at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
            <span class="c1"># trigger reading and wait</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*OPC?&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
                <span class="n">timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Finshed Trigger Command and Started to Read Channels at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
            <span class="c1"># get data from the necessary channels</span>
            <span class="k">for</span> <span class="n">channel_read_index</span><span class="p">,</span> <span class="n">channel_read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]):</span>
                <span class="c1"># get data for channel 1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:SOUR CHAN{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_read</span><span class="p">))</span>
                <span class="c1"># get data</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;asc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;download_format&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                    <span class="n">data_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:WAV:DATA?&#39;</span><span class="p">)</span>
                    <span class="n">data_column</span> <span class="o">=</span> <span class="n">data_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;1-&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># This downloads the data as signed 16bit ints</span>
                    <span class="c1"># Need a conversion to volts</span>
                    <span class="n">data_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query_binary_values</span><span class="p">(</span><span class="s1">&#39;:WAV:DATA?&#39;</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>


                <span class="n">new_frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_column</span><span class="p">)</span>
                <span class="c1"># print(&quot;{0} is {1}&quot;.format(&quot;data_column&quot;,data_column))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
                    <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                    <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Finshed Data Acquistion for Channel {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_read</span><span class="p">,</span><span class="n">timer</span><span class="p">)))</span>
            <span class="n">frames_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_frame</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data Manipulation Began at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
        <span class="c1"># reshape measurement data</span>
        <span class="n">measurement_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_points</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames_data</span><span class="p">))]</span>
        <span class="c1">#         print(len(measurement_data))</span>
        <span class="c1">#         print(len(measurement_data[0]))</span>
        <span class="c1">#         print(&quot;{0} is{1}&quot;.format(&quot;len(frames_data)&quot;,len(frames_data)))</span>
        <span class="c1">#         print(&quot;{0} is{1}&quot;.format(&quot;len(frames_data[0])&quot;,len(frames_data[0])))</span>
        <span class="c1">#         print(&quot;{0} is{1}&quot;.format(&quot;len(frames_data[0][0])&quot;,len(frames_data[0][0])))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data reshaping step1 ended at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">frame_index</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frames_data</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">column_index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">column</span><span class="p">):</span>
                    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                    <span class="c1"># print(&quot;{0} is {1}&quot;.format(&quot;([row_index+frame_index*number_rows],[column_index],[frame_index])&quot;,</span>
                    <span class="c1">#([row_index + frame_index * number_rows], [column_index], [frame_index])))</span>
                    <span class="n">measurement_data</span><span class="p">[</span><span class="n">row_index</span> <span class="o">+</span> <span class="n">frame_index</span> <span class="o">*</span> <span class="n">number_rows</span><span class="p">][</span><span class="n">column_index</span><span class="p">]</span> <span class="o">=</span><span class="n">frames_data</span><span class="p">[</span><span class="n">frame_index</span><span class="p">][</span><span class="n">column_index</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data reshaping step 2 ended at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
        <span class="c1"># reset timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="n">data_out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">time_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;initial_time_offset&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">data_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">measurement_data</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_start</span> <span class="o">+</span> <span class="n">row_index</span> <span class="o">*</span> <span class="n">time_step</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_row</span>
            <span class="n">data_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;add_header&quot;</span><span class="p">]:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{0} = {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]:</span>
            <span class="n">column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_string_list</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">table_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data_out</span><span class="p">,</span>
                         <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="n">header</span><span class="p">,</span>
                         <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                         <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                         <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="s2">&quot;dat&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span>
                         <span class="s2">&quot;column_names&quot;</span><span class="p">:</span> <span class="n">column_names</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;asc&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;download_format&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">table_options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table_options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;int&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;output_table_options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">table_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">output_table</span> <span class="o">=</span> <span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">table_options</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;save_data&quot;</span><span class="p">]:</span>
            <span class="n">data_save_path</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                                       <span class="n">general_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                                       <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span>
                                       <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;dat&#39;</span>
                                       <span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">output_table</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">data_save_path</span>
            <span class="n">output_table</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data Manipulation Ended at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">output_table</span>


    <span class="k">def</span> <span class="nf">get_error_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the error state of the oscope&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:SYSTEM:ERROR? STRING&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_state</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">return</span> <span class="n">state</span>


    <span class="k">def</span> <span class="nf">set_number_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_points</span><span class="o">=</span><span class="mi">16384</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the number of points for the acquisition&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:ACQ:POINTS {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number_points</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_number_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the number of points in the waveform&quot;&quot;&quot;</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:ACQ:POINTS?&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">number_points</span>


    <span class="k">def</span> <span class="nf">set_time_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the time in ns to start the acquisition&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TIM:POS {0}ns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_time_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the time position in ns&quot;&quot;&quot;</span>
        <span class="n">position</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:TIM:POS?&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">position</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span>


    <span class="k">def</span> <span class="nf">set_timebase_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_scale</span><span class="o">=</span><span class="mf">40.96</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the timebase scale in ns&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TIM:SCAL {0}ns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_scale</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_timebase_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the timebase scale in ns&quot;&quot;&quot;</span>
        <span class="n">time_scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:TIM:SCAL?&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">time_scale</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span>


    <span class="k">def</span> <span class="nf">set_trigger_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;FPAN&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the tigger source, &#39;FPAN&#39; Frontpanel or &#39;FRUN&#39; freerun&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TRIG:SOUR {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_trigger_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the trigger source FPAN for FrontPanel or FRUN for free run&quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:TRIG:SOUR?&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_trigger_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the trigger level in mv&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TRIG:LEV {0}m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_trigger_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the trigger level&quot;&quot;&quot;</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:TRIG:LEV?&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_channel_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the scale in mv of channel. Default is 10mv/division on channel 1&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:SCAL {1}m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">scale</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_channel_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="s2">&quot;Returns the scale for a specified channel, the default is channel 1&quot;</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:SCAL?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">scale</span>

    <span class="k">def</span> <span class="nf">set_channel_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the scale in mv of channel. Default is 10mv/division on channel 1&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:OFFSet {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_channel_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="s2">&quot;Returns the scale for a specified channel, the default is channel 1&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:OFFSet?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">offset</span>

    <span class="k">def</span> <span class="nf">set_channel_bandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="s2">&quot;LOW&quot;</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the specified channel&#39;s bandwith to LOW, MED or HIGH, default is to set channel 1 to LOW&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:BAND {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_channel_bandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the selected channels bandwidth&quot;&quot;&quot;</span>
        <span class="n">bandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:BAND?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">bandwidth</span>


    <span class="k">def</span> <span class="nf">set_trigger_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slope</span><span class="o">=</span><span class="s2">&quot;POS&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the trigger slope on the oscope choose from POS or NEG&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TRIG:SLOP {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_trigger_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the trigger slope either POS or NEG&quot;&quot;&quot;</span>
        <span class="n">slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:TRIG:SLOP?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slope</span>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1"># Module Scripts</span>

<span class="k">def</span> <span class="nf">test_determine_instrument_type</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="s1">&#39;GPIB::22&#39;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="s1">&#39;COMM::1&#39;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="s1">&#39;CoMm::1&#39;</span><span class="p">))</span> 
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="s1">&#39;SRS830&#39;</span><span class="p">))</span> 
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="s1">&#39;36111&#39;</span><span class="p">))</span> 
    <span class="k">class</span> <span class="nc">blank</span><span class="p">():</span><span class="k">pass</span>
    <span class="n">new</span><span class="o">=</span><span class="n">blank</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>
    <span class="n">new</span><span class="o">.</span><span class="n">instrument_type</span><span class="o">=</span><span class="s1">&#39;Ocean_Optics&#39;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">instrument_type</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>
    <span class="n">TF</span><span class="o">=</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">InstanceType</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ClassType</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">TF</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;instrument_type&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>
        


<span class="k">def</span> <span class="nf">test_find_description</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Tests the function find description&quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The path of the description of </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;Lockin2&#39;</span><span class="p">,</span><span class="n">find_description</span><span class="p">(</span><span class="s1">&#39;Lockin2&#39;</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The File Contents are:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">find_description</span><span class="p">(</span><span class="s1">&#39;Lockin2&#39;</span><span class="p">,</span><span class="s1">&#39;file&#39;</span><span class="p">))</span>
     
<span class="k">def</span> <span class="nf">test_VisaInstrument</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;GPIB::21&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Simple test of the VisaInstrument class&quot;&quot;&quot;</span>
    <span class="n">instrument</span><span class="o">=</span><span class="n">VisaInstrument</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
    <span class="c1">#print instrument.ask(&#39;*IDN?&#39;)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">instrument</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">idn</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Writing 0 volts to AUX4&#39;</span><span class="p">)</span>
    <span class="n">instrument</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;AUXV 4,&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>

<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1"># Module Runner       </span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1">#test_IV()</span>
    <span class="c1">#test_find_description()</span>
    <span class="n">test_VisaInstrument</span><span class="p">()</span>
    <span class="c1">#user_terminate=raw_input(&quot;Please Press Any key To Finish:&quot;)</span>
    
</pre></div>

  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.determine_instrument_type">
    <p>def <span class="ident">determine_instrument_type</span>(</p><p>object)</p>
    </div>
    

    
  
    <div class="desc"><p>Tries to return an instrument type given an address, name, serial #
or class instance</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.determine_instrument_type', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.determine_instrument_type" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">determine_instrument_type</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tries to return an instrument type given an address, name, serial #</span>
<span class="sd">     or class instance&quot;&quot;&quot;</span>
    <span class="c1"># attributes that normally have the type hidden in there</span>
    <span class="c1"># should be in the order of likelyhood </span>
    <span class="n">attritbute_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;instrument_type&#39;</span><span class="p">,</span><span class="s1">&#39;address&#39;</span><span class="p">,</span><span class="s1">&#39;serial&#39;</span><span class="p">,</span><span class="s1">&#39;Id&#39;</span><span class="p">]</span> 
    <span class="c1"># Check to see if it is a string and then go through the possibilities</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span> <span class="ow">in</span> <span class="n">StringTypes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">determine_instrument_type_from_string</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="c1"># If it is a object or class look around in normal names looking for a string</span>
    <span class="c1"># to process</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">InstanceType</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ClassType</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">attritbute_names</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                    <span class="n">string</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;object.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">attribute</span><span class="p">)</span>
                    <span class="n">answer</span><span class="o">=</span><span class="n">determine_instrument_type_from_string</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">answer</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span><span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">answer</span> 
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>        
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">string</span><span class="o">=</span><span class="nb">object</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                    <span class="k">return</span> <span class="n">determine_instrument_type_from_string</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span> <span class="k">pass</span> 
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.determine_instrument_type_from_string">
    <p>def <span class="ident">determine_instrument_type_from_string</span>(</p><p>string)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a string returns the instrument type</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.determine_instrument_type_from_string', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.determine_instrument_type_from_string" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">determine_instrument_type_from_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Given a string returns the instrument type&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">in</span> <span class="n">StringTypes</span><span class="p">:</span>
         <span class="c1"># Start with the easy ones</span>
         <span class="k">for</span> <span class="n">instrument_type</span> <span class="ow">in</span> <span class="n">INSTRUMENT_TYPES</span><span class="p">:</span>
            <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">instrument_type</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="n">string</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">instrument_type</span>
         <span class="c1"># Now read in all the Instrument sheets and look for a match</span>
         <span class="c1"># Returning the Name in the Instrument_Type Tag</span>
         <span class="n">instrument_folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">instrument_sheet</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">instrument_folder</span><span class="p">):</span>
             <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">,</span><span class="n">instrument_sheet</span><span class="p">)</span>
             <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">text</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
                    <span class="n">tag_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                    <span class="s1">&#39;&lt;Instrument_Type&gt;(?P&lt;instrument_type&gt;\w+)&lt;/Instrument_Type&gt;&#39;</span><span class="p">,</span>
                    <span class="n">text</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">tag_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;instrument_type&#39;</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span><span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.find_description">
    <p>def <span class="ident">find_description</span>(</p><p>identifier, output=&#39;path&#39;, directory=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Finds an instrument description in pyMez/Instruments given an identifier, 
outputs a path or the file. Right now this outputs the first sheet that matches the identifier</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.find_description', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.find_description" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">find_description</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;path&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Finds an instrument description in pyMez/Instruments given an identifier, </span>
<span class="sd">    outputs a path or the file. Right now this outputs the first sheet that matches the identifier&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Now read in all the Instrument sheets and look for a match</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">instrument_folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">instrument_folder</span><span class="o">=</span><span class="n">directory</span>
        <span class="k">for</span> <span class="n">instrument_sheet</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">instrument_folder</span><span class="p">):</span>
            <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">,</span><span class="n">instrument_sheet</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">text</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
                    <span class="n">path_out</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;name|path&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
                    <span class="n">file_contents</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;file|xml|node|contents&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">path_out</span><span class="p">,</span><span class="n">output</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">path</span>
                    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">file_contents</span><span class="p">,</span><span class="n">output</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">text</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.fix_segment_table">
    <p>def <span class="ident">fix_segment_table</span>(</p><p>segment_table)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a list of dictionaries in the form [{"start":start_frequency,
"stop":stop_frequency,"number_points":number_points,"step":frequency_step}...] returns a table that is ordered by start
frequency and has no overlapping points</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.fix_segment_table', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.fix_segment_table" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fix_segment_table</span><span class="p">(</span><span class="n">segment_table</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a list of dictionaries in the form [{&quot;start&quot;:start_frequency,</span>
<span class="sd">    &quot;stop&quot;:stop_frequency,&quot;number_points&quot;:number_points,&quot;step&quot;:frequency_step}...] returns a table that is ordered by start</span>
<span class="sd">    frequency and has no overlapping points&quot;&quot;&quot;</span>
    <span class="n">segment_table</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">segment_table</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">])</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment_table</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;stop&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]:</span>
            <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;step&quot;</span><span class="p">]</span>
            <span class="n">segment_table</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;number_points&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">segment_table</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.test_VisaInstrument">
    <p>def <span class="ident">test_VisaInstrument</span>(</p><p>address=&#39;GPIB::21&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Simple test of the VisaInstrument class</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.test_VisaInstrument', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.test_VisaInstrument" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">test_VisaInstrument</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;GPIB::21&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Simple test of the VisaInstrument class&quot;&quot;&quot;</span>
    <span class="n">instrument</span><span class="o">=</span><span class="n">VisaInstrument</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
    <span class="c1">#print instrument.ask(&#39;*IDN?&#39;)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">instrument</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">idn</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Writing 0 volts to AUX4&#39;</span><span class="p">)</span>
    <span class="n">instrument</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;AUXV 4,&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.test_determine_instrument_type">
    <p>def <span class="ident">test_determine_instrument_type</span>(</p><p>)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.test_determine_instrument_type', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.test_determine_instrument_type" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">test_determine_instrument_type</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="s1">&#39;GPIB::22&#39;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="s1">&#39;COMM::1&#39;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="s1">&#39;CoMm::1&#39;</span><span class="p">))</span> 
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="s1">&#39;SRS830&#39;</span><span class="p">))</span> 
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="s1">&#39;36111&#39;</span><span class="p">))</span> 
    <span class="k">class</span> <span class="nc">blank</span><span class="p">():</span><span class="k">pass</span>
    <span class="n">new</span><span class="o">=</span><span class="n">blank</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>
    <span class="n">new</span><span class="o">.</span><span class="n">instrument_type</span><span class="o">=</span><span class="s1">&#39;Ocean_Optics&#39;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">instrument_type</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Type is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">determine_instrument_type</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>
    <span class="n">TF</span><span class="o">=</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">InstanceType</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ClassType</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">TF</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;instrument_type&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.test_find_description">
    <p>def <span class="ident">test_find_description</span>(</p><p>)</p>
    </div>
    

    
  
    <div class="desc"><p>Tests the function find description</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.test_find_description', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.test_find_description" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">test_find_description</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Tests the function find description&quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The path of the description of </span><span class="si">%s</span><span class="s2"> is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;Lockin2&#39;</span><span class="p">,</span><span class="n">find_description</span><span class="p">(</span><span class="s1">&#39;Lockin2&#39;</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The File Contents are:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">find_description</span><span class="p">(</span><span class="s1">&#39;Lockin2&#39;</span><span class="p">,</span><span class="s1">&#39;file&#39;</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.whos_there">
    <p>def <span class="ident">whos_there</span>(</p><p>)</p>
    </div>
    

    
  
    <div class="desc"><p>Whos_there is a function that prints the idn string for all
GPIB instruments connected</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.whos_there', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.whos_there" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">whos_there</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Whos_there is a function that prints the idn string for all</span>
<span class="sd">    GPIB instruments connected&quot;&quot;&quot;</span>
    <span class="n">resource_manager</span> <span class="o">=</span> <span class="n">visa</span><span class="o">.</span><span class="n">ResourceManager</span><span class="p">()</span>
    <span class="n">resource_list</span><span class="o">=</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">list_resources</span><span class="p">()</span>
    <span class="n">gpib_resources</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">gpib_idn_dictionary</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">resource_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;GPIB&quot;</span><span class="p">,</span><span class="n">instrument</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">resource</span><span class="o">=</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="n">instrument</span><span class="p">)</span>
            <span class="n">gpib_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
            <span class="n">idn</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;*IDN?&quot;</span><span class="p">)</span>
            <span class="n">gpib_idn_dictionary</span><span class="p">[</span><span class="n">instrument</span><span class="p">]</span><span class="o">=</span><span class="n">idn</span>
    <span class="k">if</span> <span class="n">gpib_resources</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">instrument_name</span><span class="p">,</span><span class="n">idn</span> <span class="ow">in</span> <span class="n">gpib_idn_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;{0} is at address {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idn</span><span class="p">,</span><span class="n">instrument_name</span><span class="p">)))</span>
        <span class="c1">#return gpib_idn_dictionary</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;There are no GPIB resources available&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument" class="name">class <span class="ident">FakeInstrument</span></p>
      
  
    <div class="desc"><p>General Class to communicate with COMM and GPIB instruments
This is a blend of the pyvisa resource and an xml description.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">FakeInstrument</span><span class="p">(</span><span class="n">InstrumentSheet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; General Class to communicate with COMM and GPIB instruments</span>
<span class="sd">    This is a blend of the pyvisa resource and an xml description. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Intializes the VisaInstrument Class&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                    <span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span> <span class="s1">&#39;Instruments&#39;</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># First we try to look up the description and get info from it</span>
        <span class="k">if</span> <span class="n">DATA_SHEETS</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span> <span class="o">=</span> <span class="n">find_description</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span>
                                                  <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">])</span>
                <span class="n">InstrumentSheet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_query_dictionary</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The information sheet was not found defaulting to address&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span> <span class="o">=</span> <span class="n">resource_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">resource_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span> <span class="o">=</span> <span class="n">resource_name</span>

        <span class="c1"># Create a description for state saving</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_buffer</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_buffer</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">=</span><span class="p">[]</span>
        <span class="c1">#self.resource_manager = visa.ResourceManager()</span>
        <span class="c1"># Call the visa instrument class-- this gives ask,write,read</span>
        <span class="c1">#self.resource = self.resource_manager.open_resource(self.instrument_address)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command to instrument&quot;</span>
        <span class="n">now</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">:</span><span class="n">now</span><span class="p">,</span><span class="s2">&quot;Action&quot;</span><span class="p">:</span><span class="s2">&quot;self.write&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;Argument&quot;</span><span class="p">:</span><span class="n">command</span><span class="p">,</span><span class="s2">&quot;Response&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">})</span>


    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Reads from the instrument&quot;</span>
        <span class="n">now</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">out</span><span class="o">=</span><span class="s2">&quot;Buffer Read at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">001</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">:</span><span class="n">now</span><span class="p">,</span><span class="s2">&quot;Action&quot;</span><span class="p">:</span><span class="s2">&quot;self.read&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;Argument&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Response&quot;</span><span class="p">:</span><span class="n">out</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command and then reads a response&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command and then reads a response&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the instrument to the state specified by Command:Value pairs&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">state_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">state_table</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">state_table</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="c1"># now we need to write the command</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_table</span><span class="p">:</span>
                <span class="c1"># a state row has a set and value</span>
                <span class="n">state_command</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_query_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the current state of the instrument. get_state accepts any query dictionary in</span>
<span class="sd">        the form state_query_dictionary={&quot;GPIB_SET_COMMAND&quot;:&quot;GPIB_QUERY_COMMAND&quot;,...} or any state_query_table</span>
<span class="sd">        in the form [{&quot;Set&quot;:&quot;GPIB_SET_COMMAND&quot;,&quot;Query&quot;:&quot;GPIB_QUERY_COMMAND&quot;,&quot;Index&quot;:Optional_int_ordering commands,</span>
<span class="sd">        if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state_query_table</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state_query_dictionary</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_query_dictionary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">state_query_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span>
            <span class="n">state</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">state_command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span> <span class="n">query</span>
                          <span class="ow">in</span> <span class="n">state_query_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="k">return</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># a state_query_table is a list of dictionaries, each row has at least a Set and Query key but could</span>
            <span class="c1"># have an Index key that denotes order</span>
            <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">state_query_table</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]))</span>
                <span class="n">state</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                    <span class="nb">set</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                    <span class="n">query</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;Index&quot;</span><span class="p">:</span> <span class="n">index</span><span class="p">})</span>
                <span class="k">return</span> <span class="n">state</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                    <span class="nb">set</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                    <span class="n">query</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)})</span>
                <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">update_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves the state in self.current_state attribute &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">state_path</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">general_descriptor</span><span class="o">=</span><span class="s2">&quot;State&quot;</span><span class="p">,</span>
                                   <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;state_directory&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
            <span class="n">new_state</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span> <span class="n">state_dictionary</span><span class="p">,</span>
                                                 <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="n">new_state</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_table&quot;</span><span class="p">:</span> <span class="n">state_table</span><span class="p">,</span>
                                                 <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_state</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
                                                 <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_state</span><span class="o">.</span><span class="n">add_state_description</span><span class="p">()</span>
            <span class="n">new_state</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">description_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>  <span class="c1"># pass</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state_path</span>

    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads a state from a file.&quot;&quot;&quot;</span>
        <span class="c1"># TODO put a UDT to state_table</span>
        <span class="n">state_model</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state_table</span><span class="o">=</span><span class="n">state_model</span><span class="o">.</span><span class="n">get_state_list_dictionary</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes the VISA session&quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Fake Instrument has been closed&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.FakeInstrument">FakeInstrument</a></li>
          <li>Code.DataHandlers.XMLModels.InstrumentSheet</li>
          <li>Code.DataHandlers.XMLModels.XMLBase</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, resource_name=None, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Intializes the VisaInstrument Class</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Intializes the VisaInstrument Class&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                <span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span> <span class="s1">&#39;Instruments&#39;</span><span class="p">)}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c1"># First we try to look up the description and get info from it</span>
    <span class="k">if</span> <span class="n">DATA_SHEETS</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span> <span class="o">=</span> <span class="n">find_description</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span>
                                              <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">])</span>
            <span class="n">InstrumentSheet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_query_dictionary</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The information sheet was not found defaulting to address&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span> <span class="o">=</span> <span class="n">resource_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">resource_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span> <span class="o">=</span> <span class="n">resource_name</span>
    <span class="c1"># Create a description for state saving</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_buffer</span><span class="o">=</span><span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">read_buffer</span><span class="o">=</span><span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1">#self.resource_manager = visa.ResourceManager()</span>
    <span class="c1"># Call the visa instrument class-- this gives ask,write,read</span>
    <span class="c1">#self.resource = self.resource_manager.open_resource(self.instrument_address)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.add_entry">
    <p>def <span class="ident">add_entry</span>(</p><p>self, tag_name, text=None, description=&#39;Specific&#39;, **attribute_dictionary)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds an entry to the instrument sheet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.add_entry', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.add_entry" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag_name</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">attribute_dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds an entry to the instrument sheet.&quot;&quot;&quot;</span>
    <span class="n">specific_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">general_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">specific_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Specific_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">general_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;General_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_entry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">text_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">text_node</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">attribute_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_attribute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">creatAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttributeNode</span><span class="p">(</span><span class="n">new_attribute</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">description_node</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">new_entry</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.ask">
    <p>def <span class="ident">ask</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.ask', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.ask" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.close">
    <p>def <span class="ident">close</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Closes the VISA session</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.close', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.close" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Closes the VISA session&quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Fake Instrument has been closed&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_image_path">
    <p>def <span class="ident">get_image_path</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Tries to return the image path, requires image to be in
<Image href="http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg"/> format</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_image_path', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_image_path" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_image_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tries to return the image path, requires image to be in</span>
<span class="sd">    &lt;Image href=&quot;http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg&quot;/&gt; format&quot;&quot;&quot;</span>
    <span class="c1"># Take the first thing called Image</span>
    <span class="n">image_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Image&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">image_path</span><span class="o">=</span><span class="n">image_node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_query_dictionary">
    <p>def <span class="ident">get_query_dictionary</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a set:query dictionary if there is a State_Commands element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_query_dictionary', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_query_dictionary" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_query_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a set:query dictionary if there is a State_Commands element&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">state_commands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;State_Commands&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">state_query_dictionary</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Set&#39;</span><span class="p">)</span>
        <span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Query&#39;</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">state_commands</span><span class="o">.</span><span class="n">childNodes</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeType</span> <span class="ow">is</span> \
        <span class="n">NODE_TYPE_DICTIONARY</span><span class="p">[</span><span class="s1">&#39;ELEMENT_NODE&#39;</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">state_query_dictionary</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_state">
    <p>def <span class="ident">get_state</span>(</p><p>self, state_query_dictionary=None, state_query_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Gets the current state of the instrument. get_state accepts any query dictionary in
the form state_query_dictionary={"GPIB_SET_COMMAND":"GPIB_QUERY_COMMAND",...} or any state_query_table
in the form [{"Set":"GPIB_SET_COMMAND","Query":"GPIB_QUERY_COMMAND","Index":Optional_int_ordering commands,
if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.get_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_query_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Gets the current state of the instrument. get_state accepts any query dictionary in</span>
<span class="sd">    the form state_query_dictionary={&quot;GPIB_SET_COMMAND&quot;:&quot;GPIB_QUERY_COMMAND&quot;,...} or any state_query_table</span>
<span class="sd">    in the form [{&quot;Set&quot;:&quot;GPIB_SET_COMMAND&quot;,&quot;Query&quot;:&quot;GPIB_QUERY_COMMAND&quot;,&quot;Index&quot;:Optional_int_ordering commands,</span>
<span class="sd">    if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">state_query_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state_query_dictionary</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_query_dictionary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">state_query_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">state_command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span> <span class="n">query</span>
                      <span class="ow">in</span> <span class="n">state_query_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">state</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># a state_query_table is a list of dictionaries, each row has at least a Set and Query key but could</span>
        <span class="c1"># have an Index key that denotes order</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_query_table</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]))</span>
            <span class="n">state</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;Index&quot;</span><span class="p">:</span> <span class="n">index</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)})</span>
            <span class="k">return</span> <span class="n">state</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.load_state">
    <p>def <span class="ident">load_state</span>(</p><p>self, file_path)</p>
    </div>
    

    
  
    <div class="desc"><p>Loads a state from a file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.load_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.load_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads a state from a file.&quot;&quot;&quot;</span>
    <span class="c1"># TODO put a UDT to state_table</span>
    <span class="n">state_model</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state_table</span><span class="o">=</span><span class="n">state_model</span><span class="o">.</span><span class="n">get_state_list_dictionary</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.query">
    <p>def <span class="ident">query</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.query', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.query" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.read">
    <p>def <span class="ident">read</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Reads from the instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.read', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.read" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Reads from the instrument&quot;</span>
    <span class="n">now</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">out</span><span class="o">=</span><span class="s2">&quot;Buffer Read at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">read_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">001</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">:</span><span class="n">now</span><span class="p">,</span><span class="s2">&quot;Action&quot;</span><span class="p">:</span><span class="s2">&quot;self.read&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;Argument&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Response&quot;</span><span class="p">:</span><span class="n">out</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">out</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save">
    <p>def <span class="ident">save</span>(</p><p>self, path=None)</p>
    </div>
    

    
  
    <div class="desc"><p>" Saves as an XML file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot; Saves as an XML file&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span>
    <span class="n">file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_HTML">
    <p>def <span class="ident">save_HTML</span>(</p><p>self, file_path=None, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves a HTML transformation of the XML document using XLST at file_path. Defaults to
an XLST in self.options["XSLT"] and file_path=self.path.replace('.xml','.html')</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves a HTML transformation of the XML document using XLST at file_path. Defaults to</span>
<span class="sd">    an XLST in self.options[&quot;XSLT&quot;] and file_path=self.path.replace(&#39;.xml&#39;,&#39;.html&#39;)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">HTML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">(</span><span class="n">XSLT</span><span class="o">=</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="c1">#print type(HTML)</span>
    <span class="k">if</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span><span class="s1">&#39;.html&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_current_state">
    <p>def <span class="ident">save_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves the state in self.current_state attribute</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves the state in self.current_state attribute &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_state">
    <p>def <span class="ident">save_state</span>(</p><p>self, state_path=None, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.save_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">state_path</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">general_descriptor</span><span class="o">=</span><span class="s2">&quot;State&quot;</span><span class="p">,</span>
                               <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;state_directory&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="n">new_state</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span> <span class="n">state_dictionary</span><span class="p">,</span>
                                             <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="n">new_state</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_table&quot;</span><span class="p">:</span> <span class="n">state_table</span><span class="p">,</span>
                                             <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_state</span> <span class="o">=</span> <span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
                                             <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">add_state_description</span><span class="p">()</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">description_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>  <span class="c1"># pass</span>
    <span class="n">new_state</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.set_state">
    <p>def <span class="ident">set_state</span>(</p><p>self, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the instrument to the state specified by Command:Value pairs</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.set_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.set_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Sets the instrument to the state specified by Command:Value pairs&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">state_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_table</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">state_table</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="c1"># now we need to write the command</span>
        <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="c1"># a state row has a set and value</span>
            <span class="n">state_command</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.show">
    <p>def <span class="ident">show</span>(</p><p>self, mode=&#39;Window&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Displays a XML Document either as formatted text in the command line or in a
window (using wx)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.show', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.show" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;Window&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Displays a XML Document either as formatted text in the command line or in a</span>
<span class="sd">    window (using wx)&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">tag_to_tagName</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tagName</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span><span class="s1">&#39;cmd line&#39;</span><span class="p">,</span><span class="s1">&#39;cmd&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Entry Index: </span><span class="si">%s</span><span class="s1"> </span><span class="se">\t</span><span class="s1">Date: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span>
            <span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;xml&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Window|wx&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">wx</span>
            <span class="kn">import</span> <span class="nn">wx.html2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Cannot locate wx, please add to sys.path&#39;</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">html2</span><span class="o">.</span><span class="n">WebView</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">.</span><span class="n">SetPage</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">()),</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.to_HTML">
    <p>def <span class="ident">to_HTML</span>(</p><p>self, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns HTML string by applying a XSL to the XML document</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.to_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.to_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">to_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns HTML string by applying a XSL to the XML document&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">XSL_data</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="n">XSL_transform</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">XSLT</span><span class="p">(</span><span class="n">XSL_data</span><span class="p">)</span>
    <span class="n">HTML</span><span class="o">=</span><span class="n">XSL_transform</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">()))</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_current_state">
    <p>def <span class="ident">update_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_document">
    <p>def <span class="ident">update_document</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute document from the self.etree.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_document', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_document" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Updates the attribute document from the self.etree. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">=</span><span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">etree</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_etree">
    <p>def <span class="ident">update_etree</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute etree. Should be called anytime the xml content is changed</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_etree', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.update_etree" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_etree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Updates the attribute etree. Should be called anytime the xml content is changed&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">etree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.write">
    <p>def <span class="ident">write</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command to instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.write', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.FakeInstrument.write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command to instrument&quot;</span>
    <span class="n">now</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">:</span><span class="n">now</span><span class="p">,</span><span class="s2">&quot;Action&quot;</span><span class="p">:</span><span class="s2">&quot;self.write&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;Argument&quot;</span><span class="p">:</span><span class="n">command</span><span class="p">,</span><span class="s2">&quot;Response&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">})</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.STATE_BUFFER_MAX_LENGTH" class="name">var <span class="ident">STATE_BUFFER_MAX_LENGTH</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.current_state" class="name">var <span class="ident">current_state</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.history" class="name">var <span class="ident">history</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.options" class="name">var <span class="ident">options</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.read_buffer" class="name">var <span class="ident">read_buffer</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.state_buffer" class="name">var <span class="ident">state_buffer</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.FakeInstrument.write_buffer" class="name">var <span class="ident">write_buffer</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope" class="name">class <span class="ident">HighSpeedOscope</span></p>
      
  
    <div class="desc"><p>Control Class for high speed oscilloscopes. Based on code from Diogo</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">HighSpeedOscope</span><span class="p">(</span><span class="n">VisaInstrument</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Control Class for high speed oscilloscopes. Based on code from Diogo &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the oscilloscope  for data collection&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
        <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">measure_waves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns data for a measurement in an AsciiDataTable&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;number_frames&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_points</span><span class="p">(),</span>
                    <span class="s2">&quot;timebase_scale&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timebase_scale</span><span class="p">(),</span> <span class="s2">&quot;channels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                    <span class="s2">&quot;initial_time_offset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time_position</span><span class="p">(),</span> <span class="s2">&quot;timeout_measurement&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
                    <span class="s2">&quot;save_data&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;data_format&quot;</span><span class="p">:</span> <span class="s2">&quot;dat&quot;</span><span class="p">,</span> <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                    <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Scope&quot;</span><span class="p">,</span> <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Measurement&quot;</span><span class="p">,</span> <span class="s2">&quot;add_header&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s2">&quot;output_table_options&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;data_delimiter&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;treat_header_as_comment&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
                    <span class="s2">&quot;download_format&quot;</span><span class="p">:</span><span class="s2">&quot;ASCII&quot;</span><span class="p">,</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">start_timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;The .measure_waves method began at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start_timer</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_number_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span>
        <span class="n">channel_string_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CHAN1&quot;</span><span class="p">,</span> <span class="s2">&quot;CHAN2&quot;</span><span class="p">,</span> <span class="s2">&quot;CHAN3&quot;</span><span class="p">,</span> <span class="s2">&quot;CHAN4&quot;</span><span class="p">]</span>

        <span class="c1"># begin by setting timeout to timeout_measurement</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timeout_measurement&quot;</span><span class="p">]</span>

        <span class="c1"># now calculate timestep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timebase_scale&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span>
        <span class="n">time_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">]</span>

        <span class="c1"># now configure the scope for data transfer</span>
        <span class="c1"># define the way the data is transmitted from the instrument to the PC</span>
        <span class="c1"># Word -&gt; 16bit signed integer</span>
        <span class="c1"># now we choose if you want it to be bin or ASCII</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;asc&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;download_format&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:FORM ASCII&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:FORM WORD&#39;</span><span class="p">)</span>
            <span class="c1"># little-endian</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:BYT LSBF&#39;</span><span class="p">)</span>
        <span class="n">number_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_frames&quot;</span><span class="p">]</span>
        <span class="c1"># this is the way diogo did it</span>
        <span class="c1"># number of points</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">setup_timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">time_difference</span><span class="o">=</span><span class="n">setup_timer</span><span class="o">-</span><span class="n">start_timer</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;The setup of the sweep finished at {0} and took {1} seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">setup_timer</span><span class="p">,</span><span class="n">time_difference</span><span class="p">)))</span>
        <span class="n">frames_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">frame_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_frames&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
                <span class="n">frame_timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">time_difference</span><span class="o">=</span><span class="n">frame_timer</span><span class="o">-</span><span class="n">start_timer</span>
                <span class="k">print</span><span class="p">((</span><span class="s2">&quot; Frame {0} began at {1}, {2} seconds from measure_waves begin &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frame_index</span><span class="p">,</span>
                                                                                              <span class="n">frame_timer</span><span class="p">,</span>
                                                                                              <span class="n">time_difference</span><span class="o">.</span><span class="n">seconds</span><span class="p">)))</span>
            <span class="n">new_frame</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># calculate time position for this frame</span>
            <span class="n">time_position</span> <span class="o">=</span> <span class="n">frame_index</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timebase_scale&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span>
                <span class="s2">&quot;initial_time_offset&quot;</span><span class="p">]</span>

            <span class="c1"># define postion to start the acquisition</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TIM:POS {0}ns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_position</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
                <span class="n">timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Writing Channel Command at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>

            <span class="c1"># acquire channels desired</span>
            <span class="n">channel_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">channel_index</span><span class="p">,</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">channel_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">channel_string</span> <span class="o">=</span> <span class="n">channel_string</span> <span class="o">+</span> <span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_string_list</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">channel_string</span> <span class="o">=</span> <span class="n">channel_string</span> <span class="o">+</span> <span class="s2">&quot;{0},&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_string_list</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">channel_command</span> <span class="o">=</span> <span class="s2">&quot;:DIG {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">channel_command</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
                <span class="n">timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Finished Writing Channel Command at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
            <span class="c1"># trigger reading and wait</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*OPC?&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
                <span class="n">timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Finshed Trigger Command and Started to Read Channels at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
            <span class="c1"># get data from the necessary channels</span>
            <span class="k">for</span> <span class="n">channel_read_index</span><span class="p">,</span> <span class="n">channel_read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]):</span>
                <span class="c1"># get data for channel 1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:SOUR CHAN{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_read</span><span class="p">))</span>
                <span class="c1"># get data</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;asc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;download_format&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                    <span class="n">data_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:WAV:DATA?&#39;</span><span class="p">)</span>
                    <span class="n">data_column</span> <span class="o">=</span> <span class="n">data_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;1-&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># This downloads the data as signed 16bit ints</span>
                    <span class="c1"># Need a conversion to volts</span>
                    <span class="n">data_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query_binary_values</span><span class="p">(</span><span class="s1">&#39;:WAV:DATA?&#39;</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>


                <span class="n">new_frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_column</span><span class="p">)</span>
                <span class="c1"># print(&quot;{0} is {1}&quot;.format(&quot;data_column&quot;,data_column))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
                    <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                    <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Finshed Data Acquistion for Channel {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_read</span><span class="p">,</span><span class="n">timer</span><span class="p">)))</span>
            <span class="n">frames_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_frame</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data Manipulation Began at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
        <span class="c1"># reshape measurement data</span>
        <span class="n">measurement_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_points</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames_data</span><span class="p">))]</span>
        <span class="c1">#         print(len(measurement_data))</span>
        <span class="c1">#         print(len(measurement_data[0]))</span>
        <span class="c1">#         print(&quot;{0} is{1}&quot;.format(&quot;len(frames_data)&quot;,len(frames_data)))</span>
        <span class="c1">#         print(&quot;{0} is{1}&quot;.format(&quot;len(frames_data[0])&quot;,len(frames_data[0])))</span>
        <span class="c1">#         print(&quot;{0} is{1}&quot;.format(&quot;len(frames_data[0][0])&quot;,len(frames_data[0][0])))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data reshaping step1 ended at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">frame_index</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frames_data</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">column_index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">column</span><span class="p">):</span>
                    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                    <span class="c1"># print(&quot;{0} is {1}&quot;.format(&quot;([row_index+frame_index*number_rows],[column_index],[frame_index])&quot;,</span>
                    <span class="c1">#([row_index + frame_index * number_rows], [column_index], [frame_index])))</span>
                    <span class="n">measurement_data</span><span class="p">[</span><span class="n">row_index</span> <span class="o">+</span> <span class="n">frame_index</span> <span class="o">*</span> <span class="n">number_rows</span><span class="p">][</span><span class="n">column_index</span><span class="p">]</span> <span class="o">=</span><span class="n">frames_data</span><span class="p">[</span><span class="n">frame_index</span><span class="p">][</span><span class="n">column_index</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data reshaping step 2 ended at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
        <span class="c1"># reset timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="n">data_out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">time_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;initial_time_offset&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">data_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">measurement_data</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_start</span> <span class="o">+</span> <span class="n">row_index</span> <span class="o">*</span> <span class="n">time_step</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_row</span>
            <span class="n">data_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;add_header&quot;</span><span class="p">]:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{0} = {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]:</span>
            <span class="n">column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_string_list</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">table_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data_out</span><span class="p">,</span>
                         <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="n">header</span><span class="p">,</span>
                         <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                         <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                         <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="s2">&quot;dat&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span>
                         <span class="s2">&quot;column_names&quot;</span><span class="p">:</span> <span class="n">column_names</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;asc&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;download_format&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">table_options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table_options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;int&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;output_table_options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">table_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">output_table</span> <span class="o">=</span> <span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">table_options</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;save_data&quot;</span><span class="p">]:</span>
            <span class="n">data_save_path</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                                       <span class="n">general_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                                       <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span>
                                       <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;dat&#39;</span>
                                       <span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">output_table</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">data_save_path</span>
            <span class="n">output_table</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data Manipulation Ended at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">output_table</span>


    <span class="k">def</span> <span class="nf">get_error_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the error state of the oscope&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:SYSTEM:ERROR? STRING&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_state</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">return</span> <span class="n">state</span>


    <span class="k">def</span> <span class="nf">set_number_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_points</span><span class="o">=</span><span class="mi">16384</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the number of points for the acquisition&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:ACQ:POINTS {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number_points</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_number_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the number of points in the waveform&quot;&quot;&quot;</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:ACQ:POINTS?&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">number_points</span>


    <span class="k">def</span> <span class="nf">set_time_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the time in ns to start the acquisition&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TIM:POS {0}ns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_time_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the time position in ns&quot;&quot;&quot;</span>
        <span class="n">position</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:TIM:POS?&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">position</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span>


    <span class="k">def</span> <span class="nf">set_timebase_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_scale</span><span class="o">=</span><span class="mf">40.96</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the timebase scale in ns&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TIM:SCAL {0}ns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_scale</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_timebase_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the timebase scale in ns&quot;&quot;&quot;</span>
        <span class="n">time_scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:TIM:SCAL?&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">time_scale</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span>


    <span class="k">def</span> <span class="nf">set_trigger_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;FPAN&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the tigger source, &#39;FPAN&#39; Frontpanel or &#39;FRUN&#39; freerun&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TRIG:SOUR {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_trigger_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the trigger source FPAN for FrontPanel or FRUN for free run&quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:TRIG:SOUR?&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_trigger_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the trigger level in mv&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TRIG:LEV {0}m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_trigger_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the trigger level&quot;&quot;&quot;</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:TRIG:LEV?&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_channel_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the scale in mv of channel. Default is 10mv/division on channel 1&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:SCAL {1}m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">scale</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_channel_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="s2">&quot;Returns the scale for a specified channel, the default is channel 1&quot;</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:SCAL?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">scale</span>

    <span class="k">def</span> <span class="nf">set_channel_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the scale in mv of channel. Default is 10mv/division on channel 1&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:OFFSet {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_channel_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="s2">&quot;Returns the scale for a specified channel, the default is channel 1&quot;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:OFFSet?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">offset</span>

    <span class="k">def</span> <span class="nf">set_channel_bandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="s2">&quot;LOW&quot;</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the specified channel&#39;s bandwith to LOW, MED or HIGH, default is to set channel 1 to LOW&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:BAND {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_channel_bandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the selected channels bandwidth&quot;&quot;&quot;</span>
        <span class="n">bandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:BAND?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">bandwidth</span>


    <span class="k">def</span> <span class="nf">set_trigger_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slope</span><span class="o">=</span><span class="s2">&quot;POS&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the trigger slope on the oscope choose from POS or NEG&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TRIG:SLOP {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">get_trigger_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the trigger slope either POS or NEG&quot;&quot;&quot;</span>
        <span class="n">slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:TRIG:SLOP?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slope</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope">HighSpeedOscope</a></li>
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument">VisaInstrument</a></li>
          <li>Code.DataHandlers.XMLModels.InstrumentSheet</li>
          <li>Code.DataHandlers.XMLModels.XMLBase</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, resource_name=None, **options)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument">VisaInstrument</a></code>.<code><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.__init__">__init__</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Initializes the VisaInstrument Class</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initializes the VisaInstrument Class&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
              <span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">)}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="c1"># First we try to look up the description and get info from it</span>
    <span class="k">if</span> <span class="n">DATA_SHEETS</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="o">=</span><span class="n">find_description</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span>
                                            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">])</span>
            <span class="n">InstrumentSheet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_query_dictionary</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The information sheet was not found defaulting to address&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">resource_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
    
    <span class="c1"># Create a description for state saving</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">}</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">=</span><span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="o">=</span><span class="mi">10</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">=</span><span class="n">visa</span><span class="o">.</span><span class="n">ResourceManager</span><span class="p">()</span>
        <span class="c1"># Call the visa instrument class-- this gives ask,write,read</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Unable to load resource entering fake mode ...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="n">FakeInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span><span class="o">=</span><span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.add_entry">
    <p>def <span class="ident">add_entry</span>(</p><p>self, tag_name, text=None, description=&#39;Specific&#39;, **attribute_dictionary)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds an entry to the instrument sheet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.add_entry', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.add_entry" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag_name</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">attribute_dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds an entry to the instrument sheet.&quot;&quot;&quot;</span>
    <span class="n">specific_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">general_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">specific_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Specific_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">general_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;General_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_entry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">text_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">text_node</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">attribute_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_attribute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">creatAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttributeNode</span><span class="p">(</span><span class="n">new_attribute</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">description_node</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">new_entry</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.ask">
    <p>def <span class="ident">ask</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.ask', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.ask" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.close">
    <p>def <span class="ident">close</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Closes the VISA session</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.close', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.close" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Closes the VISA session&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_bandwidth">
    <p>def <span class="ident">get_channel_bandwidth</span>(</p><p>self, channel=1)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the selected channels bandwidth</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_bandwidth', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_bandwidth" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_channel_bandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the selected channels bandwidth&quot;&quot;&quot;</span>
    <span class="n">bandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:BAND?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">bandwidth</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_offset">
    <p>def <span class="ident">get_channel_offset</span>(</p><p>self, channel=1)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the scale for a specified channel, the default is channel 1</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_offset', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_offset" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_channel_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="s2">&quot;Returns the scale for a specified channel, the default is channel 1&quot;</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:OFFSet?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">offset</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_scale">
    <p>def <span class="ident">get_channel_scale</span>(</p><p>self, channel=1)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the scale for a specified channel, the default is channel 1</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_scale', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_channel_scale" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_channel_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="s2">&quot;Returns the scale for a specified channel, the default is channel 1&quot;</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:SCAL?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">scale</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_error_state">
    <p>def <span class="ident">get_error_state</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the error state of the oscope</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_error_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_error_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_error_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the error state of the oscope&quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:SYSTEM:ERROR? STRING&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">error_state</span> <span class="o">=</span> <span class="n">state</span>
    <span class="k">return</span> <span class="n">state</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_image_path">
    <p>def <span class="ident">get_image_path</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Tries to return the image path, requires image to be in
<Image href="http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg"/> format</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_image_path', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_image_path" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_image_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tries to return the image path, requires image to be in</span>
<span class="sd">    &lt;Image href=&quot;http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg&quot;/&gt; format&quot;&quot;&quot;</span>
    <span class="c1"># Take the first thing called Image</span>
    <span class="n">image_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Image&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">image_path</span><span class="o">=</span><span class="n">image_node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_number_points">
    <p>def <span class="ident">get_number_points</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the number of points in the waveform</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_number_points', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_number_points" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_number_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the number of points in the waveform&quot;&quot;&quot;</span>
    <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:ACQ:POINTS?&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">number_points</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_query_dictionary">
    <p>def <span class="ident">get_query_dictionary</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a set:query dictionary if there is a State_Commands element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_query_dictionary', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_query_dictionary" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_query_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a set:query dictionary if there is a State_Commands element&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">state_commands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;State_Commands&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">state_query_dictionary</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Set&#39;</span><span class="p">)</span>
        <span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Query&#39;</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">state_commands</span><span class="o">.</span><span class="n">childNodes</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeType</span> <span class="ow">is</span> \
        <span class="n">NODE_TYPE_DICTIONARY</span><span class="p">[</span><span class="s1">&#39;ELEMENT_NODE&#39;</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">state_query_dictionary</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_state">
    <p>def <span class="ident">get_state</span>(</p><p>self, state_query_dictionary=None, state_query_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Gets the current state of the instrument. get_state accepts any query dictionary in
the form state_query_dictionary={"GPIB_SET_COMMAND":"GPIB_QUERY_COMMAND",...} or any state_query_table
in the form [{"Set":"GPIB_SET_COMMAND","Query":"GPIB_QUERY_COMMAND","Index":Optional_int_ordering commands,
if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_query_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Gets the current state of the instrument. get_state accepts any query dictionary in</span>
<span class="sd">    the form state_query_dictionary={&quot;GPIB_SET_COMMAND&quot;:&quot;GPIB_QUERY_COMMAND&quot;,...} or any state_query_table</span>
<span class="sd">    in the form [{&quot;Set&quot;:&quot;GPIB_SET_COMMAND&quot;,&quot;Query&quot;:&quot;GPIB_QUERY_COMMAND&quot;,&quot;Index&quot;:Optional_int_ordering commands,</span>
<span class="sd">    if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">state_query_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state_query_dictionary</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_query_dictionary</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
            <span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span>
        <span class="n">state</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">state_command</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">query</span>
        <span class="ow">in</span> <span class="n">state_query_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">state</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># a state_query_table is a list of dictionaries, each row has at least a Set and Query key but could</span>
        <span class="c1"># have an Index key that denotes order</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_query_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]))</span>
            <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">index</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span><span class="s2">&quot;Index&quot;</span><span class="p">:</span><span class="n">index</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)})</span>
            <span class="k">return</span> <span class="n">state</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_time_position">
    <p>def <span class="ident">get_time_position</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the time position in ns</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_time_position', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_time_position" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_time_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the time position in ns&quot;&quot;&quot;</span>
    <span class="n">position</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:TIM:POS?&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">position</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_timebase_scale">
    <p>def <span class="ident">get_timebase_scale</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the timebase scale in ns</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_timebase_scale', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_timebase_scale" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_timebase_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the timebase scale in ns&quot;&quot;&quot;</span>
    <span class="n">time_scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:TIM:SCAL?&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">time_scale</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_level">
    <p>def <span class="ident">get_trigger_level</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the trigger level</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_level', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_level" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_trigger_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the trigger level&quot;&quot;&quot;</span>
    <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:TRIG:LEV?&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_slope">
    <p>def <span class="ident">get_trigger_slope</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the trigger slope either POS or NEG</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_slope', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_slope" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_trigger_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the trigger slope either POS or NEG&quot;&quot;&quot;</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;:TRIG:SLOP?&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">slope</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_source">
    <p>def <span class="ident">get_trigger_source</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the trigger source FPAN for FrontPanel or FRUN for free run</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_source', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.get_trigger_source" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_trigger_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the trigger source FPAN for FrontPanel or FRUN for free run&quot;&quot;&quot;</span>
    <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:TRIG:SOUR?&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.initialize">
    <p>def <span class="ident">initialize</span>(</p><p>self, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Initializes the oscilloscope  for data collection</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.initialize', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.initialize" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes the oscilloscope  for data collection&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
    <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.load_state">
    <p>def <span class="ident">load_state</span>(</p><p>self, file_path)</p>
    </div>
    

    
  
    <div class="desc"><p>Loads a state from a file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.load_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.load_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads a state from a file.&quot;&quot;&quot;</span>
    <span class="c1">#TODO put a UDT to state_table</span>
    <span class="n">state_model</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state_table</span><span class="o">=</span><span class="n">state_model</span><span class="o">.</span><span class="n">get_state_list_dictionary</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.measure_waves">
    <p>def <span class="ident">measure_waves</span>(</p><p>self, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns data for a measurement in an AsciiDataTable</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.measure_waves', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.measure_waves" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">measure_waves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns data for a measurement in an AsciiDataTable&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;number_frames&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_points</span><span class="p">(),</span>
                <span class="s2">&quot;timebase_scale&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timebase_scale</span><span class="p">(),</span> <span class="s2">&quot;channels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                <span class="s2">&quot;initial_time_offset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time_position</span><span class="p">(),</span> <span class="s2">&quot;timeout_measurement&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
                <span class="s2">&quot;save_data&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;data_format&quot;</span><span class="p">:</span> <span class="s2">&quot;dat&quot;</span><span class="p">,</span> <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Scope&quot;</span><span class="p">,</span> <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Measurement&quot;</span><span class="p">,</span> <span class="s2">&quot;add_header&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;output_table_options&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;data_delimiter&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;treat_header_as_comment&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
                <span class="s2">&quot;download_format&quot;</span><span class="p">:</span><span class="s2">&quot;ASCII&quot;</span><span class="p">,</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
        <span class="n">start_timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">print</span><span class="p">((</span><span class="s2">&quot;The .measure_waves method began at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start_timer</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_number_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span>
    <span class="n">channel_string_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CHAN1&quot;</span><span class="p">,</span> <span class="s2">&quot;CHAN2&quot;</span><span class="p">,</span> <span class="s2">&quot;CHAN3&quot;</span><span class="p">,</span> <span class="s2">&quot;CHAN4&quot;</span><span class="p">]</span>
    <span class="c1"># begin by setting timeout to timeout_measurement</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">timeout</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timeout_measurement&quot;</span><span class="p">]</span>
    <span class="c1"># now calculate timestep</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timebase_scale&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span>
    <span class="n">time_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timestep&quot;</span><span class="p">]</span>
    <span class="c1"># now configure the scope for data transfer</span>
    <span class="c1"># define the way the data is transmitted from the instrument to the PC</span>
    <span class="c1"># Word -&gt; 16bit signed integer</span>
    <span class="c1"># now we choose if you want it to be bin or ASCII</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;asc&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;download_format&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:FORM ASCII&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:FORM WORD&#39;</span><span class="p">)</span>
        <span class="c1"># little-endian</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:BYT LSBF&#39;</span><span class="p">)</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_frames&quot;</span><span class="p">]</span>
    <span class="c1"># this is the way diogo did it</span>
    <span class="c1"># number of points</span>
    <span class="n">number_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
        <span class="n">setup_timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">time_difference</span><span class="o">=</span><span class="n">setup_timer</span><span class="o">-</span><span class="n">start_timer</span>
        <span class="k">print</span><span class="p">((</span><span class="s2">&quot;The setup of the sweep finished at {0} and took {1} seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">setup_timer</span><span class="p">,</span><span class="n">time_difference</span><span class="p">)))</span>
    <span class="n">frames_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">frame_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;number_frames&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">frame_timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">time_difference</span><span class="o">=</span><span class="n">frame_timer</span><span class="o">-</span><span class="n">start_timer</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot; Frame {0} began at {1}, {2} seconds from measure_waves begin &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frame_index</span><span class="p">,</span>
                                                                                          <span class="n">frame_timer</span><span class="p">,</span>
                                                                                          <span class="n">time_difference</span><span class="o">.</span><span class="n">seconds</span><span class="p">)))</span>
        <span class="n">new_frame</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># calculate time position for this frame</span>
        <span class="n">time_position</span> <span class="o">=</span> <span class="n">frame_index</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;timebase_scale&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span>
            <span class="s2">&quot;initial_time_offset&quot;</span><span class="p">]</span>
        <span class="c1"># define postion to start the acquisition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TIM:POS {0}ns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_position</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Writing Channel Command at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
        <span class="c1"># acquire channels desired</span>
        <span class="n">channel_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">channel_index</span><span class="p">,</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">channel_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">channel_string</span> <span class="o">=</span> <span class="n">channel_string</span> <span class="o">+</span> <span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_string_list</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">channel_string</span> <span class="o">=</span> <span class="n">channel_string</span> <span class="o">+</span> <span class="s2">&quot;{0},&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_string_list</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">channel_command</span> <span class="o">=</span> <span class="s2">&quot;:DIG {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">channel_command</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Finished Writing Channel Command at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
        <span class="c1"># trigger reading and wait</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*OPC?&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
            <span class="n">timer</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Finshed Trigger Command and Started to Read Channels at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
        <span class="c1"># get data from the necessary channels</span>
        <span class="k">for</span> <span class="n">channel_read_index</span><span class="p">,</span> <span class="n">channel_read</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]):</span>
            <span class="c1"># get data for channel 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:WAV:SOUR CHAN{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_read</span><span class="p">))</span>
            <span class="c1"># get data</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;asc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;download_format&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">data_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;:WAV:DATA?&#39;</span><span class="p">)</span>
                <span class="n">data_column</span> <span class="o">=</span> <span class="n">data_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;1-&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># This downloads the data as signed 16bit ints</span>
                <span class="c1"># Need a conversion to volts</span>
                <span class="n">data_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query_binary_values</span><span class="p">(</span><span class="s1">&#39;:WAV:DATA?&#39;</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>
            <span class="n">new_frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_column</span><span class="p">)</span>
            <span class="c1"># print(&quot;{0} is {1}&quot;.format(&quot;data_column&quot;,data_column))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
                <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Finshed Data Acquistion for Channel {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_read</span><span class="p">,</span><span class="n">timer</span><span class="p">)))</span>
        <span class="n">frames_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_frame</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data Manipulation Began at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
    <span class="c1"># reshape measurement data</span>
    <span class="n">measurement_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_points</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames_data</span><span class="p">))]</span>
    <span class="c1">#         print(len(measurement_data))</span>
    <span class="c1">#         print(len(measurement_data[0]))</span>
    <span class="c1">#         print(&quot;{0} is{1}&quot;.format(&quot;len(frames_data)&quot;,len(frames_data)))</span>
    <span class="c1">#         print(&quot;{0} is{1}&quot;.format(&quot;len(frames_data[0])&quot;,len(frames_data[0])))</span>
    <span class="c1">#         print(&quot;{0} is{1}&quot;.format(&quot;len(frames_data[0][0])&quot;,len(frames_data[0][0])))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data reshaping step1 ended at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">frame_index</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frames_data</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">column_index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">column</span><span class="p">):</span>
                <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                <span class="c1"># print(&quot;{0} is {1}&quot;.format(&quot;([row_index+frame_index*number_rows],[column_index],[frame_index])&quot;,</span>
                <span class="c1">#([row_index + frame_index * number_rows], [column_index], [frame_index])))</span>
                <span class="n">measurement_data</span><span class="p">[</span><span class="n">row_index</span> <span class="o">+</span> <span class="n">frame_index</span> <span class="o">*</span> <span class="n">number_rows</span><span class="p">][</span><span class="n">column_index</span><span class="p">]</span> <span class="o">=</span><span class="n">frames_data</span><span class="p">[</span><span class="n">frame_index</span><span class="p">][</span><span class="n">column_index</span><span class="p">][</span><span class="n">row_index</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data reshaping step 2 ended at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
    <span class="c1"># reset timeout</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
    <span class="n">data_out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;initial_time_offset&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">data_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">measurement_data</span><span class="p">):</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">time_start</span> <span class="o">+</span> <span class="n">row_index</span> <span class="o">*</span> <span class="n">time_step</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_row</span>
        <span class="n">data_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;add_header&quot;</span><span class="p">]:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{0} = {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]:</span>
        <span class="n">column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_string_list</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">table_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data_out</span><span class="p">,</span>
                     <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="n">header</span><span class="p">,</span>
                     <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                     <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                     <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="s2">&quot;dat&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span>
                     <span class="s2">&quot;column_names&quot;</span><span class="p">:</span> <span class="n">column_names</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;asc&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;download_format&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">table_options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">table_options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;int&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;output_table_options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">table_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">output_table</span> <span class="o">=</span> <span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">table_options</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;save_data&quot;</span><span class="p">]:</span>
        <span class="n">data_save_path</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                                   <span class="n">general_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                                   <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span>
                                   <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;dat&#39;</span>
                                   <span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">output_table</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">data_save_path</span>
        <span class="n">output_table</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_options</span><span class="p">[</span><span class="s2">&quot;verbose_timing&quot;</span><span class="p">]:</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">print</span><span class="p">((</span><span class="s2">&quot;Data Manipulation Ended at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">output_table</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.query">
    <p>def <span class="ident">query</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.query', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.query" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.read">
    <p>def <span class="ident">read</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Reads from the instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.read', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.read" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Reads from the instrument&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save">
    <p>def <span class="ident">save</span>(</p><p>self, path=None)</p>
    </div>
    

    
  
    <div class="desc"><p>" Saves as an XML file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot; Saves as an XML file&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span>
    <span class="n">file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_HTML">
    <p>def <span class="ident">save_HTML</span>(</p><p>self, file_path=None, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves a HTML transformation of the XML document using XLST at file_path. Defaults to
an XLST in self.options["XSLT"] and file_path=self.path.replace('.xml','.html')</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves a HTML transformation of the XML document using XLST at file_path. Defaults to</span>
<span class="sd">    an XLST in self.options[&quot;XSLT&quot;] and file_path=self.path.replace(&#39;.xml&#39;,&#39;.html&#39;)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">HTML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">(</span><span class="n">XSLT</span><span class="o">=</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="c1">#print type(HTML)</span>
    <span class="k">if</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span><span class="s1">&#39;.html&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_current_state">
    <p>def <span class="ident">save_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves the state in self.current_state attribute</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves the state in self.current_state attribute &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_state">
    <p>def <span class="ident">save_state</span>(</p><p>self, state_path=None, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.save_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">state_path</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">general_descriptor</span><span class="o">=</span><span class="s2">&quot;State&quot;</span><span class="p">,</span>
                             <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;state_directory&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="n">state_dictionary</span><span class="p">,</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_table&quot;</span><span class="p">:</span><span class="n">state_table</span><span class="p">,</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">add_state_description</span><span class="p">()</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">description_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">raise</span> <span class="c1">#pass</span>
    <span class="n">new_state</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_bandwidth">
    <p>def <span class="ident">set_channel_bandwidth</span>(</p><p>self, bandwidth=&#39;LOW&#39;, channel=1)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the specified channel's bandwith to LOW, MED or HIGH, default is to set channel 1 to LOW</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_bandwidth', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_bandwidth" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_channel_bandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="s2">&quot;LOW&quot;</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the specified channel&#39;s bandwith to LOW, MED or HIGH, default is to set channel 1 to LOW&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:BAND {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_offset">
    <p>def <span class="ident">set_channel_offset</span>(</p><p>self, offset=0, channel=1)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the scale in mv of channel. Default is 10mv/division on channel 1</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_offset', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_offset" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_channel_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the scale in mv of channel. Default is 10mv/division on channel 1&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:OFFSet {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_scale">
    <p>def <span class="ident">set_channel_scale</span>(</p><p>self, scale=10, channel=1)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the scale in mv of channel. Default is 10mv/division on channel 1</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_scale', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_channel_scale" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_channel_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the scale in mv of channel. Default is 10mv/division on channel 1&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:CHAN{0}:SCAL {1}m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">scale</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_number_points">
    <p>def <span class="ident">set_number_points</span>(</p><p>self, number_points=16384)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the number of points for the acquisition</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_number_points', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_number_points" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_number_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_points</span><span class="o">=</span><span class="mi">16384</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the number of points for the acquisition&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:ACQ:POINTS {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number_points</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_state">
    <p>def <span class="ident">set_state</span>(</p><p>self, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the instrument to the state specified by Command:Value pairs</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Sets the instrument to the state specified by Command:Value pairs&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">state_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="c1"># now we need to write the command</span>
        <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="c1"># a state row has a set and value</span>
            <span class="n">state_command</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
            <span class="n">value</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_time_position">
    <p>def <span class="ident">set_time_position</span>(</p><p>self, time=50)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the time in ns to start the acquisition</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_time_position', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_time_position" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_time_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the time in ns to start the acquisition&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TIM:POS {0}ns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_timebase_scale">
    <p>def <span class="ident">set_timebase_scale</span>(</p><p>self, time_scale=40.96)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the timebase scale in ns</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_timebase_scale', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_timebase_scale" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_timebase_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_scale</span><span class="o">=</span><span class="mf">40.96</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the timebase scale in ns&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TIM:SCAL {0}ns&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_scale</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_level">
    <p>def <span class="ident">set_trigger_level</span>(</p><p>self, level=10)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the trigger level in mv</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_level', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_level" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_trigger_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the trigger level in mv&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TRIG:LEV {0}m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_slope">
    <p>def <span class="ident">set_trigger_slope</span>(</p><p>self, slope=&#39;POS&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the trigger slope on the oscope choose from POS or NEG</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_slope', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_slope" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_trigger_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slope</span><span class="o">=</span><span class="s2">&quot;POS&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the trigger slope on the oscope choose from POS or NEG&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TRIG:SLOP {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_source">
    <p>def <span class="ident">set_trigger_source</span>(</p><p>self, source=&#39;FPAN&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the tigger source, 'FPAN' Frontpanel or 'FRUN' freerun</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_source', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.set_trigger_source" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_trigger_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;FPAN&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the tigger source, &#39;FPAN&#39; Frontpanel or &#39;FRUN&#39; freerun&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;:TRIG:SOUR {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.show">
    <p>def <span class="ident">show</span>(</p><p>self, mode=&#39;Window&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Displays a XML Document either as formatted text in the command line or in a
window (using wx)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.show', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.show" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;Window&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Displays a XML Document either as formatted text in the command line or in a</span>
<span class="sd">    window (using wx)&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">tag_to_tagName</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tagName</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span><span class="s1">&#39;cmd line&#39;</span><span class="p">,</span><span class="s1">&#39;cmd&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Entry Index: </span><span class="si">%s</span><span class="s1"> </span><span class="se">\t</span><span class="s1">Date: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span>
            <span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;xml&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Window|wx&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">wx</span>
            <span class="kn">import</span> <span class="nn">wx.html2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Cannot locate wx, please add to sys.path&#39;</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">html2</span><span class="o">.</span><span class="n">WebView</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">.</span><span class="n">SetPage</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">()),</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.to_HTML">
    <p>def <span class="ident">to_HTML</span>(</p><p>self, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns HTML string by applying a XSL to the XML document</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.to_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.to_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">to_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns HTML string by applying a XSL to the XML document&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">XSL_data</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="n">XSL_transform</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">XSLT</span><span class="p">(</span><span class="n">XSL_data</span><span class="p">)</span>
    <span class="n">HTML</span><span class="o">=</span><span class="n">XSL_transform</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">()))</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_current_state">
    <p>def <span class="ident">update_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_document">
    <p>def <span class="ident">update_document</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute document from the self.etree.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_document', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_document" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Updates the attribute document from the self.etree. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">=</span><span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">etree</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_etree">
    <p>def <span class="ident">update_etree</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute etree. Should be called anytime the xml content is changed</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_etree', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.update_etree" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_etree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Updates the attribute etree. Should be called anytime the xml content is changed&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">etree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.write">
    <p>def <span class="ident">write</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command to instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.write', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.HighSpeedOscope.write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command to instrument&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter" class="name">class <span class="ident">NRPPowerMeter</span></p>
      
  
    <div class="desc"><p>Controls RS power meters</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">NRPPowerMeter</span><span class="p">(</span><span class="n">PowerMeter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Controls RS power meters&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the power meter to a state with W units, 10ms aperture and Avgerage power readings&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*RST&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;UNIT:POW W&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FUNC POW:AVG&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:APER 10 MS&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter">NRPPowerMeter</a></li>
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter">PowerMeter</a></li>
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument">VisaInstrument</a></li>
          <li>Code.DataHandlers.XMLModels.InstrumentSheet</li>
          <li>Code.DataHandlers.XMLModels.XMLBase</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, resource_name=None, **options)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter">PowerMeter</a></code>.<code><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter.__init__">__init__</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Initializes the VisaInstrument Class</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initializes the VisaInstrument Class&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
              <span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">)}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="c1"># First we try to look up the description and get info from it</span>
    <span class="k">if</span> <span class="n">DATA_SHEETS</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="o">=</span><span class="n">find_description</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span>
                                            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">])</span>
            <span class="n">InstrumentSheet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_query_dictionary</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The information sheet was not found defaulting to address&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">resource_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
    
    <span class="c1"># Create a description for state saving</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">}</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">=</span><span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="o">=</span><span class="mi">10</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">=</span><span class="n">visa</span><span class="o">.</span><span class="n">ResourceManager</span><span class="p">()</span>
        <span class="c1"># Call the visa instrument class-- this gives ask,write,read</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Unable to load resource entering fake mode ...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="n">FakeInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span><span class="o">=</span><span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.add_entry">
    <p>def <span class="ident">add_entry</span>(</p><p>self, tag_name, text=None, description=&#39;Specific&#39;, **attribute_dictionary)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument">VisaInstrument</a></code>.<code><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.add_entry">add_entry</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Adds an entry to the instrument sheet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.add_entry', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.add_entry" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag_name</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">attribute_dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds an entry to the instrument sheet.&quot;&quot;&quot;</span>
    <span class="n">specific_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">general_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">specific_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Specific_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">general_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;General_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_entry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">text_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">text_node</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">attribute_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_attribute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">creatAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttributeNode</span><span class="p">(</span><span class="n">new_attribute</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">description_node</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">new_entry</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.ask">
    <p>def <span class="ident">ask</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.ask', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.ask" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.close">
    <p>def <span class="ident">close</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Closes the VISA session</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.close', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.close" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Closes the VISA session&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_frequency">
    <p>def <span class="ident">get_frequency</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the frequency of the power meter</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_frequency', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_frequency" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Returns the frequency of the power meter&quot;</span>
    <span class="n">frequency</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_image_path">
    <p>def <span class="ident">get_image_path</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Tries to return the image path, requires image to be in
<Image href="http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg"/> format</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_image_path', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_image_path" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_image_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tries to return the image path, requires image to be in</span>
<span class="sd">    &lt;Image href=&quot;http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg&quot;/&gt; format&quot;&quot;&quot;</span>
    <span class="c1"># Take the first thing called Image</span>
    <span class="n">image_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Image&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">image_path</span><span class="o">=</span><span class="n">image_node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_query_dictionary">
    <p>def <span class="ident">get_query_dictionary</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a set:query dictionary if there is a State_Commands element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_query_dictionary', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_query_dictionary" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_query_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a set:query dictionary if there is a State_Commands element&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">state_commands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;State_Commands&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">state_query_dictionary</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Set&#39;</span><span class="p">)</span>
        <span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Query&#39;</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">state_commands</span><span class="o">.</span><span class="n">childNodes</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeType</span> <span class="ow">is</span> \
        <span class="n">NODE_TYPE_DICTIONARY</span><span class="p">[</span><span class="s1">&#39;ELEMENT_NODE&#39;</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">state_query_dictionary</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_reading">
    <p>def <span class="ident">get_reading</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Initializes and fetches a reading</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_reading', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_reading" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes and fetches a reading&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;FETCh?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_state">
    <p>def <span class="ident">get_state</span>(</p><p>self, state_query_dictionary=None, state_query_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Gets the current state of the instrument. get_state accepts any query dictionary in
the form state_query_dictionary={"GPIB_SET_COMMAND":"GPIB_QUERY_COMMAND",...} or any state_query_table
in the form [{"Set":"GPIB_SET_COMMAND","Query":"GPIB_QUERY_COMMAND","Index":Optional_int_ordering commands,
if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_query_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Gets the current state of the instrument. get_state accepts any query dictionary in</span>
<span class="sd">    the form state_query_dictionary={&quot;GPIB_SET_COMMAND&quot;:&quot;GPIB_QUERY_COMMAND&quot;,...} or any state_query_table</span>
<span class="sd">    in the form [{&quot;Set&quot;:&quot;GPIB_SET_COMMAND&quot;,&quot;Query&quot;:&quot;GPIB_QUERY_COMMAND&quot;,&quot;Index&quot;:Optional_int_ordering commands,</span>
<span class="sd">    if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">state_query_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state_query_dictionary</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_query_dictionary</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
            <span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span>
        <span class="n">state</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">state_command</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">query</span>
        <span class="ow">in</span> <span class="n">state_query_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">state</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># a state_query_table is a list of dictionaries, each row has at least a Set and Query key but could</span>
        <span class="c1"># have an Index key that denotes order</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_query_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]))</span>
            <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">index</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span><span class="s2">&quot;Index&quot;</span><span class="p">:</span><span class="n">index</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)})</span>
            <span class="k">return</span> <span class="n">state</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_units">
    <p>def <span class="ident">get_units</span>(</p><p>self, unit=&#39;W&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Gets the power meters units</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_units', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.get_units" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the power meters units&quot;&quot;&quot;</span>
    <span class="c1"># Todo put an input checker on this to only allow desired commands</span>
    <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;UNIT:POW?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unit</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.initialize">
    <p>def <span class="ident">initialize</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Initializes the power meter to a state with W units, 10ms aperture and Avgerage power readings</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.initialize', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.initialize" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes the power meter to a state with W units, 10ms aperture and Avgerage power readings&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*RST&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;UNIT:POW W&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FUNC POW:AVG&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:APER 10 MS&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.load_state">
    <p>def <span class="ident">load_state</span>(</p><p>self, file_path)</p>
    </div>
    

    
  
    <div class="desc"><p>Loads a state from a file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.load_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.load_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads a state from a file.&quot;&quot;&quot;</span>
    <span class="c1">#TODO put a UDT to state_table</span>
    <span class="n">state_model</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state_table</span><span class="o">=</span><span class="n">state_model</span><span class="o">.</span><span class="n">get_state_list_dictionary</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.query">
    <p>def <span class="ident">query</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.query', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.query" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.read">
    <p>def <span class="ident">read</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Reads from the instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.read', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.read" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Reads from the instrument&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save">
    <p>def <span class="ident">save</span>(</p><p>self, path=None)</p>
    </div>
    

    
  
    <div class="desc"><p>" Saves as an XML file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot; Saves as an XML file&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span>
    <span class="n">file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_HTML">
    <p>def <span class="ident">save_HTML</span>(</p><p>self, file_path=None, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves a HTML transformation of the XML document using XLST at file_path. Defaults to
an XLST in self.options["XSLT"] and file_path=self.path.replace('.xml','.html')</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves a HTML transformation of the XML document using XLST at file_path. Defaults to</span>
<span class="sd">    an XLST in self.options[&quot;XSLT&quot;] and file_path=self.path.replace(&#39;.xml&#39;,&#39;.html&#39;)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">HTML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">(</span><span class="n">XSLT</span><span class="o">=</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="c1">#print type(HTML)</span>
    <span class="k">if</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span><span class="s1">&#39;.html&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_current_state">
    <p>def <span class="ident">save_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves the state in self.current_state attribute</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves the state in self.current_state attribute &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_state">
    <p>def <span class="ident">save_state</span>(</p><p>self, state_path=None, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.save_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">state_path</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">general_descriptor</span><span class="o">=</span><span class="s2">&quot;State&quot;</span><span class="p">,</span>
                             <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;state_directory&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="n">state_dictionary</span><span class="p">,</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_table&quot;</span><span class="p">:</span><span class="n">state_table</span><span class="p">,</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">add_state_description</span><span class="p">()</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">description_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">raise</span> <span class="c1">#pass</span>
    <span class="n">new_state</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_frequency">
    <p>def <span class="ident">set_frequency</span>(</p><p>self, frequency=1000000000)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the frequency of the power meter</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_frequency', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_frequency" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frequency</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">9</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the frequency of the power meter&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frequency</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_state">
    <p>def <span class="ident">set_state</span>(</p><p>self, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the instrument to the state specified by Command:Value pairs</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Sets the instrument to the state specified by Command:Value pairs&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">state_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="c1"># now we need to write the command</span>
        <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="c1"># a state row has a set and value</span>
            <span class="n">state_command</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
            <span class="n">value</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_units">
    <p>def <span class="ident">set_units</span>(</p><p>self, unit=&#39;W&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the power meters units, acceptable units are W or adBM</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_units', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.set_units" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the power meters units, acceptable units are W or adBM&quot;&quot;&quot;</span>
    <span class="c1"># Todo put an input checker on this to only allow desired commands</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;UNIT:POW {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.show">
    <p>def <span class="ident">show</span>(</p><p>self, mode=&#39;Window&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Displays a XML Document either as formatted text in the command line or in a
window (using wx)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.show', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.show" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;Window&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Displays a XML Document either as formatted text in the command line or in a</span>
<span class="sd">    window (using wx)&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">tag_to_tagName</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tagName</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span><span class="s1">&#39;cmd line&#39;</span><span class="p">,</span><span class="s1">&#39;cmd&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Entry Index: </span><span class="si">%s</span><span class="s1"> </span><span class="se">\t</span><span class="s1">Date: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span>
            <span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;xml&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Window|wx&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">wx</span>
            <span class="kn">import</span> <span class="nn">wx.html2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Cannot locate wx, please add to sys.path&#39;</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">html2</span><span class="o">.</span><span class="n">WebView</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">.</span><span class="n">SetPage</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">()),</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.to_HTML">
    <p>def <span class="ident">to_HTML</span>(</p><p>self, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns HTML string by applying a XSL to the XML document</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.to_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.to_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">to_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns HTML string by applying a XSL to the XML document&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">XSL_data</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="n">XSL_transform</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">XSLT</span><span class="p">(</span><span class="n">XSL_data</span><span class="p">)</span>
    <span class="n">HTML</span><span class="o">=</span><span class="n">XSL_transform</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">()))</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_current_state">
    <p>def <span class="ident">update_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_document">
    <p>def <span class="ident">update_document</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute document from the self.etree.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_document', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_document" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Updates the attribute document from the self.etree. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">=</span><span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">etree</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_etree">
    <p>def <span class="ident">update_etree</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute etree. Should be called anytime the xml content is changed</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_etree', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.update_etree" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_etree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Updates the attribute etree. Should be called anytime the xml content is changed&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">etree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.write">
    <p>def <span class="ident">write</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command to instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.write', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.NRPPowerMeter.write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command to instrument&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.PowerMeter" class="name">class <span class="ident">PowerMeter</span></p>
      
  
    <div class="desc"><p>Controls power meters</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PowerMeter</span><span class="p">(</span><span class="n">VisaInstrument</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Controls power meters&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the power meter to a state with W units&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*RST&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;UNIT:POW W&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frequency</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">9</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the frequency of the power meter&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frequency</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns the frequency of the power meter&quot;</span>
        <span class="n">frequency</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes and fetches a reading&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;FETCh?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the power meters units, acceptable units are W or adBM&quot;&quot;&quot;</span>
        <span class="c1"># Todo put an input checker on this to only allow desired commands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;UNIT:POW {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the power meters units&quot;&quot;&quot;</span>
        <span class="c1"># Todo put an input checker on this to only allow desired commands</span>
        <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;UNIT:POW?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unit</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.PowerMeter">PowerMeter</a></li>
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument">VisaInstrument</a></li>
          <li>Code.DataHandlers.XMLModels.InstrumentSheet</li>
          <li>Code.DataHandlers.XMLModels.XMLBase</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, resource_name=None, **options)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument">VisaInstrument</a></code>.<code><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.__init__">__init__</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Initializes the VisaInstrument Class</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initializes the VisaInstrument Class&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
              <span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">)}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="c1"># First we try to look up the description and get info from it</span>
    <span class="k">if</span> <span class="n">DATA_SHEETS</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="o">=</span><span class="n">find_description</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span>
                                            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">])</span>
            <span class="n">InstrumentSheet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_query_dictionary</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The information sheet was not found defaulting to address&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">resource_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
    
    <span class="c1"># Create a description for state saving</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">}</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">=</span><span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="o">=</span><span class="mi">10</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">=</span><span class="n">visa</span><span class="o">.</span><span class="n">ResourceManager</span><span class="p">()</span>
        <span class="c1"># Call the visa instrument class-- this gives ask,write,read</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Unable to load resource entering fake mode ...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="n">FakeInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span><span class="o">=</span><span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.add_entry">
    <p>def <span class="ident">add_entry</span>(</p><p>self, tag_name, text=None, description=&#39;Specific&#39;, **attribute_dictionary)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds an entry to the instrument sheet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.add_entry', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.add_entry" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag_name</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">attribute_dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds an entry to the instrument sheet.&quot;&quot;&quot;</span>
    <span class="n">specific_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">general_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">specific_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Specific_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">general_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;General_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_entry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">text_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">text_node</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">attribute_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_attribute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">creatAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttributeNode</span><span class="p">(</span><span class="n">new_attribute</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">description_node</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">new_entry</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.ask">
    <p>def <span class="ident">ask</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.ask', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.ask" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.close">
    <p>def <span class="ident">close</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Closes the VISA session</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.close', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.close" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Closes the VISA session&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_frequency">
    <p>def <span class="ident">get_frequency</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the frequency of the power meter</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_frequency', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_frequency" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Returns the frequency of the power meter&quot;</span>
    <span class="n">frequency</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_image_path">
    <p>def <span class="ident">get_image_path</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Tries to return the image path, requires image to be in
<Image href="http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg"/> format</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_image_path', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_image_path" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_image_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tries to return the image path, requires image to be in</span>
<span class="sd">    &lt;Image href=&quot;http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg&quot;/&gt; format&quot;&quot;&quot;</span>
    <span class="c1"># Take the first thing called Image</span>
    <span class="n">image_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Image&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">image_path</span><span class="o">=</span><span class="n">image_node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_query_dictionary">
    <p>def <span class="ident">get_query_dictionary</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a set:query dictionary if there is a State_Commands element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_query_dictionary', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_query_dictionary" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_query_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a set:query dictionary if there is a State_Commands element&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">state_commands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;State_Commands&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">state_query_dictionary</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Set&#39;</span><span class="p">)</span>
        <span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Query&#39;</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">state_commands</span><span class="o">.</span><span class="n">childNodes</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeType</span> <span class="ow">is</span> \
        <span class="n">NODE_TYPE_DICTIONARY</span><span class="p">[</span><span class="s1">&#39;ELEMENT_NODE&#39;</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">state_query_dictionary</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_reading">
    <p>def <span class="ident">get_reading</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Initializes and fetches a reading</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_reading', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_reading" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_reading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes and fetches a reading&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;FETCh?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_state">
    <p>def <span class="ident">get_state</span>(</p><p>self, state_query_dictionary=None, state_query_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Gets the current state of the instrument. get_state accepts any query dictionary in
the form state_query_dictionary={"GPIB_SET_COMMAND":"GPIB_QUERY_COMMAND",...} or any state_query_table
in the form [{"Set":"GPIB_SET_COMMAND","Query":"GPIB_QUERY_COMMAND","Index":Optional_int_ordering commands,
if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_query_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Gets the current state of the instrument. get_state accepts any query dictionary in</span>
<span class="sd">    the form state_query_dictionary={&quot;GPIB_SET_COMMAND&quot;:&quot;GPIB_QUERY_COMMAND&quot;,...} or any state_query_table</span>
<span class="sd">    in the form [{&quot;Set&quot;:&quot;GPIB_SET_COMMAND&quot;,&quot;Query&quot;:&quot;GPIB_QUERY_COMMAND&quot;,&quot;Index&quot;:Optional_int_ordering commands,</span>
<span class="sd">    if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">state_query_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state_query_dictionary</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_query_dictionary</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
            <span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span>
        <span class="n">state</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">state_command</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">query</span>
        <span class="ow">in</span> <span class="n">state_query_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">state</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># a state_query_table is a list of dictionaries, each row has at least a Set and Query key but could</span>
        <span class="c1"># have an Index key that denotes order</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_query_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]))</span>
            <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">index</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span><span class="s2">&quot;Index&quot;</span><span class="p">:</span><span class="n">index</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)})</span>
            <span class="k">return</span> <span class="n">state</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_units">
    <p>def <span class="ident">get_units</span>(</p><p>self, unit=&#39;W&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Gets the power meters units</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_units', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.get_units" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the power meters units&quot;&quot;&quot;</span>
    <span class="c1"># Todo put an input checker on this to only allow desired commands</span>
    <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;UNIT:POW?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unit</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.initialize">
    <p>def <span class="ident">initialize</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Initializes the power meter to a state with W units</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.initialize', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.initialize" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes the power meter to a state with W units&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*RST&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;UNIT:POW W&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.load_state">
    <p>def <span class="ident">load_state</span>(</p><p>self, file_path)</p>
    </div>
    

    
  
    <div class="desc"><p>Loads a state from a file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.load_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.load_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads a state from a file.&quot;&quot;&quot;</span>
    <span class="c1">#TODO put a UDT to state_table</span>
    <span class="n">state_model</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state_table</span><span class="o">=</span><span class="n">state_model</span><span class="o">.</span><span class="n">get_state_list_dictionary</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.query">
    <p>def <span class="ident">query</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.query', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.query" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.read">
    <p>def <span class="ident">read</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Reads from the instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.read', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.read" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Reads from the instrument&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.save">
    <p>def <span class="ident">save</span>(</p><p>self, path=None)</p>
    </div>
    

    
  
    <div class="desc"><p>" Saves as an XML file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.save', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot; Saves as an XML file&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span>
    <span class="n">file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_HTML">
    <p>def <span class="ident">save_HTML</span>(</p><p>self, file_path=None, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves a HTML transformation of the XML document using XLST at file_path. Defaults to
an XLST in self.options["XSLT"] and file_path=self.path.replace('.xml','.html')</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves a HTML transformation of the XML document using XLST at file_path. Defaults to</span>
<span class="sd">    an XLST in self.options[&quot;XSLT&quot;] and file_path=self.path.replace(&#39;.xml&#39;,&#39;.html&#39;)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">HTML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">(</span><span class="n">XSLT</span><span class="o">=</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="c1">#print type(HTML)</span>
    <span class="k">if</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span><span class="s1">&#39;.html&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_current_state">
    <p>def <span class="ident">save_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves the state in self.current_state attribute</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves the state in self.current_state attribute &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_state">
    <p>def <span class="ident">save_state</span>(</p><p>self, state_path=None, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.save_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">state_path</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">general_descriptor</span><span class="o">=</span><span class="s2">&quot;State&quot;</span><span class="p">,</span>
                             <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;state_directory&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="n">state_dictionary</span><span class="p">,</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_table&quot;</span><span class="p">:</span><span class="n">state_table</span><span class="p">,</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">add_state_description</span><span class="p">()</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">description_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">raise</span> <span class="c1">#pass</span>
    <span class="n">new_state</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_frequency">
    <p>def <span class="ident">set_frequency</span>(</p><p>self, frequency=1000000000)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the frequency of the power meter</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_frequency', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_frequency" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frequency</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">9</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the frequency of the power meter&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frequency</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_state">
    <p>def <span class="ident">set_state</span>(</p><p>self, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the instrument to the state specified by Command:Value pairs</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Sets the instrument to the state specified by Command:Value pairs&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">state_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="c1"># now we need to write the command</span>
        <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="c1"># a state row has a set and value</span>
            <span class="n">state_command</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
            <span class="n">value</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_units">
    <p>def <span class="ident">set_units</span>(</p><p>self, unit=&#39;W&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the power meters units, acceptable units are W or adBM</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_units', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.set_units" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the power meters units, acceptable units are W or adBM&quot;&quot;&quot;</span>
    <span class="c1"># Todo put an input checker on this to only allow desired commands</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;UNIT:POW {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.show">
    <p>def <span class="ident">show</span>(</p><p>self, mode=&#39;Window&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Displays a XML Document either as formatted text in the command line or in a
window (using wx)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.show', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.show" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;Window&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Displays a XML Document either as formatted text in the command line or in a</span>
<span class="sd">    window (using wx)&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">tag_to_tagName</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tagName</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span><span class="s1">&#39;cmd line&#39;</span><span class="p">,</span><span class="s1">&#39;cmd&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Entry Index: </span><span class="si">%s</span><span class="s1"> </span><span class="se">\t</span><span class="s1">Date: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span>
            <span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;xml&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Window|wx&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">wx</span>
            <span class="kn">import</span> <span class="nn">wx.html2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Cannot locate wx, please add to sys.path&#39;</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">html2</span><span class="o">.</span><span class="n">WebView</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">.</span><span class="n">SetPage</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">()),</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.to_HTML">
    <p>def <span class="ident">to_HTML</span>(</p><p>self, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns HTML string by applying a XSL to the XML document</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.to_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.to_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">to_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns HTML string by applying a XSL to the XML document&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">XSL_data</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="n">XSL_transform</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">XSLT</span><span class="p">(</span><span class="n">XSL_data</span><span class="p">)</span>
    <span class="n">HTML</span><span class="o">=</span><span class="n">XSL_transform</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">()))</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_current_state">
    <p>def <span class="ident">update_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_document">
    <p>def <span class="ident">update_document</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute document from the self.etree.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_document', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_document" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Updates the attribute document from the self.etree. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">=</span><span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">etree</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_etree">
    <p>def <span class="ident">update_etree</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute etree. Should be called anytime the xml content is changed</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_etree', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.update_etree" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_etree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Updates the attribute etree. Should be called anytime the xml content is changed&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">etree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.PowerMeter.write">
    <p>def <span class="ident">write</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command to instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.write', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.PowerMeter.write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command to instrument&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.VNA" class="name">class <span class="ident">VNA</span></p>
      
  
    <div class="desc"><p>Control class for a linear VNA.
The .measure_sparameters ans .measure_switch_terms return a S2PV1
class that can be saved, printed or have a simple plot using show(). The attribute frequency_list
stores the frequency points as Hz.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">VNA</span><span class="p">(</span><span class="n">VisaInstrument</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Control class for a linear VNA.</span>
<span class="sd">    The .measure_sparameters ans .measure_switch_terms return a S2PV1</span>
<span class="sd">    class that can be saved, printed or have a simple plot using show(). The attribute frequency_list</span>
<span class="sd">    stores the frequency points as Hz.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the E8631A control class&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;frequency_units&quot;</span><span class="p">:</span> <span class="s2">&quot;Hz&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">VisaInstrument</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;frequency_units&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># this should be if SENS:SWE:TYPE? is LIN or LOG</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span><span class="s2">&quot;LIN&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_power</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IFBW</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;frequency_units&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># this should be if SENS:SWE:TYPE? is LIN or LOG</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                                     <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                                 <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
                    <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                        <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                        <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">trace_name</span><span class="p">,</span><span class="n">trace_parameter</span><span class="p">,</span><span class="n">drive_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">display_trace</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a single trace to the VNA. Trace parameters vary by instrument and can be ratios of</span>
<span class="sd">        recievers or raw receiver values. For instance, R1 is the a1 wave. Traditional Sparameters</span>
<span class="sd">        do not require the identification of a drive_port. Does not display trace on the front panel&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="n">trace_parameter</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;{0}&#39;,{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">,</span><span class="n">trace_parameter</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;{0}&#39;,{1},{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">,</span> <span class="n">trace_parameter</span><span class="p">,</span><span class="n">drive_port</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">display_trace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">read_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">trace_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a 2-d list of [[reParameter1,imParameter1],..[reParameterN,imParameterN]] where</span>
<span class="sd">         n is the number of points in the sweep. User is responsible for triggering the sweep and retrieving</span>
<span class="sd">          the frequency array vna.get_frequency_list()&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
        <span class="c1"># First get the A and Blists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL &quot;{0}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">out_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
        <span class="n">out_string</span><span class="o">=</span><span class="n">out_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">re_list</span><span class="o">=</span><span class="n">out_string</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">im_list</span><span class="o">=</span><span class="n">out_string</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">out_list</span><span class="o">=</span><span class="p">[[</span><span class="nb">float</span><span class="p">(</span><span class="n">real_parameter</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">im_list</span><span class="p">[</span><span class="n">index</span><span class="p">])]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">real_parameter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">re_list</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">out_list</span>

    <span class="k">def</span> <span class="nf">trigger_sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers a single sweep of the VNA, note you need to wait for the sweep to finish before reading the</span>
<span class="sd">        values. It takes ~ #ports sourced*#points/IFBW &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_source_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets all of the outputs of the VNA to OFF(0) or ON (1). This disables/enables all the source outputs.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;OUTP {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_source_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the state of the outputs. This is equivelent to vna.query(&#39;OUTP?&#39;)&quot;&quot;&quot;</span>
        <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;OUTP?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">add_all_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds all Sparameter and wave parameter traces.</span>
<span class="sd">        Does not initialize the instrument. The trace names match those in the</span>
<span class="sd">        measure methods (S11,S12,..S22) and (A1_D1,B1_D1..B2_D2) by default it</span>
<span class="sd">        assumes port 1 and port 2 are being used. In addition, it assumes the B receiver names are [A,B,C,D].</span>
<span class="sd">         This method will cause an error if the traces are already defined&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;port1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;port2&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]}</span>
        <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
        <span class="n">scattering_parameter_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S11&quot;</span><span class="p">,</span><span class="s2">&quot;S12&quot;</span><span class="p">,</span><span class="s2">&quot;S21&quot;</span><span class="p">,</span><span class="s2">&quot;S22&quot;</span><span class="p">]</span>
        <span class="n">trace_definitions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]),</span>
                           <span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]),</span>
                           <span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]),</span>
                           <span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scattering_parameter_names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;{0}&#39;,{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">trace_definitions</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe{1}:FEED &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">b1_name</span> <span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">b2_name</span><span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Initialize Port 1 traces A1_D1,B1_D1,B2_D1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{0}&#39;,R{0},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe5:FEED &#39;A{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{0}&#39;,{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span><span class="n">b1_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe6:FEED &#39;B{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{0}&#39;,R{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe7:FEED &#39;A{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{0}&#39;,{2},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b2_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe8:FEED &#39;B{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="c1"># Initialize Port 2 Traces A1_D2,B1_D2,</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{1}&#39;,R{0},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe9:FEED &#39;A{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b1_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe10:FEED &#39;B{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{1}&#39;,R{1},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe11:FEED &#39;A{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b2_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe12:FEED &#39;B{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>


    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Intializes the system&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
        <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SYST:FPRESET&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S11&#39;,S11&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;S11&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S12&#39;,S12&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe2:FEED &#39;S12&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S21&#39;,S21&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe3:FEED &#39;S21&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S22&#39;,S22&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe4:FEED &#39;S22&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                                 <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                             <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
                <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                    <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">set_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the power of the Instrument in dbm&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SOUR:POW {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns the power of the instrument in dbm&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;SOUR:POW?&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_sweep_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns the current sweep type. It can be LIN, LOG, or SEG&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:TYPE?&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_IFBW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifbw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the IF Bandwidth of the instrument in Hz&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:BAND {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ifbw</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:BAND:TRAC OFF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="n">ifbw</span>

    <span class="k">def</span> <span class="nf">get_IFBW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the IFBW of the instrument in Hz&quot;&quot;&quot;</span>
        <span class="n">ifbw</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;SENS:BAND?&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="n">ifbw</span>
        <span class="k">return</span> <span class="n">ifbw</span>

    <span class="k">def</span> <span class="nf">set_frequency_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the frequency units of the class, all values are still written to the VNA</span>
<span class="sd">        as Hz and the attrbiute frequncy_list is in Hz,</span>
<span class="sd">        however all commands that deal with sweeps and measurements will be in units&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">frequency_units</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="n">unit</span>

    <span class="k">def</span> <span class="nf">add_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">number_points</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">frequency_units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the VNA to a segment mode and appends a single entry in the frequency table. If start is the only specified</span>
<span class="sd">        parameter sets the entry to start=stop and number_points = 1. If step is specified calculates the number of points</span>
<span class="sd">        and sets start, stop, number_points on the VNA. It also stores the value into the attribute frequency_list.</span>
<span class="sd">        Note this function was primarily tested on an agilent which stores frequency to the nearest mHz.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># first handle the start only case</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># fix the frequency units</span>
        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">frequency_units</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">step</span><span class="p">:</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="c1"># handle creating step and number of points</span>
        <span class="k">if</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">step</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="mi">201</span>  <span class="c1"># I don&#39;t like the default for n_points this far down in the code</span>
            <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># append the new segment to self.frequency_table and fix any strangeness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span> <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:])</span>

        <span class="c1"># update the frequency_list</span>
        <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
            <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>

        <span class="c1"># now we write the segment to the instrument</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">(),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE SEGM&#39;</span><span class="p">)</span>

        <span class="c1"># now get the number of segments and add or delete the right amount to make it line up with self.frequency_table</span>
        <span class="c1"># This routine is broken</span>

        <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">print</span><span class="p">((</span><span class="s2">&quot;{0} is {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;number_segments&quot;</span><span class="p">,</span> <span class="n">number_segments</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">number_segments</span><span class="p">:</span>
            <span class="n">difference</span> <span class="o">=</span> <span class="n">number_segments</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
            <span class="n">max_segment</span> <span class="o">=</span> <span class="n">number_segments</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">difference</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:DEL&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_segment</span><span class="p">))</span>
                <span class="n">max_segment</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">difference</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">number_segments</span><span class="p">:</span>
            <span class="n">difference</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span> <span class="o">-</span> <span class="n">number_segments</span>
            <span class="n">max_segment</span> <span class="o">=</span> <span class="n">number_segments</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;{0} is {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;difference&quot;</span><span class="p">,</span> <span class="n">difference</span><span class="p">)))</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">difference</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:ADD&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_segment</span><span class="p">))</span>
                <span class="n">max_segment</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">difference</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">print</span><span class="p">((</span><span class="s2">&quot;{0} is {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;difference&quot;</span><span class="p">,</span> <span class="n">difference</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]):</span>
            <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]]</span>
            <span class="c1"># SENSe&lt;cnum&gt;:SEGMent&lt;snum&gt;:SWEep:POINts &lt;num&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">number_points</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:STAT ON&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">write_frequency_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes frequency_table to the instrument, the frequency table should be in the form</span>
<span class="sd">        [{start:,stop:,number_points:}..] or None&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">frequency_table</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">frequency_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]</span>
        <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frequency_table</span><span class="p">[:]):</span>
            <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]]</span>
            <span class="c1"># SENSe&lt;cnum&gt;:SEGMent&lt;snum&gt;:SWEep:POINts &lt;num&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">number_points</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:STAT ON&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">number_points</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;LIN&#39;</span><span class="p">,</span> <span class="n">frequency_units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the VNA to a linear mode and creates a single entry in the frequency table. If start is the only specified</span>
<span class="sd">        parameter sets the entry to start=stop and number_points = 1. If step is specified calculates the number of points</span>
<span class="sd">        and sets start, stop, number_points on the VNA. It also stores the value into the attribute frequency_list.</span>
<span class="sd">        Note this function was primarily tested on an agilent which stores frequency to the nearest mHz.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">frequency_units</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">step</span><span class="p">:</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="k">if</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">step</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE LIN&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LOG&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE LOG&#39;</span><span class="p">)</span>
            <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                                 <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE LIN&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stop</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number_points</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns the frequency in python list format&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span>

    <span class="k">def</span> <span class="nf">is_busy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the instrument is currently doing something and returns a boolean value&quot;&quot;&quot;</span>
        <span class="n">opc</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;*OPC?&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">opc</span>

    <span class="k">def</span> <span class="nf">clear_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clears the  window of traces. Does not delete the variables&quot;&quot;&quot;</span>
        <span class="n">string_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow{0}:CATalog?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
        <span class="n">traces</span> <span class="o">=</span> <span class="n">string_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">traces</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISP:WIND{0}:TRAC{1}:DEL&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">trace</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">measure_switch_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Measures switch terms and returns a s2p table in forward and reverse format. To return in port format</span>
<span class="sd">        set the option order= &quot;PORT&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;view_trace&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span><span class="s2">&quot;initialize&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;order&quot;</span><span class="p">:</span><span class="s2">&quot;FR&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># this resets the traces to be based on swith terms</span>
        <span class="c1"># Set VS to be remotely triggered by GPIB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:HOLD:FUNC HOLD&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TRIG:REM:TYP CHAN&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;initialize&quot;</span><span class="p">]:</span>

            <span class="c1"># Set the Channel to have 2 Traces</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:PAR:COUN 2&quot;</span><span class="p">)</span>
            <span class="c1"># Trace 1 This is port 2 or Forward Switch Terms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:PAR:DEF &#39;FWD&#39;,R2B,1&quot;</span><span class="p">)</span>  <span class="c1"># note this command is different for vector star A2,B2</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;view_trace&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe5:FEED &#39;FWD&#39;&quot;</span><span class="p">)</span>
            <span class="c1"># Trace 2 This is port 1 or Reverse Switch Terms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:PAR:DEF &#39;REV&#39;,R1A,2&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;view_trace&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe6:FEED &#39;REV&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Select Channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:SEL;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;TRIG:SING;&quot;</span><span class="p">)</span>
        <span class="c1"># Sleep for the duration of the scan</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.5</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>
        <span class="c1"># wait for other functions to be completed</span>
        <span class="c1"># while self.is_busy():</span>
        <span class="c1">#     time.sleep(.01)</span>
        <span class="c1"># Set the read format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FORM:ASC,0&quot;</span><span class="p">)</span>
        <span class="c1"># Read in the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC:PAR:SEL &#39;FWD&#39;;&quot;</span><span class="p">)</span>
        <span class="n">foward_switch_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CALC:DATA? SDATA&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC:PAR:SEL &#39;REV&#39;;&quot;</span><span class="p">)</span>
        <span class="n">reverse_switch_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CALC:DATA? SDATA&quot;</span><span class="p">)</span>
        <span class="c1"># Now parse the string</span>
        <span class="n">foward_switch_list</span> <span class="o">=</span> <span class="n">foward_switch_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">reverse_switch_list</span> <span class="o">=</span> <span class="n">reverse_switch_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">real_foward</span> <span class="o">=</span> <span class="n">foward_switch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imaginary_forward</span> <span class="o">=</span> <span class="n">foward_switch_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">real_reverse</span> <span class="o">=</span> <span class="n">reverse_switch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imaginary_reverse</span> <span class="o">=</span> <span class="n">reverse_switch_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">switch_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span><span class="p">,</span>
                           <span class="n">real_foward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_forward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                           <span class="n">real_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                           <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
                <span class="n">switch_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span><span class="p">,</span>
                           <span class="n">real_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                           <span class="n">real_foward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_forward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                           <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                           <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
                <span class="n">switch_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="n">option_line</span> <span class="o">=</span> <span class="s2">&quot;# Hz S RI R 50&quot;</span>
        <span class="c1"># add some options here about auto saving</span>
        <span class="c1"># do we want comment options?</span>
        <span class="n">s2p</span> <span class="o">=</span> <span class="n">S2PV1</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">option_line</span><span class="o">=</span><span class="n">option_line</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">switch_data</span><span class="p">)</span>
        <span class="n">s2p</span><span class="o">.</span><span class="n">change_frequency_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s2p</span>

    <span class="k">def</span> <span class="nf">measure_sparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers a single sparameter measurement for all 4 parameters and returns a SP2V1 object&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;single&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span><span class="p">[</span><span class="s2">&quot;trigger&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;single&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>
            <span class="c1"># now go to sleep for the time to take the scan</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>

        <span class="c1"># wait for other functions to be completed</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="c1"># Set the format to ascii and set up sweep definitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
        <span class="c1"># First get the Sparameter lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S11&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">s11_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S12&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">s12_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S21&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">s21_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S22&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">s22_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
        <span class="c1"># String Parsing</span>
        <span class="n">s11_list</span> <span class="o">=</span> <span class="n">s11_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">s12_list</span> <span class="o">=</span> <span class="n">s12_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">s21_list</span> <span class="o">=</span> <span class="n">s21_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">s22_list</span> <span class="o">=</span> <span class="n">s22_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="c1"># Construct a list of lists that is data in RI format</span>
        <span class="n">reS11</span> <span class="o">=</span> <span class="n">s11_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imS11</span> <span class="o">=</span> <span class="n">s11_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">reS12</span> <span class="o">=</span> <span class="n">s12_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imS12</span> <span class="o">=</span> <span class="n">s12_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">reS21</span> <span class="o">=</span> <span class="n">s21_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imS21</span> <span class="o">=</span> <span class="n">s21_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">reS22</span> <span class="o">=</span> <span class="n">s22_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">imS22</span> <span class="o">=</span> <span class="n">s22_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">sparameter_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span><span class="p">,</span>
                       <span class="n">reS11</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS11</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="n">reS21</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS21</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="n">reS12</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS12</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="n">reS22</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS22</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
            <span class="n">sparameter_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="n">option_line</span> <span class="o">=</span> <span class="s2">&quot;# Hz S RI R 50&quot;</span>
        <span class="c1"># add some options here about auto saving</span>
        <span class="c1"># do we want comment options?</span>
        <span class="n">s2p</span> <span class="o">=</span> <span class="n">S2PV1</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">option_line</span><span class="o">=</span><span class="n">option_line</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sparameter_data</span><span class="p">)</span>
        <span class="n">s2p</span><span class="o">.</span><span class="n">change_frequency_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s2p</span>
    <span class="k">def</span> <span class="nf">initialize_w2p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the system for w2p acquisition&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;port1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;port2&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]}</span>
        <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SYST:FPRESET&quot;</span><span class="p">)</span>
        <span class="n">b1_name</span> <span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">b2_name</span><span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Initialize Port 1 traces A1_D1,B1_D1,B2_D1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{0}&#39;,R{0},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;A{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{0}&#39;,{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span><span class="n">b1_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe2:FEED &#39;B{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{0}&#39;,R{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe3:FEED &#39;A{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{0}&#39;,{2},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b2_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe4:FEED &#39;B{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="c1"># Initialize Port 2 Traces A1_D2,B1_D2,</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{1}&#39;,R{0},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe5:FEED &#39;A{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b1_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe6:FEED &#39;B{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{1}&#39;,R{1},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                            <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe7:FEED &#39;A{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                           <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                           <span class="n">b2_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe8:FEED &#39;B{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                    <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_frequency_list</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">initialize_w1p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the system for w1p acquisition, default works for ZVA&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span><span class="s2">&quot;source_port&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SYST:FPRESET&quot;</span><span class="p">)</span>
        <span class="n">b_name</span> <span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{0}&#39;,R{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;A{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{0}&#39;,{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">],</span>
                                                                       <span class="n">b_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe2:FEED &#39;B{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                                 <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                             <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
                <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                    <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_frequency_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns the frequency list as read from the VNA&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                                 <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                             <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
                <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                    <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]</span>

    <span class="k">def</span> <span class="nf">measure_w1p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers a single w1p measurement for a specified</span>
<span class="sd">        port and returns a w1p object.&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;w1p_options&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;trigger&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;single&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>
            <span class="c1"># now go to sleep for the time to take the scan</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>

        <span class="c1"># wait for other functions to be completed</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="c1"># Set the format to ascii and set up sweep definitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
        <span class="c1"># First get the A and Blists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL A{0}_D{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">a_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL  B{0}_D{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">b_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
        <span class="c1"># String Parsing</span>
        <span class="n">a_list</span> <span class="o">=</span> <span class="n">a_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">b_list</span> <span class="o">=</span> <span class="n">b_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="c1"># Construct a list of lists that is data in RI format</span>
        <span class="n">re_a</span> <span class="o">=</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">im_a</span> <span class="o">=</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">re_b</span> <span class="o">=</span> <span class="n">b_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">im_b</span> <span class="o">=</span> <span class="n">b_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">wparameter_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span> <span class="o">/</span> <span class="mf">10.</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span>
                       <span class="n">re_a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">im_a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="n">re_b</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">im_b</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
            <span class="n">wparameter_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;reA1_D1&quot;</span><span class="p">,</span> <span class="s2">&quot;imA1_D1&quot;</span><span class="p">,</span> <span class="s2">&quot;reB1_D1&quot;</span><span class="p">,</span> <span class="s2">&quot;imB1_D1&quot;</span><span class="p">]</span>
        <span class="c1"># add some options here about auto saving</span>
        <span class="c1"># do we want comment options?</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;column_names_begin_token&quot;</span><span class="p">:</span> <span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;data_delimiter&quot;</span><span class="p">:</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;column_names&quot;</span><span class="p">:</span> <span class="n">column_names</span><span class="p">,</span>
                   <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">wparameter_data</span><span class="p">,</span> <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Wave_Parameters&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;One_Port&quot;</span><span class="p">,</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="s2">&quot;w1p&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;column_types&quot;</span><span class="p">:[</span><span class="s2">&quot;float&quot;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;w1p_options&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;w1p_options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
        <span class="n">w1p</span> <span class="o">=</span> <span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w1p</span>

    <span class="k">def</span> <span class="nf">measure_w2p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers a single w2p measurement for a specified</span>
<span class="sd">        port and returns a w2p object.&quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="s2">&quot;port1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;port2&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                    <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;w2p_options&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;trigger&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;single&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>
            <span class="c1"># now go to sleep for the time to take the scan</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>

        <span class="c1"># wait for other functions to be completed</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="c1"># Set the format to ascii and set up sweep definitions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
        <span class="c1"># First get the A and B lists drive port 1</span>
        <span class="c1"># Note this could be a loop over the list = [a1_d1,b1_d1,b2_d1...,b2_d2]</span>
        <span class="n">waveparameter_names</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">drive_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
            <span class="k">for</span> <span class="n">detect_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
                <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">]:</span>
                    <span class="n">waveparameter_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{0}{1}_D{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span><span class="n">detect_port</span><span class="p">,</span><span class="n">drive_port</span><span class="p">))</span>
        <span class="c1"># now get data for all of them</span>
        <span class="n">all_wave_raw_string</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">waveparameter</span> <span class="ow">in</span> <span class="n">waveparameter_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">waveparameter</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
            <span class="n">all_wave_raw_string</span> <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">))</span>

        <span class="c1"># String Parsing</span>
        <span class="n">all_wave_list</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_wave_raw_string</span><span class="p">]</span>
        <span class="c1"># Construct a list of lists that is data in RI format</span>
        <span class="n">re_all_wave_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_list</span> <span class="ow">in</span> <span class="n">all_wave_list</span><span class="p">]</span>
        <span class="n">im_all_wave_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_list</span> <span class="ow">in</span> <span class="n">all_wave_list</span><span class="p">]</span>
        <span class="n">wparameter_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
            <span class="n">re_row</span><span class="o">=</span><span class="p">[</span><span class="n">re</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">re</span> <span class="ow">in</span> <span class="n">re_all_wave_list</span> <span class="p">]</span>
            <span class="n">im_row</span><span class="o">=</span><span class="p">[</span><span class="n">im</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">im_all_wave_list</span><span class="p">]</span>
            <span class="n">wave_row</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">re_row</span><span class="p">):</span>
                <span class="n">wave_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">wave_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im_row</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span> <span class="o">/</span> <span class="mf">10.</span> <span class="o">**</span> <span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="n">wave_row</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
            <span class="n">wparameter_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="n">waveparameter_column_names</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">drive_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
            <span class="k">for</span> <span class="n">detect_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
                <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">complex_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;re&quot;</span><span class="p">,</span><span class="s2">&quot;im&quot;</span><span class="p">]:</span>
                        <span class="n">waveparameter_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{3}{0}{1}_D{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span>
                                                                                  <span class="n">detect_port</span><span class="p">,</span>
                                                                                  <span class="n">drive_port</span><span class="p">,</span>
                                                                                  <span class="n">complex_type</span><span class="p">))</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">waveparameter_column_names</span>
        <span class="c1"># add some options here about auto saving</span>
        <span class="c1"># do we want comment options?</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;column_names_begin_token&quot;</span><span class="p">:</span> <span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;data_delimiter&quot;</span><span class="p">:</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;column_names&quot;</span><span class="p">:</span> <span class="n">column_names</span><span class="p">,</span>
                   <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">wparameter_data</span><span class="p">,</span> <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Wave_Parameters&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Two_Port&quot;</span><span class="p">,</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="s2">&quot;w2p&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;column_types&quot;</span><span class="p">:[</span><span class="s2">&quot;float&quot;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;w2p_options&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;w2p_options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
        <span class="n">w2p</span> <span class="o">=</span> <span class="n">W2P</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w2p</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.VNA">VNA</a></li>
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument">VisaInstrument</a></li>
          <li>Code.DataHandlers.XMLModels.InstrumentSheet</li>
          <li>Code.DataHandlers.XMLModels.XMLBase</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, resource_name=None, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Initializes the E8631A control class</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes the E8631A control class&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;frequency_units&quot;</span><span class="p">:</span> <span class="s2">&quot;Hz&quot;</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">VisaInstrument</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;frequency_units&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># this should be if SENS:SWE:TYPE? is LIN or LOG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span><span class="s2">&quot;LIN&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_power</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IFBW</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;frequency_units&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># this should be if SENS:SWE:TYPE? is LIN or LOG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                                 <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                             <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
                <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                    <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.add_all_traces">
    <p>def <span class="ident">add_all_traces</span>(</p><p>self, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds all Sparameter and wave parameter traces.
Does not initialize the instrument. The trace names match those in the
measure methods (S11,S12,..S22) and (A1_D1,B1_D1..B2_D2) by default it
assumes port 1 and port 2 are being used. In addition, it assumes the B receiver names are [A,B,C,D].
 This method will cause an error if the traces are already defined</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.add_all_traces', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.add_all_traces" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_all_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds all Sparameter and wave parameter traces.</span>
<span class="sd">    Does not initialize the instrument. The trace names match those in the</span>
<span class="sd">    measure methods (S11,S12,..S22) and (A1_D1,B1_D1..B2_D2) by default it</span>
<span class="sd">    assumes port 1 and port 2 are being used. In addition, it assumes the B receiver names are [A,B,C,D].</span>
<span class="sd">     This method will cause an error if the traces are already defined&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;port1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;port2&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]}</span>
    <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
    <span class="n">scattering_parameter_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S11&quot;</span><span class="p">,</span><span class="s2">&quot;S12&quot;</span><span class="p">,</span><span class="s2">&quot;S21&quot;</span><span class="p">,</span><span class="s2">&quot;S22&quot;</span><span class="p">]</span>
    <span class="n">trace_definitions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]),</span>
                       <span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]),</span>
                       <span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]),</span>
                       <span class="s2">&quot;S{0}{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">])]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scattering_parameter_names</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;{0}&#39;,{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">trace_definitions</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe{1}:FEED &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">b1_name</span> <span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">b2_name</span><span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Initialize Port 1 traces A1_D1,B1_D1,B2_D1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{0}&#39;,R{0},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe5:FEED &#39;A{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{0}&#39;,{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span><span class="n">b1_name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe6:FEED &#39;B{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{0}&#39;,R{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                        <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe7:FEED &#39;A{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{0}&#39;,{2},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                       <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                       <span class="n">b2_name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe8:FEED &#39;B{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                       <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
    <span class="c1"># Initialize Port 2 Traces A1_D2,B1_D2,</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{1}&#39;,R{0},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                        <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe9:FEED &#39;A{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                       <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                       <span class="n">b1_name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe10:FEED &#39;B{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{1}&#39;,R{1},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                        <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe11:FEED &#39;A{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                       <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                       <span class="n">b2_name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe12:FEED &#39;B{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.add_entry">
    <p>def <span class="ident">add_entry</span>(</p><p>self, tag_name, text=None, description=&#39;Specific&#39;, **attribute_dictionary)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds an entry to the instrument sheet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.add_entry', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.add_entry" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag_name</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">attribute_dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds an entry to the instrument sheet.&quot;&quot;&quot;</span>
    <span class="n">specific_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">general_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">specific_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Specific_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">general_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;General_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_entry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">text_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">text_node</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">attribute_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_attribute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">creatAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttributeNode</span><span class="p">(</span><span class="n">new_attribute</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">description_node</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">new_entry</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.add_segment">
    <p>def <span class="ident">add_segment</span>(</p><p>self, start, stop=None, number_points=None, step=None, frequency_units=&#39;Hz&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the VNA to a segment mode and appends a single entry in the frequency table. If start is the only specified
parameter sets the entry to start=stop and number_points = 1. If step is specified calculates the number of points
and sets start, stop, number_points on the VNA. It also stores the value into the attribute frequency_list.
Note this function was primarily tested on an agilent which stores frequency to the nearest mHz.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.add_segment', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.add_segment" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">number_points</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">frequency_units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the VNA to a segment mode and appends a single entry in the frequency table. If start is the only specified</span>
<span class="sd">    parameter sets the entry to start=stop and number_points = 1. If step is specified calculates the number of points</span>
<span class="sd">    and sets start, stop, number_points on the VNA. It also stores the value into the attribute frequency_list.</span>
<span class="sd">    Note this function was primarily tested on an agilent which stores frequency to the nearest mHz.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># first handle the start only case</span>
    <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># fix the frequency units</span>
    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">frequency_units</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">step</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="n">unit</span>
    <span class="c1"># handle creating step and number of points</span>
    <span class="k">if</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">step</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="mi">201</span>  <span class="c1"># I don&#39;t like the default for n_points this far down in the code</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># append the new segment to self.frequency_table and fix any strangeness</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span> <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:])</span>
    <span class="c1"># update the frequency_list</span>
    <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
        <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
    <span class="c1"># now we write the segment to the instrument</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">(),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE SEGM&#39;</span><span class="p">)</span>
    <span class="c1"># now get the number of segments and add or delete the right amount to make it line up with self.frequency_table</span>
    <span class="c1"># This routine is broken</span>
    <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">((</span><span class="s2">&quot;{0} is {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;number_segments&quot;</span><span class="p">,</span> <span class="n">number_segments</span><span class="p">)))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">number_segments</span><span class="p">:</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">number_segments</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
        <span class="n">max_segment</span> <span class="o">=</span> <span class="n">number_segments</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">difference</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:DEL&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_segment</span><span class="p">))</span>
            <span class="n">max_segment</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">difference</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">number_segments</span><span class="p">:</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span> <span class="o">-</span> <span class="n">number_segments</span>
        <span class="n">max_segment</span> <span class="o">=</span> <span class="n">number_segments</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">print</span><span class="p">((</span><span class="s2">&quot;{0} is {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;difference&quot;</span><span class="p">,</span> <span class="n">difference</span><span class="p">)))</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">difference</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:ADD&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_segment</span><span class="p">))</span>
            <span class="n">max_segment</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">difference</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">print</span><span class="p">((</span><span class="s2">&quot;{0} is {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;difference&quot;</span><span class="p">,</span> <span class="n">difference</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]):</span>
        <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]]</span>
        <span class="c1"># SENSe&lt;cnum&gt;:SEGMent&lt;snum&gt;:SWEep:POINts &lt;num&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">number_points</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:STAT ON&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.add_trace">
    <p>def <span class="ident">add_trace</span>(</p><p>self, trace_name, trace_parameter, drive_port=1, display_trace=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds a single trace to the VNA. Trace parameters vary by instrument and can be ratios of
recievers or raw receiver values. For instance, R1 is the a1 wave. Traditional Sparameters
do not require the identification of a drive_port. Does not display trace on the front panel</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.add_trace', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.add_trace" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">trace_name</span><span class="p">,</span><span class="n">trace_parameter</span><span class="p">,</span><span class="n">drive_port</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">display_trace</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds a single trace to the VNA. Trace parameters vary by instrument and can be ratios of</span>
<span class="sd">    recievers or raw receiver values. For instance, R1 is the a1 wave. Traditional Sparameters</span>
<span class="sd">    do not require the identification of a drive_port. Does not display trace on the front panel&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="n">trace_parameter</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;{0}&#39;,{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">,</span><span class="n">trace_parameter</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;{0}&#39;,{1},{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">,</span> <span class="n">trace_parameter</span><span class="p">,</span><span class="n">drive_port</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">display_trace</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.ask">
    <p>def <span class="ident">ask</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.ask', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.ask" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.clear_window">
    <p>def <span class="ident">clear_window</span>(</p><p>self, window=1)</p>
    </div>
    

    
  
    <div class="desc"><p>Clears the  window of traces. Does not delete the variables</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.clear_window', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.clear_window" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">clear_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clears the  window of traces. Does not delete the variables&quot;&quot;&quot;</span>
    <span class="n">string_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow{0}:CATalog?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
    <span class="n">traces</span> <span class="o">=</span> <span class="n">string_response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">traces</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISP:WIND{0}:TRAC{1}:DEL&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">trace</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.close">
    <p>def <span class="ident">close</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Closes the VISA session</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.close', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.close" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Closes the VISA session&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.get_IFBW">
    <p>def <span class="ident">get_IFBW</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the IFBW of the instrument in Hz</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.get_IFBW', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.get_IFBW" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_IFBW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the IFBW of the instrument in Hz&quot;&quot;&quot;</span>
    <span class="n">ifbw</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;SENS:BAND?&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="n">ifbw</span>
    <span class="k">return</span> <span class="n">ifbw</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.get_frequency">
    <p>def <span class="ident">get_frequency</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the frequency in python list format</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.get_frequency', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.get_frequency" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Returns the frequency in python list format&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.get_frequency_list">
    <p>def <span class="ident">get_frequency_list</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the frequency list as read from the VNA</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.get_frequency_list', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.get_frequency_list" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_frequency_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Returns the frequency list as read from the VNA&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                             <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                         <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
            <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.get_image_path">
    <p>def <span class="ident">get_image_path</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Tries to return the image path, requires image to be in
<Image href="http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg"/> format</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.get_image_path', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.get_image_path" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_image_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tries to return the image path, requires image to be in</span>
<span class="sd">    &lt;Image href=&quot;http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg&quot;/&gt; format&quot;&quot;&quot;</span>
    <span class="c1"># Take the first thing called Image</span>
    <span class="n">image_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Image&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">image_path</span><span class="o">=</span><span class="n">image_node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.get_power">
    <p>def <span class="ident">get_power</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the power of the instrument in dbm</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.get_power', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.get_power" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Returns the power of the instrument in dbm&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;SOUR:POW?&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.get_query_dictionary">
    <p>def <span class="ident">get_query_dictionary</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a set:query dictionary if there is a State_Commands element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.get_query_dictionary', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.get_query_dictionary" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_query_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a set:query dictionary if there is a State_Commands element&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">state_commands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;State_Commands&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">state_query_dictionary</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Set&#39;</span><span class="p">)</span>
        <span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Query&#39;</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">state_commands</span><span class="o">.</span><span class="n">childNodes</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeType</span> <span class="ow">is</span> \
        <span class="n">NODE_TYPE_DICTIONARY</span><span class="p">[</span><span class="s1">&#39;ELEMENT_NODE&#39;</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">state_query_dictionary</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.get_source_output">
    <p>def <span class="ident">get_source_output</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the state of the outputs. This is equivelent to vna.query('OUTP?')</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.get_source_output', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.get_source_output" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_source_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the state of the outputs. This is equivelent to vna.query(&#39;OUTP?&#39;)&quot;&quot;&quot;</span>
    <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;OUTP?&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.get_state">
    <p>def <span class="ident">get_state</span>(</p><p>self, state_query_dictionary=None, state_query_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Gets the current state of the instrument. get_state accepts any query dictionary in
the form state_query_dictionary={"GPIB_SET_COMMAND":"GPIB_QUERY_COMMAND",...} or any state_query_table
in the form [{"Set":"GPIB_SET_COMMAND","Query":"GPIB_QUERY_COMMAND","Index":Optional_int_ordering commands,
if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.get_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.get_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_query_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Gets the current state of the instrument. get_state accepts any query dictionary in</span>
<span class="sd">    the form state_query_dictionary={&quot;GPIB_SET_COMMAND&quot;:&quot;GPIB_QUERY_COMMAND&quot;,...} or any state_query_table</span>
<span class="sd">    in the form [{&quot;Set&quot;:&quot;GPIB_SET_COMMAND&quot;,&quot;Query&quot;:&quot;GPIB_QUERY_COMMAND&quot;,&quot;Index&quot;:Optional_int_ordering commands,</span>
<span class="sd">    if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">state_query_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state_query_dictionary</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_query_dictionary</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
            <span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span>
        <span class="n">state</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">state_command</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">query</span>
        <span class="ow">in</span> <span class="n">state_query_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">state</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># a state_query_table is a list of dictionaries, each row has at least a Set and Query key but could</span>
        <span class="c1"># have an Index key that denotes order</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_query_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]))</span>
            <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">index</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span><span class="s2">&quot;Index&quot;</span><span class="p">:</span><span class="n">index</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)})</span>
            <span class="k">return</span> <span class="n">state</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.get_sweep_type">
    <p>def <span class="ident">get_sweep_type</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the current sweep type. It can be LIN, LOG, or SEG</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.get_sweep_type', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.get_sweep_type" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_sweep_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Returns the current sweep type. It can be LIN, LOG, or SEG&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:TYPE?&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.initialize">
    <p>def <span class="ident">initialize</span>(</p><p>self, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Intializes the system</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.initialize', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.initialize" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Intializes the system&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
    <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SYST:FPRESET&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S11&#39;,S11&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;S11&#39;&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S12&#39;,S12&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe2:FEED &#39;S12&#39;&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S21&#39;,S21&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe3:FEED &#39;S21&#39;&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;S22&#39;,S22&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe4:FEED &#39;S22&#39;&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                             <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                         <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
            <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.initialize_w1p">
    <p>def <span class="ident">initialize_w1p</span>(</p><p>self, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Initializes the system for w1p acquisition, default works for ZVA</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.initialize_w1p', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.initialize_w1p" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">initialize_w1p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes the system for w1p acquisition, default works for ZVA&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span><span class="s2">&quot;source_port&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
    <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SYST:FPRESET&quot;</span><span class="p">)</span>
    <span class="n">b_name</span> <span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{0}&#39;,R{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;A{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{0}&#39;,{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">],</span>
                                                                   <span class="n">b_name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe2:FEED &#39;B{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                             <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;SEG&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">number_segments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM:COUN?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_segments</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">number_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">,</span>
                                         <span class="s2">&quot;number_points&quot;</span><span class="p">:</span> <span class="n">number_points</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span> <span class="o">=</span> <span class="n">fix_segment_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">)</span>
            <span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]:</span>
                <span class="n">new_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span> <span class="o">+</span> <span class="n">new_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">frequency_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.initialize_w2p">
    <p>def <span class="ident">initialize_w2p</span>(</p><p>self, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Initializes the system for w2p acquisition</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.initialize_w2p', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.initialize_w2p" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">initialize_w2p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes the system for w2p acquisition&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reset&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;port1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;port2&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]}</span>
    <span class="n">initialize_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">initialize_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SYST:FPRESET&quot;</span><span class="p">)</span>
    <span class="n">b1_name</span> <span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">b2_name</span><span class="o">=</span> <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;b_name_list&quot;</span><span class="p">][</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Initialize Port 1 traces A1_D1,B1_D1,B2_D1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:STATE ON&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{0}&#39;,R{0},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe1:FEED &#39;A{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{0}&#39;,{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span><span class="n">b1_name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe2:FEED &#39;B{0}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{0}&#39;,R{1},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                        <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe3:FEED &#39;A{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{0}&#39;,{2},{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                       <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                       <span class="n">b2_name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe4:FEED &#39;B{1}_D{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                       <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
    <span class="c1"># Initialize Port 2 Traces A1_D2,B1_D2,</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{0}_D{1}&#39;,R{0},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                        <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe5:FEED &#39;A{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{0}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                       <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                       <span class="n">b1_name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe6:FEED &#39;B{0}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;A{1}_D{1}&#39;,R{1},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                        <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]</span> <span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe7:FEED &#39;A{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALCulate:PARameter:DEFine &#39;B{1}_D{1}&#39;,{2},{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                       <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">],</span>
                                                                       <span class="n">b2_name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe8:FEED &#39;B{1}_D{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span>
                                                                <span class="n">initialize_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sweep_type</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_frequency_list</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.is_busy">
    <p>def <span class="ident">is_busy</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Checks if the instrument is currently doing something and returns a boolean value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.is_busy', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.is_busy" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">is_busy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks if the instrument is currently doing something and returns a boolean value&quot;&quot;&quot;</span>
    <span class="n">opc</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;*OPC?&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">opc</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.load_state">
    <p>def <span class="ident">load_state</span>(</p><p>self, file_path)</p>
    </div>
    

    
  
    <div class="desc"><p>Loads a state from a file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.load_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.load_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads a state from a file.&quot;&quot;&quot;</span>
    <span class="c1">#TODO put a UDT to state_table</span>
    <span class="n">state_model</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state_table</span><span class="o">=</span><span class="n">state_model</span><span class="o">.</span><span class="n">get_state_list_dictionary</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.measure_sparameters">
    <p>def <span class="ident">measure_sparameters</span>(</p><p>self, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Triggers a single sparameter measurement for all 4 parameters and returns a SP2V1 object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.measure_sparameters', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.measure_sparameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">measure_sparameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Triggers a single sparameter measurement for all 4 parameters and returns a SP2V1 object&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;single&quot;</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_sparameter_options</span><span class="p">[</span><span class="s2">&quot;trigger&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;single&quot;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>
        <span class="c1"># now go to sleep for the time to take the scan</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>
    <span class="c1"># wait for other functions to be completed</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
    <span class="c1"># Set the format to ascii and set up sweep definitions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
    <span class="c1"># First get the Sparameter lists</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S11&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
    <span class="n">s11_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S12&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
    <span class="n">s12_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S21&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
    <span class="n">s21_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL S22&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
    <span class="n">s22_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
    <span class="c1"># String Parsing</span>
    <span class="n">s11_list</span> <span class="o">=</span> <span class="n">s11_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">s12_list</span> <span class="o">=</span> <span class="n">s12_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">s21_list</span> <span class="o">=</span> <span class="n">s21_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">s22_list</span> <span class="o">=</span> <span class="n">s22_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="c1"># Construct a list of lists that is data in RI format</span>
    <span class="n">reS11</span> <span class="o">=</span> <span class="n">s11_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">imS11</span> <span class="o">=</span> <span class="n">s11_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">reS12</span> <span class="o">=</span> <span class="n">s12_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">imS12</span> <span class="o">=</span> <span class="n">s12_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">reS21</span> <span class="o">=</span> <span class="n">s21_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">imS21</span> <span class="o">=</span> <span class="n">s21_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">reS22</span> <span class="o">=</span> <span class="n">s22_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">imS22</span> <span class="o">=</span> <span class="n">s22_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">sparameter_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span><span class="p">,</span>
                   <span class="n">reS11</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS11</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                   <span class="n">reS21</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS21</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                   <span class="n">reS12</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS12</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                   <span class="n">reS22</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imS22</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
        <span class="n">sparameter_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="n">option_line</span> <span class="o">=</span> <span class="s2">&quot;# Hz S RI R 50&quot;</span>
    <span class="c1"># add some options here about auto saving</span>
    <span class="c1"># do we want comment options?</span>
    <span class="n">s2p</span> <span class="o">=</span> <span class="n">S2PV1</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">option_line</span><span class="o">=</span><span class="n">option_line</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sparameter_data</span><span class="p">)</span>
    <span class="n">s2p</span><span class="o">.</span><span class="n">change_frequency_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s2p</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.measure_switch_terms">
    <p>def <span class="ident">measure_switch_terms</span>(</p><p>self, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Measures switch terms and returns a s2p table in forward and reverse format. To return in port format
set the option order= "PORT</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.measure_switch_terms', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.measure_switch_terms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">measure_switch_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Measures switch terms and returns a s2p table in forward and reverse format. To return in port format</span>
<span class="sd">    set the option order= &quot;PORT&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;view_trace&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span><span class="s2">&quot;initialize&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;order&quot;</span><span class="p">:</span><span class="s2">&quot;FR&quot;</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c1"># this resets the traces to be based on swith terms</span>
    <span class="c1"># Set VS to be remotely triggered by GPIB</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:HOLD:FUNC HOLD&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TRIG:REM:TYP CHAN&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;initialize&quot;</span><span class="p">]:</span>
        <span class="c1"># Set the Channel to have 2 Traces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:PAR:COUN 2&quot;</span><span class="p">)</span>
        <span class="c1"># Trace 1 This is port 2 or Forward Switch Terms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:PAR:DEF &#39;FWD&#39;,R2B,1&quot;</span><span class="p">)</span>  <span class="c1"># note this command is different for vector star A2,B2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;view_trace&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe5:FEED &#39;FWD&#39;&quot;</span><span class="p">)</span>
        <span class="c1"># Trace 2 This is port 1 or Reverse Switch Terms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:PAR:DEF &#39;REV&#39;,R1A,2&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;view_trace&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DISPlay:WINDow1:TRACe6:FEED &#39;REV&#39;&quot;</span><span class="p">)</span>
    <span class="c1"># Select Channel</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC1:SEL;&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;TRIG:SING;&quot;</span><span class="p">)</span>
    <span class="c1"># Sleep for the duration of the scan</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.5</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>
    <span class="c1"># wait for other functions to be completed</span>
    <span class="c1"># while self.is_busy():</span>
    <span class="c1">#     time.sleep(.01)</span>
    <span class="c1"># Set the read format</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FORM:ASC,0&quot;</span><span class="p">)</span>
    <span class="c1"># Read in the data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC:PAR:SEL &#39;FWD&#39;;&quot;</span><span class="p">)</span>
    <span class="n">foward_switch_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CALC:DATA? SDATA&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALC:PAR:SEL &#39;REV&#39;;&quot;</span><span class="p">)</span>
    <span class="n">reverse_switch_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CALC:DATA? SDATA&quot;</span><span class="p">)</span>
    <span class="c1"># Now parse the string</span>
    <span class="n">foward_switch_list</span> <span class="o">=</span> <span class="n">foward_switch_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">reverse_switch_list</span> <span class="o">=</span> <span class="n">reverse_switch_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">real_foward</span> <span class="o">=</span> <span class="n">foward_switch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">imaginary_forward</span> <span class="o">=</span> <span class="n">foward_switch_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">real_reverse</span> <span class="o">=</span> <span class="n">reverse_switch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">imaginary_reverse</span> <span class="o">=</span> <span class="n">reverse_switch_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">switch_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span><span class="p">,</span>
                       <span class="n">real_foward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_forward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="n">real_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                       <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
            <span class="n">switch_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_switch_term_options</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span><span class="p">,</span>
                       <span class="n">real_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_reverse</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="n">real_foward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">imaginary_forward</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                       <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                       <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
            <span class="n">switch_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="n">option_line</span> <span class="o">=</span> <span class="s2">&quot;# Hz S RI R 50&quot;</span>
    <span class="c1"># add some options here about auto saving</span>
    <span class="c1"># do we want comment options?</span>
    <span class="n">s2p</span> <span class="o">=</span> <span class="n">S2PV1</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">option_line</span><span class="o">=</span><span class="n">option_line</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">switch_data</span><span class="p">)</span>
    <span class="n">s2p</span><span class="o">.</span><span class="n">change_frequency_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s2p</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.measure_w1p">
    <p>def <span class="ident">measure_w1p</span>(</p><p>self, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Triggers a single w1p measurement for a specified
port and returns a w1p object.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.measure_w1p', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.measure_w1p" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">measure_w1p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Triggers a single w1p measurement for a specified</span>
<span class="sd">    port and returns a w1p object.&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span>
                <span class="s2">&quot;w1p_options&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;trigger&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;single&quot;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>
        <span class="c1"># now go to sleep for the time to take the scan</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>
    <span class="c1"># wait for other functions to be completed</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
    <span class="c1"># Set the format to ascii and set up sweep definitions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
    <span class="c1"># First get the A and Blists</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL A{0}_D{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
    <span class="n">a_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL  B{0}_D{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
    <span class="n">b_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
    <span class="c1"># String Parsing</span>
    <span class="n">a_list</span> <span class="o">=</span> <span class="n">a_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">b_list</span> <span class="o">=</span> <span class="n">b_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="c1"># Construct a list of lists that is data in RI format</span>
    <span class="n">re_a</span> <span class="o">=</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">im_a</span> <span class="o">=</span> <span class="n">a_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">re_b</span> <span class="o">=</span> <span class="n">b_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">im_b</span> <span class="o">=</span> <span class="n">b_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">wparameter_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span> <span class="o">/</span> <span class="mf">10.</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span>
                   <span class="n">re_a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">im_a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                   <span class="n">re_b</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">im_b</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
        <span class="n">wparameter_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;reA1_D1&quot;</span><span class="p">,</span> <span class="s2">&quot;imA1_D1&quot;</span><span class="p">,</span> <span class="s2">&quot;reB1_D1&quot;</span><span class="p">,</span> <span class="s2">&quot;imB1_D1&quot;</span><span class="p">]</span>
    <span class="c1"># add some options here about auto saving</span>
    <span class="c1"># do we want comment options?</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;column_names_begin_token&quot;</span><span class="p">:</span> <span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;data_delimiter&quot;</span><span class="p">:</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;column_names&quot;</span><span class="p">:</span> <span class="n">column_names</span><span class="p">,</span>
               <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">wparameter_data</span><span class="p">,</span> <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Wave_Parameters&quot;</span><span class="p">,</span>
               <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;One_Port&quot;</span><span class="p">,</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="s2">&quot;w1p&quot;</span><span class="p">,</span>
               <span class="s2">&quot;column_types&quot;</span><span class="p">:[</span><span class="s2">&quot;float&quot;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;w1p_options&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w1p_options</span><span class="p">[</span><span class="s2">&quot;w1p_options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="n">w1p</span> <span class="o">=</span> <span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">w1p</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.measure_w2p">
    <p>def <span class="ident">measure_w2p</span>(</p><p>self, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Triggers a single w2p measurement for a specified
port and returns a w2p object.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.measure_w2p', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.measure_w2p" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">measure_w2p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Triggers a single w2p measurement for a specified</span>
<span class="sd">    port and returns a w2p object.&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="s2">&quot;port1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;port2&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;b_name_list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span>
                <span class="s2">&quot;w2p_options&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;trigger&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;single&quot;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>
        <span class="c1"># now go to sleep for the time to take the scan</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span><span class="p">))</span>
    <span class="c1"># wait for other functions to be completed</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
    <span class="c1"># Set the format to ascii and set up sweep definitions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
    <span class="c1"># First get the A and B lists drive port 1</span>
    <span class="c1"># Note this could be a loop over the list = [a1_d1,b1_d1,b2_d1...,b2_d2]</span>
    <span class="n">waveparameter_names</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">drive_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
        <span class="k">for</span> <span class="n">detect_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
            <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">]:</span>
                <span class="n">waveparameter_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{0}{1}_D{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span><span class="n">detect_port</span><span class="p">,</span><span class="n">drive_port</span><span class="p">))</span>
    <span class="c1"># now get data for all of them</span>
    <span class="n">all_wave_raw_string</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">waveparameter</span> <span class="ow">in</span> <span class="n">waveparameter_names</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">waveparameter</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">all_wave_raw_string</span> <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">))</span>
    <span class="c1"># String Parsing</span>
    <span class="n">all_wave_list</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_wave_raw_string</span><span class="p">]</span>
    <span class="c1"># Construct a list of lists that is data in RI format</span>
    <span class="n">re_all_wave_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_list</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_list</span> <span class="ow">in</span> <span class="n">all_wave_list</span><span class="p">]</span>
    <span class="n">im_all_wave_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_list</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_list</span> <span class="ow">in</span> <span class="n">all_wave_list</span><span class="p">]</span>
    <span class="n">wparameter_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">[:]):</span>
        <span class="n">re_row</span><span class="o">=</span><span class="p">[</span><span class="n">re</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">re</span> <span class="ow">in</span> <span class="n">re_all_wave_list</span> <span class="p">]</span>
        <span class="n">im_row</span><span class="o">=</span><span class="p">[</span><span class="n">im</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">im_all_wave_list</span><span class="p">]</span>
        <span class="n">wave_row</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">re_row</span><span class="p">):</span>
            <span class="n">wave_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">wave_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im_row</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span> <span class="o">/</span> <span class="mf">10.</span> <span class="o">**</span> <span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="n">wave_row</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">new_row</span><span class="p">]</span>
        <span class="n">wparameter_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="n">waveparameter_column_names</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">drive_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
        <span class="k">for</span> <span class="n">detect_port</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port1&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;port2&quot;</span><span class="p">]]:</span>
            <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;B&quot;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">complex_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;re&quot;</span><span class="p">,</span><span class="s2">&quot;im&quot;</span><span class="p">]:</span>
                    <span class="n">waveparameter_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{3}{0}{1}_D{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span>
                                                                              <span class="n">detect_port</span><span class="p">,</span>
                                                                              <span class="n">drive_port</span><span class="p">,</span>
                                                                              <span class="n">complex_type</span><span class="p">))</span>
    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">waveparameter_column_names</span>
    <span class="c1"># add some options here about auto saving</span>
    <span class="c1"># do we want comment options?</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;column_names_begin_token&quot;</span><span class="p">:</span> <span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="s2">&quot;data_delimiter&quot;</span><span class="p">:</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;column_names&quot;</span><span class="p">:</span> <span class="n">column_names</span><span class="p">,</span>
               <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">wparameter_data</span><span class="p">,</span> <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Wave_Parameters&quot;</span><span class="p">,</span>
               <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Two_Port&quot;</span><span class="p">,</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span> <span class="s2">&quot;w2p&quot;</span><span class="p">,</span>
               <span class="s2">&quot;column_types&quot;</span><span class="p">:[</span><span class="s2">&quot;float&quot;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;w2p_options&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_w2p_options</span><span class="p">[</span><span class="s2">&quot;w2p_options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="n">w2p</span> <span class="o">=</span> <span class="n">W2P</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">w2p</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.query">
    <p>def <span class="ident">query</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.query', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.query" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.read">
    <p>def <span class="ident">read</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Reads from the instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.read', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.read" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Reads from the instrument&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.read_trace">
    <p>def <span class="ident">read_trace</span>(</p><p>self, trace_name)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a 2-d list of [[reParameter1,imParameter1],..[reParameterN,imParameterN]] where
n is the number of points in the sweep. User is responsible for triggering the sweep and retrieving
 the frequency array vna.get_frequency_list()</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.read_trace', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.read_trace" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">trace_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a 2-d list of [[reParameter1,imParameter1],..[reParameterN,imParameterN]] where</span>
<span class="sd">     n is the number of points in the sweep. User is responsible for triggering the sweep and retrieving</span>
<span class="sd">      the frequency array vna.get_frequency_list()&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;FORM:ASC,0&#39;</span><span class="p">)</span>
    <span class="c1"># First get the A and Blists</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:PAR:SEL &quot;{0}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trace_name</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CALC:FORM MLIN&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span><span class="p">():</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)</span>
    <span class="n">out_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;CALC:DATA? SDATA&#39;</span><span class="p">)</span>
    <span class="n">out_string</span><span class="o">=</span><span class="n">out_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">re_list</span><span class="o">=</span><span class="n">out_string</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">im_list</span><span class="o">=</span><span class="n">out_string</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">out_list</span><span class="o">=</span><span class="p">[[</span><span class="nb">float</span><span class="p">(</span><span class="n">real_parameter</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">im_list</span><span class="p">[</span><span class="n">index</span><span class="p">])]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">real_parameter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">re_list</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">out_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.save">
    <p>def <span class="ident">save</span>(</p><p>self, path=None)</p>
    </div>
    

    
  
    <div class="desc"><p>" Saves as an XML file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.save', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot; Saves as an XML file&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span>
    <span class="n">file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.save_HTML">
    <p>def <span class="ident">save_HTML</span>(</p><p>self, file_path=None, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves a HTML transformation of the XML document using XLST at file_path. Defaults to
an XLST in self.options["XSLT"] and file_path=self.path.replace('.xml','.html')</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.save_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.save_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves a HTML transformation of the XML document using XLST at file_path. Defaults to</span>
<span class="sd">    an XLST in self.options[&quot;XSLT&quot;] and file_path=self.path.replace(&#39;.xml&#39;,&#39;.html&#39;)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">HTML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">(</span><span class="n">XSLT</span><span class="o">=</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="c1">#print type(HTML)</span>
    <span class="k">if</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span><span class="s1">&#39;.html&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.save_current_state">
    <p>def <span class="ident">save_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves the state in self.current_state attribute</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.save_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.save_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves the state in self.current_state attribute &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.save_state">
    <p>def <span class="ident">save_state</span>(</p><p>self, state_path=None, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.save_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.save_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">state_path</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">general_descriptor</span><span class="o">=</span><span class="s2">&quot;State&quot;</span><span class="p">,</span>
                             <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;state_directory&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="n">state_dictionary</span><span class="p">,</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_table&quot;</span><span class="p">:</span><span class="n">state_table</span><span class="p">,</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">add_state_description</span><span class="p">()</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">description_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">raise</span> <span class="c1">#pass</span>
    <span class="n">new_state</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.set_IFBW">
    <p>def <span class="ident">set_IFBW</span>(</p><p>self, ifbw)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the IF Bandwidth of the instrument in Hz</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.set_IFBW', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.set_IFBW" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_IFBW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifbw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the IF Bandwidth of the instrument in Hz&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:BAND {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ifbw</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:BAND:TRAC OFF&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">IFBW</span> <span class="o">=</span> <span class="n">ifbw</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.set_frequency">
    <p>def <span class="ident">set_frequency</span>(</p><p>self, start, stop=None, number_points=None, step=None, type=&#39;LIN&#39;, frequency_units=&#39;Hz&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the VNA to a linear mode and creates a single entry in the frequency table. If start is the only specified
parameter sets the entry to start=stop and number_points = 1. If step is specified calculates the number of points
and sets start, stop, number_points on the VNA. It also stores the value into the attribute frequency_list.
Note this function was primarily tested on an agilent which stores frequency to the nearest mHz.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.set_frequency', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.set_frequency" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">number_points</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;LIN&#39;</span><span class="p">,</span> <span class="n">frequency_units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the VNA to a linear mode and creates a single entry in the frequency table. If start is the only specified</span>
<span class="sd">    parameter sets the entry to start=stop and number_points = 1. If step is specified calculates the number of points</span>
<span class="sd">    and sets start, stop, number_points on the VNA. It also stores the value into the attribute frequency_list.</span>
<span class="sd">    Note this function was primarily tested on an agilent which stores frequency to the nearest mHz.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">frequency_units</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">step</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="n">unit</span>
    <span class="k">if</span> <span class="n">number_points</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">step</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">number_points</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LIN&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE LIN&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;LOG&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE LOG&#39;</span><span class="p">)</span>
        <span class="n">logspace_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">logspace_stop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logspace_start</span><span class="p">,</span> <span class="n">logspace_stop</span><span class="p">,</span>
                                                                             <span class="n">num</span><span class="o">=</span><span class="n">number_points</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SENS:SWE:TYPE LIN&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:START {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:FREQ:STOP {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stop</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SWE:POIN {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number_points</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.set_frequency_units">
    <p>def <span class="ident">set_frequency_units</span>(</p><p>self, frequency_units=&#39;Hz&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the frequency units of the class, all values are still written to the VNA
as Hz and the attrbiute frequncy_list is in Hz,
however all commands that deal with sweeps and measurements will be in units</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.set_frequency_units', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.set_frequency_units" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_frequency_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the frequency units of the class, all values are still written to the VNA</span>
<span class="sd">    as Hz and the attrbiute frequncy_list is in Hz,</span>
<span class="sd">    however all commands that deal with sweeps and measurements will be in units&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">VNA_FREQUENCY_UNIT_MULTIPLIERS</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">frequency_units</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="n">unit</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.set_power">
    <p>def <span class="ident">set_power</span>(</p><p>self, power)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the power of the Instrument in dbm</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.set_power', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.set_power" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the power of the Instrument in dbm&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SOUR:POW {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.set_source_output">
    <p>def <span class="ident">set_source_output</span>(</p><p>self, state=0)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets all of the outputs of the VNA to OFF(0) or ON (1). This disables/enables all the source outputs.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.set_source_output', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.set_source_output" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_source_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets all of the outputs of the VNA to OFF(0) or ON (1). This disables/enables all the source outputs.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;OUTP {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.set_state">
    <p>def <span class="ident">set_state</span>(</p><p>self, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the instrument to the state specified by Command:Value pairs</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.set_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.set_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Sets the instrument to the state specified by Command:Value pairs&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">state_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="c1"># now we need to write the command</span>
        <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="c1"># a state row has a set and value</span>
            <span class="n">state_command</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
            <span class="n">value</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.show">
    <p>def <span class="ident">show</span>(</p><p>self, mode=&#39;Window&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Displays a XML Document either as formatted text in the command line or in a
window (using wx)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.show', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.show" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;Window&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Displays a XML Document either as formatted text in the command line or in a</span>
<span class="sd">    window (using wx)&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">tag_to_tagName</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tagName</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span><span class="s1">&#39;cmd line&#39;</span><span class="p">,</span><span class="s1">&#39;cmd&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Entry Index: </span><span class="si">%s</span><span class="s1"> </span><span class="se">\t</span><span class="s1">Date: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span>
            <span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;xml&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Window|wx&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">wx</span>
            <span class="kn">import</span> <span class="nn">wx.html2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Cannot locate wx, please add to sys.path&#39;</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">html2</span><span class="o">.</span><span class="n">WebView</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">.</span><span class="n">SetPage</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">()),</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.to_HTML">
    <p>def <span class="ident">to_HTML</span>(</p><p>self, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns HTML string by applying a XSL to the XML document</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.to_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.to_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">to_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns HTML string by applying a XSL to the XML document&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">XSL_data</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="n">XSL_transform</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">XSLT</span><span class="p">(</span><span class="n">XSL_data</span><span class="p">)</span>
    <span class="n">HTML</span><span class="o">=</span><span class="n">XSL_transform</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">()))</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.trigger_sweep">
    <p>def <span class="ident">trigger_sweep</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Triggers a single sweep of the VNA, note you need to wait for the sweep to finish before reading the
values. It takes ~ #ports sourced*#points/IFBW</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.trigger_sweep', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.trigger_sweep" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">trigger_sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Triggers a single sweep of the VNA, note you need to wait for the sweep to finish before reading the</span>
<span class="sd">    values. It takes ~ #ports sourced*#points/IFBW &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INITiate:CONTinuous OFF&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT;INITiate:IMMediate;*wai&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.update_current_state">
    <p>def <span class="ident">update_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.update_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.update_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.update_document">
    <p>def <span class="ident">update_document</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute document from the self.etree.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.update_document', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.update_document" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Updates the attribute document from the self.etree. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">=</span><span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">etree</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.update_etree">
    <p>def <span class="ident">update_etree</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute etree. Should be called anytime the xml content is changed</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.update_etree', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.update_etree" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_etree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Updates the attribute etree. Should be called anytime the xml content is changed&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">etree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.write">
    <p>def <span class="ident">write</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command to instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.write', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command to instrument&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VNA.write_frequency_table">
    <p>def <span class="ident">write_frequency_table</span>(</p><p>self, frequency_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes frequency_table to the instrument, the frequency table should be in the form
[{start:,stop:,number_points:}..] or None</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VNA.write_frequency_table', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VNA.write_frequency_table" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write_frequency_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Writes frequency_table to the instrument, the frequency table should be in the form</span>
<span class="sd">    [{start:,stop:,number_points:}..] or None&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">frequency_table</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">frequency_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_table</span><span class="p">[:]</span>
    <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frequency_table</span><span class="p">[:]):</span>
        <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">number_points</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;stop&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;number_points&quot;</span><span class="p">]]</span>
        <span class="c1"># SENSe&lt;cnum&gt;:SEGMent&lt;snum&gt;:SWEep:POINts &lt;num&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:START {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:FREQ:STOP {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:SWE:POIN {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">number_points</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SENS:SEGM{0}:STAT ON&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.VNA.options" class="name">var <span class="ident">options</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument">VisaInstrument</a></code>.<code><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument.options">options</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument" class="name">class <span class="ident">VisaInstrument</span></p>
      
  
    <div class="desc"><p>General Class to communicate with COMM and GPIB instruments
This is a blend of the pyvisa resource and an xml description. If there is no device connected
 enters into a fake mode. Where all the commands are logged as .history and the attribute fake_mode=True</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">VisaInstrument</span><span class="p">(</span><span class="n">InstrumentSheet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; General Class to communicate with COMM and GPIB instruments</span>
<span class="sd">    This is a blend of the pyvisa resource and an xml description. If there is no device connected</span>
<span class="sd">     enters into a fake mode. Where all the commands are logged as .history and the attribute fake_mode=True&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes the VisaInstrument Class&quot;&quot;&quot;</span>
        <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                  <span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
        <span class="c1"># First we try to look up the description and get info from it</span>
        <span class="k">if</span> <span class="n">DATA_SHEETS</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="o">=</span><span class="n">find_description</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span>
                                                <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">])</span>
                <span class="n">InstrumentSheet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_query_dictionary</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The information sheet was not found defaulting to address&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">resource_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
        
        <span class="c1"># Create a description for state saving</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="o">=</span><span class="mi">10</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">=</span><span class="n">visa</span><span class="o">.</span><span class="n">ResourceManager</span><span class="p">()</span>
            <span class="c1"># Call the visa instrument class-- this gives ask,write,read</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Unable to load resource entering fake mode ...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="n">FakeInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">history</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span><span class="o">=</span><span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command to instrument&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Reads from the instrument&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command and then reads a response&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
        <span class="s2">&quot;Writes command and then reads a response&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the instrument to the state specified by Command:Value pairs&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">state_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">state_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
            <span class="c1"># now we need to write the command</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_table</span><span class="p">:</span>
                <span class="c1"># a state row has a set and value</span>
                <span class="n">state_command</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">value</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            
    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_query_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the current state of the instrument. get_state accepts any query dictionary in</span>
<span class="sd">        the form state_query_dictionary={&quot;GPIB_SET_COMMAND&quot;:&quot;GPIB_QUERY_COMMAND&quot;,...} or any state_query_table</span>
<span class="sd">        in the form [{&quot;Set&quot;:&quot;GPIB_SET_COMMAND&quot;,&quot;Query&quot;:&quot;GPIB_QUERY_COMMAND&quot;,&quot;Index&quot;:Optional_int_ordering commands,</span>
<span class="sd">        if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state_query_table</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state_query_dictionary</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_query_dictionary</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
                <span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span>
            <span class="n">state</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">state_command</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">query</span>
            <span class="ow">in</span> <span class="n">state_query_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="k">return</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># a state_query_table is a list of dictionaries, each row has at least a Set and Query key but could</span>
            <span class="c1"># have an Index key that denotes order</span>
            <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">state_query_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]))</span>
                <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                    <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                    <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span><span class="s2">&quot;Index&quot;</span><span class="p">:</span><span class="n">index</span><span class="p">})</span>
                <span class="k">return</span> <span class="n">state</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                    <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                    <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)})</span>
                <span class="k">return</span> <span class="n">state</span>
    
    <span class="k">def</span> <span class="nf">update_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
   
    <span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves the state in self.current_state attribute &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">state_path</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">general_descriptor</span><span class="o">=</span><span class="s2">&quot;State&quot;</span><span class="p">,</span>
                                 <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;state_directory&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
            <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="n">state_dictionary</span><span class="p">,</span>
                                              <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_table&quot;</span><span class="p">:</span><span class="n">state_table</span><span class="p">,</span>
                                              <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
                                              <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_state</span><span class="o">.</span><span class="n">add_state_description</span><span class="p">()</span>
            <span class="n">new_state</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">description_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">raise</span> <span class="c1">#pass</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state_path</span>

    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads a state from a file.&quot;&quot;&quot;</span>
        <span class="c1">#TODO put a UDT to state_table</span>
        <span class="n">state_model</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state_table</span><span class="o">=</span><span class="n">state_model</span><span class="o">.</span><span class="n">get_state_list_dictionary</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes the VISA session&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrument">VisaInstrument</a></li>
          <li>Code.DataHandlers.XMLModels.InstrumentSheet</li>
          <li>Code.DataHandlers.XMLModels.XMLBase</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, resource_name=None, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Initializes the VisaInstrument Class</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resource_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initializes the VisaInstrument Class&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;state_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
              <span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PYMEASURE_ROOT</span><span class="p">,</span><span class="s1">&#39;Instruments&#39;</span><span class="p">)}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="c1"># First we try to look up the description and get info from it</span>
    <span class="k">if</span> <span class="n">DATA_SHEETS</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="o">=</span><span class="n">find_description</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span>
                                            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrument_description_directory&quot;</span><span class="p">])</span>
            <span class="n">InstrumentSheet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_query_dictionary</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;The information sheet was not found defaulting to address&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">resource_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="o">=</span><span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="o">=</span><span class="n">resource_name</span>
    
    <span class="c1"># Create a description for state saving</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_found</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Instrument_Description&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">}</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">=</span><span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="o">=</span><span class="mi">10</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">=</span><span class="n">visa</span><span class="o">.</span><span class="n">ResourceManager</span><span class="p">()</span>
        <span class="c1"># Call the visa instrument class-- this gives ask,write,read</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Unable to load resource entering fake mode ...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">=</span><span class="n">FakeInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instrument_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">history</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fake_mode</span><span class="o">=</span><span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.add_entry">
    <p>def <span class="ident">add_entry</span>(</p><p>self, tag_name, text=None, description=&#39;Specific&#39;, **attribute_dictionary)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds an entry to the instrument sheet.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.add_entry', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.add_entry" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag_name</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">attribute_dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds an entry to the instrument sheet.&quot;&quot;&quot;</span>
    <span class="n">specific_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;Specific&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">general_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;General&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">specific_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Specific_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">general_match</span><span class="p">,</span><span class="n">description</span><span class="p">):</span>
        <span class="n">description_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;General_Information&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_entry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">text_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">text_node</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">attribute_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_attribute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">creatAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttributeNode</span><span class="p">(</span><span class="n">new_attribute</span><span class="p">)</span>
        <span class="n">new_entry</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">description_node</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">new_entry</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.ask">
    <p>def <span class="ident">ask</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.ask', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.ask" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.close">
    <p>def <span class="ident">close</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Closes the VISA session</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.close', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.close" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Closes the VISA session&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resource_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_image_path">
    <p>def <span class="ident">get_image_path</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Tries to return the image path, requires image to be in
<Image href="http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg"/> format</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_image_path', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_image_path" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_image_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tries to return the image path, requires image to be in</span>
<span class="sd">    &lt;Image href=&quot;http://132.163.53.152:8080/home_media/img/Fischione_1040.jpg&quot;/&gt; format&quot;&quot;&quot;</span>
    <span class="c1"># Take the first thing called Image</span>
    <span class="n">image_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Image&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">image_path</span><span class="o">=</span><span class="n">image_node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_query_dictionary">
    <p>def <span class="ident">get_query_dictionary</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a set:query dictionary if there is a State_Commands element</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_query_dictionary', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_query_dictionary" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_query_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a set:query dictionary if there is a State_Commands element&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">state_commands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;State_Commands&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">state_query_dictionary</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Set&#39;</span><span class="p">)</span>
        <span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Query&#39;</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">state_commands</span><span class="o">.</span><span class="n">childNodes</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeType</span> <span class="ow">is</span> \
        <span class="n">NODE_TYPE_DICTIONARY</span><span class="p">[</span><span class="s1">&#39;ELEMENT_NODE&#39;</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">state_query_dictionary</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_state">
    <p>def <span class="ident">get_state</span>(</p><p>self, state_query_dictionary=None, state_query_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Gets the current state of the instrument. get_state accepts any query dictionary in
the form state_query_dictionary={"GPIB_SET_COMMAND":"GPIB_QUERY_COMMAND",...} or any state_query_table
in the form [{"Set":"GPIB_SET_COMMAND","Query":"GPIB_QUERY_COMMAND","Index":Optional_int_ordering commands,
if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.get_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_query_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Gets the current state of the instrument. get_state accepts any query dictionary in</span>
<span class="sd">    the form state_query_dictionary={&quot;GPIB_SET_COMMAND&quot;:&quot;GPIB_QUERY_COMMAND&quot;,...} or any state_query_table</span>
<span class="sd">    in the form [{&quot;Set&quot;:&quot;GPIB_SET_COMMAND&quot;,&quot;Query&quot;:&quot;GPIB_QUERY_COMMAND&quot;,&quot;Index&quot;:Optional_int_ordering commands,</span>
<span class="sd">    if no state is provided it returns the DEFAULT_STATE_QUERY_DICTIONARY as read in from the InstrumentSheet&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">state_query_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state_query_dictionary</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_query_dictionary</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
            <span class="n">state_query_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STATE_QUERY_DICTIONARY</span>
        <span class="n">state</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">state_command</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">query</span>
        <span class="ow">in</span> <span class="n">state_query_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">state</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># a state_query_table is a list of dictionaries, each row has at least a Set and Query key but could</span>
        <span class="c1"># have an Index key that denotes order</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_query_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_query_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]))</span>
            <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">index</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span><span class="s2">&quot;Index&quot;</span><span class="p">:</span><span class="n">index</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_query_table</span><span class="p">:</span>
                <span class="nb">set</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
                <span class="n">query</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Query&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;Set&quot;</span><span class="p">:</span><span class="nb">set</span><span class="p">,</span><span class="s2">&quot;Value&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)})</span>
            <span class="k">return</span> <span class="n">state</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.load_state">
    <p>def <span class="ident">load_state</span>(</p><p>self, file_path)</p>
    </div>
    

    
  
    <div class="desc"><p>Loads a state from a file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.load_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.load_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads a state from a file.&quot;&quot;&quot;</span>
    <span class="c1">#TODO put a UDT to state_table</span>
    <span class="n">state_model</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state_table</span><span class="o">=</span><span class="n">state_model</span><span class="o">.</span><span class="n">get_state_list_dictionary</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.query">
    <p>def <span class="ident">query</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command and then reads a response</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.query', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.query" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command and then reads a response&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.read">
    <p>def <span class="ident">read</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Reads from the instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.read', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.read" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Reads from the instrument&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save">
    <p>def <span class="ident">save</span>(</p><p>self, path=None)</p>
    </div>
    

    
  
    <div class="desc"><p>" Saves as an XML file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot; Saves as an XML file&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span>
    <span class="n">file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    <span class="n">file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_HTML">
    <p>def <span class="ident">save_HTML</span>(</p><p>self, file_path=None, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves a HTML transformation of the XML document using XLST at file_path. Defaults to
an XLST in self.options["XSLT"] and file_path=self.path.replace('.xml','.html')</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves a HTML transformation of the XML document using XLST at file_path. Defaults to</span>
<span class="sd">    an XLST in self.options[&quot;XSLT&quot;] and file_path=self.path.replace(&#39;.xml&#39;,&#39;.html&#39;)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">HTML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">(</span><span class="n">XSLT</span><span class="o">=</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="c1">#print type(HTML)</span>
    <span class="k">if</span> <span class="n">file_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span><span class="s1">&#39;.html&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
    <span class="n">out_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_current_state">
    <p>def <span class="ident">save_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves the state in self.current_state attribute</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves the state in self.current_state attribute &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_state">
    <p>def <span class="ident">save_state</span>(</p><p>self, state_path=None, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.save_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Saves any state dictionary to an xml file, with state_path, if not specified defaults to autonamed state</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">state_path</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">general_descriptor</span><span class="o">=</span><span class="s2">&quot;State&quot;</span><span class="p">,</span>
                             <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;state_directory&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="n">state_dictionary</span><span class="p">,</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_table&quot;</span><span class="p">:</span><span class="n">state_table</span><span class="p">,</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">=</span><span class="n">InstrumentState</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;state_dictionary&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span>
                                          <span class="s2">&quot;style_sheet&quot;</span><span class="p">:</span><span class="s2">&quot;./DEFAULT_STATE_STYLE.xsl&quot;</span><span class="p">})</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">add_state_description</span><span class="p">()</span>
        <span class="n">new_state</span><span class="o">.</span><span class="n">append_description</span><span class="p">(</span><span class="n">description_dictionary</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">raise</span> <span class="c1">#pass</span>
    <span class="n">new_state</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">state_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state_path</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.set_state">
    <p>def <span class="ident">set_state</span>(</p><p>self, state_dictionary=None, state_table=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets the instrument to the state specified by Command:Value pairs</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.set_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.set_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state_dictionary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">state_table</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Sets the instrument to the state specified by Command:Value pairs&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">state_dictionary</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">state_command</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">state_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">state_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;Index&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">state_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">state_table</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state_table</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Index&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_BUFFER_MAX_LENGTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_buffer</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="c1"># now we need to write the command</span>
        <span class="k">for</span> <span class="n">state_row</span> <span class="ow">in</span> <span class="n">state_table</span><span class="p">:</span>
            <span class="c1"># a state row has a set and value</span>
            <span class="n">state_command</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Set&quot;</span><span class="p">]</span>
            <span class="n">value</span><span class="o">=</span><span class="n">state_row</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state_command</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.show">
    <p>def <span class="ident">show</span>(</p><p>self, mode=&#39;Window&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Displays a XML Document either as formatted text in the command line or in a
window (using wx)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.show', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.show" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;Window&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Displays a XML Document either as formatted text in the command line or in a</span>
<span class="sd">    window (using wx)&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">tag_to_tagName</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tag</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">tagName</span><span class="o">=</span><span class="n">tagName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tagName</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span><span class="s1">&#39;cmd line&#39;</span><span class="p">,</span><span class="s1">&#39;cmd&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Entry Index: </span><span class="si">%s</span><span class="s1"> </span><span class="se">\t</span><span class="s1">Date: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span>
            <span class="n">node</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;xml&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;Entry&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">toprettyxml</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Window|wx&#39;</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">wx</span>
            <span class="kn">import</span> <span class="nn">wx.html2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Cannot locate wx, please add to sys.path&#39;</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">html2</span><span class="o">.</span><span class="n">WebView</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">html_window</span><span class="o">.</span><span class="n">SetPage</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_HTML</span><span class="p">()),</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.to_HTML">
    <p>def <span class="ident">to_HTML</span>(</p><p>self, XSLT=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns HTML string by applying a XSL to the XML document</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.to_HTML', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.to_HTML" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">to_HTML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">XSLT</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns HTML string by applying a XSL to the XML document&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">XSLT</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># For some reason an absolute path tends to break here, maybe a spaces in file names problem</span>
        <span class="n">XSLT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;style_sheet&#39;</span><span class="p">]</span>
    <span class="n">XSL_data</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">XSLT</span><span class="p">)</span>
    <span class="n">XSL_transform</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">XSLT</span><span class="p">(</span><span class="n">XSL_data</span><span class="p">)</span>
    <span class="n">HTML</span><span class="o">=</span><span class="n">XSL_transform</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">()))</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">HTML</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_current_state">
    <p>def <span class="ident">update_current_state</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_current_state', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_current_state" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_document">
    <p>def <span class="ident">update_document</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute document from the self.etree.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_document', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_document" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Updates the attribute document from the self.etree. &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">=</span><span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">etree</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_etree">
    <p>def <span class="ident">update_etree</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the attribute etree. Should be called anytime the xml content is changed</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_etree', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.update_etree" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_etree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Updates the attribute etree. Should be called anytime the xml content is changed&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">etree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">toxml</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.write">
    <p>def <span class="ident">write</span>(</p><p>self, command)</p>
    </div>
    

    
  
    <div class="desc"><p>Writes command to instrument</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.write', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrument.write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>
    <span class="s2">&quot;Writes command to instrument&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.STATE_BUFFER_MAX_LENGTH" class="name">var <span class="ident">STATE_BUFFER_MAX_LENGTH</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.current_state" class="name">var <span class="ident">current_state</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.options" class="name">var <span class="ident">options</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.VisaInstrument.state_buffer" class="name">var <span class="ident">state_buffer</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.VisaInstrumentError" class="name">class <span class="ident">VisaInstrumentError</span></p>
      
  
    <div class="desc"><p>Common base class for all non-exit exceptions.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrumentError', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrumentError" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">VisaInstrumentError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pyMez.Code.InstrumentControl.Instruments.VisaInstrumentError">VisaInstrumentError</a></li>
          <li>builtins.Exception</li>
          <li>builtins.BaseException</li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="pyMez.Code.InstrumentControl.Instruments.VisaInstrumentError.args" class="name">var <span class="ident">args</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="pyMez.Code.InstrumentControl.Instruments.VisaInstrumentError.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, *args)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.InstrumentControl.Instruments.VisaInstrumentError.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.InstrumentControl.Instruments.VisaInstrumentError.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>


	
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.ACTIVE_COMPONENTS" class="name">var <span class="ident">ACTIVE_COMPONENTS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.COMBINE_S11_S22" class="name">var <span class="ident">COMBINE_S11_S22</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.COMMENT_PATTERN" class="name">var <span class="ident">COMMENT_PATTERN</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.CONVERT_S21" class="name">var <span class="ident">CONVERT_S21</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.DATA_SHEETS" class="name">var <span class="ident">DATA_SHEETS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.DEFAULT_FILE_NAME" class="name">var <span class="ident">DEFAULT_FILE_NAME</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.DEFAULT_MODE" class="name">var <span class="ident">DEFAULT_MODE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.DUT_COLUMN_NAMES" class="name">var <span class="ident">DUT_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.EXTENSION_PATTERN" class="name">var <span class="ident">EXTENSION_PATTERN</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.FORMATS" class="name">var <span class="ident">FORMATS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.FREQUENCY_UNITS" class="name">var <span class="ident">FREQUENCY_UNITS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.GENERAL_DESCRIPTORS" class="name">var <span class="ident">GENERAL_DESCRIPTORS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.INSTRUMENTS_DEFINED" class="name">var <span class="ident">INSTRUMENTS_DEFINED</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.INSTRUMENT_TYPES" class="name">var <span class="ident">INSTRUMENT_TYPES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.METHOD_ALIASES" class="name">var <span class="ident">METHOD_ALIASES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.MINIMUM_DB_ARG_VALUE" class="name">var <span class="ident">MINIMUM_DB_ARG_VALUE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.MINIMUM_DB_VALUE" class="name">var <span class="ident">MINIMUM_DB_VALUE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.NUMBER_MATCH_STRING" class="name">var <span class="ident">NUMBER_MATCH_STRING</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.ONE_PORT_COLUMN_NAMES" class="name">var <span class="ident">ONE_PORT_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.OPTION_LINE_PATTERN" class="name">var <span class="ident">OPTION_LINE_PATTERN</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.PARAMETERS" class="name">var <span class="ident">PARAMETERS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.PIL_AVAILABLE" class="name">var <span class="ident">PIL_AVAILABLE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.POWER_3TERM_COLUMN_DESCRIPTIONS" class="name">var <span class="ident">POWER_3TERM_COLUMN_DESCRIPTIONS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.POWER_3TERM_COLUMN_NAMES" class="name">var <span class="ident">POWER_3TERM_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.POWER_4TERM_COLUMN_DESCRIPTIONS" class="name">var <span class="ident">POWER_4TERM_COLUMN_DESCRIPTIONS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.POWER_4TERM_COLUMN_NAMES" class="name">var <span class="ident">POWER_4TERM_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.PYMEASURE_ROOT" class="name">var <span class="ident">PYMEASURE_ROOT</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.RESULTS_FILE_ONE_PORT_COLUMN_NAMES" class="name">var <span class="ident">RESULTS_FILE_ONE_PORT_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.RESULTS_FILE_POWER_COLUMN_NAMES" class="name">var <span class="ident">RESULTS_FILE_POWER_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.RESULTS_FILE_TWO_PORT_COLUMN_NAMES" class="name">var <span class="ident">RESULTS_FILE_TWO_PORT_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.RTLD_GLOBAL" class="name">var <span class="ident">RTLD_GLOBAL</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.RTLD_LOCAL" class="name">var <span class="ident">RTLD_LOCAL</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.S1P_DB_COLUMN_NAMES" class="name">var <span class="ident">S1P_DB_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.S1P_MA_COLUMN_NAMES" class="name">var <span class="ident">S1P_MA_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.S1P_RI_COLUMN_NAMES" class="name">var <span class="ident">S1P_RI_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.S2P_COMPLEX_COLUMN_NAMES" class="name">var <span class="ident">S2P_COMPLEX_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.S2P_DB_COLUMN_DESCRIPTION" class="name">var <span class="ident">S2P_DB_COLUMN_DESCRIPTION</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.S2P_DB_COLUMN_NAMES" class="name">var <span class="ident">S2P_DB_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.S2P_MA_COLUMN_DESCRIPTION" class="name">var <span class="ident">S2P_MA_COLUMN_DESCRIPTION</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.S2P_MA_COLUMN_NAMES" class="name">var <span class="ident">S2P_MA_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.S2P_NOISE_PARAMETER_COLUMN_NAMES" class="name">var <span class="ident">S2P_NOISE_PARAMETER_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.S2P_RI_COLUMN_DESCRIPTION" class="name">var <span class="ident">S2P_RI_COLUMN_DESCRIPTION</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.S2P_RI_COLUMN_NAMES" class="name">var <span class="ident">S2P_RI_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.SMITHPLOT" class="name">var <span class="ident">SMITHPLOT</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.TESTS_DIRECTORY" class="name">var <span class="ident">TESTS_DIRECTORY</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.TOUCHSTONE_KEYWORDS" class="name">var <span class="ident">TOUCHSTONE_KEYWORDS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.TWELVE_TERM_ERROR_COLUMN_NAMES" class="name">var <span class="ident">TWELVE_TERM_ERROR_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.VNA_FREQUENCY_UNIT_MULTIPLIERS" class="name">var <span class="ident">VNA_FREQUENCY_UNIT_MULTIPLIERS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.InstrumentControl.Instruments.type_names" class="name">var <span class="ident">type_names</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
