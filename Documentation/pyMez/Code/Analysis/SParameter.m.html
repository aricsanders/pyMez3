<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <title>pyMez.Code.Analysis.SParameter API documentation</title>
    <meta name="description" content="Sparameter is a module with tools for analyzing Scattering parameter data. It contains functions
for..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
	word-wrap: break-word;
  }
  
  .toggleButton {
      background-color: white;
      border: 2px solid black;
       border-radius: 8px;
       color:red;
	   }
   .toggleButton:hover {
    box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);
	}
	
	#functionsNavigation, #classesNavigation, #variablesNavigation {
	display:none;
	}
  
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
	
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  

    function toggleId(id,$link){
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.value = '-';
    } else {
    $node.style.display = 'none';
    $link.value = '+';
    }
  }
  </script>
</head>
<body>
<a id="top"></a>
        <table style='border-style:none;'>
        <tr style="border-style:none;">
        <td style="border-style:none;">
        <a href='../../../pyMez_Documentation.html'><button type="button" class='btn btn-primary'>
        <span style="font-size:20px">Documentation Home</span></button></a>
        </td>
        <td style="border-style:none;">
        <a href='../../index.html'><button type="button" class='btn btn-primary'>
        <span style="font-size:20px">API Documentation</span></button></a>
        </td>
        <td style="border-style:none;">
        <a href='../../../Examples/html/Examples_Home.html'>
        <button type="button" class='btn btn-primary'>
        <span style="font-size:20px">Examples</span></button></a>
        </td>
        <td style="border-style:none;">
        <a href='../../../Reference_Index.html'>
        <button type="button" class='btn btn-primary'>
        <span style="font-size:20px">Index</span></button></a>
        </td>
        </tr>
        </table><a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a>
	<input type="button" class="toggleButton"  value="+" onclick="toggleId('functionsNavigation',this)">
	</h3>
	<div id="functionsNavigation">
      
  <ul>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S_to_T">S_to_T</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.T_to_S">T_to_S</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.add_white_noise_s2p">add_white_noise_s2p</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.average_one_port_sparameters">average_one_port_sparameters</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.calrep">calrep</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.calrep_history_plot">calrep_history_plot</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.cascade">cascade</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.compare_s2p_plots">compare_s2p_plots</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.correct_sparameters">correct_sparameters</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.correct_sparameters_eight_term">correct_sparameters_eight_term</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.correct_sparameters_sixteen_term">correct_sparameters_sixteen_term</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.correct_sparameters_twelve_term">correct_sparameters_twelve_term</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.create_monte_carlo_reference_curve">create_monte_carlo_reference_curve</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.create_sensitivity_reference_curve">create_sensitivity_reference_curve</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.frequency_model_collapse_multiple_measurements">frequency_model_collapse_multiple_measurements</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.frequency_model_difference">frequency_model_difference</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.invert_two_port_matrix_list">invert_two_port_matrix_list</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.mean_from_history">mean_from_history</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.median_from_history">median_from_history</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.one_port_robin_comparison_plot">one_port_robin_comparison_plot</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.plot_calrep">plot_calrep</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.plot_calrep_comparison">plot_calrep_comparison</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.plot_calrep_results_comparison">plot_calrep_results_comparison</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.plot_calrep_results_difference_comparison">plot_calrep_results_difference_comparison</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.plot_calrep_uncertainty">plot_calrep_uncertainty</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.plot_checkstandard_history">plot_checkstandard_history</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.plot_frequency_model">plot_frequency_model</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.plot_frequency_model_histogram">plot_frequency_model_histogram</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.plot_raw_MUF_comparison">plot_raw_MUF_comparison</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.plot_reference_curve">plot_reference_curve</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.plot_reference_curve_comparison">plot_reference_curve_comparison</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.polar_average">polar_average</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.polar_geometric_average">polar_geometric_average</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.raw_comparison_plot_with_residuals">raw_comparison_plot_with_residuals</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.raw_difference_frame">raw_difference_frame</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.return_calrep_error_column_names">return_calrep_error_column_names</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.return_calrep_value_column_names">return_calrep_value_column_names</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.return_history_key">return_history_key</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.test_average_one_port_sparameters">test_average_one_port_sparameters</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.test_compare_s2p_plots">test_compare_s2p_plots</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.test_comparison">test_comparison</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.two_port_comparison_plot_with_residuals">two_port_comparison_plot_with_residuals</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.two_port_complex_to_matrix_form">two_port_complex_to_matrix_form</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.two_port_difference_frame">two_port_difference_frame</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.two_port_matrix_to_complex_form">two_port_matrix_to_complex_form</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.two_port_mean_frame">two_port_mean_frame</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.two_port_swap_ports">two_port_swap_ports</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.uncorrect_sparameters_eight_term">uncorrect_sparameters_eight_term</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.uncorrect_sparameters_sixteen_term">uncorrect_sparameters_sixteen_term</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.uncorrect_sparameters_twelve_term">uncorrect_sparameters_twelve_term</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.unwrap_phase">unwrap_phase</a></li>
  </ul>

	 </div>
    </li>



    
	<li class="set"><h3><a href="#header-variables">Module variables</a>
	<input type="button" class="toggleButton" value="+" onclick="toggleId('variablesNavigation',this)"></h3>
	<div id="variablesNavigation">
      
  <ul>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.COMBINE_S11_S22">COMBINE_S11_S22</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.COMMENT_PATTERN">COMMENT_PATTERN</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.CONNECTOR_TYPES">CONNECTOR_TYPES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.CONVERT_S21">CONVERT_S21</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.DEFAULT_FILE_NAME">DEFAULT_FILE_NAME</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.DEFAULT_INSTRUMENT_SHEET_STYLE">DEFAULT_INSTRUMENT_SHEET_STYLE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.DEFAULT_INSTRUMENT_STATE_STYLE">DEFAULT_INSTRUMENT_STATE_STYLE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.DEFAULT_LOG_STYLE">DEFAULT_LOG_STYLE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.DEFAULT_MEASUREMENT_STYLE">DEFAULT_MEASUREMENT_STYLE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.DEFAULT_METADATA_STYLE">DEFAULT_METADATA_STYLE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.DEFAULT_REGISTER_STYLE">DEFAULT_REGISTER_STYLE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.DEFAULT_STYLE">DEFAULT_STYLE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.DRIVER_FILE_EXTENSIONS">DRIVER_FILE_EXTENSIONS</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.DUT_COLUMN_NAMES">DUT_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.EXIF_AVAILABLE">EXIF_AVAILABLE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.EXTENSION_PATTERN">EXTENSION_PATTERN</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.FORMATS">FORMATS</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.FREQUENCY_UNITS">FREQUENCY_UNITS</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.GET_STATS_FIELDS">GET_STATS_FIELDS</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.HTML_TEMPLATE_DIRECTORY">HTML_TEMPLATE_DIRECTORY</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.IMAGE_FILE_EXTENSIONS">IMAGE_FILE_EXTENSIONS</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.INKSCAPE_PATH">INKSCAPE_PATH</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.INSTRUMENT_SHEETS">INSTRUMENT_SHEETS</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.METHOD_ALIASES">METHOD_ALIASES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.MINIMUM_DB">MINIMUM_DB</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.MINIMUM_DB_ARG_VALUE">MINIMUM_DB_ARG_VALUE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.MINIMUM_DB_VALUE">MINIMUM_DB_VALUE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.NODE_TYPE_DICTIONARY">NODE_TYPE_DICTIONARY</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.NUMBER_MATCH_STRING">NUMBER_MATCH_STRING</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.ONE_PORT_COLUMN_NAMES">ONE_PORT_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.ONE_PORT_DUT">ONE_PORT_DUT</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.OPTION_LINE_PATTERN">OPTION_LINE_PATTERN</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.OS_STAT_FIELDS">OS_STAT_FIELDS</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.PARAMETERS">PARAMETERS</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.PDF_CONVERT">PDF_CONVERT</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.PIL_AVAILABLE">PIL_AVAILABLE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.POWER_3TERM_COLUMN_DESCRIPTIONS">POWER_3TERM_COLUMN_DESCRIPTIONS</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.POWER_3TERM_COLUMN_NAMES">POWER_3TERM_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.POWER_4TERM_COLUMN_DESCRIPTIONS">POWER_4TERM_COLUMN_DESCRIPTIONS</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.POWER_4TERM_COLUMN_NAMES">POWER_4TERM_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.PYMEASURE_ROOT">PYMEASURE_ROOT</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.RESULTS_FILE_ONE_PORT_COLUMN_NAMES">RESULTS_FILE_ONE_PORT_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.RESULTS_FILE_POWER_COLUMN_NAMES">RESULTS_FILE_POWER_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.RESULTS_FILE_TWO_PORT_COLUMN_NAMES">RESULTS_FILE_TWO_PORT_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S1P_DB_COLUMN_NAMES">S1P_DB_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S1P_MA_COLUMN_NAMES">S1P_MA_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S1P_RI_COLUMN_NAMES">S1P_RI_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S2P_COMPLEX_COLUMN_NAMES">S2P_COMPLEX_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S2P_DB_COLUMN_DESCRIPTION">S2P_DB_COLUMN_DESCRIPTION</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S2P_DB_COLUMN_NAMES">S2P_DB_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S2P_MA_COLUMN_DESCRIPTION">S2P_MA_COLUMN_DESCRIPTION</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S2P_MA_COLUMN_NAMES">S2P_MA_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S2P_NOISE_PARAMETER_COLUMN_NAMES">S2P_NOISE_PARAMETER_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S2P_RI_COLUMN_DESCRIPTION">S2P_RI_COLUMN_DESCRIPTION</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.S2P_RI_COLUMN_NAMES">S2P_RI_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.SMITHPLOT">SMITHPLOT</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.SOLUTION_VECTOR_COLUMN_NAMES">SOLUTION_VECTOR_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.StringTypes">StringTypes</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.TESTS_DIRECTORY">TESTS_DIRECTORY</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.TOUCHSTONE_KEYWORDS">TOUCHSTONE_KEYWORDS</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.TWELVE_TERM_ERROR_COLUMN_NAMES">TWELVE_TERM_ERROR_COLUMN_NAMES</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.WINDOWS_COM">WINDOWS_COM</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.WINDOWS_WRAPPER">WINDOWS_WRAPPER</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.WKHTML_PATH">WKHTML_PATH</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.XSLT_CAPABLE">XSLT_CAPABLE</a></li>
    <li class="mono"><a href="#pyMez.Code.Analysis.SParameter.XSLT_REPOSITORY">XSLT_REPOSITORY</a></li>
  </ul>

	  </div>
    </li>
    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">pyMez.Code.Analysis.SParameter</span> module</h1>
  <p>Sparameter is a module with tools for analyzing Scattering parameter data. It contains functions
for comparing, applying corrections, uncertainty analysis and plotting scattering parameters.
see also <a href="./NISTUncertainty.m.html">NISTUncertainty</a></p>
<h2>Examples</h2>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;</span><span class="n">test_compare_s2p_plots</span><span class="p">()</span>
</pre></div>


<p><h3><a href="../../../Examples/html/SParameter_Example.html">SParameter Example</a></h3></p>
<h2>Requirements</h2>
<ul>
<li><a href="https://docs.python.org/2/library/sys.html">sys</a></li>
<li><a href="https://docs.python.org/2/library/os.html">os</a></li>
<li><a href="https://docs.python.org/2/library/re.html">re</a></li>
<li><a href="https://docs.python.org/2/library/datetime.html">datetime</a></li>
<li><a href="https://docs.python.org/2/library/math.html">math</a></li>
<li><a href="https://docs.python.org/2/library/cmath.html">cmath</a></li>
<li><a href="https://docs.scipy.org/doc/">numpy</a></li>
<li><a href="https://docs.scipy.org/doc/">scipy</a></li>
<li><a href="http://pandas.pydata.org/">pandas</a></li>
<li><a href="http://matplotlib.org/">matplotlib</a></li>
<li><a href="https://github.com/aricsanders/pyMez">pyMez</a></li>
</ul>
<h2>Help</h2>
<p><a href="./index.html"><code>pyMez.Code.Analysis</code></a>
<div>
<a href="../../../pyMez_Documentation.html">Documentation Home</a> |
<a href="../../index.html">API Documentation Home</a> |
<a href="../../../Examples/html/Examples_Home.html">Examples Home</a> |
<a href="../../../Reference_Index.html">Index</a>
</div></p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter" class="source">
    <div class="codehilite"><pre><span></span><span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Name:        SParameter.py</span>
<span class="c1"># Purpose:    Tools to analyze SParameter Data</span>
<span class="c1"># Author:      Aric Sanders</span>
<span class="c1"># Created:     4/13/2016</span>
<span class="c1"># License:     MIT License</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot; Sparameter is a module with tools for analyzing Scattering parameter data. It contains functions</span>
<span class="sd">for comparing, applying corrections, uncertainty analysis and plotting scattering parameters.</span>
<span class="sd">see also &lt;a href=&quot;./NISTUncertainty.m.html&quot;&gt;NISTUncertainty&lt;/a&gt;</span>



<span class="sd"> Examples</span>
<span class="sd">--------</span>
<span class="sd">    #!python</span>
<span class="sd">    &gt;&gt;test_compare_s2p_plots()</span>

<span class="sd"> &lt;h3&gt;&lt;a href=&quot;../../../Examples/html/SParameter_Example.html&quot;&gt;SParameter Example&lt;/a&gt;&lt;/h3&gt;</span>

<span class="sd">Requirements</span>
<span class="sd">------------</span>
<span class="sd">+ [sys](https://docs.python.org/2/library/sys.html)</span>
<span class="sd">+ [os](https://docs.python.org/2/library/os.html)</span>
<span class="sd">+ [re](https://docs.python.org/2/library/re.html)</span>
<span class="sd">+ [datetime](https://docs.python.org/2/library/datetime.html)</span>
<span class="sd">+ [math](https://docs.python.org/2/library/math.html)</span>
<span class="sd">+ [cmath](https://docs.python.org/2/library/cmath.html)</span>
<span class="sd">+ [numpy](https://docs.scipy.org/doc/)</span>
<span class="sd">+ [scipy](https://docs.scipy.org/doc/)</span>
<span class="sd">+ [pandas](http://pandas.pydata.org/)</span>
<span class="sd">+ [matplotlib](http://matplotlib.org/)</span>
<span class="sd">+ [pyMez](https://github.com/aricsanders/pyMez)</span>

<span class="sd">Help</span>
<span class="sd">---------------</span>
<span class="sd">&lt;a href=&quot;./index.html&quot;&gt;`pyMez.Code.Analysis`&lt;/a&gt;</span>
<span class="sd">&lt;div&gt;</span>
<span class="sd">&lt;a href=&quot;../../../pyMez_Documentation.html&quot;&gt;Documentation Home&lt;/a&gt; |</span>
<span class="sd">&lt;a href=&quot;../../index.html&quot;&gt;API Documentation Home&lt;/a&gt; |</span>
<span class="sd">&lt;a href=&quot;../../../Examples/html/Examples_Home.html&quot;&gt;Examples Home&lt;/a&gt; |</span>
<span class="sd">&lt;a href=&quot;../../../Reference_Index.html&quot;&gt;Index&lt;/a&gt;</span>
<span class="sd">&lt;/div&gt;</span>
<span class="sd">  &quot;&quot;&quot;</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Standard Imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">cmath</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Third Party Imports</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span> <span class="n">__file__</span> <span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span><span class="s1">&#39;..&#39;</span><span class="p">))</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">=</span><span class="s1">&#39;np.ndarray&#39;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Numpy was not imported&quot;</span><span class="p">)</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pandas</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Pandas was not imported&quot;</span><span class="p">)</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">scipy.stats.mstats</span> <span class="kn">import</span> <span class="n">gmean</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The function gmean from the package scipy.stats.mstats did not import correctly &quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">statsmodels.robust.scale</span> <span class="kn">import</span> <span class="n">mad</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The function mad from the package statsmodels.robust.scale did not import correctly &quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1">#Todo: this could lead to a cyclic dependency, it really should import only the models it analyzes</span>
    <span class="c1">#Todo: If analysis is to be in the top import, none of the models should rely on it</span>
    <span class="c1">#import pyMez.Code.DataHandlers.NISTModels</span>
    <span class="kn">from</span> <span class="nn">Code.DataHandlers.NISTModels</span> <span class="kn">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">Code.DataHandlers.TouchstoneModels</span> <span class="kn">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">Code.DataHandlers.GeneralModels</span> <span class="kn">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">Code.Analysis.NISTUncertainty</span> <span class="kn">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">Code.DataHandlers.Translations</span> <span class="kn">import</span> <span class="o">*</span>
    <span class="c1">#from pyMez import *</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The subpackage pyMez.Code.DataHandlers did not import properly,&quot;</span>
          <span class="s2">&quot;please check that it is on the python path and that unit tests passed&quot;</span><span class="p">)</span>
    <span class="k">raise</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The module matplotlib was not found,&quot;</span>
          <span class="s2">&quot;please put it on the python path&quot;</span><span class="p">)</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Module Constants</span>

<span class="c1"># Does this belong in tests or a Data folder</span>
<span class="c1">#Todo: This should not be here..</span>
<span class="n">ONE_PORT_DUT</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span><span class="s1">&#39;Tests&#39;</span><span class="p">)</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Module Functions</span>

<span class="k">def</span> <span class="nf">cascade</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Cascade returns the cascaded sparameters of s1 and s2. s1 and s2 should be in complex list form</span>
<span class="sd">    [[f,S11,S12,S21,S22]...] and the returned sparameters will be in the same format. Assumes that s1,s2 have the</span>
<span class="sd">    same frequencies. If 1-S2_22*S1_11 is zero we add a small non zero real part or loss.&quot;&quot;&quot;</span>
    <span class="n">out_sparameters</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s1</span><span class="p">):</span>
        <span class="p">[</span><span class="n">f1</span><span class="p">,</span><span class="n">S1_11</span><span class="p">,</span><span class="n">S1_12</span><span class="p">,</span><span class="n">S1_21</span><span class="p">,</span><span class="n">S1_22</span><span class="p">]</span><span class="o">=</span><span class="n">row</span>
        <span class="p">[</span><span class="n">f2</span><span class="p">,</span><span class="n">S2_11</span><span class="p">,</span><span class="n">S2_12</span><span class="p">,</span><span class="n">S2_21</span><span class="p">,</span><span class="n">S2_22</span><span class="p">]</span><span class="o">=</span><span class="n">s2</span><span class="p">[</span><span class="n">row_index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">f1</span><span class="o">!=</span><span class="n">f2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Frequencies do not match! F lists must be the same&quot;</span><span class="p">)</span>
        <span class="n">denominator</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">S1_22</span><span class="o">*</span><span class="n">S2_11</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">denominator</span> <span class="o">==</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">denominator</span><span class="o">=</span><span class="nb">complex</span><span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">S11</span><span class="o">=</span><span class="n">S1_11</span><span class="o">+</span><span class="n">S2_11</span><span class="o">*</span><span class="p">(</span><span class="n">S1_12</span><span class="o">*</span><span class="n">S1_21</span><span class="p">)</span><span class="o">/</span><span class="n">denominator</span>
        <span class="n">S12</span><span class="o">=</span><span class="n">S1_12</span><span class="o">*</span><span class="n">S2_12</span><span class="o">/</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span>
        <span class="n">S21</span><span class="o">=</span><span class="n">S1_21</span><span class="o">*</span><span class="n">S2_21</span><span class="o">/</span><span class="n">denominator</span>
        <span class="n">S22</span><span class="o">=</span><span class="n">S2_22</span><span class="o">+</span><span class="n">S1_22</span><span class="o">*</span><span class="p">(</span><span class="n">S2_12</span><span class="o">*</span><span class="n">S2_21</span><span class="p">)</span><span class="o">/</span><span class="n">denominator</span>
        <span class="n">new_row</span><span class="o">=</span><span class="p">[</span><span class="n">f1</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">]</span>
        <span class="n">out_sparameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_sparameters</span>

<span class="k">def</span> <span class="nf">add_white_noise_s2p</span><span class="p">(</span><span class="n">s2p_model</span><span class="p">,</span><span class="n">noise_level</span><span class="o">=.</span><span class="mo">0005</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds white noise to a s2p in RI format and returns a new s2p with the noise added to each real and imaginary component&quot;&quot;&quot;</span>
    <span class="n">s2p_model</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="s2">&quot;RI&quot;</span><span class="p">)</span>
    <span class="n">s2p_data</span><span class="o">=</span><span class="n">s2p_model</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
    <span class="n">noisy_data</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s2p_data</span><span class="p">:</span>
        <span class="n">new_row</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">sparameters</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">noise_level</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="n">new_row</span><span class="o">=</span><span class="n">new_row</span><span class="o">+</span><span class="n">sparameters</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">noisy_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="n">options</span><span class="o">=</span><span class="n">s2p_model</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">noisy_data</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sparameter_complex&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">noisy_s2p</span><span class="o">=</span><span class="n">S2PV1</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">noisy_s2p</span>

<span class="k">def</span> <span class="nf">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a model with a single set of frequencies. Default is to average values together</span>
<span class="sd">    but geometric mean, std, variance, rss, mad and median are options.</span>
<span class="sd">    Geometric means of odd number of negative values fails&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">model_1</span> <span class="o">=</span> <span class="n">DataFrame_to_AsciiDataTable</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">}</span>
    <span class="c1"># load other options from model</span>
    <span class="k">for</span> <span class="n">option</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;begin_line|end_line&#39;</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
            <span class="n">defaults</span><span class="p">[</span><span class="n">option</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">element</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">defaults</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">element</span><span class="p">][:]</span>
    <span class="c1"># We need to preserve the frequency column some how</span>
    <span class="n">collapse_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">collapse_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">collapse_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">unique_frequency_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])))</span>
    <span class="n">frequency_selector</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">column_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">out_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_frequency_list</span><span class="p">):</span>
        <span class="n">data_row</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">frequency_selector</span><span class="p">]</span> <span class="o">==</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[:])</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mean|av&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;geometric&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">gmean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;st&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;rms&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;rss&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mad&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">mad</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">new_row</span><span class="p">[</span><span class="n">frequency_selector</span><span class="p">]</span><span class="o">=</span><span class="n">frequency</span>
        <span class="n">out_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>

    <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_data</span>

    <span class="k">if</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">]:</span>
        <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> \
                                                  <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">]</span>
    <span class="n">resulting_model</span> <span class="o">=</span> <span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">collapse_options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resulting_model</span>

<span class="k">def</span> <span class="nf">frequency_model_difference</span><span class="p">(</span><span class="n">model_1</span><span class="p">,</span> <span class="n">model_2</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes the difference of two models that both have frequency and a similar set of columns. Returns an object that is</span>
<span class="sd">    a list of [[frequency,column_1,..column_n],...] where columns are the same in the models. If  a particular subset of</span>
<span class="sd">    columns is desired use columns=[&quot;Frequency&quot;,&quot;magS11] models can be any subclass of AsciiDataTable, SNP, or</span>
<span class="sd">    pandas.DataFrame, if a column is a non-numeric type it drops it. The frequency list should be unique</span>
<span class="sd">    (no multiple frequencies) for at least one model&quot;&quot;&quot;</span>
    <span class="c1"># Set up defaults and pass options</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
    <span class="n">difference_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">difference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">difference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># first check type, if it is a panadas data frame a little conversion is needed, else is for all other models</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_1</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">model_1</span> <span class="o">=</span> <span class="n">DataFrame_to_AsciiDataTable</span><span class="p">(</span><span class="n">model_1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_2</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">model_2</span> <span class="o">=</span> <span class="n">DataFrame_to_AsciiDataTable</span><span class="p">(</span><span class="n">model_2</span><span class="p">)</span>
    <span class="c1"># now start with a set of frequencies (unique values from both)</span>
    <span class="n">frequency_set_1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">model_1</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])</span>
    <span class="n">frequency_set_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">model_2</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])</span>
    <span class="n">model_2_frequency_selector</span> <span class="o">=</span> <span class="n">model_2</span><span class="o">.</span><span class="n">column_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="n">column_names_set_1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">column_names</span><span class="p">)</span>
    <span class="n">column_names_set_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">model_2</span><span class="o">.</span><span class="n">column_names</span><span class="p">)</span>

    <span class="c1"># All points must be in the intersection to be used</span>
    <span class="n">frequency_intersection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">frequency_set_1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">frequency_set_2</span><span class="p">))</span>
    <span class="n">column_names_intersection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">column_names_set_1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">column_names_set_2</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">frequency_intersection</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The models do not have any frequency points in common&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">new_column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">column_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">column_index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">column_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names_intersection</span> <span class="ow">and</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]:</span>
            <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
            <span class="n">column_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">][</span><span class="n">column_index</span><span class="p">])</span>

    <span class="n">difference_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_1</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]):</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="n">frequency_intersection</span><span class="p">:</span>
            <span class="n">model_2_frequency_row</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">model_2_frequency_selector</span><span class="p">]</span> <span class="o">==</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">model_2</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># print(&quot;{0} is {1}&quot;.format(&quot;model_2_frequency_row&quot;,model_2_frequency_row))</span>
            <span class="k">for</span> <span class="n">column_index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">column_names</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names_intersection</span> <span class="ow">and</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]:</span>
                    <span class="n">model_2_column_selector</span> <span class="o">=</span> <span class="n">model_2</span><span class="o">.</span><span class="n">column_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;int|float&#39;</span><span class="p">,</span>
                                 <span class="n">model_1</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">][</span><span class="n">column_index</span><span class="p">],</span>
                                 <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;int|float&#39;</span><span class="p">,</span>
                                                              <span class="n">model_2</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">][</span><span class="n">model_2_column_selector</span><span class="p">],</span>
                                                              <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>

                        <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">model_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">column_index</span><span class="p">]</span> <span class="o">-</span> <span class="n">model_2_frequency_row</span><span class="p">[</span><span class="n">model_2_column_selector</span><span class="p">])</span>

                        <span class="c1"># Print(&quot;New Column Names are {0}&quot;.format(new_column_names))</span>
                    <span class="k">elif</span> <span class="n">difference_options</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">]:</span>
                        <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">column_index</span><span class="p">])</span>
            <span class="n">difference_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="n">difference_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_column_names</span>
    <span class="c1"># print(&quot;New Column Names are {0}&quot;.format(new_column_names))</span>
    <span class="n">difference_options</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">difference_data</span>
    <span class="n">difference_options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">column_types</span>
    <span class="c1">#print column_types</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">difference_options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">create_monte_carlo_reference_curve</span><span class="p">(</span><span class="n">monte_carlo_directory</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a standard curve from a montecarlo directory (from MUF). The standard curve</span>
<span class="sd">    has a mean or median and a standard deviation for the uncertainty&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;RI&quot;</span><span class="p">,</span> <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="s2">&quot;s\d+p&quot;</span><span class="p">}</span>
    <span class="n">reference_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">reference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">reference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">monte_carlo_directory</span><span class="p">)</span>
    <span class="n">filtered_file_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">[:]:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">filtered_file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="n">filtered_file_names</span>
    <span class="c1"># print file_names</span>
    <span class="n">initial_file</span> <span class="o">=</span> <span class="n">SNP</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">monte_carlo_directory</span><span class="p">,</span> <span class="n">file_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">initial_file</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
    <span class="n">combined_table</span> <span class="o">=</span> <span class="n">Snp_to_AsciiDataTable</span><span class="p">(</span><span class="n">initial_file</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">snp_file</span> <span class="o">=</span> <span class="n">SNP</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">monte_carlo_directory</span><span class="p">,</span> <span class="n">file_name</span><span class="p">))</span>
        <span class="n">snp_file</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">Snp_to_AsciiDataTable</span><span class="p">(</span><span class="n">snp_file</span><span class="p">)</span>
        <span class="n">combined_table</span> <span class="o">+</span> <span class="n">table</span>
    <span class="n">mean_table</span> <span class="o">=</span> <span class="n">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">combined_table</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">])</span>
    <span class="n">standard_deviation</span> <span class="o">=</span> <span class="n">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">combined_table</span><span class="p">,</span>
                                                                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">)</span>
    <span class="n">new_column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;u&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">standard_deviation</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="n">standard_deviation</span><span class="o">.</span><span class="n">column_names</span> <span class="o">=</span> <span class="n">new_column_names</span>
    <span class="n">reference_curve</span> <span class="o">=</span> <span class="n">ascii_data_table_join</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">mean_table</span><span class="p">,</span> <span class="n">standard_deviation</span><span class="p">)</span>
    <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;value_column_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_table</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;uncertainty_column_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">reference_curve</span>

<span class="k">def</span> <span class="nf">create_sensitivity_reference_curve</span><span class="p">(</span><span class="n">sensitivity_directory</span><span class="p">,</span><span class="n">nominal_file_path</span><span class="o">=</span><span class="s2">&quot;../DUT_0.s2p&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a standard curve from a sensitivity_directory usually called Covariance(from MUF). The standard curve</span>
<span class="sd">    has a mean or median and a RMS variance from the nominal value for the uncertainty&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;RI&quot;</span><span class="p">,</span> <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="s2">&quot;s\d+p&quot;</span><span class="p">}</span>
    <span class="n">reference_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">reference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">reference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sensitivity_directory</span><span class="p">)</span>
    <span class="n">filtered_file_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">[:]:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">filtered_file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="n">filtered_file_names</span>
    <span class="c1"># print file_names</span>
    <span class="n">nominal_file</span><span class="o">=</span><span class="n">SNP</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sensitivity_directory</span><span class="p">,</span> <span class="n">nominal_file_path</span><span class="p">))</span>
    <span class="n">nominal_file</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
    <span class="n">initial_file</span> <span class="o">=</span> <span class="n">SNP</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sensitivity_directory</span><span class="p">,</span> <span class="n">file_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">initial_file</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
    <span class="n">initial_difference</span><span class="o">=</span><span class="n">frequency_model_difference</span><span class="p">(</span><span class="n">nominal_file</span><span class="p">,</span><span class="n">initial_file</span><span class="p">)</span>
    <span class="c1">#print initial_difference.column_names</span>
    <span class="n">combined_table</span> <span class="o">=</span> <span class="n">initial_difference</span>
    <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">snp_file</span> <span class="o">=</span> <span class="n">SNP</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sensitivity_directory</span><span class="p">,</span> <span class="n">file_name</span><span class="p">))</span>
        <span class="n">snp_file</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
        <span class="n">difference</span><span class="o">=</span><span class="n">frequency_model_difference</span><span class="p">(</span><span class="n">nominal_file</span><span class="p">,</span><span class="n">snp_file</span><span class="p">)</span>
        <span class="c1">#print difference.column_names</span>
<span class="c1">#         table = Snp_to_AsciiDataTable(difference)</span>
        <span class="n">combined_table</span> <span class="o">+</span> <span class="n">difference</span>
    <span class="c1">#print combined_table.options[&quot;column_types&quot;]</span>
    <span class="n">variance</span> <span class="o">=</span> <span class="n">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">combined_table</span><span class="p">,</span>
                                                                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;rss&#39;</span><span class="p">)</span>
    <span class="n">new_column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;u&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">variance</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="n">mean_table</span><span class="o">=</span><span class="n">Snp_to_AsciiDataTable</span><span class="p">(</span><span class="n">nominal_file</span><span class="p">)</span>
    <span class="n">variance</span><span class="o">.</span><span class="n">column_names</span> <span class="o">=</span> <span class="n">new_column_names</span>
    <span class="n">reference_curve</span> <span class="o">=</span> <span class="n">ascii_data_table_join</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">mean_table</span><span class="p">,</span> <span class="n">variance</span><span class="p">)</span>
    <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;value_column_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_table</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;uncertainty_column_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">reference_curve</span>

<span class="k">def</span> <span class="nf">plot_reference_curve</span><span class="p">(</span><span class="n">reference_curve</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a frequency based reference curve by using the options</span>
<span class="sd">    value_column_names and uncertainty_column_names.&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Reference_Curve&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plots_per_column&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;plot_format&quot;</span><span class="p">:</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span>
                <span class="s2">&quot;fill_color&quot;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="s2">&quot;fill_opacity&quot;</span><span class="p">:</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span>
                <span class="s2">&quot;fill_edge_color&quot;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="s2">&quot;plot_size&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
                <span class="s2">&quot;independent_axis_column_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span>
                <span class="s2">&quot;share_x&quot;</span><span class="p">:</span> <span class="s2">&quot;col&quot;</span><span class="p">}</span>
    <span class="n">plot_options</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">value_columns</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;value_column_names&quot;</span><span class="p">]</span>
    <span class="n">uncertainty_columns</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;uncertainty_column_names&quot;</span><span class="p">]</span>
    <span class="n">number_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_columns</span><span class="p">)</span>
    <span class="n">number_columns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plots_per_column&quot;</span><span class="p">])</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_columns</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">reference_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">number_columns</span><span class="p">,</span>
                                       <span class="n">sharex</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;share_x&quot;</span><span class="p">],</span>
                                       <span class="n">figsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_size&quot;</span><span class="p">],</span>
                                       <span class="n">dpi</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;dpi&quot;</span><span class="p">])</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="p">[</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;independent_axis_column_name&quot;</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">axes_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reference_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reference_curve</span><span class="p">[</span><span class="n">value_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">]])</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reference_curve</span><span class="p">[</span><span class="n">uncertainty_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_format&quot;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">-</span> <span class="n">error</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">+</span> <span class="n">error</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">],</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_opacity&quot;</span><span class="p">],</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_edge_color&quot;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">value_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">plot_reference_curve_comparison</span><span class="p">(</span><span class="n">reference_curve_list</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a list of frequency based reference curves</span>
<span class="sd">     by using the options value_column_names and uncertainty_column_names.</span>
<span class="sd">     Options &quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Reference_Curve&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plots_per_column&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;plot_format&quot;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                <span class="s2">&quot;fill_color&quot;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="s2">&quot;fill_opacity&quot;</span><span class="p">:</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span>
                <span class="s2">&quot;fill_edge_color&quot;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="s2">&quot;plot_size&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
                <span class="s2">&quot;independent_axis_column_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span>
                <span class="s2">&quot;share_x&quot;</span><span class="p">:</span> <span class="s2">&quot;col&quot;</span><span class="p">,</span>
                <span class="s2">&quot;labels&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
    <span class="n">plot_options</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]:</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">reference_curve_list</span><span class="p">)</span>
    <span class="n">value_columns</span> <span class="o">=</span> <span class="n">reference_curve_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;value_column_names&quot;</span><span class="p">]</span>
    <span class="n">uncertainty_columns</span> <span class="o">=</span> <span class="n">reference_curve_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;uncertainty_column_names&quot;</span><span class="p">]</span>
    <span class="n">number_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_columns</span><span class="p">)</span>
    <span class="n">number_columns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plots_per_column&quot;</span><span class="p">])</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_columns</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">reference_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">number_columns</span><span class="p">,</span>
                                       <span class="n">sharex</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;share_x&quot;</span><span class="p">],</span>
                                       <span class="n">figsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_size&quot;</span><span class="p">],</span>
                                       <span class="n">dpi</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;dpi&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">reference_curve</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reference_curve_list</span><span class="p">[:]):</span>
        <span class="n">value_columns</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;value_column_names&quot;</span><span class="p">]</span>
        <span class="n">uncertainty_columns</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;uncertainty_column_names&quot;</span><span class="p">]</span>


        <span class="n">x_data</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="p">[</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;independent_axis_column_name&quot;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">axes_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reference_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
            <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reference_curve</span><span class="p">[</span><span class="n">value_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">]])</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reference_curve</span><span class="p">[</span><span class="n">uncertainty_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">]])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_format&quot;</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">-</span> <span class="n">error</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">+</span> <span class="n">error</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">],</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_opacity&quot;</span><span class="p">],</span>
                            <span class="n">edgecolor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_edge_color&quot;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">value_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">calrep</span><span class="p">(</span><span class="n">raw_model</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Performs the calrep analysis routine on a raw data format (such as OnePortRawModel, TwoPortRawModel,PowerRawModel)</span>
<span class="sd">    Differs from the HP BASIC program in that it keeps the metadata Needs to be checked, returns 4 error terms for power</span>
<span class="sd">    Also does not calculate all the same rows for power, expansion factor is set to 2, requires that the raw model</span>
<span class="sd">    has the attribute raw_model.metadata[&quot;Connector_Type_Measurement&quot;] defined. If the columns passed in raw_model</span>
<span class="sd">    do not have repeat values or contain text the result will set connect uncertainty to zero&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mean_file</span><span class="o">=</span><span class="n">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">raw_model</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">mean_file</span><span class="o">=</span><span class="n">raw_model</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">standard_deviation_file</span><span class="o">=</span><span class="n">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">raw_model</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;std&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">std_data</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mean_file</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">new_row</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">mean_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">std_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="n">standard_deviation_file</span><span class="o">=</span><span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">column_names</span><span class="o">=</span><span class="n">raw_model</span><span class="o">.</span><span class="n">column_names</span><span class="p">,</span>
                                               <span class="n">data</span><span class="o">=</span><span class="n">std_data</span><span class="p">,</span><span class="n">column_types</span><span class="o">=</span><span class="n">raw_model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;Direction&quot;</span> <span class="ow">in</span> <span class="n">mean_file</span><span class="o">.</span><span class="n">column_names</span> <span class="ow">and</span> <span class="s2">&quot;Connect&quot;</span> <span class="ow">in</span> <span class="n">mean_file</span><span class="o">.</span><span class="n">column_names</span><span class="p">:</span>
        <span class="n">mean_file</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;Direction&quot;</span><span class="p">)</span>
        <span class="n">mean_file</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;Connect&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Direction&quot;</span> <span class="ow">in</span> <span class="n">standard_deviation_file</span><span class="o">.</span><span class="n">column_names</span> <span class="ow">and</span> <span class="s2">&quot;Connect&quot;</span> <span class="ow">in</span> <span class="n">standard_deviation_file</span><span class="o">.</span><span class="n">column_names</span><span class="p">:</span>
        <span class="n">standard_deviation_file</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;Direction&quot;</span><span class="p">)</span>
        <span class="n">standard_deviation_file</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;Connect&quot;</span><span class="p">)</span>
    <span class="n">new_data</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">new_column_names</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">expansion_factor</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">frequency_index</span><span class="o">=</span><span class="n">mean_file</span><span class="o">.</span><span class="n">column_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mean_file</span><span class="o">.</span><span class="n">data</span><span class="p">[:]):</span>
        <span class="n">new_data_row</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">column_index</span><span class="p">,</span><span class="n">column_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mean_file</span><span class="o">.</span><span class="n">column_names</span><span class="p">[:]):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">row_index</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">column_index</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                    <span class="n">error_selector</span><span class="o">=</span><span class="mi">0</span>
                    <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;M&quot;</span>
                    <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;arg|phase&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                    <span class="n">error_selector</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
                    <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Eff&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                    <span class="n">error_selector</span><span class="o">=</span><span class="mi">0</span>
                    <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;E&quot;</span>
                    <span class="n">error_parameter</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">error_selector</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">if</span> <span class="n">row_index</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># If this is the first row build the column names list</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;b&quot;</span><span class="o">+</span><span class="n">error_parameter</span><span class="p">)</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;a&quot;</span><span class="o">+</span><span class="n">error_parameter</span><span class="p">)</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;d&quot;</span><span class="o">+</span><span class="n">error_parameter</span><span class="p">)</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span><span class="p">)</span>

                <span class="c1"># Mean Value</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">column_index</span><span class="p">])</span>
                <span class="c1"># Type B</span>
                <span class="n">ub</span><span class="o">=</span><span class="n">type_b</span><span class="p">(</span><span class="n">wr_connector_type</span><span class="o">=</span><span class="n">mean_file</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">],</span>
                         <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">frequency_index</span><span class="p">],</span><span class="n">parameter</span><span class="o">=</span><span class="n">column_name</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">column_index</span><span class="p">],</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;mag&quot;</span><span class="p">)</span>
                <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;ub&quot;,ub))</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ub</span><span class="p">[</span><span class="n">error_selector</span><span class="p">])</span>
                <span class="c1"># Type A or SNIST</span>
                <span class="n">ua</span><span class="o">=</span><span class="n">S_NIST</span><span class="p">(</span><span class="n">wr_connector_type</span><span class="o">=</span><span class="n">mean_file</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">],</span>
                         <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">frequency_index</span><span class="p">],</span><span class="n">parameter</span><span class="o">=</span><span class="n">column_name</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">column_index</span><span class="p">],</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;mag&quot;</span><span class="p">)</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ua</span><span class="p">[</span><span class="n">error_selector</span><span class="p">])</span>

                <span class="c1"># Standard Deviation</span>
                <span class="n">ud</span><span class="o">=</span><span class="n">standard_deviation_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">column_index</span><span class="p">]</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ud</span><span class="p">)</span>
                <span class="c1"># Total Uncertainty</span>
                <span class="c1">#print(&quot; ua is {0}, ub is {1} and ud is {2}&quot;.format(ua,ub,ud))</span>
                <span class="n">total_uncertainty</span><span class="o">=</span><span class="n">expansion_factor</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ua</span><span class="p">[</span><span class="n">error_selector</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ub</span><span class="p">[</span><span class="n">error_selector</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ud</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_uncertainty</span><span class="p">)</span>
        <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data_row</span><span class="p">)</span>
    <span class="n">sorted_keys</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">mean_file</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;{0} = {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">mean_file</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sorted_keys</span><span class="p">]</span>
    <span class="n">column_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float&quot;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">new_column_names</span><span class="p">]</span>
    <span class="c1">#todo: Add value_column_names and uncertainty_column_names to conform to reference curve</span>
    <span class="n">calrep</span><span class="o">=</span><span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">new_data</span><span class="p">,</span><span class="n">column_types</span><span class="o">=</span><span class="n">column_types</span><span class="p">,</span>
                          <span class="n">column_names</span><span class="o">=</span><span class="n">new_column_names</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
                          <span class="n">metadata</span><span class="o">=</span><span class="n">mean_file</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">calrep</span>

<span class="k">def</span> <span class="nf">one_port_robin_comparison_plot</span><span class="p">(</span><span class="n">input_asc_file</span><span class="p">,</span><span class="n">input_res_file</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;one_port_robin_comparison_plot plots a one port.asc file against a given .res file,</span>
<span class="sd">    use device_history=True in options to show device history&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;device_history&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s2">&quot;mag_res&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>
    <span class="n">plot_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="n">history</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">input_res_file</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS11N&#39;</span><span class="p">,</span><span class="s1">&#39;argS11N&#39;</span><span class="p">,</span><span class="s1">&#39;UmagS11N&#39;</span><span class="p">,</span><span class="s1">&#39;UargS11N&#39;</span><span class="p">]</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="n">history</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="s2">&quot;column_names&quot;</span><span class="p">:</span><span class="n">column_names</span><span class="p">,</span><span class="s2">&quot;column_types&quot;</span><span class="p">:[</span><span class="s1">&#39;float&#39;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]}</span>
    <span class="n">history_table</span><span class="o">=</span><span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="n">table</span><span class="o">=</span><span class="n">OnePortCalrepModel</span><span class="p">(</span><span class="n">input_asc_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;device_history&quot;</span><span class="p">]:</span>
        <span class="n">history_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ONE_PORT_DUT</span><span class="p">)</span>
        <span class="n">device_history</span><span class="o">=</span><span class="n">history_frame</span><span class="p">[</span><span class="n">history_frame</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">table</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()]</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;magS11N&#39;</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span>
                <span class="n">yerr</span><span class="o">=</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;UmagS11N&#39;</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;History&quot;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;magS11&#39;</span><span class="p">),</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;uMg&#39;</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current Measurement&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;device_history&quot;</span><span class="p">]:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;bs&#39;</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;uMg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;From .asc&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;mag_res&quot;</span><span class="p">]:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;gx&#39;</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;UmagS11N&#39;</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;From mag in res&quot;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnitude S11&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span>
                <span class="n">yerr</span><span class="o">=</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;UargS11N&#39;</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;history&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">),</span>
                 <span class="n">yerr</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;uAg&#39;</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current Measurement&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;device_history&quot;</span><span class="p">]:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;arg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;bs&#39;</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;uAg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;From .asc&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Phase S11&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">two_port_swap_ports</span><span class="p">(</span><span class="n">complex_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Accepts data in [[frequency, S11, S21, S12, S22]..] format and returns</span>
<span class="sd">    [[frequency, S22, S12, S21, S11]..]&quot;&quot;&quot;</span>
    <span class="n">out_data</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">complex_data</span><span class="p">:</span>
        <span class="p">[</span><span class="n">frequency</span><span class="p">,</span> <span class="n">S11</span><span class="p">,</span> <span class="n">S21</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S22</span><span class="p">]</span><span class="o">=</span><span class="n">row</span>
        <span class="n">new_row</span><span class="o">=</span><span class="p">[</span><span class="n">frequency</span><span class="p">,</span> <span class="n">S22</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S21</span><span class="p">,</span> <span class="n">S11</span><span class="p">]</span>
        <span class="n">out_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_data</span>

<span class="k">def</span> <span class="nf">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">complex_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;two_port_complex_to_matrix_form takes a list of [[frequency,S11,S21,S12,S22],..] and</span>
<span class="sd">    returns a list in the</span>
<span class="sd">    form [[frequency,np.matrix([[S11,S12],[S21,S22]])]..], it is meant to prepare data for correction&quot;&quot;&quot;</span>
    <span class="n">out_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">complex_data</span><span class="p">:</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">[</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">]</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">],[</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">]])</span>
        <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">m</span><span class="p">])</span>
    <span class="c1">#print out_list</span>
    <span class="k">return</span> <span class="n">out_list</span>

<span class="k">def</span> <span class="nf">two_port_matrix_to_complex_form</span><span class="p">(</span><span class="n">matrix_form_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;two_port_matrix_to_complex_form takes a list of [[frequency,np.matrix([[S11,S12],[S21,S22]])]..]</span>
<span class="sd">    and returns a list in the</span>
<span class="sd">    form [[frequency,S11,S21,S12,S22],..] , it is meant to undo two_port_complex_to_matrix_form&quot;&quot;&quot;</span>
    <span class="n">out_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matrix_form_data</span><span class="p">:</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">[</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out_list</span>

<span class="k">def</span> <span class="nf">invert_two_port_matrix_list</span><span class="p">(</span><span class="n">two_port_matrix_form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;invert_two_port_matrix_list inverts all elements in the list two_port_matrix_form,</span>
<span class="sd">    which is in the format [[frequency,np.matrix([[S11,S12],[S21,S22]])]..] and returns a list</span>
<span class="sd">    in [[frequency,inv(np.matrix([[S11,S12],[S21,S22]]))]..] format works on any list in the form [value, matrix]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">two_port_matrix_form</span><span class="p">:</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">m_inv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">m_inv</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out_list</span>

<span class="k">def</span> <span class="nf">polar_average</span><span class="p">(</span><span class="n">complex_number_1</span><span class="p">,</span><span class="n">complex_number_2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Averages 2 complex numbers in polar coordinates and returns a single complex number&quot;&quot;&quot;</span>
    <span class="n">polar_number_1</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">complex_number_1</span><span class="p">)</span>
    <span class="n">polar_number_2</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">complex_number_2</span><span class="p">)</span>
    <span class="n">average_length</span><span class="o">=</span><span class="p">(</span><span class="n">polar_number_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">polar_number_2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">average_phase</span><span class="o">=</span><span class="p">(</span><span class="n">polar_number_1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">polar_number_2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">out_value</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">average_length</span><span class="p">,</span><span class="n">average_phase</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_value</span>

<span class="k">def</span> <span class="nf">polar_geometric_average</span><span class="p">(</span><span class="n">complex_number_1</span><span class="p">,</span><span class="n">complex_number_2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Averages 2 complex numbers in polar coordinates and returns a single complex number&quot;&quot;&quot;</span>
    <span class="n">polar_number_1</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">complex_number_1</span><span class="p">)</span>
    <span class="n">polar_number_2</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">complex_number_2</span><span class="p">)</span>
    <span class="n">average_length</span><span class="o">=</span><span class="p">(</span><span class="n">polar_number_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">polar_number_2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**.</span><span class="mi">5</span>
    <span class="n">average_phase</span><span class="o">=</span><span class="p">(</span><span class="n">polar_number_1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">polar_number_2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">out_value</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">average_length</span><span class="p">,</span><span class="n">average_phase</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_value</span>

<span class="k">def</span> <span class="nf">S_to_T</span><span class="p">(</span><span class="n">S_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts S-parameters into a T Matrix. Input form should be in frequency, np.matrix([[S11,S12],[S21,S22]])</span>
<span class="sd">    format. Returns a list in [frequency, np.matrix] format &quot;&quot;&quot;</span>
    <span class="n">t_complex_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">t_matrix</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">S_list</span><span class="p">:</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">T11</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">T12</span><span class="o">=</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">T21</span><span class="o">=-</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">T22</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">T11</span><span class="p">,</span><span class="n">T12</span><span class="p">],[</span><span class="n">T21</span><span class="p">,</span><span class="n">T22</span><span class="p">]])])</span>
        <span class="n">t_complex_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">T11</span><span class="p">,</span><span class="n">T12</span><span class="p">,</span><span class="n">T21</span><span class="p">,</span><span class="n">T22</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">t_matrix</span>

<span class="k">def</span> <span class="nf">T_to_S</span><span class="p">(</span><span class="n">T_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts T Matrix into S parameters. Input form should be in frequency, np.matrix([[T11,T12],[T21,T22]])</span>
<span class="sd">    format. Returns a list in [frequency, np.matrix] format.&quot;&quot;&quot;</span>
    <span class="n">S_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">T_list</span><span class="p">:</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">S11</span><span class="o">=</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">S12</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">S21</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">S22</span><span class="o">=-</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">S_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">],[</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">]])])</span>
    <span class="k">return</span> <span class="n">S_list</span>

<span class="k">def</span> <span class="nf">unwrap_phase</span><span class="p">(</span><span class="n">phase_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;unwrap_phase returns an unwraped phase list given a wraped phase list,</span>
<span class="sd">    assumed units are degrees &quot;&quot;&quot;</span>
    <span class="n">unwrapped_phase_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phase_list_copy</span><span class="o">=</span><span class="n">phase_list</span><span class="p">[:]</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">phase_list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">phase_list</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">phase_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">phase_list</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span><span class="o">-=</span><span class="mi">1</span>
            <span class="n">phase_list_copy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">phase_list_copy</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="mi">360</span>
        <span class="n">phase_list_copy</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">phase_list_copy</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="mi">360</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">phase_list_copy</span>


<span class="k">def</span> <span class="nf">correct_sparameters_eight_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">eight_term_correction</span><span class="p">,</span><span class="n">reciprocal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies the eight term correction to sparameters_complex and returns</span>
<span class="sd">    a correct complex list in the form of [[frequency,S11,S21,S12,S22],..]. The eight term</span>
<span class="sd">    correction should be in the form [[frequency,S1_11,S1_21,S1_12,S1_22,S2_11,S2_21,S2_12,S2_22]..]</span>
<span class="sd">    Use s2p.sparameter_complex as input.&quot;&quot;&quot;</span>
    <span class="c1"># first transform both lists to matrices</span>
    <span class="n">s2p_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span>
    <span class="n">s1_list</span><span class="o">=</span><span class="p">[[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">eight_term_correction</span><span class="p">]</span>
    <span class="n">s2_list</span><span class="o">=</span><span class="p">[[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">8</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">eight_term_correction</span><span class="p">]</span>
    <span class="n">s1_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">s1_list</span><span class="p">)</span>
    <span class="n">s2_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">s2_list</span><span class="p">)</span>
    <span class="c1"># now transform to T matrices</span>
    <span class="n">t_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s2p_matrix_list</span><span class="p">)</span>
    <span class="n">x_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s1_matrix_list</span><span class="p">)</span>
    <span class="n">y_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s2_matrix_list</span><span class="p">)</span>
    <span class="c1"># now invert x</span>
    <span class="n">x_inverse_matrix_list</span><span class="o">=</span><span class="n">invert_two_port_matrix_list</span><span class="p">(</span><span class="n">x_matrix_list</span><span class="p">)</span>
    <span class="n">y_inverse_matrix_list</span><span class="o">=</span><span class="n">invert_two_port_matrix_list</span><span class="p">(</span><span class="n">y_matrix_list</span><span class="p">)</span>
    <span class="c1"># now apply the correction</span>
    <span class="n">t_corrected_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t_matrix_list</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t_corrected</span><span class="o">=</span><span class="n">x_inverse_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">y_inverse_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">t_corrected_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">t_corrected</span><span class="p">])</span>
    <span class="c1"># now transform back to S</span>
    <span class="n">s_corrected_matrix_list</span> <span class="o">=</span><span class="n">T_to_S</span><span class="p">(</span><span class="n">t_corrected_list</span><span class="p">)</span>
    <span class="c1"># now put back into single row form</span>
    <span class="n">s_corrected_list</span><span class="o">=</span><span class="n">two_port_matrix_to_complex_form</span><span class="p">(</span><span class="n">s_corrected_matrix_list</span><span class="p">)</span>
    <span class="c1"># now we take the geometric average and replace S12 and S21 with it</span>
    <span class="k">if</span> <span class="n">reciprocal</span><span class="p">:</span>
        <span class="n">s_averaged_corrected</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">phase_last</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s_corrected_list</span><span class="p">:</span>
            <span class="p">[</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">]</span><span class="o">=</span><span class="n">row</span>
            <span class="c1"># S12 and S21 are averaged together in a weird way that makes phase continuous</span>
            <span class="n">geometric_mean</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
            <span class="n">root_select</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">phase_new</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">geometric_mean</span><span class="p">)</span>
            <span class="c1"># if the phase jumps by &gt;180 but less than 270, then pick the other root</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&gt;</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">root_select</span><span class="o">=-</span><span class="mi">1</span>
            <span class="n">mean_S12_S21</span><span class="o">=</span><span class="n">root_select</span><span class="o">*</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
            <span class="n">s_averaged_corrected</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
            <span class="n">phase_last</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">mean_S12_S21</span><span class="p">)</span>
        <span class="n">s_corrected_list</span><span class="o">=</span><span class="n">s_averaged_corrected</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">s_corrected_list</span>

<span class="k">def</span> <span class="nf">uncorrect_sparameters_eight_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">eight_term_correction</span><span class="p">,</span><span class="n">reciprocal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Removes the eight term correction to sparameters_complex and returns</span>
<span class="sd">    a uncorrected (reference plane is measurement)</span>
<span class="sd">     complex list in the form of [[frequency,S11,S21,S12,S22],..]. The eight term</span>
<span class="sd">    correction should be in the form [[frequency,S1_11,S1_21,S1_12,S1_22,S2_11,S2_21,S2_12,S2_22]..]</span>
<span class="sd">    Use s2p.sparameter_complex as input.&quot;&quot;&quot;</span>
    <span class="c1"># first transform both lists to matrices</span>
    <span class="n">s2p_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span>
    <span class="n">s1_list</span><span class="o">=</span><span class="p">[[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">eight_term_correction</span><span class="p">]</span>
    <span class="n">s2_list</span><span class="o">=</span><span class="p">[[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">8</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">eight_term_correction</span><span class="p">]</span>
    <span class="n">s1_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">s1_list</span><span class="p">)</span>
    <span class="n">s2_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">s2_list</span><span class="p">)</span>
    <span class="c1"># now transform to T matrices</span>
    <span class="n">t_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s2p_matrix_list</span><span class="p">)</span>
    <span class="n">x_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s1_matrix_list</span><span class="p">)</span>
    <span class="n">y_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s2_matrix_list</span><span class="p">)</span>


    <span class="c1"># now apply the correction</span>
    <span class="n">t_uncorrected_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t_matrix_list</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t_corrected</span><span class="o">=</span><span class="n">x_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">y_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">t_uncorrected_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">t_corrected</span><span class="p">])</span>
    <span class="c1"># now transform back to S</span>
    <span class="n">s_uncorrected_matrix_list</span> <span class="o">=</span><span class="n">T_to_S</span><span class="p">(</span><span class="n">t_uncorrected_list</span><span class="p">)</span>
    <span class="c1"># now put back into single row form</span>
    <span class="n">s_uncorrected_list</span><span class="o">=</span><span class="n">two_port_matrix_to_complex_form</span><span class="p">(</span><span class="n">s_uncorrected_matrix_list</span><span class="p">)</span>
    <span class="c1"># now we take the geometric average and replace S12 and S21 with it</span>
    <span class="k">if</span> <span class="n">reciprocal</span><span class="p">:</span>
        <span class="n">s_averaged_corrected</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">phase_last</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s_uncorrected_list</span><span class="p">:</span>
            <span class="p">[</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">]</span><span class="o">=</span><span class="n">row</span>
            <span class="c1"># S12 and S21 are averaged together in a weird way that makes phase continuous</span>
            <span class="n">geometric_mean</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
            <span class="n">root_select</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">phase_new</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">geometric_mean</span><span class="p">)</span>
            <span class="c1"># if the phase jumps by &gt;180 but less than 270, then pick the other root</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&gt;</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">root_select</span><span class="o">=-</span><span class="mi">1</span>
            <span class="n">mean_S12_S21</span><span class="o">=</span><span class="n">root_select</span><span class="o">*</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
            <span class="n">s_averaged_corrected</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
            <span class="n">phase_last</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">mean_S12_S21</span><span class="p">)</span>
        <span class="n">s_uncorrected_list</span><span class="o">=</span><span class="n">s_averaged_corrected</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">s_uncorrected_list</span>

<span class="k">def</span> <span class="nf">correct_sparameters_sixteen_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">sixteen_term_correction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies the sixteen term correction to sparameters and returns a new sparameter list.</span>
<span class="sd">    The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.</span>
<span class="sd">    The sixteen term correction should be a list of</span>
<span class="sd">    [frequency, S11, S12, S13,S14,S21, S22,S23,S24,S31,S32,S33,S34,S41,S42,S43,S44], etc are complex numbers</span>
<span class="sd">    Designed to use S2P.sparameter_complex and SNP.sparameter_complex&quot;&quot;&quot;</span>

    <span class="c1"># first create 4 separate matrix lists for 16 term correction</span>
    <span class="n">s1_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s2_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s3_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s4_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1"># Then populate them with the right values</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">correction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sixteen_term_correction</span><span class="p">):</span>
        <span class="p">[</span><span class="n">frequency</span><span class="p">,</span> <span class="n">S11</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S13</span><span class="p">,</span><span class="n">S14</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span> <span class="n">S22</span><span class="p">,</span><span class="n">S23</span><span class="p">,</span><span class="n">S24</span><span class="p">,</span><span class="n">S31</span><span class="p">,</span><span class="n">S32</span><span class="p">,</span><span class="n">S33</span><span class="p">,</span><span class="n">S34</span><span class="p">,</span><span class="n">S41</span><span class="p">,</span><span class="n">S42</span><span class="p">,</span><span class="n">S43</span><span class="p">,</span><span class="n">S44</span><span class="p">]</span><span class="o">=</span><span class="n">correction</span>
        <span class="n">s1_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">],[</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">]])])</span>
        <span class="n">s2_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S13</span><span class="p">,</span><span class="n">S14</span><span class="p">],[</span><span class="n">S23</span><span class="p">,</span><span class="n">S24</span><span class="p">]])])</span>
        <span class="n">s3_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S31</span><span class="p">,</span><span class="n">S32</span><span class="p">],[</span><span class="n">S41</span><span class="p">,</span><span class="n">S42</span><span class="p">]])])</span>
        <span class="n">s4_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S33</span><span class="p">,</span><span class="n">S34</span><span class="p">],[</span><span class="n">S43</span><span class="p">,</span><span class="n">S44</span><span class="p">]])])</span>
    <span class="n">sparameter_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span>
    <span class="c1"># Apply the correction</span>
    <span class="n">sparameter_out</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">sparameter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sparameter_matrix_list</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">sparameter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s_matrix</span><span class="o">=</span><span class="n">sparameter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">[</span><span class="n">s11_matrix</span><span class="p">,</span><span class="n">s12_matrix</span><span class="p">,</span><span class="n">s21_matrix</span><span class="p">,</span><span class="n">s22_matrix</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">s1_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">s2_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">s3_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">s4_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">corrected_s_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">s21_matrix</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">s_matrix</span><span class="o">-</span><span class="n">s11_matrix</span><span class="p">)</span><span class="o">*</span><span class="n">s12_matrix</span><span class="o">+</span><span class="n">s22_matrix</span><span class="p">)</span>
        <span class="c1"># This flips S12 and S21</span>
        <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">corrected_s_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">corrected_s_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">corrected_s_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">corrected_s_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">sparameter_out</span>

<span class="k">def</span> <span class="nf">uncorrect_sparameters_sixteen_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">sixteen_term_correction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Removes the sixteen term correction to sparameters and returns a new sparameter list.</span>
<span class="sd">    The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.</span>
<span class="sd">    The sixteen term correction should be a list of</span>
<span class="sd">    [frequency, S11, S12, S13,S14,S21, S22,S23,S24,S31,S32,S33,S34,S41,S42,S43,S44], etc are complex numbers</span>
<span class="sd">    Designed to use S2P.sparameter_complex and SNP.sparameter_complex.</span>
<span class="sd">    Inverse of correct_sparameters_sixteen_term&quot;&quot;&quot;</span>

    <span class="c1"># first create 4 separate matrix lists for 16 term correction</span>
    <span class="n">s1_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s2_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s3_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s4_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1"># Then populate them with the right values</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">correction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sixteen_term_correction</span><span class="p">):</span>
        <span class="p">[</span><span class="n">frequency</span><span class="p">,</span> <span class="n">S11</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S13</span><span class="p">,</span><span class="n">S14</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span> <span class="n">S22</span><span class="p">,</span><span class="n">S23</span><span class="p">,</span><span class="n">S24</span><span class="p">,</span><span class="n">S31</span><span class="p">,</span><span class="n">S32</span><span class="p">,</span><span class="n">S33</span><span class="p">,</span><span class="n">S34</span><span class="p">,</span><span class="n">S41</span><span class="p">,</span><span class="n">S42</span><span class="p">,</span><span class="n">S43</span><span class="p">,</span><span class="n">S44</span><span class="p">]</span><span class="o">=</span><span class="n">correction</span>
        <span class="n">s1_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">],[</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">]])])</span>
        <span class="n">s2_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S13</span><span class="p">,</span><span class="n">S14</span><span class="p">],[</span><span class="n">S23</span><span class="p">,</span><span class="n">S24</span><span class="p">]])])</span>
        <span class="n">s3_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S31</span><span class="p">,</span><span class="n">S32</span><span class="p">],[</span><span class="n">S41</span><span class="p">,</span><span class="n">S42</span><span class="p">]])])</span>
        <span class="n">s4_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S33</span><span class="p">,</span><span class="n">S34</span><span class="p">],[</span><span class="n">S43</span><span class="p">,</span><span class="n">S44</span><span class="p">]])])</span>
    <span class="n">sparameter_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span>
    <span class="c1"># Apply the correction</span>
    <span class="n">sparameter_out</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">sparameter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sparameter_matrix_list</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">sparameter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s_matrix</span><span class="o">=</span><span class="n">sparameter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">[</span><span class="n">s11_matrix</span><span class="p">,</span><span class="n">s12_matrix</span><span class="p">,</span><span class="n">s21_matrix</span><span class="p">,</span><span class="n">s22_matrix</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">s1_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">s2_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">s3_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">s4_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">uncorrected_s_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">s21_matrix</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">s_matrix</span><span class="p">)</span><span class="o">-</span><span class="n">s22_matrix</span><span class="p">)</span><span class="o">*</span>\
                                            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">s12_matrix</span><span class="p">))</span><span class="o">+</span><span class="n">s11_matrix</span>

        <span class="c1"># This flips S12 and S21</span>
        <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">uncorrected_s_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">uncorrected_s_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">uncorrected_s_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">uncorrected_s_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">sparameter_out</span>

<span class="k">def</span> <span class="nf">correct_sparameters_twelve_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">twelve_term_correction</span><span class="p">,</span><span class="n">reciprocal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies the twelve term correction to sparameters and returns a new sparameter list.</span>
<span class="sd">    The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.</span>
<span class="sd">    The twelve term correction should be a list of</span>
<span class="sd">    [frequency,Edf,Esf,Erf,Exf,Elf,Etf,Edr,Esr,Err,Exr,Elr,Etr] where Edf, etc are complex numbers&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">twelve_term_correction</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;s parameter and twelve term correction must be the same length&quot;</span><span class="p">)</span>
    <span class="n">sparameter_out</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phase_last</span><span class="o">=</span><span class="mf">0.</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Sm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">[</span><span class="n">frequency</span><span class="p">,</span><span class="n">Edf</span><span class="p">,</span><span class="n">Esf</span><span class="p">,</span><span class="n">Erf</span><span class="p">,</span><span class="n">Exf</span><span class="p">,</span><span class="n">Elf</span><span class="p">,</span><span class="n">Etf</span><span class="p">,</span><span class="n">Edr</span><span class="p">,</span><span class="n">Esr</span><span class="p">,</span><span class="n">Err</span><span class="p">,</span><span class="n">Exr</span><span class="p">,</span><span class="n">Elr</span><span class="p">,</span><span class="n">Etr</span><span class="p">]</span><span class="o">=</span><span class="n">twelve_term_correction</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="c1">#        frequency Edf Esf Erf Exf Elf Etf Edr Esr Err Exr Elr Etr.</span>
<span class="c1">#         print [frequency,Edf,Esf,Erf,Exf,Elf,Etf,Edr,Esr,Err,Exr,Elr,Etr]</span>
<span class="c1">#         print Sm[0,0]</span>
        <span class="n">D</span> <span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Edf</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esf</span><span class="o">/</span><span class="n">Erf</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Edr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esr</span><span class="o">/</span><span class="n">Err</span><span class="p">))</span><span class="o">-</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Elf</span><span class="o">*</span><span class="n">Elr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Etf</span><span class="o">*</span><span class="n">Etr</span><span class="p">)</span>
<span class="c1">#         print D</span>
        <span class="n">S11</span> <span class="o">=</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Edf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Erf</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Edr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esr</span><span class="o">/</span><span class="n">Err</span><span class="p">))</span><span class="o">-</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Elf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Etf</span><span class="o">*</span><span class="n">Etr</span><span class="p">)</span>
        <span class="n">S21</span> <span class="o">=</span><span class="p">((</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Exr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Etf</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Edr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esr</span><span class="o">-</span><span class="n">Elf</span><span class="p">)</span><span class="o">/</span><span class="n">Err</span><span class="p">)</span>
        <span class="n">S12</span> <span class="o">=</span> <span class="p">((</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Exf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Etr</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Edf</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esf</span><span class="o">-</span><span class="n">Elr</span><span class="p">)</span><span class="o">/</span><span class="n">Erf</span><span class="p">)</span>
        <span class="n">S22</span> <span class="o">=</span> <span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Edr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Err</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Edf</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esf</span><span class="o">/</span><span class="n">Erf</span><span class="p">))</span><span class="o">-</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Elr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Etf</span><span class="o">*</span><span class="n">Etr</span><span class="p">)</span>
        <span class="c1"># S12 and S21 are averaged together in a weird way that makes phase continuous</span>
        <span class="n">geometric_mean</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
        <span class="n">root_select</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">phase_new</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">geometric_mean</span><span class="p">)</span>
        <span class="c1"># if the phase jumps by &gt;180 but less than 270, then pick the other root</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&gt;</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">root_select</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">mean_S12_S21</span><span class="o">=</span><span class="n">root_select</span><span class="o">*</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reciprocal</span><span class="p">:</span>
            <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
        <span class="n">phase_last</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">mean_S12_S21</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sparameter_out</span>

<span class="k">def</span> <span class="nf">uncorrect_sparameters_twelve_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">twelve_term_correction</span><span class="p">,</span><span class="n">reciprocal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Removes the twelve term correction to sparameters and returns a new sparameter list.</span>
<span class="sd">    The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.</span>
<span class="sd">    The twelve term correction should be a list of</span>
<span class="sd">    [frequency,Edf,Esf,Erf,Exf,Elf,Etf,Edr,Esr,Err,Exr,Elr,Etr] where Edf, etc are complex numbers&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">twelve_term_correction</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;s parameter and twelve term correction must be the same length&quot;</span><span class="p">)</span>
    <span class="n">sparameter_out</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phase_last</span><span class="o">=</span><span class="mf">0.</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Sa</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">[</span><span class="n">frequency</span><span class="p">,</span><span class="n">Edf</span><span class="p">,</span><span class="n">Esf</span><span class="p">,</span><span class="n">Erf</span><span class="p">,</span><span class="n">Exf</span><span class="p">,</span><span class="n">Elf</span><span class="p">,</span><span class="n">Etf</span><span class="p">,</span><span class="n">Edr</span><span class="p">,</span><span class="n">Esr</span><span class="p">,</span><span class="n">Err</span><span class="p">,</span><span class="n">Exr</span><span class="p">,</span><span class="n">Elr</span><span class="p">,</span><span class="n">Etr</span><span class="p">]</span><span class="o">=</span><span class="n">twelve_term_correction</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="c1">#        frequency Edf Esf Erf Exf Elf Etf Edr Esr Err Exr Elr Etr.</span>
<span class="c1">#         print [frequency,Edf,Esf,Erf,Exf,Elf,Etf,Edr,Esr,Err,Exr,Elr,Etr]</span>
<span class="c1">#         print Sm[0,0]</span>
        <span class="n">delta</span><span class="o">=</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#         print D</span>
        <span class="n">S11</span> <span class="o">=</span><span class="n">Edf</span><span class="o">+</span><span class="p">(</span><span class="n">Erf</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Elf</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Esf</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Elf</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Esf</span><span class="o">*</span><span class="n">Elf</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">S21</span> <span class="o">=</span><span class="n">Etf</span><span class="o">*</span><span class="p">(</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Esf</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Elf</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Esf</span><span class="o">*</span><span class="n">Elf</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">S12</span> <span class="o">=</span> <span class="n">Etr</span><span class="o">*</span><span class="p">(</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Elr</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Esr</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Esr</span><span class="o">*</span><span class="n">Elr</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">S22</span> <span class="o">=</span> <span class="n">Edr</span><span class="o">+</span><span class="n">Err</span><span class="o">*</span><span class="p">(</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Elr</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Elr</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Esr</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Esr</span><span class="o">*</span><span class="n">Elr</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span>
        <span class="c1"># S12 and S21 are averaged together in a weird way that makes phase continuous</span>
        <span class="n">geometric_mean</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
        <span class="n">root_select</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">phase_new</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">geometric_mean</span><span class="p">)</span>
        <span class="c1"># if the phase jumps by &gt;180 but less than 270, then pick the other root</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&gt;</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">root_select</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">mean_S12_S21</span><span class="o">=</span><span class="n">root_select</span><span class="o">*</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reciprocal</span><span class="p">:</span>
            <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
        <span class="n">phase_last</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">mean_S12_S21</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sparameter_out</span>
<span class="c1">#TODO: Check that this works the way it should</span>
<span class="k">def</span> <span class="nf">correct_sparameters</span><span class="p">(</span><span class="n">sparameters</span><span class="p">,</span><span class="n">correction</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Correction sparamters trys to return a corrected set of sparameters given uncorrected sparameters</span>
<span class="sd">    and a correction. Correct sparameters will accept file_name&#39;s, pyMez classes,</span>
<span class="sd">    complex lists or a mixture, returns value in the form it was entered. Correction is assumed reciprocal</span>
<span class="sd">    unless reciprocal=False&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;reciprocal&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;output_type&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;file_path&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
    <span class="n">correction_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">correction_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">correction_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># import and condition sparameters and correction</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span> <span class="ow">is</span> <span class="n">StringType</span><span class="p">:</span>
            <span class="c1"># Assume sparameters is given by file name</span>
            <span class="n">sparameters_table</span><span class="o">=</span><span class="n">S2PV1</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span>
            <span class="n">sparameters</span><span class="o">=</span><span class="n">sparameters_table</span><span class="o">.</span><span class="n">sparameter_complex</span>
            <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;file&#39;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;S2PV1&#39;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)):</span>
            <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;S2PV1&#39;</span>
            <span class="n">sparameters</span><span class="o">=</span><span class="n">sparameters</span><span class="o">.</span><span class="n">sparameter_complex</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span> <span class="ow">is</span> <span class="n">ListType</span><span class="p">:</span>
            <span class="c1"># check to see if it is a list of complex variables or matrix</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="n">ComplexType</span><span class="p">:</span>
                <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;complex_list&#39;</span>
            <span class="c1"># Handle frequency, matrix lists</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;np.array&#39;</span><span class="p">,</span><span class="s1">&#39;np.matrix&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span> <span class="ow">is</span> <span class="n">FloatType</span> <span class="p">:</span>
                <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;matrix_list&#39;</span>
                <span class="n">sparameters</span><span class="o">=</span><span class="n">two_port_matrix_to_complex_form</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span>
            <span class="c1"># handle matrix</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;np.array&#39;</span><span class="p">,</span><span class="s1">&#39;np.matrix&#39;</span><span class="p">]:</span>
            <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;matrix&#39;</span>
            <span class="k">raise</span>
        <span class="c1"># Handle the correction types</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">correction</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">13</span><span class="p">:</span>
            <span class="n">corrected_sparameters</span><span class="o">=</span><span class="n">correct_sparameters_twelve_term</span><span class="p">(</span><span class="n">sparameters</span><span class="p">,</span><span class="n">correction</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">correction</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">17</span><span class="p">:</span>
            <span class="n">corrected_sparameters</span><span class="o">=</span><span class="n">correct_sparameters_sixteen_term</span><span class="p">(</span><span class="n">sparameters</span><span class="p">,</span><span class="n">correction</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">correction</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">corrected_sparameters</span><span class="o">=</span><span class="n">correct_sparameters_eight_term</span><span class="p">(</span><span class="n">sparameters</span><span class="p">,</span><span class="n">correction</span><span class="p">)</span>
        <span class="c1"># Handle the output type using the derived one or the one entered as an option</span>
        <span class="k">if</span> <span class="n">correction_options</span><span class="p">[</span><span class="s2">&quot;output_type&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_type</span><span class="o">=</span><span class="n">correction_options</span><span class="p">[</span><span class="s2">&quot;output_type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="n">output_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">output_table</span><span class="o">=</span><span class="n">S2PV1</span><span class="p">(</span><span class="n">correction_options</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">],</span><span class="n">sparameter_complex</span><span class="o">=</span><span class="n">corrected_sparameters</span><span class="p">)</span>
            <span class="n">output_table</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Output was saved as {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_table</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;complex&quot;</span><span class="p">,</span><span class="n">output_type</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">corrected_sparameters</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;matrix_list&quot;</span><span class="p">,</span><span class="n">output_type</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">corrected_sparameters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;matrix&quot;</span><span class="p">,</span><span class="n">output_type</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="k">raise</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Could not correct sparameters&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

<span class="k">def</span> <span class="nf">average_one_port_sparameters</span><span class="p">(</span><span class="n">table_list</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a table that is the average of the Sparameters in table list. The new table will have all the unique</span>
<span class="sd">    frequency values contained in all of the tables. Tables must be in Real-Imaginary format or magnitude-angle format</span>
<span class="sd">    do not try to average db-angle format. &quot;&quot;&quot;</span>
    <span class="c1">#This will work on any table that the data is stored in data, need to add a sparameter version</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;frequency_selector&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;frequency_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;Frequency&quot;</span><span class="p">}</span>
    <span class="n">average_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">average_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">average_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="n">frequency_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">average_data</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">table_list</span><span class="p">:</span>
        <span class="n">frequency_list</span><span class="o">=</span><span class="n">frequency_list</span><span class="o">+</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">unique_frequency_list</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">frequency_list</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="n">unique_frequency_list</span><span class="p">:</span>
        <span class="n">new_row</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">table_list</span><span class="p">:</span>
            <span class="n">data_list</span><span class="o">=</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">average_options</span><span class="p">[</span><span class="s2">&quot;frequency_selector&quot;</span><span class="p">]]</span><span class="o">==</span><span class="n">frequency</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">table_average</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_list</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_average</span><span class="p">)</span>
            <span class="c1">#print new_row</span>
        <span class="n">average_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">average_data</span>

<span class="k">def</span> <span class="nf">two_port_comparison_plot_with_residuals</span><span class="p">(</span><span class="n">two_port_raw</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">,</span><span class="n">difference_frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a comparison plot given a TwoPortRawModel object and a pandas.DataFrame mean frame&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">measurement_date</span><span class="o">=</span><span class="n">two_port_raw</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Date&quot;</span><span class="p">]</span>
    <span class="n">ax0</span><span class="p">,</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">,</span><span class="n">ax5</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flat</span>
    <span class="n">compare_axes</span><span class="o">=</span><span class="p">[</span><span class="n">ax0</span><span class="p">,</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">,</span><span class="n">ax5</span><span class="p">]</span>
    <span class="n">diff_axes</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">compare_axes</span><span class="p">:</span>
        <span class="n">diff_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
    <span class="c1">#diff_axes=[diff_ax0,diff_ax1,diff_ax2,diff_ax3,diff_ax4,diff_ax5]</span>
    <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">diff_axes</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">difference_frame</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">difference_frame</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="s1">&#39;r-x&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Difference&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-.</span><span class="mo">02</span><span class="p">,</span><span class="o">.</span><span class="mo">02</span><span class="p">)</span>
        <span class="c1">#ax.legend_.remove()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">two_port_raw</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">two_port_raw</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s1">&#39;k-o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">measurement_date</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_frame</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">mean_frame</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="s1">&#39;gs&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;8&#39;</span><span class="p">)</span>
        <span class="c1">#ax.xaxis.set_visible(False)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|${\Gamma} $|&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="c1">#ax.sharex(diff_axes[index])</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">two_port_raw</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">two_port_difference_frame</span><span class="p">(</span><span class="n">two_port_raw</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a difference pandas.DataFrame given a two port raw file and a mean pandas.DataFrame&quot;&quot;&quot;</span>
    <span class="n">difference_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">two_port_raw</span><span class="o">.</span><span class="n">data</span><span class="p">[:]:</span>
        <span class="c1">#print row[0]</span>
        <span class="n">mean_row</span><span class="o">=</span><span class="n">mean_frame</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">mean_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="nb">abs</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
        <span class="c1">#print mean_row</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mean_row</span><span class="o">=</span><span class="n">mean_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">difference_row</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">mean_row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_row</span><span class="p">))]</span>
            <span class="n">difference_row</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">difference_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">difference_row</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span><span class="k">pass</span>
    <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="n">diff_data_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">difference_list</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">diff_data_frame</span>

<span class="k">def</span> <span class="nf">two_port_mean_frame</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span><span class="n">system_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">history_data_frame</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a Device_Id and a pandas data frame of the history creates a mean data_frame&quot;&quot;&quot;</span>
    <span class="n">device_history</span><span class="o">=</span><span class="n">history_data_frame</span><span class="p">[</span><span class="n">history_data_frame</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">device_id</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">system_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">device_history</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;System_Id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">system_id</span><span class="p">]</span>
    <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="n">unique_frequency_list</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">mean_array</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_frequency_list</span><span class="p">):</span>
        <span class="n">row</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">:</span>
            <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">device_history</span><span class="p">[</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">unique_frequency_list</span><span class="p">[</span><span class="n">index</span><span class="p">]][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">())</span>
            <span class="c1">#print values</span>
            <span class="n">mean_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_value</span><span class="p">)</span>
        <span class="n">mean_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">mean_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mean_array</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mean_frame</span>

<span class="k">def</span> <span class="nf">mean_from_history</span><span class="p">(</span><span class="n">history_frame</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;mean_from_history creates a mean_frame given a full history frame (pandas.DataFrame object),</span>
<span class="sd">    by setting options it selects column names</span>
<span class="sd">    to output and input values to filter on. Returns a pandas.DataFrame object with column names = column_names,</span>
<span class="sd">    and filtered by any of the following: &quot;Device_Id&quot;,&quot;System_Id&quot;,&quot;Measurement_Timestamp&quot;,</span>
<span class="sd">    &quot;Connector_Type_Measurement&quot;, &quot;Measurement_Date&quot; or &quot;Measurement_Time&quot; &quot;&quot;&quot;</span>

    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;System_Id&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             <span class="s2">&quot;Measurement_Date&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Measurement_Time&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Direction&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;column_names&quot;</span><span class="p">:[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">],</span><span class="s2">&quot;outlier_removal&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
    <span class="n">mean_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">mean_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">mean_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>

    <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">,</span><span class="s2">&quot;System_Id&quot;</span><span class="p">,</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">,</span><span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">,</span>
             <span class="s2">&quot;Measurement_Date&quot;</span><span class="p">,</span><span class="s2">&quot;Measurement_Time&quot;</span><span class="p">,</span><span class="s2">&quot;Direction&quot;</span><span class="p">]</span>
    <span class="n">temp_frame</span><span class="o">=</span><span class="n">history_frame</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">filter_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mean_options</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">temp_frame</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]</span><span class="o">==</span><span class="n">mean_options</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]]</span>
<span class="c1">#     temp_frame=temp_frame[temp_frame[&quot;Device_Id&quot;]==mean_options[&quot;Device_Id&quot;]]</span>
<span class="c1">#     temp_frame=temp_frame[temp_frame[&quot;System_Id&quot;]==mean_options[&quot;System_Id&quot;]]</span>
    <span class="k">if</span> <span class="n">mean_options</span><span class="p">[</span><span class="s2">&quot;outlier_removal&quot;</span><span class="p">]:</span>
        <span class="n">mean_s11</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">std_s11</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">temp_frame</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="n">mean_s11</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">std_s11</span><span class="p">)]</span>
        <span class="n">temp_frame</span> <span class="o">=</span> <span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">mean_s11</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">std_s11</span><span class="p">)]</span>
    <span class="n">unique_frequency_list</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">mean_array</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_frequency_list</span><span class="p">):</span>
        <span class="n">row</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">mean_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]:</span>
            <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">unique_frequency_list</span><span class="p">[</span><span class="n">index</span><span class="p">]][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">())</span>
            <span class="n">mean_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_value</span><span class="p">)</span>
        <span class="n">mean_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">mean_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mean_array</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">mean_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">mean_frame</span>

<span class="k">def</span> <span class="nf">median_from_history</span><span class="p">(</span><span class="n">history_frame</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;median_from_history creates a median_frame given a full history frame (pandas.DataFrame object),</span>
<span class="sd">    by setting options it selects column names</span>
<span class="sd">    to output and input values to filter on. Returns a pandas.DataFrame object with column names = column_names,</span>
<span class="sd">    and filtered by any of the following: &quot;Device_Id&quot;,&quot;System_Id&quot;,&quot;Measurement_Timestamp&quot;,</span>
<span class="sd">    &quot;Connector_Type_Measurement&quot;, &quot;Measurement_Date&quot; or &quot;Measurement_Time&quot; &quot;&quot;&quot;</span>

    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;System_Id&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             <span class="s2">&quot;Measurement_Date&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Measurement_Time&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Direction&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;column_names&quot;</span><span class="p">:[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">],</span><span class="s2">&quot;outlier_removal&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
    <span class="n">median_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">median_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">median_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>

    <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">,</span><span class="s2">&quot;System_Id&quot;</span><span class="p">,</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">,</span><span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">,</span>
             <span class="s2">&quot;Measurement_Date&quot;</span><span class="p">,</span><span class="s2">&quot;Measurement_Time&quot;</span><span class="p">,</span><span class="s2">&quot;Direction&quot;</span><span class="p">]</span>
    <span class="n">temp_frame</span><span class="o">=</span><span class="n">history_frame</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">filter_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">median_options</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">temp_frame</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]</span><span class="o">==</span><span class="n">median_options</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">median_options</span><span class="p">[</span><span class="s2">&quot;outlier_removal&quot;</span><span class="p">]:</span>
        <span class="n">mean_s11</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">std_s11</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">temp_frame</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="n">mean_s11</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">std_s11</span><span class="p">)]</span>
        <span class="n">temp_frame</span> <span class="o">=</span> <span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">mean_s11</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">std_s11</span><span class="p">)]</span>
<span class="c1">#     temp_frame=temp_frame[temp_frame[&quot;Device_Id&quot;]==median_options[&quot;Device_Id&quot;]]</span>
<span class="c1">#     temp_frame=temp_frame[temp_frame[&quot;System_Id&quot;]==median_options[&quot;System_Id&quot;]]</span>
    <span class="n">unique_frequency_list</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">median_array</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_frequency_list</span><span class="p">):</span>
        <span class="n">row</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">median_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]:</span>
            <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">unique_frequency_list</span><span class="p">[</span><span class="n">index</span><span class="p">]][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">())</span>
            <span class="n">median_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">median_value</span><span class="p">)</span>
        <span class="n">median_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">median_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">median_array</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">median_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">median_frame</span>

<span class="k">def</span> <span class="nf">raw_difference_frame</span><span class="p">(</span><span class="n">raw_model</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a difference pandas.DataFrame given a raw NIST model and a mean pandas.DataFrame&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;column_names&quot;</span><span class="p">:</span><span class="n">mean_frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
    <span class="n">difference_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">difference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">difference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="n">difference_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">raw_model</span><span class="o">.</span><span class="n">data</span><span class="p">[:]:</span>
        <span class="c1">#print row[0]</span>
        <span class="n">mean_row</span><span class="o">=</span><span class="n">mean_frame</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">mean_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="nb">abs</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
        <span class="c1">#print mean_row</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mean_row</span><span class="o">=</span><span class="n">mean_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">difference_row</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">mean_row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_row</span><span class="p">))]</span>
            <span class="n">difference_row</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">difference_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">difference_row</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span><span class="k">pass</span>
    <span class="n">difference_data_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">difference_list</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">difference_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">difference_data_frame</span>

<span class="k">def</span> <span class="nf">return_history_key</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">):</span>
    <span class="s2">&quot;Returns a key for the history dictionary given a calrep model&quot;</span>
    <span class="n">model</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="c1">#print model</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Calrep|DUT&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;OnePortCalrep&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;1-port calrep&#39;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;TwoPortCalrep&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;2-port calrep&#39;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;PowerCalrep&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">POWER_3TERM_COLUMN_NAMES</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;power 3term calrep&#39;</span>
            <span class="k">elif</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">POWER_4TERM_COLUMN_NAMES</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;power 4term calrep&#39;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;OnePortDUT&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;power 3term calrep&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Must be a calrep model, such as OnePortCalrepModel, etc. &quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">raw_comparison_plot_with_residuals</span><span class="p">(</span><span class="n">raw_nist</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">,</span><span class="n">difference_frame</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a comparison plot given a RawModel object and a pandas.DataFrame mean frame and difference frame&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;display_mean&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;display_difference&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;display_raw&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;display_legend&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
              <span class="s2">&quot;directory&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span><span class="n">raw_nist</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;_Check_Standard&quot;</span><span class="p">,</span>
              <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
    <span class="n">comparison_plot_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="n">column_names</span><span class="o">=</span><span class="n">mean_frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">number_rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">measurement_date</span><span class="o">=</span><span class="n">raw_nist</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Date&quot;</span><span class="p">]</span>
    <span class="n">diff_axes</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
        <span class="n">diff_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
    <span class="c1">#diff_axes=[diff_ax0,diff_ax1,diff_ax2,diff_ax3,diff_ax4,diff_ax5]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_difference&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">diff_axes</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">difference_frame</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">difference_frame</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="s1">&#39;r-x&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Difference&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-.</span><span class="mo">02</span><span class="p">,</span><span class="o">.</span><span class="mo">02</span><span class="p">)</span>
            <span class="c1">#ax.legend_.remove()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_raw&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">raw_nist</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">raw_nist</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s1">&#39;k-o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">measurement_date</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_mean&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_frame</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">mean_frame</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="s1">&#39;gs&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;8&#39;</span><span class="p">)</span>
        <span class="c1">#ax.xaxis.set_visible(False)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|${\Gamma} $|&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="c1">#ax.sharex(diff_axes[index])</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">raw_nist</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">general_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">directory</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span><span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1">#print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span><span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">calrep_history_plot</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">,</span><span class="n">history_frame</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a calrep_model and a history frame calrep_history_plot plots the file against any other in history</span>
<span class="sd">    frame  (pandas.DataFrame) with dates&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
              <span class="s2">&quot;directory&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;_Device_Measurement&quot;</span><span class="p">,</span>
              <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
              <span class="s2">&quot;file_name&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;min_num&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
              <span class="s2">&quot;max_num&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;error_style&quot;</span><span class="p">:</span><span class="s2">&quot;area&quot;</span><span class="p">}</span>
    <span class="n">history_plot_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">history_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">history_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="c1"># The way we plot depends on the models</span>
    <span class="n">model</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="c1"># The new method relies on metadata and not the class</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;DataTable&quot;</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1-port&#39;</span><span class="p">]:</span>
                <span class="n">model</span><span class="o">=</span><span class="s2">&quot;OnePort&quot;</span>
            <span class="k">elif</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2-port&#39;</span><span class="p">]:</span>
                <span class="n">model</span><span class="o">=</span><span class="s2">&quot;TwoPort&quot;</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Dry Cal|Thermistor|power&#39;</span><span class="p">,</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]):</span>
                <span class="n">model</span><span class="o">=</span><span class="s2">&quot;Power&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>


    <span class="n">device_history</span><span class="o">=</span><span class="n">history_frame</span><span class="p">[</span><span class="n">history_frame</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]]</span>
    <span class="n">unique_analysis_dates</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Analysis_Date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} are {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;unique_analysis_dates&quot;</span><span class="p">,</span><span class="n">unique_analysis_dates</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Power&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span><span class="o">=</span><span class="mi">2</span>
        <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;Efficiency&#39;</span><span class="p">,</span><span class="s1">&#39;Calibration_Factor&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">POWER_3TERM_COLUMN_NAMES</span><span class="p">:</span>
            <span class="n">error_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uMgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uEe&#39;</span><span class="p">,</span><span class="s1">&#39;uCe&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">POWER_4TERM_COLUMN_NAMES</span><span class="p">:</span>
            <span class="n">error_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uMgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uEg&#39;</span><span class="p">,</span><span class="s1">&#39;uCg&#39;</span><span class="p">]</span>
        <span class="n">table</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">joined_table</span>

    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;OnePort&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
        <span class="n">error_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uMgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS11&#39;</span><span class="p">]</span>
        <span class="n">table</span><span class="o">=</span><span class="n">calrep_model</span>

    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;TwoPort&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span><span class="o">=</span><span class="mi">3</span>
        <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="n">error_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uMgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uMgS21&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS21&#39;</span><span class="p">,</span><span class="s1">&#39;uMgS22&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS22&#39;</span><span class="p">]</span>
        <span class="n">table</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">joined_table</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>

        <span class="c1">#ax.xaxis.set_visible(False)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|${\Gamma} $|&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="c1"># initial plot of</span>
        <span class="n">x</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
        <span class="n">error</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">error_names</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;error_style&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">date_index</span><span class="p">,</span><span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_analysis_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]]):</span>
                <span class="n">number_lines</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_analysis_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]])</span>
                <span class="n">date_device_history</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Analysis_Date&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">date</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">date_device_history</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">x_date</span><span class="o">=</span><span class="n">date_device_history</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span>
                    <span class="n">y_date</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">date_device_history</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="n">error_date</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">date_device_history</span><span class="p">[</span><span class="n">error_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;date_device_history&quot;,date_device_history))</span>
                    <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;y_date&quot;,y_date))</span>
                    <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;date&quot;,date))</span>
                    <span class="n">date_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">date_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">number_lines</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">date_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">number_lines</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x_date</span><span class="p">,</span><span class="n">y_date</span><span class="p">,</span>
                         <span class="n">yerr</span><span class="o">=</span><span class="n">error_date</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">date_color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;area&#39;</span><span class="p">,</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;error_style&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="n">error</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">error</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">25</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">date_index</span><span class="p">,</span><span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_analysis_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]]):</span>
                <span class="n">number_lines</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_analysis_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]]))</span>
                <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;number_lines&quot;,number_lines))</span>
                <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;index&quot;,index))</span>
                <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;date_index&quot;,date_index))</span>
                <span class="n">date_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">date_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">number_lines</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">date_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">number_lines</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;date_color&quot;,date_color))</span>

                <span class="n">date_device_history</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Analysis_Date&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">date</span><span class="p">]</span>
                <span class="n">x_date</span><span class="o">=</span><span class="n">date_device_history</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span>
                <span class="n">y_date</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">date_device_history</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">error_date</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">date_device_history</span><span class="p">[</span><span class="n">error_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>


                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_date</span><span class="p">,</span><span class="n">y_date</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">date_color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
        <span class="c1">#ax.sharex(diff_axes[index])</span>
        <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;8&#39;</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">general_descriptor</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">directory</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span><span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1">#print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span><span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">compare_s2p_plots</span><span class="p">(</span><span class="n">list_S2PV1</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;compare_s2p_plot compares a list of s2p files plotting each on the same axis for all</span>
<span class="sd">    8 possible components. The format of plots can be changed by passing options as key words in a</span>
<span class="sd">    key word dictionary. &quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span><span class="s2">&quot;MA&quot;</span><span class="p">,</span>
              <span class="s2">&quot;display_legend&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
              <span class="s2">&quot;directory&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span><span class="s2">&quot;comparison_Plot&quot;</span><span class="p">,</span>
              <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
              <span class="s2">&quot;file_name&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;labels&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;grid&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
    <span class="n">comparison_plot_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>

    <span class="c1"># create a set of 8 subplots</span>
    <span class="c1">#plt.hold(True)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">s2p</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">s2p</span> <span class="ow">in</span> <span class="n">list_S2PV1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">s2p_index</span><span class="p">,</span><span class="n">s2p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_S2PV1</span><span class="p">):</span>
        <span class="c1"># start by changing the format of all the s2p</span>
        <span class="n">s2p</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
        <span class="n">column_names</span><span class="o">=</span><span class="n">s2p</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
            <span class="c1">#ax.xaxis.set_visible(False)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|{0}|&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;grid&quot;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="c1"># initial plot of</span>
            <span class="n">x</span><span class="o">=</span><span class="n">s2p</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s2p</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">s2p_index</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">),</span>
                              <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                              <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">general_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">directory</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span>
                            <span class="p">,</span><span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1">#print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span><span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">return_calrep_value_column_names</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the column names for values in a calrep model. For example if the</span>
<span class="sd">    calrep model is a 1-port, then it returns [&quot;magS11&quot;,&quot;argS11&quot;] &quot;&quot;&quot;</span>
    <span class="n">measurement_type</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1|one&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2|two&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;NR&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS12&#39;</span><span class="p">,</span> <span class="s1">&#39;argS12&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">column_names</span>

<span class="k">def</span> <span class="nf">return_calrep_error_column_names</span><span class="p">(</span><span class="n">calrep_model_value_columns</span><span class="p">,</span><span class="n">error_suffix</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the column names for errors in a calrep model. For example if the</span>
<span class="sd">    calrep model value column names are [&quot;magS11&quot;,&quot;argS11&quot;], then it returns [&quot;uMgS11&quot;,&quot;uAgS11&quot;] &quot;&quot;&quot;</span>
    <span class="n">error_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">calrep_model_value_columns</span><span class="p">[:]:</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span> <span class="s2">&quot;uM&quot;</span> <span class="o">+</span> <span class="n">error_suffix</span><span class="p">)</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span> <span class="s2">&quot;uA&quot;</span> <span class="o">+</span> <span class="n">error_suffix</span><span class="p">)</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Efficiency&quot;</span><span class="p">,</span> <span class="s2">&quot;uE&quot;</span> <span class="o">+</span> <span class="n">error_suffix</span><span class="p">)</span>
        <span class="n">error_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_column</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">error_columns</span>


<span class="k">def</span> <span class="nf">plot_frequency_model</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots any table with frequency as its x-axis and column_names as the x-axis in a</span>
<span class="sd">    series of subplots&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Frequency_Model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plots_per_column&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;plot_format&quot;</span><span class="p">:</span> <span class="s1">&#39;b-o&#39;</span><span class="p">,</span>
                <span class="s2">&quot;share_x&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;subplots_title&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s2">&quot;plot_title&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plot_size&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">}</span>
    <span class="n">plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">frequency_model</span> <span class="o">=</span> <span class="n">DataFrame_to_AsciiDataTable</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">)</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])</span>
    <span class="n">y_data_columns</span> <span class="o">=</span> <span class="n">frequency_model</span><span class="o">.</span><span class="n">column_names</span><span class="p">[:]</span>
    <span class="n">y_data_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">number_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_data_columns</span><span class="p">)</span>
    <span class="n">number_columns</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plots_per_column&quot;</span><span class="p">]</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_columns</span><span class="p">)))</span>
    <span class="n">figure</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="n">number_columns</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;share_x&quot;</span><span class="p">],</span>
                                <span class="n">figsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_size&quot;</span><span class="p">],</span> <span class="n">dpi</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;dpi&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">plot_index</span> <span class="o">&lt;</span> <span class="n">number_plots</span><span class="p">:</span>
            <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">[</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_format&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;subplots_title&quot;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_title&quot;</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_title&quot;</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">figure</span>


<span class="k">def</span> <span class="nf">plot_frequency_model_histogram</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots any table with frequency as its x-axis and column_names as the x-axis in a</span>
<span class="sd">    series of subplots&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Frequency_Model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plots_per_column&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;plot_format&quot;</span><span class="p">:</span> <span class="s1">&#39;b-o&#39;</span><span class="p">,</span>
                <span class="s2">&quot;share_x&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;subplots_title&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s2">&quot;plot_title&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plot_size&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
                <span class="s2">&quot;non_plotable_text&quot;</span><span class="p">:</span> <span class="s2">&quot;Not Plotable&quot;</span><span class="p">}</span>
    <span class="n">plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">frequency_model</span> <span class="o">=</span> <span class="n">DataFrame_to_AsciiDataTable</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">)</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])</span>
    <span class="n">y_data_columns</span> <span class="o">=</span> <span class="n">frequency_model</span><span class="o">.</span><span class="n">column_names</span><span class="p">[:]</span>
    <span class="n">y_data_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">number_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_data_columns</span><span class="p">)</span>
    <span class="n">number_columns</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plots_per_column&quot;</span><span class="p">]</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_columns</span><span class="p">)))</span>
    <span class="n">figure</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="n">number_columns</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;share_x&quot;</span><span class="p">],</span>
                                <span class="n">figsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_size&quot;</span><span class="p">],</span> <span class="n">dpi</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;dpi&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">plot_index</span> <span class="o">&lt;</span> <span class="n">number_plots</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">[</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;subplots_title&quot;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;non_plotable_text&quot;</span><span class="p">]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">Annotation</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;subplots_title&quot;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_title&quot;</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_title&quot;</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">figure</span>

<span class="k">def</span> <span class="nf">plot_calrep</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a calrep model with uncertainties&quot;&quot;&quot;</span>
    <span class="c1"># todo: add options to this plot</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PowerCalrepModel</span><span class="p">,</span><span class="n">TwoPortCalrepModel</span><span class="p">]:</span>
        <span class="n">calrep_model</span><span class="o">.</span><span class="n">joined_table</span><span class="o">.</span><span class="n">metadata</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">calrep_model</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">joined_table</span>

    <span class="c1"># Uncertainties all have u in them</span>
    <span class="n">average_columns</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">column_names</span><span class="p">[:]:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;mag|arg|eff&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">average_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
    <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;average_columns&quot;,average_columns))</span>
    <span class="n">number_plots</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">average_columns</span><span class="p">)</span>
    <span class="n">number_rows</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">number_plots</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="n">column_name</span><span class="o">=</span><span class="n">average_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;M&quot;</span>
            <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
            <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
            <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
            <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
            <span class="c1">#print(&quot;Length of x is {0}, Length of y is {1}, Length of error is {2}&quot;.format(len(x),len(y),len(error)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k-x&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|${\Gamma} $|&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
            <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
            <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
            <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
            <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k-x&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;eff&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;E&quot;</span>
            <span class="n">error_parameter</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;e&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>

            <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
            <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k-x&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
<span class="k">def</span> <span class="nf">plot_calrep_uncertainty</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots the uncertainty values for a calrep model versus frequency&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Calrep_Uncertainty&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;error_suffixes&quot;</span><span class="p">:[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="p">,</span>
                <span class="s2">&quot;error_names&quot;</span><span class="p">:[</span><span class="s1">&#39;Type B&#39;</span><span class="p">,</span><span class="s1">&#39;SNIST&#39;</span><span class="p">,</span><span class="s1">&#39;Connect&#39;</span><span class="p">,</span><span class="s1">&#39;Total Uncertainty&#39;</span><span class="p">],</span>
                <span class="s2">&quot;error_plot_formats&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;r-x&#39;</span><span class="p">,</span><span class="s1">&#39;b-x&#39;</span><span class="p">,</span><span class="s1">&#39;g-x&#39;</span><span class="p">,</span><span class="s1">&#39;k-x&#39;</span><span class="p">]}</span>
    <span class="n">comparison_plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c1"># figure out the number of plots based on the measurement type</span>
    <span class="n">measurement_type</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1|one&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2|two&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;NR&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS12&#39;</span><span class="p">,</span> <span class="s1">&#39;argS12&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span>
    <span class="c1"># create the error column names</span>
    <span class="n">error_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">[:]:</span>
        <span class="n">error_columns_per_plot</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffixes&quot;</span><span class="p">]:</span>
            <span class="n">error_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span> <span class="s2">&quot;uM&quot;</span> <span class="o">+</span><span class="n">suffix</span> <span class="p">)</span>
            <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span> <span class="s2">&quot;uA&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span>
            <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Efficiency&quot;</span><span class="p">,</span> <span class="s2">&quot;uE&quot;</span> <span class="o">+</span><span class="n">suffix</span><span class="p">)</span>
            <span class="n">error_columns_per_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_column</span><span class="p">)</span>
        <span class="n">error_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_columns_per_plot</span><span class="p">)</span>

    <span class="c1"># We want plots that have frequency as the x-axis and y that has an error</span>
    <span class="n">calrep_x</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="c1"># each axis has an error column</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[:]):</span>
        <span class="k">for</span> <span class="n">error_index</span><span class="p">,</span><span class="n">error_column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">error_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]):</span>

            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_column</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">calrep_x</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s1">&#39;error_plot_formats&#39;</span><span class="p">][</span><span class="n">error_index</span><span class="p">],</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s1">&#39;error_names&#39;</span><span class="p">][</span><span class="n">error_index</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">plot_index</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span>
                              <span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">plot_checkstandard_history</span><span class="p">(</span><span class="n">device_history</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a plot of all of the measurements of a device from a history frame (pandas.DataFrame).</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Checkstandard_History&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;min_num&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;max_num&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;error_style&quot;</span><span class="p">:</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span>
                <span class="s2">&quot;extra_plots&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;extra_plot_labels&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;extra_plot_formats&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
    <span class="n">history_plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">history_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">history_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">device_id</span> <span class="o">=</span> <span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">measurement_type</span> <span class="o">=</span> <span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># The new method relies on metadata and not the class</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;OnePort&quot;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;TwoPort&quot;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Dry Cal|Thermistor|power&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;Power&quot;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># print(&quot;{0} is {1}&quot;.format(&quot;model&quot;,model))</span>
    <span class="n">unique_measurement_dates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">number_dates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_measurement_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]])</span>
    <span class="n">extra_length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s1">&#39;extra_plots&#39;</span><span class="p">]:</span>
        <span class="n">extra_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s1">&#39;extra_plots&#39;</span><span class="p">])</span>
    <span class="n">number_measurements</span> <span class="o">=</span> <span class="n">number_dates</span> <span class="o">+</span> <span class="n">extra_length</span>
    <span class="c1"># print(&quot;{0} are {1}&quot;.format(&quot;unique_measurement_dates&quot;,unique_measurement_dates))</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Power&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency&#39;</span><span class="p">,</span> <span class="s1">&#39;Calibration_Factor&#39;</span><span class="p">]</span>


    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;OnePort&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">]</span>


    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;TwoPort&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>

        <span class="c1"># ax.xaxis.set_visible(False)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span> <span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|{0}|&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="c1"># ax.set_title(column_names[index])</span>
        <span class="c1"># initial plot of</span>
        <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_formats&quot;</span><span class="p">]:</span>
                <span class="n">plot_formats</span> <span class="o">=</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_formats&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plot_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;r--&quot;</span> <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_labels&quot;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">model_index</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">plot_formats</span><span class="p">[</span><span class="n">model_index</span><span class="p">],</span>
                            <span class="n">label</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_labels&quot;</span><span class="p">][</span><span class="n">model_index</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">model_index</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">plot_formats</span><span class="p">[</span><span class="n">model_index</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Comparison {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_index</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">date_index</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">unique_measurement_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]]):</span>
            <span class="n">number_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">unique_measurement_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]])</span>
            <span class="n">date_device_history</span> <span class="o">=</span> <span class="n">device_history</span><span class="p">[</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">date</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">date_device_history</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">x_date</span> <span class="o">=</span> <span class="n">date_device_history</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span>
                <span class="n">y_date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">date_device_history</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">date_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">date_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">number_lines</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">date_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">number_lines</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_date</span><span class="p">,</span> <span class="n">y_date</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">date_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># ax.sharex(diff_axes[index])</span>
        <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">),</span>
                          <span class="n">ncol</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_measurements</span><span class="p">)</span> <span class="o">/</span> <span class="mf">28.</span><span class="p">),</span> <span class="mi">1</span><span class="p">])),</span> <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Measurement Dates&quot;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">device_id</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="p">)</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">plot_calrep_results_comparison</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">,</span> <span class="n">results_model</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a calrep file and a results file on the same axis. Input is a calrep table from the sparameter</span>
<span class="sd">    function calrep and a</span>
<span class="sd">    results file, with options. &quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;comparison_Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;error_suffix&quot;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span>
                <span class="s2">&quot;calrep_format&quot;</span><span class="p">:</span> <span class="s1">&#39;k-x&#39;</span><span class="p">,</span>
                <span class="s2">&quot;results_format&quot;</span><span class="p">:</span> <span class="s1">&#39;r-x&#39;</span><span class="p">}</span>
    <span class="n">comparison_plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c1"># figure out the number of plots based on the measurement type</span>
    <span class="n">measurement_type</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1|one&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2|two&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;NR&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS12&#39;</span><span class="p">,</span> <span class="s1">&#39;argS12&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span>
    <span class="c1"># create the error column names</span>
    <span class="n">error_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">[:]:</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span> <span class="s2">&quot;uM&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span> <span class="s2">&quot;uA&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Efficiency&quot;</span><span class="p">,</span> <span class="s2">&quot;uE&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_column</span><span class="p">)</span>

    <span class="c1"># We want plots that have frequency as the x-axis and y that has an error</span>
    <span class="n">calrep_x</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">results_x</span> <span class="o">=</span> <span class="n">results_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="c1"># each axis has an error column</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[:]):</span>
        <span class="n">calrep_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
        <span class="n">results_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results_model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">calrep_x</span><span class="p">,</span> <span class="n">calrep_y</span><span class="p">,</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s1">&#39;calrep_format&#39;</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Calrep of {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">calrep_x</span><span class="p">,</span> <span class="n">calrep_y</span> <span class="o">-</span> <span class="n">error</span><span class="p">,</span> <span class="n">calrep_y</span> <span class="o">+</span> <span class="n">error</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">),</span>
                        <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results_x</span><span class="p">,</span> <span class="n">results_y</span><span class="p">,</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s1">&#39;results_format&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reference File&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span>
                              <span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>


<span class="k">def</span> <span class="nf">plot_calrep_results_difference_comparison</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">,</span> <span class="n">results_model</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a calrep file and a results file on the same axis. Input is a calrep table from the sparameter</span>
<span class="sd">    function calrep and a</span>
<span class="sd">    results file, with options. &quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Difference_Comparison&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;error_suffix&quot;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span>
                <span class="s2">&quot;calrep_format&quot;</span><span class="p">:</span> <span class="s1">&#39;r-x&#39;</span><span class="p">,</span>
                <span class="s2">&quot;results_format&quot;</span><span class="p">:</span> <span class="s1">&#39;r-x&#39;</span><span class="p">,</span>
                <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s1">&#39;Calrep diference of {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">])}</span>
    <span class="n">comparison_plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c1"># figure out the number of plots based on the measurement type</span>
    <span class="n">measurement_type</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1|one&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2|two&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;NR&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS12&#39;</span><span class="p">,</span> <span class="s1">&#39;argS12&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span>
    <span class="c1"># create the error column names</span>
    <span class="n">error_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">[:]:</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span> <span class="s2">&quot;uM&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span> <span class="s2">&quot;uA&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Efficiency&quot;</span><span class="p">,</span> <span class="s2">&quot;uE&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_column</span><span class="p">)</span>
    <span class="n">difference_model</span> <span class="o">=</span> <span class="n">frequency_model_difference</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">,</span> <span class="n">results_model</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} is {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;difference_model.column_names&quot;</span><span class="p">,</span> <span class="n">difference_model</span><span class="o">.</span><span class="n">column_names</span><span class="p">))</span>
    <span class="c1"># We want plots that have frequency as the x-axis and y that has an error</span>
    <span class="n">difference_x</span> <span class="o">=</span> <span class="n">difference_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">calrep_x</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="c1"># each axis has an error column</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[:]):</span>

        <span class="n">difference_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">difference_model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">difference_x</span><span class="p">,</span> <span class="n">difference_y</span><span class="p">,</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s1">&#39;calrep_format&#39;</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Calrep diiference of {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">calrep_x</span><span class="p">,</span> <span class="o">-</span> <span class="n">error</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">),</span>
                        <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>

    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span>
                              <span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">plot_calrep_comparison</span><span class="p">(</span><span class="n">calrep_model_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots many calrep models on the same axis with uncertainties&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">calrep_model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">calrep_model_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PowerCalrepModel</span><span class="p">,</span><span class="n">TwoPortCalrepModel</span><span class="p">]:</span>
            <span class="n">calrep_model_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">joined_table</span><span class="o">.</span><span class="n">metadata</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span>
            <span class="n">calrep_model_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">joined_table</span>

        <span class="c1"># Uncertainties all have u in them</span>
    <span class="n">average_columns</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">calrep_model_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">column_names</span><span class="p">[:]:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;mag|arg|eff&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">average_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
    <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;average_columns&quot;,average_columns))</span>
    <span class="n">number_plots</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">average_columns</span><span class="p">)</span>
    <span class="n">number_rows</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">number_plots</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
    <span class="c1">#plt.hold(True)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">calrep_model</span> <span class="ow">in</span> <span class="n">calrep_model_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
            <span class="n">column_name</span><span class="o">=</span><span class="n">average_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;M&quot;</span>
                <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
                <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|${\Gamma} $|&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
                <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
                <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;eff&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;E&quot;</span>
                <span class="n">error_parameter</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                    <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;e&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                    <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>

                <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>


<span class="k">def</span> <span class="nf">plot_checkstandard_history</span><span class="p">(</span><span class="n">device_history</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a plot of all of the measurements of a device from a history frame (pandas.DataFrame).</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Checkstandard_History&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;min_num&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;max_num&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;error_style&quot;</span><span class="p">:</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span>
                <span class="s2">&quot;extra_plots&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;extra_plot_labels&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;extra_plot_formats&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
    <span class="n">history_plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">history_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">history_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">device_id</span> <span class="o">=</span> <span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">measurement_type</span> <span class="o">=</span> <span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># The new method relies on metadata and not the class</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;OnePort&quot;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;TwoPort&quot;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Dry Cal|Thermistor|power&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;Power&quot;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># print(&quot;{0} is {1}&quot;.format(&quot;model&quot;,model))</span>
    <span class="n">unique_measurement_dates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">number_dates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_measurement_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]])</span>
    <span class="n">extra_length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s1">&#39;extra_plots&#39;</span><span class="p">]:</span>
        <span class="n">extra_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s1">&#39;extra_plots&#39;</span><span class="p">])</span>
    <span class="n">number_measurements</span> <span class="o">=</span> <span class="n">number_dates</span> <span class="o">+</span> <span class="n">extra_length</span>
    <span class="c1"># print(&quot;{0} are {1}&quot;.format(&quot;unique_measurement_dates&quot;,unique_measurement_dates))</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Power&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span>
        <span class="n">number_columns</span><span class="o">=</span><span class="mi">1</span>


    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;OnePort&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
        <span class="n">number_columns</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;TwoPort&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="n">number_columns</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">number_columns</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># ax.xaxis.set_visible(False)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span> <span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|{0}|&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Ef&#39;</span><span class="p">,</span> <span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|{0}|&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="c1"># ax.set_title(column_names[index])</span>
            <span class="c1"># initial plot of</span>

            <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_formats&quot;</span><span class="p">]:</span>
                    <span class="n">plot_formats</span> <span class="o">=</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_formats&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plot_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;r--&quot;</span> <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_labels&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">model_index</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">plot_formats</span><span class="p">[</span><span class="n">model_index</span><span class="p">],</span>
                                <span class="n">label</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_labels&quot;</span><span class="p">][</span><span class="n">model_index</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">model_index</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">plot_formats</span><span class="p">[</span><span class="n">model_index</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Comparison {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_index</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">for</span> <span class="n">date_index</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">unique_measurement_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]]):</span>
            <span class="n">number_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">unique_measurement_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]])</span>
            <span class="n">date_device_history</span> <span class="o">=</span> <span class="n">device_history</span><span class="p">[</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">date</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">date_device_history</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">x_date</span> <span class="o">=</span> <span class="n">date_device_history</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span>
                    <span class="n">y_date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">date_device_history</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="n">date_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">date_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">number_lines</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">date_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">number_lines</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_date</span><span class="p">,</span> <span class="n">y_date</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">date_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># ax.sharex(diff_axes[index])</span>
        <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">),</span>
                          <span class="n">ncol</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_measurements</span><span class="p">)</span> <span class="o">/</span> <span class="mf">28.</span><span class="p">),</span> <span class="mi">1</span><span class="p">])),</span> <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Measurement Dates&quot;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">device_id</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="p">)</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">plot_raw_MUF_comparison</span><span class="p">(</span><span class="n">raw_directory</span><span class="o">=</span><span class="s2">r&quot;C:\Share\35CalComp\35_ascii_results&quot;</span><span class="p">,</span>
                            <span class="n">measurement_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;N101P1.L1_030716&#39;</span><span class="p">,</span> <span class="s1">&#39;N101P2.L1_030716&#39;</span><span class="p">],</span>
                            <span class="n">nominal_path</span><span class="o">=</span><span class="s2">r&quot;C:\Share\35CalComp\MUF_results\DUTs\N101P1_Support\N101P1_0.s2p&quot;</span><span class="p">,</span>
                            <span class="n">sensitivity_directory</span><span class="o">=</span><span class="s2">r&quot;C:\Share\35CalComp\MUF_results\DUTs\N101P1_Support\Covariance&quot;</span><span class="p">,</span>
                            <span class="n">montecarlo_directory</span><span class="o">=</span><span class="s2">r&quot;C:\Share\35CalComp\MUF_results\DUTs\N101P1_Support\MonteCarlo&quot;</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a comparison of results form the Microwave Uncertainty Framework and calrep given a raw file, nominal file,</span>
<span class="sd">    a sensitivity directory and a montecarlo directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># deal with options</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;save_plots&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
    <span class="n">comparison_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">comparison_options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c1"># load files into python classes</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">sparameter_power_type</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raw_directory</span><span class="p">,</span> <span class="n">measurement_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">print</span> <span class="n">model_name</span>
    <span class="c1"># raw_type(os.path.join(raw_directory,&#39;M105P1.L1_030716&#39;))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">model_name</span><span class="p">]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">model</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raw_directory</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span> <span class="n">measurement_names</span><span class="p">)</span>
    <span class="n">calrep_measurements</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calrep</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">measurements</span><span class="p">)</span>
    <span class="n">montecarlo_reference_curve</span> <span class="o">=</span> <span class="n">create_monte_carlo_reference_curve</span><span class="p">(</span><span class="n">monte_carlo_directory</span><span class="o">=</span><span class="n">montecarlo_directory</span><span class="p">,</span>
                                                                    <span class="n">format</span><span class="o">=</span><span class="s2">&quot;MA&quot;</span><span class="p">)</span>
    <span class="n">sensitivity_reference_curve</span> <span class="o">=</span> <span class="n">create_sensitivity_reference_curve</span><span class="p">(</span><span class="n">nominal_file_path</span><span class="o">=</span><span class="n">nominal_path</span><span class="p">,</span>
                                                                     <span class="n">sensitivity_directory</span><span class="o">=</span><span class="n">sensitivity_directory</span><span class="p">,</span>
                                                                     <span class="n">format</span><span class="o">=</span><span class="s2">&quot;MA&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]))</span>

    <span class="c1"># update global preferences</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">)})</span>

    <span class="c1"># for one-port</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">combined_figure</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Now plot all of these together at once mag first</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="n">measurements</span> <span class="o">+</span> <span class="p">[</span><span class="n">sensitivity_reference_curve</span><span class="p">,</span> <span class="n">montecarlo_reference_curve</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Montecarlo&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Nominal&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Measurement {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

        <span class="c1"># now phase</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;argS11&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">combined_figure</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="n">measurements</span> <span class="o">+</span> <span class="p">[</span><span class="n">sensitivity_reference_curve</span><span class="p">,</span> <span class="n">montecarlo_reference_curve</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Montecarlo&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Nominal&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Measurement {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S11&quot;</span><span class="p">,</span> <span class="s2">&quot;S21&quot;</span><span class="p">,</span> <span class="s2">&quot;S22&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">plot_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="c1"># Now plot all of these together at once mag first</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="c1"># now phase</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;arg&quot;</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">plot_index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>


                <span class="c1"># plot the difference with uncertainties</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;One&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="c1"># now the difference of mag for measurement one</span>
        <span class="n">montecarlo_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">montecarlo_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;umagS11&quot;</span><span class="p">])</span>
        <span class="n">measurement_1_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">measurement_1_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;uMgS11&quot;</span><span class="p">])</span>
        <span class="n">nominal_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">nominal_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;umagS11&quot;</span><span class="p">])</span>
        <span class="n">difference_figure</span><span class="p">,</span> <span class="n">difference_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                <span class="n">measurement_1_mag</span> <span class="o">-</span> <span class="n">nominal_mag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Nominal and Calrep&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">nominal_uncertainty</span><span class="p">,</span>
                                        <span class="n">nominal_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sensitivity Uncertainty&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">measurement_1_mag</span> <span class="o">-</span> <span class="n">montecarlo_mag</span><span class="p">,</span>
                                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Montecarlo mean and Calrep&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">montecarlo_uncertainty</span><span class="p">,</span>
                                        <span class="n">montecarlo_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Montecarlo Uncertainty&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">measurement_1_uncertainty</span><span class="p">,</span>
                                        <span class="n">measurement_1_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calrep Uncertainty&quot;</span><span class="p">)</span>
        <span class="n">montecarlo_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;argS11&quot;</span><span class="p">])</span>
        <span class="n">montecarlo_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;uargS11&quot;</span><span class="p">])</span>
        <span class="n">measurement_1_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;argS11&quot;</span><span class="p">])</span>
        <span class="n">measurement_1_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;uAgS11&quot;</span><span class="p">])</span>
        <span class="n">nominal_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;argS11&quot;</span><span class="p">])</span>
        <span class="n">nominal_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;uargS11&quot;</span><span class="p">])</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                <span class="n">measurement_1_arg</span> <span class="o">-</span> <span class="n">nominal_arg</span><span class="p">,</span>
                                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Nominal &quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">nominal_arg_uncertainty</span><span class="p">,</span>
                                        <span class="n">nominal_arg_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sensitivity Uncertainty&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">measurement_1_arg</span> <span class="o">-</span> <span class="n">montecarlo_arg</span><span class="p">,</span>
                                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Montecarlo &quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                        <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">montecarlo_arg_uncertainty</span><span class="p">,</span> <span class="n">montecarlo_arg_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Montecarlo Uncertainty&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                        <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">measurement_1_arg_uncertainty</span><span class="p">,</span> <span class="n">measurement_1_arg_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calrep Uncertainty&quot;</span><span class="p">)</span>

        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-.</span><span class="mo">025</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=.</span><span class="mo">025</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S11&quot;</span><span class="p">,</span> <span class="s2">&quot;S21&quot;</span><span class="p">,</span> <span class="s2">&quot;S22&quot;</span><span class="p">]</span>
        <span class="n">difference_figure</span><span class="p">,</span> <span class="n">difference_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">plot_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">difference_axes</span><span class="p">):</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]</span>
            <span class="n">montecarlo_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">montecarlo_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;umag&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">measurement_1_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;mag&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">measurement_1_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;uMg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">nominal_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">nominal_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;umag&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                             <span class="n">measurement_1_mag</span> <span class="o">-</span> <span class="n">nominal_mag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Nominal and Calrep&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">nominal_uncertainty</span><span class="p">,</span>
                                     <span class="n">nominal_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sensitivity Uncertainty&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">measurement_1_mag</span> <span class="o">-</span> <span class="n">montecarlo_mag</span><span class="p">,</span>
                             <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Montecarlo mean and Calrep&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">montecarlo_uncertainty</span><span class="p">,</span>
                                     <span class="n">montecarlo_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Montecarlo Uncertainty&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">measurement_1_uncertainty</span><span class="p">,</span>
                                     <span class="n">measurement_1_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calrep Uncertainty&quot;</span><span class="p">)</span>
            <span class="n">montecarlo_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;arg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">montecarlo_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;uarg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">measurement_1_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;arg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">measurement_1_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;uAg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">nominal_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;arg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">nominal_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;uarg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                             <span class="n">measurement_1_arg</span> <span class="o">-</span> <span class="n">nominal_arg</span><span class="p">,</span>
                             <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Nominal &quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">nominal_arg_uncertainty</span><span class="p">,</span>
                                     <span class="n">nominal_arg_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sensitivity Uncertainty&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">measurement_1_arg</span> <span class="o">-</span> <span class="n">montecarlo_arg</span><span class="p">,</span>
                             <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Montecarlo &quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                     <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">montecarlo_arg_uncertainty</span><span class="p">,</span> <span class="n">montecarlo_arg_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Montecarlo Uncertainty&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                     <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">measurement_1_arg_uncertainty</span><span class="p">,</span> <span class="n">measurement_1_arg_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calrep Uncertainty&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plot_index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-.</span><span class="mo">0001</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=.</span><span class="mo">0001</span><span class="p">)</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mf">1.8</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-.</span><span class="mo">025</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=.</span><span class="mo">025</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="c1"># Return files if you need them later</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">measurements</span><span class="p">,</span> <span class="n">calrep_measurements</span><span class="p">,</span> <span class="n">montecarlo_reference_curve</span><span class="p">,</span> <span class="n">sensitivity_reference_curve</span><span class="p">]</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Module Classes</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Module Scripts</span>
<span class="k">def</span> <span class="nf">test_average_one_port_sparameters</span><span class="p">():</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">TESTS_DIRECTORY</span><span class="p">)</span>
    <span class="n">table_list</span><span class="o">=</span><span class="p">[</span><span class="n">OnePortRawModel</span><span class="p">(</span><span class="s1">&#39;OnePortRawTestFileAsConverted.txt&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="n">out_data</span><span class="o">=</span><span class="n">average_one_port_sparameters</span><span class="p">(</span><span class="n">table_list</span><span class="p">)</span>
    <span class="n">out_table</span><span class="o">=</span><span class="n">OnePortRawModel</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="n">out_data</span><span class="p">})</span>
    <span class="c1">#table_list[0].show()</span>
    <span class="c1">#out_table.show()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">out_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">out_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;magS11&#39;</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">table_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">table_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;magS11&#39;</span><span class="p">),</span><span class="s1">&#39;bx&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnitude S11&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">out_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">out_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;argS11&#39;</span><span class="p">),</span><span class="s1">&#39;ro&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">table_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">table_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;argS11&#39;</span><span class="p">),</span><span class="s1">&#39;bx&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Phase S11&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">out_table</span>

<span class="k">def</span> <span class="nf">test_comparison</span><span class="p">(</span><span class="n">input_file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test_comparison tests the raw_mean,difference and comparison plot functionality&quot;&quot;&quot;</span>
    <span class="c1"># Data sources, to be replaced as project_files in Django</span>
    <span class="c1"># Todo: These are not robust tests fix them?</span>
    <span class="n">TWO_PORT_NR_CHKSTD_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_Check_Standard\Two_Port_NR_Check_Standard.csv&quot;</span>
    <span class="n">COMBINED_ONE_PORT_CHKSTD_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_Check_Standard\Combined_One_Port_Check_Standard.csv&quot;</span>
    <span class="n">COMBINED_TWO_PORT_CHKSTD_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_Check_Standard\Combined_Two_Port_Check_Standard.csv&quot;</span>
    <span class="n">COMBINED_POWER_CHKSTD_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_Check_Standard\Combined_Power_Check_Standard.csv&quot;</span>
    <span class="n">ONE_PORT_CALREP_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_DUT\One_Port_DUT.csv&quot;</span>
    <span class="n">TWO_PORT_CALREP_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_DUT\Two_Port_DUT.csv&quot;</span>
    <span class="n">POWER_3TERM_CALREP_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_DUT\Power_3Term_DUT.csv&quot;</span>
    <span class="n">POWER_4TERM_CALREP_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_DUT\Power_4Term_DUT.csv&quot;</span>
    <span class="n">history_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;1-port&#39;</span><span class="p">:</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">COMBINED_ONE_PORT_CHKSTD_CSV</span><span class="p">),</span>
         <span class="s1">&#39;2-port&#39;</span><span class="p">:</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">COMBINED_TWO_PORT_CHKSTD_CSV</span><span class="p">),</span>
         <span class="s1">&#39;2-portNR&#39;</span><span class="p">:</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">TWO_PORT_NR_CHKSTD_CSV</span><span class="p">),</span><span class="s1">&#39;power&#39;</span><span class="p">:</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">COMBINED_POWER_CHKSTD_CSV</span><span class="p">)}</span>
    <span class="k">if</span> <span class="n">input_file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\C07207.D1_030298&quot;</span>
        <span class="n">input_file</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Ck_Std_raw_ascii\C07207.D9_042500&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\C07208.A10_081507&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\CTNP20.R1_032310&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\CN49.K2_050608&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\C22P13.H4_043015&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\C24N07.L1_070998&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\CTN208.A1_011613&quot;</span>
    <span class="n">start_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">file_model</span><span class="o">=</span><span class="n">sparameter_power_type</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
    <span class="n">model</span><span class="o">=</span><span class="nb">globals</span><span class="p">()[</span><span class="n">file_model</span><span class="p">]</span>
    <span class="n">table</span><span class="o">=</span><span class="n">model</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
    <span class="c1">#print table</span>
    <span class="c1">#table.metadata[&quot;System_Id&quot;]</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">:</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">],</span> <span class="s2">&quot;System_Id&quot;</span><span class="p">:</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;System_Id&quot;</span><span class="p">],</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                  <span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">:</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">],</span>
                 <span class="s2">&quot;Measurement_Date&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Measurement_Time&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2-port&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2-portNR&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">history_key</span><span class="o">=</span><span class="s1">&#39;2-port&#39;</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2-portNR&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">history_key</span><span class="o">=</span><span class="s1">&#39;2-portNR&#39;</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS12&#39;</span><span class="p">,</span><span class="s1">&#39;argS12&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1-port&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">history_key</span><span class="o">=</span><span class="s1">&#39;1-port&#39;</span>
        <span class="k">if</span> <span class="n">COMBINE_S11_S22</span><span class="p">:</span>
             <span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Dry Cal|Thermistor|power&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">history_key</span><span class="o">=</span><span class="s1">&#39;power&#39;</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;Efficiency&#39;</span><span class="p">,</span><span class="s1">&#39;Calibration_Factor&#39;</span><span class="p">]</span>
    <span class="c1">#print history[history_key][:5]</span>
    <span class="k">print</span> <span class="n">history_key</span>
    <span class="n">mean_frame</span><span class="o">=</span><span class="n">mean_from_history</span><span class="p">(</span><span class="n">history_dict</span><span class="p">[</span><span class="n">history_key</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="c1">#print mean_frame</span>
    <span class="n">difference_frame</span><span class="o">=</span><span class="n">raw_difference_frame</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">)</span>
    <span class="c1">#print difference_frame</span>
    <span class="n">stop_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">plot_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;display_difference&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s2">&quot;display_mean&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;display_raw&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>
    <span class="n">raw_comparison_plot_with_residuals</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">,</span><span class="n">difference_frame</span><span class="p">,</span><span class="o">**</span><span class="n">plot_options</span><span class="p">)</span>
    <span class="c1">#stop_time=datetime.datetime.now()</span>
    <span class="n">diff</span><span class="o">=</span><span class="n">stop_time</span><span class="o">-</span><span class="n">start_time</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;It took {0} seconds to process&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>

<span class="k">def</span> <span class="nf">test_compare_s2p_plots</span><span class="p">(</span><span class="n">file_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;thru.s2p&quot;</span><span class="p">,</span><span class="s1">&#39;20160301_30ft_cable_0.s2p&#39;</span><span class="p">,</span><span class="s1">&#39;TwoPortTouchstoneTestFile.s2p&#39;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Tests the compare_s2p_plots function&quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">TESTS_DIRECTORY</span><span class="p">)</span>
    <span class="n">tables</span><span class="o">=</span><span class="p">[</span><span class="n">S2PV1</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">]</span>
    <span class="n">format</span><span class="o">=</span><span class="s2">&quot;MA&quot;</span>
    <span class="n">compare_s2p_plots</span><span class="p">(</span><span class="n">tables</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="n">format</span><span class="p">)</span>
    <span class="n">format</span><span class="o">=</span><span class="s2">&quot;DB&quot;</span>
    <span class="n">compare_s2p_plots</span><span class="p">(</span><span class="n">tables</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="n">format</span><span class="p">,</span><span class="n">display_legend</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Module Runner</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1">#test_average_one_port_sparameters()</span>
    <span class="c1">#test_comparison()</span>
    <span class="n">test_compare_s2p_plots</span><span class="p">()</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.S_to_T">
    <p>def <span class="ident">S_to_T</span>(</p><p>S_list)</p>
    </div>
    

    
  
    <div class="desc"><p>Converts S-parameters into a T Matrix. Input form should be in frequency, np.matrix([[S11,S12],[S21,S22]])
format. Returns a list in [frequency, np.matrix] format</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.S_to_T', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.S_to_T" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">S_to_T</span><span class="p">(</span><span class="n">S_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts S-parameters into a T Matrix. Input form should be in frequency, np.matrix([[S11,S12],[S21,S22]])</span>
<span class="sd">    format. Returns a list in [frequency, np.matrix] format &quot;&quot;&quot;</span>
    <span class="n">t_complex_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">t_matrix</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">S_list</span><span class="p">:</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">T11</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">T12</span><span class="o">=</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">T21</span><span class="o">=-</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">T22</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t_matrix</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">T11</span><span class="p">,</span><span class="n">T12</span><span class="p">],[</span><span class="n">T21</span><span class="p">,</span><span class="n">T22</span><span class="p">]])])</span>
        <span class="n">t_complex_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">T11</span><span class="p">,</span><span class="n">T12</span><span class="p">,</span><span class="n">T21</span><span class="p">,</span><span class="n">T22</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">t_matrix</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.T_to_S">
    <p>def <span class="ident">T_to_S</span>(</p><p>T_list)</p>
    </div>
    

    
  
    <div class="desc"><p>Converts T Matrix into S parameters. Input form should be in frequency, np.matrix([[T11,T12],[T21,T22]])
format. Returns a list in [frequency, np.matrix] format.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.T_to_S', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.T_to_S" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">T_to_S</span><span class="p">(</span><span class="n">T_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts T Matrix into S parameters. Input form should be in frequency, np.matrix([[T11,T12],[T21,T22]])</span>
<span class="sd">    format. Returns a list in [frequency, np.matrix] format.&quot;&quot;&quot;</span>
    <span class="n">S_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">T_list</span><span class="p">:</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">S11</span><span class="o">=</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">S12</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">S21</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">S22</span><span class="o">=-</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">S_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">],[</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">]])])</span>
    <span class="k">return</span> <span class="n">S_list</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.add_white_noise_s2p">
    <p>def <span class="ident">add_white_noise_s2p</span>(</p><p>s2p_model, noise_level=0.0005)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds white noise to a s2p in RI format and returns a new s2p with the noise added to each real and imaginary component</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.add_white_noise_s2p', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.add_white_noise_s2p" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_white_noise_s2p</span><span class="p">(</span><span class="n">s2p_model</span><span class="p">,</span><span class="n">noise_level</span><span class="o">=.</span><span class="mo">0005</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds white noise to a s2p in RI format and returns a new s2p with the noise added to each real and imaginary component&quot;&quot;&quot;</span>
    <span class="n">s2p_model</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="s2">&quot;RI&quot;</span><span class="p">)</span>
    <span class="n">s2p_data</span><span class="o">=</span><span class="n">s2p_model</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
    <span class="n">noisy_data</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s2p_data</span><span class="p">:</span>
        <span class="n">new_row</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">sparameters</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">noise_level</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="n">new_row</span><span class="o">=</span><span class="n">new_row</span><span class="o">+</span><span class="n">sparameters</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">noisy_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="n">options</span><span class="o">=</span><span class="n">s2p_model</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">noisy_data</span>
    <span class="n">options</span><span class="p">[</span><span class="s2">&quot;sparameter_complex&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">noisy_s2p</span><span class="o">=</span><span class="n">S2PV1</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">noisy_s2p</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.average_one_port_sparameters">
    <p>def <span class="ident">average_one_port_sparameters</span>(</p><p>table_list, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a table that is the average of the Sparameters in table list. The new table will have all the unique
frequency values contained in all of the tables. Tables must be in Real-Imaginary format or magnitude-angle format
do not try to average db-angle format.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.average_one_port_sparameters', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.average_one_port_sparameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">average_one_port_sparameters</span><span class="p">(</span><span class="n">table_list</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a table that is the average of the Sparameters in table list. The new table will have all the unique</span>
<span class="sd">    frequency values contained in all of the tables. Tables must be in Real-Imaginary format or magnitude-angle format</span>
<span class="sd">    do not try to average db-angle format. &quot;&quot;&quot;</span>
    <span class="c1">#This will work on any table that the data is stored in data, need to add a sparameter version</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;frequency_selector&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;frequency_column_name&quot;</span><span class="p">:</span><span class="s2">&quot;Frequency&quot;</span><span class="p">}</span>
    <span class="n">average_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">average_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">average_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="n">frequency_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">average_data</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">table_list</span><span class="p">:</span>
        <span class="n">frequency_list</span><span class="o">=</span><span class="n">frequency_list</span><span class="o">+</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">unique_frequency_list</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">frequency_list</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="n">unique_frequency_list</span><span class="p">:</span>
        <span class="n">new_row</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">table_list</span><span class="p">:</span>
            <span class="n">data_list</span><span class="o">=</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">average_options</span><span class="p">[</span><span class="s2">&quot;frequency_selector&quot;</span><span class="p">]]</span><span class="o">==</span><span class="n">frequency</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">table_average</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_list</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_average</span><span class="p">)</span>
            <span class="c1">#print new_row</span>
        <span class="n">average_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">average_data</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.calrep">
    <p>def <span class="ident">calrep</span>(</p><p>raw_model, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Performs the calrep analysis routine on a raw data format (such as OnePortRawModel, TwoPortRawModel,PowerRawModel)
Differs from the HP BASIC program in that it keeps the metadata Needs to be checked, returns 4 error terms for power
Also does not calculate all the same rows for power, expansion factor is set to 2, requires that the raw model
has the attribute raw_model.metadata["Connector_Type_Measurement"] defined. If the columns passed in raw_model
do not have repeat values or contain text the result will set connect uncertainty to zero</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.calrep', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.calrep" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calrep</span><span class="p">(</span><span class="n">raw_model</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Performs the calrep analysis routine on a raw data format (such as OnePortRawModel, TwoPortRawModel,PowerRawModel)</span>
<span class="sd">    Differs from the HP BASIC program in that it keeps the metadata Needs to be checked, returns 4 error terms for power</span>
<span class="sd">    Also does not calculate all the same rows for power, expansion factor is set to 2, requires that the raw model</span>
<span class="sd">    has the attribute raw_model.metadata[&quot;Connector_Type_Measurement&quot;] defined. If the columns passed in raw_model</span>
<span class="sd">    do not have repeat values or contain text the result will set connect uncertainty to zero&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mean_file</span><span class="o">=</span><span class="n">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">raw_model</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">mean_file</span><span class="o">=</span><span class="n">raw_model</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">standard_deviation_file</span><span class="o">=</span><span class="n">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">raw_model</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;std&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">std_data</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mean_file</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">new_row</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">mean_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">std_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="n">standard_deviation_file</span><span class="o">=</span><span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">column_names</span><span class="o">=</span><span class="n">raw_model</span><span class="o">.</span><span class="n">column_names</span><span class="p">,</span>
                                               <span class="n">data</span><span class="o">=</span><span class="n">std_data</span><span class="p">,</span><span class="n">column_types</span><span class="o">=</span><span class="n">raw_model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;Direction&quot;</span> <span class="ow">in</span> <span class="n">mean_file</span><span class="o">.</span><span class="n">column_names</span> <span class="ow">and</span> <span class="s2">&quot;Connect&quot;</span> <span class="ow">in</span> <span class="n">mean_file</span><span class="o">.</span><span class="n">column_names</span><span class="p">:</span>
        <span class="n">mean_file</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;Direction&quot;</span><span class="p">)</span>
        <span class="n">mean_file</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;Connect&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Direction&quot;</span> <span class="ow">in</span> <span class="n">standard_deviation_file</span><span class="o">.</span><span class="n">column_names</span> <span class="ow">and</span> <span class="s2">&quot;Connect&quot;</span> <span class="ow">in</span> <span class="n">standard_deviation_file</span><span class="o">.</span><span class="n">column_names</span><span class="p">:</span>
        <span class="n">standard_deviation_file</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;Direction&quot;</span><span class="p">)</span>
        <span class="n">standard_deviation_file</span><span class="o">.</span><span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;Connect&quot;</span><span class="p">)</span>
    <span class="n">new_data</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">new_column_names</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">expansion_factor</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">frequency_index</span><span class="o">=</span><span class="n">mean_file</span><span class="o">.</span><span class="n">column_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mean_file</span><span class="o">.</span><span class="n">data</span><span class="p">[:]):</span>
        <span class="n">new_data_row</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">column_index</span><span class="p">,</span><span class="n">column_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mean_file</span><span class="o">.</span><span class="n">column_names</span><span class="p">[:]):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">row_index</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">column_index</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                    <span class="n">error_selector</span><span class="o">=</span><span class="mi">0</span>
                    <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;M&quot;</span>
                    <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;arg|phase&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                    <span class="n">error_selector</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
                    <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Eff&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                    <span class="n">error_selector</span><span class="o">=</span><span class="mi">0</span>
                    <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;E&quot;</span>
                    <span class="n">error_parameter</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">error_selector</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">if</span> <span class="n">row_index</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># If this is the first row build the column names list</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;b&quot;</span><span class="o">+</span><span class="n">error_parameter</span><span class="p">)</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;a&quot;</span><span class="o">+</span><span class="n">error_parameter</span><span class="p">)</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;d&quot;</span><span class="o">+</span><span class="n">error_parameter</span><span class="p">)</span>
                    <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span><span class="p">)</span>

                <span class="c1"># Mean Value</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">column_index</span><span class="p">])</span>
                <span class="c1"># Type B</span>
                <span class="n">ub</span><span class="o">=</span><span class="n">type_b</span><span class="p">(</span><span class="n">wr_connector_type</span><span class="o">=</span><span class="n">mean_file</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">],</span>
                         <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">frequency_index</span><span class="p">],</span><span class="n">parameter</span><span class="o">=</span><span class="n">column_name</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">column_index</span><span class="p">],</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;mag&quot;</span><span class="p">)</span>
                <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;ub&quot;,ub))</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ub</span><span class="p">[</span><span class="n">error_selector</span><span class="p">])</span>
                <span class="c1"># Type A or SNIST</span>
                <span class="n">ua</span><span class="o">=</span><span class="n">S_NIST</span><span class="p">(</span><span class="n">wr_connector_type</span><span class="o">=</span><span class="n">mean_file</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">],</span>
                         <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">frequency_index</span><span class="p">],</span><span class="n">parameter</span><span class="o">=</span><span class="n">column_name</span><span class="p">,</span><span class="n">magnitude</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">column_index</span><span class="p">],</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;mag&quot;</span><span class="p">)</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ua</span><span class="p">[</span><span class="n">error_selector</span><span class="p">])</span>

                <span class="c1"># Standard Deviation</span>
                <span class="n">ud</span><span class="o">=</span><span class="n">standard_deviation_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">column_index</span><span class="p">]</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ud</span><span class="p">)</span>
                <span class="c1"># Total Uncertainty</span>
                <span class="c1">#print(&quot; ua is {0}, ub is {1} and ud is {2}&quot;.format(ua,ub,ud))</span>
                <span class="n">total_uncertainty</span><span class="o">=</span><span class="n">expansion_factor</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ua</span><span class="p">[</span><span class="n">error_selector</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ub</span><span class="p">[</span><span class="n">error_selector</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ud</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">new_data_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_uncertainty</span><span class="p">)</span>
        <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_data_row</span><span class="p">)</span>
    <span class="n">sorted_keys</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">mean_file</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;{0} = {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">mean_file</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sorted_keys</span><span class="p">]</span>
    <span class="n">column_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float&quot;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">new_column_names</span><span class="p">]</span>
    <span class="c1">#todo: Add value_column_names and uncertainty_column_names to conform to reference curve</span>
    <span class="n">calrep</span><span class="o">=</span><span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">new_data</span><span class="p">,</span><span class="n">column_types</span><span class="o">=</span><span class="n">column_types</span><span class="p">,</span>
                          <span class="n">column_names</span><span class="o">=</span><span class="n">new_column_names</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
                          <span class="n">metadata</span><span class="o">=</span><span class="n">mean_file</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">calrep</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.calrep_history_plot">
    <p>def <span class="ident">calrep_history_plot</span>(</p><p>calrep_model, history_frame, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a calrep_model and a history frame calrep_history_plot plots the file against any other in history
frame  (pandas.DataFrame) with dates</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.calrep_history_plot', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.calrep_history_plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calrep_history_plot</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">,</span><span class="n">history_frame</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a calrep_model and a history frame calrep_history_plot plots the file against any other in history</span>
<span class="sd">    frame  (pandas.DataFrame) with dates&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
              <span class="s2">&quot;directory&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;_Device_Measurement&quot;</span><span class="p">,</span>
              <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
              <span class="s2">&quot;file_name&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;min_num&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
              <span class="s2">&quot;max_num&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;error_style&quot;</span><span class="p">:</span><span class="s2">&quot;area&quot;</span><span class="p">}</span>
    <span class="n">history_plot_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">history_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">history_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="c1"># The way we plot depends on the models</span>
    <span class="n">model</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="c1"># The new method relies on metadata and not the class</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;DataTable&quot;</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1-port&#39;</span><span class="p">]:</span>
                <span class="n">model</span><span class="o">=</span><span class="s2">&quot;OnePort&quot;</span>
            <span class="k">elif</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2-port&#39;</span><span class="p">]:</span>
                <span class="n">model</span><span class="o">=</span><span class="s2">&quot;TwoPort&quot;</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Dry Cal|Thermistor|power&#39;</span><span class="p">,</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]):</span>
                <span class="n">model</span><span class="o">=</span><span class="s2">&quot;Power&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>


    <span class="n">device_history</span><span class="o">=</span><span class="n">history_frame</span><span class="p">[</span><span class="n">history_frame</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]]</span>
    <span class="n">unique_analysis_dates</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Analysis_Date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} are {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;unique_analysis_dates&quot;</span><span class="p">,</span><span class="n">unique_analysis_dates</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Power&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span><span class="o">=</span><span class="mi">2</span>
        <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;Efficiency&#39;</span><span class="p">,</span><span class="s1">&#39;Calibration_Factor&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">POWER_3TERM_COLUMN_NAMES</span><span class="p">:</span>
            <span class="n">error_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uMgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uEe&#39;</span><span class="p">,</span><span class="s1">&#39;uCe&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">POWER_4TERM_COLUMN_NAMES</span><span class="p">:</span>
            <span class="n">error_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uMgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uEg&#39;</span><span class="p">,</span><span class="s1">&#39;uCg&#39;</span><span class="p">]</span>
        <span class="n">table</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">joined_table</span>

    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;OnePort&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
        <span class="n">error_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uMgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS11&#39;</span><span class="p">]</span>
        <span class="n">table</span><span class="o">=</span><span class="n">calrep_model</span>

    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;TwoPort&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span><span class="o">=</span><span class="mi">3</span>
        <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="n">error_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uMgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS11&#39;</span><span class="p">,</span><span class="s1">&#39;uMgS21&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS21&#39;</span><span class="p">,</span><span class="s1">&#39;uMgS22&#39;</span><span class="p">,</span><span class="s1">&#39;uAgS22&#39;</span><span class="p">]</span>
        <span class="n">table</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">joined_table</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>

        <span class="c1">#ax.xaxis.set_visible(False)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|${\Gamma} $|&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="c1"># initial plot of</span>
        <span class="n">x</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
        <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
        <span class="n">error</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">error_names</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;error_style&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">date_index</span><span class="p">,</span><span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_analysis_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]]):</span>
                <span class="n">number_lines</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_analysis_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]])</span>
                <span class="n">date_device_history</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Analysis_Date&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">date</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">date_device_history</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">x_date</span><span class="o">=</span><span class="n">date_device_history</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span>
                    <span class="n">y_date</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">date_device_history</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="n">error_date</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">date_device_history</span><span class="p">[</span><span class="n">error_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;date_device_history&quot;,date_device_history))</span>
                    <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;y_date&quot;,y_date))</span>
                    <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;date&quot;,date))</span>
                    <span class="n">date_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">date_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">number_lines</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">date_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">number_lines</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x_date</span><span class="p">,</span><span class="n">y_date</span><span class="p">,</span>
                         <span class="n">yerr</span><span class="o">=</span><span class="n">error_date</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">date_color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;area&#39;</span><span class="p">,</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;error_style&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="n">error</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">error</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">25</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">date_index</span><span class="p">,</span><span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_analysis_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]]):</span>
                <span class="n">number_lines</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_analysis_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]]))</span>
                <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;number_lines&quot;,number_lines))</span>
                <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;index&quot;,index))</span>
                <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;date_index&quot;,date_index))</span>
                <span class="n">date_color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">date_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">number_lines</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">date_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">number_lines</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;date_color&quot;,date_color))</span>

                <span class="n">date_device_history</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Analysis_Date&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">date</span><span class="p">]</span>
                <span class="n">x_date</span><span class="o">=</span><span class="n">date_device_history</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span>
                <span class="n">y_date</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">date_device_history</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">error_date</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">date_device_history</span><span class="p">[</span><span class="n">error_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>


                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_date</span><span class="p">,</span><span class="n">y_date</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">date_color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
        <span class="c1">#ax.sharex(diff_axes[index])</span>
        <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;8&#39;</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">general_descriptor</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">directory</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span><span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1">#print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span><span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.cascade">
    <p>def <span class="ident">cascade</span>(</p><p>s1, s2)</p>
    </div>
    

    
  
    <div class="desc"><p>Cascade returns the cascaded sparameters of s1 and s2. s1 and s2 should be in complex list form
[[f,S11,S12,S21,S22]...] and the returned sparameters will be in the same format. Assumes that s1,s2 have the
same frequencies. If 1-S2_22*S1_11 is zero we add a small non zero real part or loss.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.cascade', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.cascade" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">cascade</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Cascade returns the cascaded sparameters of s1 and s2. s1 and s2 should be in complex list form</span>
<span class="sd">    [[f,S11,S12,S21,S22]...] and the returned sparameters will be in the same format. Assumes that s1,s2 have the</span>
<span class="sd">    same frequencies. If 1-S2_22*S1_11 is zero we add a small non zero real part or loss.&quot;&quot;&quot;</span>
    <span class="n">out_sparameters</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s1</span><span class="p">):</span>
        <span class="p">[</span><span class="n">f1</span><span class="p">,</span><span class="n">S1_11</span><span class="p">,</span><span class="n">S1_12</span><span class="p">,</span><span class="n">S1_21</span><span class="p">,</span><span class="n">S1_22</span><span class="p">]</span><span class="o">=</span><span class="n">row</span>
        <span class="p">[</span><span class="n">f2</span><span class="p">,</span><span class="n">S2_11</span><span class="p">,</span><span class="n">S2_12</span><span class="p">,</span><span class="n">S2_21</span><span class="p">,</span><span class="n">S2_22</span><span class="p">]</span><span class="o">=</span><span class="n">s2</span><span class="p">[</span><span class="n">row_index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">f1</span><span class="o">!=</span><span class="n">f2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Frequencies do not match! F lists must be the same&quot;</span><span class="p">)</span>
        <span class="n">denominator</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">S1_22</span><span class="o">*</span><span class="n">S2_11</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">denominator</span> <span class="o">==</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">denominator</span><span class="o">=</span><span class="nb">complex</span><span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">S11</span><span class="o">=</span><span class="n">S1_11</span><span class="o">+</span><span class="n">S2_11</span><span class="o">*</span><span class="p">(</span><span class="n">S1_12</span><span class="o">*</span><span class="n">S1_21</span><span class="p">)</span><span class="o">/</span><span class="n">denominator</span>
        <span class="n">S12</span><span class="o">=</span><span class="n">S1_12</span><span class="o">*</span><span class="n">S2_12</span><span class="o">/</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span>
        <span class="n">S21</span><span class="o">=</span><span class="n">S1_21</span><span class="o">*</span><span class="n">S2_21</span><span class="o">/</span><span class="n">denominator</span>
        <span class="n">S22</span><span class="o">=</span><span class="n">S2_22</span><span class="o">+</span><span class="n">S1_22</span><span class="o">*</span><span class="p">(</span><span class="n">S2_12</span><span class="o">*</span><span class="n">S2_21</span><span class="p">)</span><span class="o">/</span><span class="n">denominator</span>
        <span class="n">new_row</span><span class="o">=</span><span class="p">[</span><span class="n">f1</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">]</span>
        <span class="n">out_sparameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_sparameters</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.compare_s2p_plots">
    <p>def <span class="ident">compare_s2p_plots</span>(</p><p>list_S2PV1, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>compare_s2p_plot compares a list of s2p files plotting each on the same axis for all
8 possible components. The format of plots can be changed by passing options as key words in a
key word dictionary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.compare_s2p_plots', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.compare_s2p_plots" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">compare_s2p_plots</span><span class="p">(</span><span class="n">list_S2PV1</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;compare_s2p_plot compares a list of s2p files plotting each on the same axis for all</span>
<span class="sd">    8 possible components. The format of plots can be changed by passing options as key words in a</span>
<span class="sd">    key word dictionary. &quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span><span class="s2">&quot;MA&quot;</span><span class="p">,</span>
              <span class="s2">&quot;display_legend&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
              <span class="s2">&quot;directory&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span><span class="s2">&quot;comparison_Plot&quot;</span><span class="p">,</span>
              <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
              <span class="s2">&quot;file_name&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;labels&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;grid&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
    <span class="n">comparison_plot_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>

    <span class="c1"># create a set of 8 subplots</span>
    <span class="c1">#plt.hold(True)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">s2p</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">s2p</span> <span class="ow">in</span> <span class="n">list_S2PV1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">s2p_index</span><span class="p">,</span><span class="n">s2p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_S2PV1</span><span class="p">):</span>
        <span class="c1"># start by changing the format of all the s2p</span>
        <span class="n">s2p</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
        <span class="n">column_names</span><span class="o">=</span><span class="n">s2p</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
            <span class="c1">#ax.xaxis.set_visible(False)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|{0}|&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;grid&quot;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="c1"># initial plot of</span>
            <span class="n">x</span><span class="o">=</span><span class="n">s2p</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s2p</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">s2p_index</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">),</span>
                              <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                              <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">general_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">directory</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span>
                            <span class="p">,</span><span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1">#print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span><span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.correct_sparameters">
    <p>def <span class="ident">correct_sparameters</span>(</p><p>sparameters, correction, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Correction sparamters trys to return a corrected set of sparameters given uncorrected sparameters
and a correction. Correct sparameters will accept file_name's, pyMez classes,
complex lists or a mixture, returns value in the form it was entered. Correction is assumed reciprocal
unless reciprocal=False</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.correct_sparameters', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.correct_sparameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">correct_sparameters</span><span class="p">(</span><span class="n">sparameters</span><span class="p">,</span><span class="n">correction</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Correction sparamters trys to return a corrected set of sparameters given uncorrected sparameters</span>
<span class="sd">    and a correction. Correct sparameters will accept file_name&#39;s, pyMez classes,</span>
<span class="sd">    complex lists or a mixture, returns value in the form it was entered. Correction is assumed reciprocal</span>
<span class="sd">    unless reciprocal=False&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;reciprocal&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;output_type&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;file_path&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
    <span class="n">correction_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">correction_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">correction_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># import and condition sparameters and correction</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span> <span class="ow">is</span> <span class="n">StringType</span><span class="p">:</span>
            <span class="c1"># Assume sparameters is given by file name</span>
            <span class="n">sparameters_table</span><span class="o">=</span><span class="n">S2PV1</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span>
            <span class="n">sparameters</span><span class="o">=</span><span class="n">sparameters_table</span><span class="o">.</span><span class="n">sparameter_complex</span>
            <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;file&#39;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;S2PV1&#39;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)):</span>
            <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;S2PV1&#39;</span>
            <span class="n">sparameters</span><span class="o">=</span><span class="n">sparameters</span><span class="o">.</span><span class="n">sparameter_complex</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span> <span class="ow">is</span> <span class="n">ListType</span><span class="p">:</span>
            <span class="c1"># check to see if it is a list of complex variables or matrix</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="n">ComplexType</span><span class="p">:</span>
                <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;complex_list&#39;</span>
            <span class="c1"># Handle frequency, matrix lists</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;np.array&#39;</span><span class="p">,</span><span class="s1">&#39;np.matrix&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span> <span class="ow">is</span> <span class="n">FloatType</span> <span class="p">:</span>
                <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;matrix_list&#39;</span>
                <span class="n">sparameters</span><span class="o">=</span><span class="n">two_port_matrix_to_complex_form</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span>
            <span class="c1"># handle matrix</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sparameters</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;np.array&#39;</span><span class="p">,</span><span class="s1">&#39;np.matrix&#39;</span><span class="p">]:</span>
            <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;matrix&#39;</span>
            <span class="k">raise</span>
        <span class="c1"># Handle the correction types</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">correction</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">13</span><span class="p">:</span>
            <span class="n">corrected_sparameters</span><span class="o">=</span><span class="n">correct_sparameters_twelve_term</span><span class="p">(</span><span class="n">sparameters</span><span class="p">,</span><span class="n">correction</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">correction</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">17</span><span class="p">:</span>
            <span class="n">corrected_sparameters</span><span class="o">=</span><span class="n">correct_sparameters_sixteen_term</span><span class="p">(</span><span class="n">sparameters</span><span class="p">,</span><span class="n">correction</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">correction</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">corrected_sparameters</span><span class="o">=</span><span class="n">correct_sparameters_eight_term</span><span class="p">(</span><span class="n">sparameters</span><span class="p">,</span><span class="n">correction</span><span class="p">)</span>
        <span class="c1"># Handle the output type using the derived one or the one entered as an option</span>
        <span class="k">if</span> <span class="n">correction_options</span><span class="p">[</span><span class="s2">&quot;output_type&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_type</span><span class="o">=</span><span class="n">correction_options</span><span class="p">[</span><span class="s2">&quot;output_type&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="n">output_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">output_table</span><span class="o">=</span><span class="n">S2PV1</span><span class="p">(</span><span class="n">correction_options</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">],</span><span class="n">sparameter_complex</span><span class="o">=</span><span class="n">corrected_sparameters</span><span class="p">)</span>
            <span class="n">output_table</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Output was saved as {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_table</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;complex&quot;</span><span class="p">,</span><span class="n">output_type</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">corrected_sparameters</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;matrix_list&quot;</span><span class="p">,</span><span class="n">output_type</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">corrected_sparameters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;matrix&quot;</span><span class="p">,</span><span class="n">output_type</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="k">raise</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Could not correct sparameters&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.correct_sparameters_eight_term">
    <p>def <span class="ident">correct_sparameters_eight_term</span>(</p><p>sparameters_complex, eight_term_correction, reciprocal=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Applies the eight term correction to sparameters_complex and returns
a correct complex list in the form of [[frequency,S11,S21,S12,S22],..]. The eight term
correction should be in the form [[frequency,S1_11,S1_21,S1_12,S1_22,S2_11,S2_21,S2_12,S2_22]..]
Use s2p.sparameter_complex as input.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.correct_sparameters_eight_term', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.correct_sparameters_eight_term" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">correct_sparameters_eight_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">eight_term_correction</span><span class="p">,</span><span class="n">reciprocal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies the eight term correction to sparameters_complex and returns</span>
<span class="sd">    a correct complex list in the form of [[frequency,S11,S21,S12,S22],..]. The eight term</span>
<span class="sd">    correction should be in the form [[frequency,S1_11,S1_21,S1_12,S1_22,S2_11,S2_21,S2_12,S2_22]..]</span>
<span class="sd">    Use s2p.sparameter_complex as input.&quot;&quot;&quot;</span>
    <span class="c1"># first transform both lists to matrices</span>
    <span class="n">s2p_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span>
    <span class="n">s1_list</span><span class="o">=</span><span class="p">[[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">eight_term_correction</span><span class="p">]</span>
    <span class="n">s2_list</span><span class="o">=</span><span class="p">[[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">8</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">eight_term_correction</span><span class="p">]</span>
    <span class="n">s1_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">s1_list</span><span class="p">)</span>
    <span class="n">s2_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">s2_list</span><span class="p">)</span>
    <span class="c1"># now transform to T matrices</span>
    <span class="n">t_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s2p_matrix_list</span><span class="p">)</span>
    <span class="n">x_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s1_matrix_list</span><span class="p">)</span>
    <span class="n">y_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s2_matrix_list</span><span class="p">)</span>
    <span class="c1"># now invert x</span>
    <span class="n">x_inverse_matrix_list</span><span class="o">=</span><span class="n">invert_two_port_matrix_list</span><span class="p">(</span><span class="n">x_matrix_list</span><span class="p">)</span>
    <span class="n">y_inverse_matrix_list</span><span class="o">=</span><span class="n">invert_two_port_matrix_list</span><span class="p">(</span><span class="n">y_matrix_list</span><span class="p">)</span>
    <span class="c1"># now apply the correction</span>
    <span class="n">t_corrected_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t_matrix_list</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t_corrected</span><span class="o">=</span><span class="n">x_inverse_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">y_inverse_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">t_corrected_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">t_corrected</span><span class="p">])</span>
    <span class="c1"># now transform back to S</span>
    <span class="n">s_corrected_matrix_list</span> <span class="o">=</span><span class="n">T_to_S</span><span class="p">(</span><span class="n">t_corrected_list</span><span class="p">)</span>
    <span class="c1"># now put back into single row form</span>
    <span class="n">s_corrected_list</span><span class="o">=</span><span class="n">two_port_matrix_to_complex_form</span><span class="p">(</span><span class="n">s_corrected_matrix_list</span><span class="p">)</span>
    <span class="c1"># now we take the geometric average and replace S12 and S21 with it</span>
    <span class="k">if</span> <span class="n">reciprocal</span><span class="p">:</span>
        <span class="n">s_averaged_corrected</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">phase_last</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s_corrected_list</span><span class="p">:</span>
            <span class="p">[</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">]</span><span class="o">=</span><span class="n">row</span>
            <span class="c1"># S12 and S21 are averaged together in a weird way that makes phase continuous</span>
            <span class="n">geometric_mean</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
            <span class="n">root_select</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">phase_new</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">geometric_mean</span><span class="p">)</span>
            <span class="c1"># if the phase jumps by &gt;180 but less than 270, then pick the other root</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&gt;</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">root_select</span><span class="o">=-</span><span class="mi">1</span>
            <span class="n">mean_S12_S21</span><span class="o">=</span><span class="n">root_select</span><span class="o">*</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
            <span class="n">s_averaged_corrected</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
            <span class="n">phase_last</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">mean_S12_S21</span><span class="p">)</span>
        <span class="n">s_corrected_list</span><span class="o">=</span><span class="n">s_averaged_corrected</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">s_corrected_list</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.correct_sparameters_sixteen_term">
    <p>def <span class="ident">correct_sparameters_sixteen_term</span>(</p><p>sparameters_complex, sixteen_term_correction)</p>
    </div>
    

    
  
    <div class="desc"><p>Applies the sixteen term correction to sparameters and returns a new sparameter list.
The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.
The sixteen term correction should be a list of
[frequency, S11, S12, S13,S14,S21, S22,S23,S24,S31,S32,S33,S34,S41,S42,S43,S44], etc are complex numbers
Designed to use S2P.sparameter_complex and SNP.sparameter_complex</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.correct_sparameters_sixteen_term', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.correct_sparameters_sixteen_term" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">correct_sparameters_sixteen_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">sixteen_term_correction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies the sixteen term correction to sparameters and returns a new sparameter list.</span>
<span class="sd">    The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.</span>
<span class="sd">    The sixteen term correction should be a list of</span>
<span class="sd">    [frequency, S11, S12, S13,S14,S21, S22,S23,S24,S31,S32,S33,S34,S41,S42,S43,S44], etc are complex numbers</span>
<span class="sd">    Designed to use S2P.sparameter_complex and SNP.sparameter_complex&quot;&quot;&quot;</span>

    <span class="c1"># first create 4 separate matrix lists for 16 term correction</span>
    <span class="n">s1_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s2_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s3_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s4_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1"># Then populate them with the right values</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">correction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sixteen_term_correction</span><span class="p">):</span>
        <span class="p">[</span><span class="n">frequency</span><span class="p">,</span> <span class="n">S11</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S13</span><span class="p">,</span><span class="n">S14</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span> <span class="n">S22</span><span class="p">,</span><span class="n">S23</span><span class="p">,</span><span class="n">S24</span><span class="p">,</span><span class="n">S31</span><span class="p">,</span><span class="n">S32</span><span class="p">,</span><span class="n">S33</span><span class="p">,</span><span class="n">S34</span><span class="p">,</span><span class="n">S41</span><span class="p">,</span><span class="n">S42</span><span class="p">,</span><span class="n">S43</span><span class="p">,</span><span class="n">S44</span><span class="p">]</span><span class="o">=</span><span class="n">correction</span>
        <span class="n">s1_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">],[</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">]])])</span>
        <span class="n">s2_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S13</span><span class="p">,</span><span class="n">S14</span><span class="p">],[</span><span class="n">S23</span><span class="p">,</span><span class="n">S24</span><span class="p">]])])</span>
        <span class="n">s3_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S31</span><span class="p">,</span><span class="n">S32</span><span class="p">],[</span><span class="n">S41</span><span class="p">,</span><span class="n">S42</span><span class="p">]])])</span>
        <span class="n">s4_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S33</span><span class="p">,</span><span class="n">S34</span><span class="p">],[</span><span class="n">S43</span><span class="p">,</span><span class="n">S44</span><span class="p">]])])</span>
    <span class="n">sparameter_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span>
    <span class="c1"># Apply the correction</span>
    <span class="n">sparameter_out</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">sparameter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sparameter_matrix_list</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">sparameter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s_matrix</span><span class="o">=</span><span class="n">sparameter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">[</span><span class="n">s11_matrix</span><span class="p">,</span><span class="n">s12_matrix</span><span class="p">,</span><span class="n">s21_matrix</span><span class="p">,</span><span class="n">s22_matrix</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">s1_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">s2_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">s3_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">s4_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">corrected_s_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">s21_matrix</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">s_matrix</span><span class="o">-</span><span class="n">s11_matrix</span><span class="p">)</span><span class="o">*</span><span class="n">s12_matrix</span><span class="o">+</span><span class="n">s22_matrix</span><span class="p">)</span>
        <span class="c1"># This flips S12 and S21</span>
        <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">corrected_s_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">corrected_s_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">corrected_s_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">corrected_s_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">sparameter_out</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.correct_sparameters_twelve_term">
    <p>def <span class="ident">correct_sparameters_twelve_term</span>(</p><p>sparameters_complex, twelve_term_correction, reciprocal=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Applies the twelve term correction to sparameters and returns a new sparameter list.
The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.
The twelve term correction should be a list of
[frequency,Edf,Esf,Erf,Exf,Elf,Etf,Edr,Esr,Err,Exr,Elr,Etr] where Edf, etc are complex numbers</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.correct_sparameters_twelve_term', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.correct_sparameters_twelve_term" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">correct_sparameters_twelve_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">twelve_term_correction</span><span class="p">,</span><span class="n">reciprocal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies the twelve term correction to sparameters and returns a new sparameter list.</span>
<span class="sd">    The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.</span>
<span class="sd">    The twelve term correction should be a list of</span>
<span class="sd">    [frequency,Edf,Esf,Erf,Exf,Elf,Etf,Edr,Esr,Err,Exr,Elr,Etr] where Edf, etc are complex numbers&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">twelve_term_correction</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;s parameter and twelve term correction must be the same length&quot;</span><span class="p">)</span>
    <span class="n">sparameter_out</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phase_last</span><span class="o">=</span><span class="mf">0.</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Sm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">[</span><span class="n">frequency</span><span class="p">,</span><span class="n">Edf</span><span class="p">,</span><span class="n">Esf</span><span class="p">,</span><span class="n">Erf</span><span class="p">,</span><span class="n">Exf</span><span class="p">,</span><span class="n">Elf</span><span class="p">,</span><span class="n">Etf</span><span class="p">,</span><span class="n">Edr</span><span class="p">,</span><span class="n">Esr</span><span class="p">,</span><span class="n">Err</span><span class="p">,</span><span class="n">Exr</span><span class="p">,</span><span class="n">Elr</span><span class="p">,</span><span class="n">Etr</span><span class="p">]</span><span class="o">=</span><span class="n">twelve_term_correction</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="c1">#        frequency Edf Esf Erf Exf Elf Etf Edr Esr Err Exr Elr Etr.</span>
<span class="c1">#         print [frequency,Edf,Esf,Erf,Exf,Elf,Etf,Edr,Esr,Err,Exr,Elr,Etr]</span>
<span class="c1">#         print Sm[0,0]</span>
        <span class="n">D</span> <span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Edf</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esf</span><span class="o">/</span><span class="n">Erf</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Edr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esr</span><span class="o">/</span><span class="n">Err</span><span class="p">))</span><span class="o">-</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Elf</span><span class="o">*</span><span class="n">Elr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Etf</span><span class="o">*</span><span class="n">Etr</span><span class="p">)</span>
<span class="c1">#         print D</span>
        <span class="n">S11</span> <span class="o">=</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Edf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Erf</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Edr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esr</span><span class="o">/</span><span class="n">Err</span><span class="p">))</span><span class="o">-</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Elf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Etf</span><span class="o">*</span><span class="n">Etr</span><span class="p">)</span>
        <span class="n">S21</span> <span class="o">=</span><span class="p">((</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Exr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Etf</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Edr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esr</span><span class="o">-</span><span class="n">Elf</span><span class="p">)</span><span class="o">/</span><span class="n">Err</span><span class="p">)</span>
        <span class="n">S12</span> <span class="o">=</span> <span class="p">((</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Exf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Etr</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Edf</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esf</span><span class="o">-</span><span class="n">Elr</span><span class="p">)</span><span class="o">/</span><span class="n">Erf</span><span class="p">)</span>
        <span class="n">S22</span> <span class="o">=</span> <span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Edr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Err</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Edf</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Esf</span><span class="o">/</span><span class="n">Erf</span><span class="p">))</span><span class="o">-</span><span class="p">(</span><span class="n">Sm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Elr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">Etf</span><span class="o">*</span><span class="n">Etr</span><span class="p">)</span>
        <span class="c1"># S12 and S21 are averaged together in a weird way that makes phase continuous</span>
        <span class="n">geometric_mean</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
        <span class="n">root_select</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">phase_new</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">geometric_mean</span><span class="p">)</span>
        <span class="c1"># if the phase jumps by &gt;180 but less than 270, then pick the other root</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&gt;</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">root_select</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">mean_S12_S21</span><span class="o">=</span><span class="n">root_select</span><span class="o">*</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reciprocal</span><span class="p">:</span>
            <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
        <span class="n">phase_last</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">mean_S12_S21</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sparameter_out</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.create_monte_carlo_reference_curve">
    <p>def <span class="ident">create_monte_carlo_reference_curve</span>(</p><p>monte_carlo_directory, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a standard curve from a montecarlo directory (from MUF). The standard curve
has a mean or median and a standard deviation for the uncertainty</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.create_monte_carlo_reference_curve', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.create_monte_carlo_reference_curve" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">create_monte_carlo_reference_curve</span><span class="p">(</span><span class="n">monte_carlo_directory</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a standard curve from a montecarlo directory (from MUF). The standard curve</span>
<span class="sd">    has a mean or median and a standard deviation for the uncertainty&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;RI&quot;</span><span class="p">,</span> <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="s2">&quot;s\d+p&quot;</span><span class="p">}</span>
    <span class="n">reference_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">reference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">reference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">monte_carlo_directory</span><span class="p">)</span>
    <span class="n">filtered_file_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">[:]:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">filtered_file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="n">filtered_file_names</span>
    <span class="c1"># print file_names</span>
    <span class="n">initial_file</span> <span class="o">=</span> <span class="n">SNP</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">monte_carlo_directory</span><span class="p">,</span> <span class="n">file_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">initial_file</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
    <span class="n">combined_table</span> <span class="o">=</span> <span class="n">Snp_to_AsciiDataTable</span><span class="p">(</span><span class="n">initial_file</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">snp_file</span> <span class="o">=</span> <span class="n">SNP</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">monte_carlo_directory</span><span class="p">,</span> <span class="n">file_name</span><span class="p">))</span>
        <span class="n">snp_file</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">Snp_to_AsciiDataTable</span><span class="p">(</span><span class="n">snp_file</span><span class="p">)</span>
        <span class="n">combined_table</span> <span class="o">+</span> <span class="n">table</span>
    <span class="n">mean_table</span> <span class="o">=</span> <span class="n">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">combined_table</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">])</span>
    <span class="n">standard_deviation</span> <span class="o">=</span> <span class="n">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">combined_table</span><span class="p">,</span>
                                                                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">)</span>
    <span class="n">new_column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;u&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">standard_deviation</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="n">standard_deviation</span><span class="o">.</span><span class="n">column_names</span> <span class="o">=</span> <span class="n">new_column_names</span>
    <span class="n">reference_curve</span> <span class="o">=</span> <span class="n">ascii_data_table_join</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">mean_table</span><span class="p">,</span> <span class="n">standard_deviation</span><span class="p">)</span>
    <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;value_column_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_table</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;uncertainty_column_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">reference_curve</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.create_sensitivity_reference_curve">
    <p>def <span class="ident">create_sensitivity_reference_curve</span>(</p><p>sensitivity_directory, nominal_file_path=&#39;../DUT_0.s2p&#39;, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a standard curve from a sensitivity_directory usually called Covariance(from MUF). The standard curve
has a mean or median and a RMS variance from the nominal value for the uncertainty</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.create_sensitivity_reference_curve', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.create_sensitivity_reference_curve" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">create_sensitivity_reference_curve</span><span class="p">(</span><span class="n">sensitivity_directory</span><span class="p">,</span><span class="n">nominal_file_path</span><span class="o">=</span><span class="s2">&quot;../DUT_0.s2p&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a standard curve from a sensitivity_directory usually called Covariance(from MUF). The standard curve</span>
<span class="sd">    has a mean or median and a RMS variance from the nominal value for the uncertainty&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;RI&quot;</span><span class="p">,</span> <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="s2">&quot;s\d+p&quot;</span><span class="p">}</span>
    <span class="n">reference_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">reference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">reference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sensitivity_directory</span><span class="p">)</span>
    <span class="n">filtered_file_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">[:]:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">filtered_file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="n">filtered_file_names</span>
    <span class="c1"># print file_names</span>
    <span class="n">nominal_file</span><span class="o">=</span><span class="n">SNP</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sensitivity_directory</span><span class="p">,</span> <span class="n">nominal_file_path</span><span class="p">))</span>
    <span class="n">nominal_file</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
    <span class="n">initial_file</span> <span class="o">=</span> <span class="n">SNP</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sensitivity_directory</span><span class="p">,</span> <span class="n">file_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">initial_file</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
    <span class="n">initial_difference</span><span class="o">=</span><span class="n">frequency_model_difference</span><span class="p">(</span><span class="n">nominal_file</span><span class="p">,</span><span class="n">initial_file</span><span class="p">)</span>
    <span class="c1">#print initial_difference.column_names</span>
    <span class="n">combined_table</span> <span class="o">=</span> <span class="n">initial_difference</span>
    <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">snp_file</span> <span class="o">=</span> <span class="n">SNP</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sensitivity_directory</span><span class="p">,</span> <span class="n">file_name</span><span class="p">))</span>
        <span class="n">snp_file</span><span class="o">.</span><span class="n">change_data_format</span><span class="p">(</span><span class="n">reference_options</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">])</span>
        <span class="n">difference</span><span class="o">=</span><span class="n">frequency_model_difference</span><span class="p">(</span><span class="n">nominal_file</span><span class="p">,</span><span class="n">snp_file</span><span class="p">)</span>
        <span class="c1">#print difference.column_names</span>
<span class="c1">#         table = Snp_to_AsciiDataTable(difference)</span>
        <span class="n">combined_table</span> <span class="o">+</span> <span class="n">difference</span>
    <span class="c1">#print combined_table.options[&quot;column_types&quot;]</span>
    <span class="n">variance</span> <span class="o">=</span> <span class="n">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">combined_table</span><span class="p">,</span>
                                                                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;rss&#39;</span><span class="p">)</span>
    <span class="n">new_column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;u&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">variance</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="n">mean_table</span><span class="o">=</span><span class="n">Snp_to_AsciiDataTable</span><span class="p">(</span><span class="n">nominal_file</span><span class="p">)</span>
    <span class="n">variance</span><span class="o">.</span><span class="n">column_names</span> <span class="o">=</span> <span class="n">new_column_names</span>
    <span class="n">reference_curve</span> <span class="o">=</span> <span class="n">ascii_data_table_join</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">mean_table</span><span class="p">,</span> <span class="n">variance</span><span class="p">)</span>
    <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;value_column_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_table</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;uncertainty_column_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">reference_curve</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.frequency_model_collapse_multiple_measurements">
    <p>def <span class="ident">frequency_model_collapse_multiple_measurements</span>(</p><p>model, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a model with a single set of frequencies. Default is to average values together
but geometric mean, std, variance, rss, mad and median are options.
Geometric means of odd number of negative values fails</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.frequency_model_collapse_multiple_measurements', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.frequency_model_collapse_multiple_measurements" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">frequency_model_collapse_multiple_measurements</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a model with a single set of frequencies. Default is to average values together</span>
<span class="sd">    but geometric mean, std, variance, rss, mad and median are options.</span>
<span class="sd">    Geometric means of odd number of negative values fails&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">model_1</span> <span class="o">=</span> <span class="n">DataFrame_to_AsciiDataTable</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">}</span>
    <span class="c1"># load other options from model</span>
    <span class="k">for</span> <span class="n">option</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;begin_line|end_line&#39;</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
            <span class="n">defaults</span><span class="p">[</span><span class="n">option</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">element</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">defaults</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">element</span><span class="p">][:]</span>
    <span class="c1"># We need to preserve the frequency column some how</span>
    <span class="n">collapse_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">collapse_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">collapse_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">unique_frequency_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])))</span>
    <span class="n">frequency_selector</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">column_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">out_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_frequency_list</span><span class="p">):</span>
        <span class="n">data_row</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">frequency_selector</span><span class="p">]</span> <span class="o">==</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[:])</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mean|av&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;geometric&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">gmean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;st&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;rms&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;rss&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mad&#39;</span><span class="p">,</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">mad</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">new_row</span><span class="p">[</span><span class="n">frequency_selector</span><span class="p">]</span><span class="o">=</span><span class="n">frequency</span>
        <span class="n">out_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>

    <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_data</span>

    <span class="k">if</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">]:</span>
        <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> \
                                                  <span class="n">collapse_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">]</span>
    <span class="n">resulting_model</span> <span class="o">=</span> <span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">collapse_options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resulting_model</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.frequency_model_difference">
    <p>def <span class="ident">frequency_model_difference</span>(</p><p>model_1, model_2, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Takes the difference of two models that both have frequency and a similar set of columns. Returns an object that is
a list of [[frequency,column_1,..column_n],...] where columns are the same in the models. If  a particular subset of
columns is desired use columns=["Frequency","magS11] models can be any subclass of AsciiDataTable, SNP, or
pandas.DataFrame, if a column is a non-numeric type it drops it. The frequency list should be unique
(no multiple frequencies) for at least one model</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.frequency_model_difference', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.frequency_model_difference" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">frequency_model_difference</span><span class="p">(</span><span class="n">model_1</span><span class="p">,</span> <span class="n">model_2</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes the difference of two models that both have frequency and a similar set of columns. Returns an object that is</span>
<span class="sd">    a list of [[frequency,column_1,..column_n],...] where columns are the same in the models. If  a particular subset of</span>
<span class="sd">    columns is desired use columns=[&quot;Frequency&quot;,&quot;magS11] models can be any subclass of AsciiDataTable, SNP, or</span>
<span class="sd">    pandas.DataFrame, if a column is a non-numeric type it drops it. The frequency list should be unique</span>
<span class="sd">    (no multiple frequencies) for at least one model&quot;&quot;&quot;</span>
    <span class="c1"># Set up defaults and pass options</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
    <span class="n">difference_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">difference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">difference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># first check type, if it is a panadas data frame a little conversion is needed, else is for all other models</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_1</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">model_1</span> <span class="o">=</span> <span class="n">DataFrame_to_AsciiDataTable</span><span class="p">(</span><span class="n">model_1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_2</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">model_2</span> <span class="o">=</span> <span class="n">DataFrame_to_AsciiDataTable</span><span class="p">(</span><span class="n">model_2</span><span class="p">)</span>
    <span class="c1"># now start with a set of frequencies (unique values from both)</span>
    <span class="n">frequency_set_1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">model_1</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])</span>
    <span class="n">frequency_set_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">model_2</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])</span>
    <span class="n">model_2_frequency_selector</span> <span class="o">=</span> <span class="n">model_2</span><span class="o">.</span><span class="n">column_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="n">column_names_set_1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">column_names</span><span class="p">)</span>
    <span class="n">column_names_set_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">model_2</span><span class="o">.</span><span class="n">column_names</span><span class="p">)</span>

    <span class="c1"># All points must be in the intersection to be used</span>
    <span class="n">frequency_intersection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">frequency_set_1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">frequency_set_2</span><span class="p">))</span>
    <span class="n">column_names_intersection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">column_names_set_1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">column_names_set_2</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">frequency_intersection</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The models do not have any frequency points in common&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">new_column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">column_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">column_index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">column_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names_intersection</span> <span class="ow">and</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]:</span>
            <span class="n">new_column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
            <span class="n">column_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">][</span><span class="n">column_index</span><span class="p">])</span>

    <span class="n">difference_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_1</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]):</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">frequency</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="n">frequency_intersection</span><span class="p">:</span>
            <span class="n">model_2_frequency_row</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">model_2_frequency_selector</span><span class="p">]</span> <span class="o">==</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">model_2</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># print(&quot;{0} is {1}&quot;.format(&quot;model_2_frequency_row&quot;,model_2_frequency_row))</span>
            <span class="k">for</span> <span class="n">column_index</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">column_names</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names_intersection</span> <span class="ow">and</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]:</span>
                    <span class="n">model_2_column_selector</span> <span class="o">=</span> <span class="n">model_2</span><span class="o">.</span><span class="n">column_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;int|float&#39;</span><span class="p">,</span>
                                 <span class="n">model_1</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">][</span><span class="n">column_index</span><span class="p">],</span>
                                 <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;int|float&#39;</span><span class="p">,</span>
                                                              <span class="n">model_2</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">][</span><span class="n">model_2_column_selector</span><span class="p">],</span>
                                                              <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>

                        <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">model_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">column_index</span><span class="p">]</span> <span class="o">-</span> <span class="n">model_2_frequency_row</span><span class="p">[</span><span class="n">model_2_column_selector</span><span class="p">])</span>

                        <span class="c1"># Print(&quot;New Column Names are {0}&quot;.format(new_column_names))</span>
                    <span class="k">elif</span> <span class="n">difference_options</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">]:</span>
                        <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">column_index</span><span class="p">])</span>
            <span class="n">difference_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="n">difference_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_column_names</span>
    <span class="c1"># print(&quot;New Column Names are {0}&quot;.format(new_column_names))</span>
    <span class="n">difference_options</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">difference_data</span>
    <span class="n">difference_options</span><span class="p">[</span><span class="s2">&quot;column_types&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">column_types</span>
    <span class="c1">#print column_types</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">difference_options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.invert_two_port_matrix_list">
    <p>def <span class="ident">invert_two_port_matrix_list</span>(</p><p>two_port_matrix_form)</p>
    </div>
    

    
  
    <div class="desc"><p>invert_two_port_matrix_list inverts all elements in the list two_port_matrix_form,
which is in the format [[frequency,np.matrix([[S11,S12],[S21,S22]])]..] and returns a list
in [[frequency,inv(np.matrix([[S11,S12],[S21,S22]]))]..] format works on any list in the form [value, matrix]</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.invert_two_port_matrix_list', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.invert_two_port_matrix_list" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">invert_two_port_matrix_list</span><span class="p">(</span><span class="n">two_port_matrix_form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;invert_two_port_matrix_list inverts all elements in the list two_port_matrix_form,</span>
<span class="sd">    which is in the format [[frequency,np.matrix([[S11,S12],[S21,S22]])]..] and returns a list</span>
<span class="sd">    in [[frequency,inv(np.matrix([[S11,S12],[S21,S22]]))]..] format works on any list in the form [value, matrix]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">two_port_matrix_form</span><span class="p">:</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">m_inv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">m_inv</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out_list</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.mean_from_history">
    <p>def <span class="ident">mean_from_history</span>(</p><p>history_frame, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>mean_from_history creates a mean_frame given a full history frame (pandas.DataFrame object),
by setting options it selects column names
to output and input values to filter on. Returns a pandas.DataFrame object with column names = column_names,
and filtered by any of the following: "Device_Id","System_Id","Measurement_Timestamp",
"Connector_Type_Measurement", "Measurement_Date" or "Measurement_Time"</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.mean_from_history', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.mean_from_history" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">mean_from_history</span><span class="p">(</span><span class="n">history_frame</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;mean_from_history creates a mean_frame given a full history frame (pandas.DataFrame object),</span>
<span class="sd">    by setting options it selects column names</span>
<span class="sd">    to output and input values to filter on. Returns a pandas.DataFrame object with column names = column_names,</span>
<span class="sd">    and filtered by any of the following: &quot;Device_Id&quot;,&quot;System_Id&quot;,&quot;Measurement_Timestamp&quot;,</span>
<span class="sd">    &quot;Connector_Type_Measurement&quot;, &quot;Measurement_Date&quot; or &quot;Measurement_Time&quot; &quot;&quot;&quot;</span>

    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;System_Id&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             <span class="s2">&quot;Measurement_Date&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Measurement_Time&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Direction&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;column_names&quot;</span><span class="p">:[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">],</span><span class="s2">&quot;outlier_removal&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
    <span class="n">mean_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">mean_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">mean_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>

    <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">,</span><span class="s2">&quot;System_Id&quot;</span><span class="p">,</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">,</span><span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">,</span>
             <span class="s2">&quot;Measurement_Date&quot;</span><span class="p">,</span><span class="s2">&quot;Measurement_Time&quot;</span><span class="p">,</span><span class="s2">&quot;Direction&quot;</span><span class="p">]</span>
    <span class="n">temp_frame</span><span class="o">=</span><span class="n">history_frame</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">filter_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mean_options</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">temp_frame</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]</span><span class="o">==</span><span class="n">mean_options</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]]</span>
<span class="c1">#     temp_frame=temp_frame[temp_frame[&quot;Device_Id&quot;]==mean_options[&quot;Device_Id&quot;]]</span>
<span class="c1">#     temp_frame=temp_frame[temp_frame[&quot;System_Id&quot;]==mean_options[&quot;System_Id&quot;]]</span>
    <span class="k">if</span> <span class="n">mean_options</span><span class="p">[</span><span class="s2">&quot;outlier_removal&quot;</span><span class="p">]:</span>
        <span class="n">mean_s11</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">std_s11</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">temp_frame</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="n">mean_s11</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">std_s11</span><span class="p">)]</span>
        <span class="n">temp_frame</span> <span class="o">=</span> <span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">mean_s11</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">std_s11</span><span class="p">)]</span>
    <span class="n">unique_frequency_list</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">mean_array</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_frequency_list</span><span class="p">):</span>
        <span class="n">row</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">mean_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]:</span>
            <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">unique_frequency_list</span><span class="p">[</span><span class="n">index</span><span class="p">]][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">())</span>
            <span class="n">mean_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_value</span><span class="p">)</span>
        <span class="n">mean_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">mean_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mean_array</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">mean_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">mean_frame</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.median_from_history">
    <p>def <span class="ident">median_from_history</span>(</p><p>history_frame, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>median_from_history creates a median_frame given a full history frame (pandas.DataFrame object),
by setting options it selects column names
to output and input values to filter on. Returns a pandas.DataFrame object with column names = column_names,
and filtered by any of the following: "Device_Id","System_Id","Measurement_Timestamp",
"Connector_Type_Measurement", "Measurement_Date" or "Measurement_Time"</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.median_from_history', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.median_from_history" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">median_from_history</span><span class="p">(</span><span class="n">history_frame</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;median_from_history creates a median_frame given a full history frame (pandas.DataFrame object),</span>
<span class="sd">    by setting options it selects column names</span>
<span class="sd">    to output and input values to filter on. Returns a pandas.DataFrame object with column names = column_names,</span>
<span class="sd">    and filtered by any of the following: &quot;Device_Id&quot;,&quot;System_Id&quot;,&quot;Measurement_Timestamp&quot;,</span>
<span class="sd">    &quot;Connector_Type_Measurement&quot;, &quot;Measurement_Date&quot; or &quot;Measurement_Time&quot; &quot;&quot;&quot;</span>

    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;System_Id&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             <span class="s2">&quot;Measurement_Date&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Measurement_Time&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Direction&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;column_names&quot;</span><span class="p">:[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">],</span><span class="s2">&quot;outlier_removal&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
    <span class="n">median_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">median_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">median_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>

    <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">,</span><span class="s2">&quot;System_Id&quot;</span><span class="p">,</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">,</span><span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">,</span>
             <span class="s2">&quot;Measurement_Date&quot;</span><span class="p">,</span><span class="s2">&quot;Measurement_Time&quot;</span><span class="p">,</span><span class="s2">&quot;Direction&quot;</span><span class="p">]</span>
    <span class="n">temp_frame</span><span class="o">=</span><span class="n">history_frame</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">filter_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">median_options</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">temp_frame</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]</span><span class="o">==</span><span class="n">median_options</span><span class="p">[</span><span class="n">filter_type</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">median_options</span><span class="p">[</span><span class="s2">&quot;outlier_removal&quot;</span><span class="p">]:</span>
        <span class="n">mean_s11</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">std_s11</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">temp_frame</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="n">mean_s11</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">std_s11</span><span class="p">)]</span>
        <span class="n">temp_frame</span> <span class="o">=</span> <span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">mean_s11</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">std_s11</span><span class="p">)]</span>
<span class="c1">#     temp_frame=temp_frame[temp_frame[&quot;Device_Id&quot;]==median_options[&quot;Device_Id&quot;]]</span>
<span class="c1">#     temp_frame=temp_frame[temp_frame[&quot;System_Id&quot;]==median_options[&quot;System_Id&quot;]]</span>
    <span class="n">unique_frequency_list</span><span class="o">=</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">median_array</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_frequency_list</span><span class="p">):</span>
        <span class="n">row</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">median_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]:</span>
            <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">temp_frame</span><span class="p">[</span><span class="n">temp_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">unique_frequency_list</span><span class="p">[</span><span class="n">index</span><span class="p">]][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">())</span>
            <span class="n">median_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">median_value</span><span class="p">)</span>
        <span class="n">median_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">median_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">median_array</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">median_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">median_frame</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.one_port_robin_comparison_plot">
    <p>def <span class="ident">one_port_robin_comparison_plot</span>(</p><p>input_asc_file, input_res_file, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>one_port_robin_comparison_plot plots a one port.asc file against a given .res file,
use device_history=True in options to show device history</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.one_port_robin_comparison_plot', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.one_port_robin_comparison_plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">one_port_robin_comparison_plot</span><span class="p">(</span><span class="n">input_asc_file</span><span class="p">,</span><span class="n">input_res_file</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;one_port_robin_comparison_plot plots a one port.asc file against a given .res file,</span>
<span class="sd">    use device_history=True in options to show device history&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;device_history&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s2">&quot;mag_res&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>
    <span class="n">plot_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="n">history</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">input_res_file</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS11N&#39;</span><span class="p">,</span><span class="s1">&#39;argS11N&#39;</span><span class="p">,</span><span class="s1">&#39;UmagS11N&#39;</span><span class="p">,</span><span class="s1">&#39;UargS11N&#39;</span><span class="p">]</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="n">history</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="s2">&quot;column_names&quot;</span><span class="p">:</span><span class="n">column_names</span><span class="p">,</span><span class="s2">&quot;column_types&quot;</span><span class="p">:[</span><span class="s1">&#39;float&#39;</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]}</span>
    <span class="n">history_table</span><span class="o">=</span><span class="n">AsciiDataTable</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="n">table</span><span class="o">=</span><span class="n">OnePortCalrepModel</span><span class="p">(</span><span class="n">input_asc_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;device_history&quot;</span><span class="p">]:</span>
        <span class="n">history_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ONE_PORT_DUT</span><span class="p">)</span>
        <span class="n">device_history</span><span class="o">=</span><span class="n">history_frame</span><span class="p">[</span><span class="n">history_frame</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">table</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()]</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;magS11N&#39;</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span>
                <span class="n">yerr</span><span class="o">=</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;UmagS11N&#39;</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;History&quot;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;magS11&#39;</span><span class="p">),</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;uMg&#39;</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current Measurement&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;device_history&quot;</span><span class="p">]:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;bs&#39;</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;uMg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;From .asc&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;mag_res&quot;</span><span class="p">]:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;gx&#39;</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;UmagS11N&#39;</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;From mag in res&quot;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnitude S11&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span>
                <span class="n">yerr</span><span class="o">=</span><span class="n">history_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;UargS11N&#39;</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;history&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">),</span>
                 <span class="n">yerr</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;uAg&#39;</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Current Measurement&quot;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;device_history&quot;</span><span class="p">]:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;arg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;bs&#39;</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="s1">&#39;uAg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;From .asc&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Phase S11&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.plot_calrep">
    <p>def <span class="ident">plot_calrep</span>(</p><p>calrep_model)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots a calrep model with uncertainties</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.plot_calrep', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.plot_calrep" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_calrep</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a calrep model with uncertainties&quot;&quot;&quot;</span>
    <span class="c1"># todo: add options to this plot</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PowerCalrepModel</span><span class="p">,</span><span class="n">TwoPortCalrepModel</span><span class="p">]:</span>
        <span class="n">calrep_model</span><span class="o">.</span><span class="n">joined_table</span><span class="o">.</span><span class="n">metadata</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">calrep_model</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">joined_table</span>

    <span class="c1"># Uncertainties all have u in them</span>
    <span class="n">average_columns</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">column_names</span><span class="p">[:]:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;mag|arg|eff&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">average_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
    <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;average_columns&quot;,average_columns))</span>
    <span class="n">number_plots</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">average_columns</span><span class="p">)</span>
    <span class="n">number_rows</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">number_plots</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="n">column_name</span><span class="o">=</span><span class="n">average_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;M&quot;</span>
            <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
            <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
            <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
            <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
            <span class="c1">#print(&quot;Length of x is {0}, Length of y is {1}, Length of error is {2}&quot;.format(len(x),len(y),len(error)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k-x&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|${\Gamma} $|&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
            <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
            <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
            <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
            <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k-x&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;eff&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;E&quot;</span>
            <span class="n">error_parameter</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;e&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>

            <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
            <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k-x&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.plot_calrep_comparison">
    <p>def <span class="ident">plot_calrep_comparison</span>(</p><p>calrep_model_list)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots many calrep models on the same axis with uncertainties</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.plot_calrep_comparison', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.plot_calrep_comparison" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_calrep_comparison</span><span class="p">(</span><span class="n">calrep_model_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots many calrep models on the same axis with uncertainties&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">calrep_model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">calrep_model_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PowerCalrepModel</span><span class="p">,</span><span class="n">TwoPortCalrepModel</span><span class="p">]:</span>
            <span class="n">calrep_model_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">joined_table</span><span class="o">.</span><span class="n">metadata</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span>
            <span class="n">calrep_model_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">joined_table</span>

        <span class="c1"># Uncertainties all have u in them</span>
    <span class="n">average_columns</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">calrep_model_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">column_names</span><span class="p">[:]:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;mag|arg|eff&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">average_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
    <span class="c1">#print(&quot;{0} is {1}&quot;.format(&quot;average_columns&quot;,average_columns))</span>
    <span class="n">number_plots</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">average_columns</span><span class="p">)</span>
    <span class="n">number_rows</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">number_plots</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
    <span class="c1">#plt.hold(True)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">calrep_model</span> <span class="ow">in</span> <span class="n">calrep_model_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
            <span class="n">column_name</span><span class="o">=</span><span class="n">average_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;M&quot;</span>
                <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
                <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|${\Gamma} $|&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;A&quot;</span>
                <span class="n">error_parameter</span><span class="o">=</span><span class="n">column_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
                <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;eff&quot;</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">error_letter</span><span class="o">=</span><span class="s2">&quot;E&quot;</span>
                <span class="n">error_parameter</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;g&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                    <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">error_name</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">+</span><span class="n">error_letter</span><span class="o">+</span><span class="s2">&quot;e&quot;</span><span class="o">+</span><span class="n">error_parameter</span>
                    <span class="n">error</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_name</span><span class="p">]</span>

                <span class="n">x</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                <span class="n">y</span><span class="o">=</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.plot_calrep_results_comparison">
    <p>def <span class="ident">plot_calrep_results_comparison</span>(</p><p>calrep_model, results_model, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots a calrep file and a results file on the same axis. Input is a calrep table from the sparameter
function calrep and a
results file, with options.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.plot_calrep_results_comparison', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.plot_calrep_results_comparison" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_calrep_results_comparison</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">,</span> <span class="n">results_model</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a calrep file and a results file on the same axis. Input is a calrep table from the sparameter</span>
<span class="sd">    function calrep and a</span>
<span class="sd">    results file, with options. &quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;comparison_Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;error_suffix&quot;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span>
                <span class="s2">&quot;calrep_format&quot;</span><span class="p">:</span> <span class="s1">&#39;k-x&#39;</span><span class="p">,</span>
                <span class="s2">&quot;results_format&quot;</span><span class="p">:</span> <span class="s1">&#39;r-x&#39;</span><span class="p">}</span>
    <span class="n">comparison_plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c1"># figure out the number of plots based on the measurement type</span>
    <span class="n">measurement_type</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1|one&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2|two&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;NR&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS12&#39;</span><span class="p">,</span> <span class="s1">&#39;argS12&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span>
    <span class="c1"># create the error column names</span>
    <span class="n">error_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">[:]:</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span> <span class="s2">&quot;uM&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span> <span class="s2">&quot;uA&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Efficiency&quot;</span><span class="p">,</span> <span class="s2">&quot;uE&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_column</span><span class="p">)</span>

    <span class="c1"># We want plots that have frequency as the x-axis and y that has an error</span>
    <span class="n">calrep_x</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">results_x</span> <span class="o">=</span> <span class="n">results_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="c1"># each axis has an error column</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[:]):</span>
        <span class="n">calrep_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
        <span class="n">results_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results_model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">calrep_x</span><span class="p">,</span> <span class="n">calrep_y</span><span class="p">,</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s1">&#39;calrep_format&#39;</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Calrep of {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">calrep_x</span><span class="p">,</span> <span class="n">calrep_y</span> <span class="o">-</span> <span class="n">error</span><span class="p">,</span> <span class="n">calrep_y</span> <span class="o">+</span> <span class="n">error</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">),</span>
                        <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results_x</span><span class="p">,</span> <span class="n">results_y</span><span class="p">,</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s1">&#39;results_format&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reference File&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span>
                              <span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.plot_calrep_results_difference_comparison">
    <p>def <span class="ident">plot_calrep_results_difference_comparison</span>(</p><p>calrep_model, results_model, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots a calrep file and a results file on the same axis. Input is a calrep table from the sparameter
function calrep and a
results file, with options.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.plot_calrep_results_difference_comparison', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.plot_calrep_results_difference_comparison" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_calrep_results_difference_comparison</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">,</span> <span class="n">results_model</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a calrep file and a results file on the same axis. Input is a calrep table from the sparameter</span>
<span class="sd">    function calrep and a</span>
<span class="sd">    results file, with options. &quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Difference_Comparison&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;error_suffix&quot;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span>
                <span class="s2">&quot;calrep_format&quot;</span><span class="p">:</span> <span class="s1">&#39;r-x&#39;</span><span class="p">,</span>
                <span class="s2">&quot;results_format&quot;</span><span class="p">:</span> <span class="s1">&#39;r-x&#39;</span><span class="p">,</span>
                <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s1">&#39;Calrep diference of {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">])}</span>
    <span class="n">comparison_plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c1"># figure out the number of plots based on the measurement type</span>
    <span class="n">measurement_type</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1|one&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2|two&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;NR&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS12&#39;</span><span class="p">,</span> <span class="s1">&#39;argS12&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span>
    <span class="c1"># create the error column names</span>
    <span class="n">error_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">[:]:</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span> <span class="s2">&quot;uM&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span> <span class="s2">&quot;uA&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Efficiency&quot;</span><span class="p">,</span> <span class="s2">&quot;uE&quot;</span> <span class="o">+</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffix&quot;</span><span class="p">])</span>
        <span class="n">error_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_column</span><span class="p">)</span>
    <span class="n">difference_model</span> <span class="o">=</span> <span class="n">frequency_model_difference</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">,</span> <span class="n">results_model</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} is {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;difference_model.column_names&quot;</span><span class="p">,</span> <span class="n">difference_model</span><span class="o">.</span><span class="n">column_names</span><span class="p">))</span>
    <span class="c1"># We want plots that have frequency as the x-axis and y that has an error</span>
    <span class="n">difference_x</span> <span class="o">=</span> <span class="n">difference_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">calrep_x</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="c1"># each axis has an error column</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[:]):</span>

        <span class="n">difference_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">difference_model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">difference_x</span><span class="p">,</span> <span class="n">difference_y</span><span class="p">,</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s1">&#39;calrep_format&#39;</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Calrep diiference of {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">calrep_x</span><span class="p">,</span> <span class="o">-</span> <span class="n">error</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">),</span>
                        <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>

    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span>
                              <span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.plot_calrep_uncertainty">
    <p>def <span class="ident">plot_calrep_uncertainty</span>(</p><p>calrep_model, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots the uncertainty values for a calrep model versus frequency</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.plot_calrep_uncertainty', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.plot_calrep_uncertainty" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_calrep_uncertainty</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots the uncertainty values for a calrep model versus frequency&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Calrep_Uncertainty&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;error_suffixes&quot;</span><span class="p">:[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="p">,</span>
                <span class="s2">&quot;error_names&quot;</span><span class="p">:[</span><span class="s1">&#39;Type B&#39;</span><span class="p">,</span><span class="s1">&#39;SNIST&#39;</span><span class="p">,</span><span class="s1">&#39;Connect&#39;</span><span class="p">,</span><span class="s1">&#39;Total Uncertainty&#39;</span><span class="p">],</span>
                <span class="s2">&quot;error_plot_formats&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;r-x&#39;</span><span class="p">,</span><span class="s1">&#39;b-x&#39;</span><span class="p">,</span><span class="s1">&#39;g-x&#39;</span><span class="p">,</span><span class="s1">&#39;k-x&#39;</span><span class="p">]}</span>
    <span class="n">comparison_plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c1"># figure out the number of plots based on the measurement type</span>
    <span class="n">measurement_type</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1|one&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2|two&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;NR&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS12&#39;</span><span class="p">,</span> <span class="s1">&#39;argS12&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">number_plots</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span>
    <span class="c1"># create the error column names</span>
    <span class="n">error_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">[:]:</span>
        <span class="n">error_columns_per_plot</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;error_suffixes&quot;</span><span class="p">]:</span>
            <span class="n">error_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span> <span class="s2">&quot;uM&quot;</span> <span class="o">+</span><span class="n">suffix</span> <span class="p">)</span>
            <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span> <span class="s2">&quot;uA&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span>
            <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Efficiency&quot;</span><span class="p">,</span> <span class="s2">&quot;uE&quot;</span> <span class="o">+</span><span class="n">suffix</span><span class="p">)</span>
            <span class="n">error_columns_per_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_column</span><span class="p">)</span>
        <span class="n">error_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_columns_per_plot</span><span class="p">)</span>

    <span class="c1"># We want plots that have frequency as the x-axis and y that has an error</span>
    <span class="n">calrep_x</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="c1"># each axis has an error column</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[:]):</span>
        <span class="k">for</span> <span class="n">error_index</span><span class="p">,</span><span class="n">error_column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">error_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]):</span>

            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">[</span><span class="n">error_column</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">calrep_x</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s1">&#39;error_plot_formats&#39;</span><span class="p">][</span><span class="n">error_index</span><span class="p">],</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s1">&#39;error_names&#39;</span><span class="p">][</span><span class="n">error_index</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">plot_index</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span>
                              <span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.plot_checkstandard_history">
    <p>def <span class="ident">plot_checkstandard_history</span>(</p><p>device_history, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a plot of all of the measurements of a device from a history frame (pandas.DataFrame).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.plot_checkstandard_history', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.plot_checkstandard_history" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_checkstandard_history</span><span class="p">(</span><span class="n">device_history</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a plot of all of the measurements of a device from a history frame (pandas.DataFrame).</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Checkstandard_History&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;min_num&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;max_num&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;error_style&quot;</span><span class="p">:</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span>
                <span class="s2">&quot;extra_plots&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;extra_plot_labels&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;extra_plot_formats&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
    <span class="n">history_plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">history_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">history_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">device_id</span> <span class="o">=</span> <span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">measurement_type</span> <span class="o">=</span> <span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># The new method relies on metadata and not the class</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;OnePort&quot;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;TwoPort&quot;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Dry Cal|Thermistor|power&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;Power&quot;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># print(&quot;{0} is {1}&quot;.format(&quot;model&quot;,model))</span>
    <span class="n">unique_measurement_dates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">number_dates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_measurement_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]])</span>
    <span class="n">extra_length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s1">&#39;extra_plots&#39;</span><span class="p">]:</span>
        <span class="n">extra_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s1">&#39;extra_plots&#39;</span><span class="p">])</span>
    <span class="n">number_measurements</span> <span class="o">=</span> <span class="n">number_dates</span> <span class="o">+</span> <span class="n">extra_length</span>
    <span class="c1"># print(&quot;{0} are {1}&quot;.format(&quot;unique_measurement_dates&quot;,unique_measurement_dates))</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Power&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span>
        <span class="n">number_columns</span><span class="o">=</span><span class="mi">1</span>


    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;OnePort&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
        <span class="n">number_columns</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;TwoPort&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">number_rows</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="n">number_columns</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">number_columns</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># ax.xaxis.set_visible(False)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span> <span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|{0}|&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Ef&#39;</span><span class="p">,</span> <span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|{0}|&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="c1"># ax.set_title(column_names[index])</span>
            <span class="c1"># initial plot of</span>

            <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_formats&quot;</span><span class="p">]:</span>
                    <span class="n">plot_formats</span> <span class="o">=</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_formats&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plot_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;r--&quot;</span> <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_labels&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">model_index</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">plot_formats</span><span class="p">[</span><span class="n">model_index</span><span class="p">],</span>
                                <span class="n">label</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plot_labels&quot;</span><span class="p">][</span><span class="n">model_index</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">model_index</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;extra_plots&quot;</span><span class="p">]):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">plot_formats</span><span class="p">[</span><span class="n">model_index</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Comparison {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_index</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">for</span> <span class="n">date_index</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">unique_measurement_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]]):</span>
            <span class="n">number_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">unique_measurement_dates</span><span class="p">[</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;min_num&quot;</span><span class="p">]:</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;max_num&quot;</span><span class="p">]])</span>
            <span class="n">date_device_history</span> <span class="o">=</span> <span class="n">device_history</span><span class="p">[</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">date</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">date_device_history</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">x_date</span> <span class="o">=</span> <span class="n">date_device_history</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span>
                    <span class="n">y_date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">date_device_history</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="n">date_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">date_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">number_lines</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">date_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">number_lines</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_date</span><span class="p">,</span> <span class="n">y_date</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">date_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># ax.sharex(diff_axes[index])</span>
        <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">),</span>
                          <span class="n">ncol</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_measurements</span><span class="p">)</span> <span class="o">/</span> <span class="mf">28.</span><span class="p">),</span> <span class="mi">1</span><span class="p">])),</span> <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Measurement Dates&quot;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">device_id</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="p">)</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">history_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.plot_frequency_model">
    <p>def <span class="ident">plot_frequency_model</span>(</p><p>frequency_model, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots any table with frequency as its x-axis and column_names as the x-axis in a
series of subplots</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.plot_frequency_model', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.plot_frequency_model" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_frequency_model</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots any table with frequency as its x-axis and column_names as the x-axis in a</span>
<span class="sd">    series of subplots&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Frequency_Model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plots_per_column&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;plot_format&quot;</span><span class="p">:</span> <span class="s1">&#39;b-o&#39;</span><span class="p">,</span>
                <span class="s2">&quot;share_x&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;subplots_title&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s2">&quot;plot_title&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plot_size&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">}</span>
    <span class="n">plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">frequency_model</span> <span class="o">=</span> <span class="n">DataFrame_to_AsciiDataTable</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">)</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])</span>
    <span class="n">y_data_columns</span> <span class="o">=</span> <span class="n">frequency_model</span><span class="o">.</span><span class="n">column_names</span><span class="p">[:]</span>
    <span class="n">y_data_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">number_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_data_columns</span><span class="p">)</span>
    <span class="n">number_columns</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plots_per_column&quot;</span><span class="p">]</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_columns</span><span class="p">)))</span>
    <span class="n">figure</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="n">number_columns</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;share_x&quot;</span><span class="p">],</span>
                                <span class="n">figsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_size&quot;</span><span class="p">],</span> <span class="n">dpi</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;dpi&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">plot_index</span> <span class="o">&lt;</span> <span class="n">number_plots</span><span class="p">:</span>
            <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">[</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_format&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;subplots_title&quot;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_title&quot;</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_title&quot;</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">figure</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.plot_frequency_model_histogram">
    <p>def <span class="ident">plot_frequency_model_histogram</span>(</p><p>frequency_model, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots any table with frequency as its x-axis and column_names as the x-axis in a
series of subplots</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.plot_frequency_model_histogram', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.plot_frequency_model_histogram" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_frequency_model_histogram</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots any table with frequency as its x-axis and column_names as the x-axis in a</span>
<span class="sd">    series of subplots&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Frequency_Model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plots_per_column&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;plot_format&quot;</span><span class="p">:</span> <span class="s1">&#39;b-o&#39;</span><span class="p">,</span>
                <span class="s2">&quot;share_x&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;subplots_title&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s2">&quot;plot_title&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plot_size&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
                <span class="s2">&quot;non_plotable_text&quot;</span><span class="p">:</span> <span class="s2">&quot;Not Plotable&quot;</span><span class="p">}</span>
    <span class="n">plot_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
        <span class="n">frequency_model</span> <span class="o">=</span> <span class="n">DataFrame_to_AsciiDataTable</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">)</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">])</span>
    <span class="n">y_data_columns</span> <span class="o">=</span> <span class="n">frequency_model</span><span class="o">.</span><span class="n">column_names</span><span class="p">[:]</span>
    <span class="n">y_data_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">number_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_data_columns</span><span class="p">)</span>
    <span class="n">number_columns</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plots_per_column&quot;</span><span class="p">]</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_columns</span><span class="p">)))</span>
    <span class="n">figure</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="n">number_columns</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;share_x&quot;</span><span class="p">],</span>
                                <span class="n">figsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_size&quot;</span><span class="p">],</span> <span class="n">dpi</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;dpi&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">plot_index</span> <span class="o">&lt;</span> <span class="n">number_plots</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequency_model</span><span class="p">[</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;subplots_title&quot;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;non_plotable_text&quot;</span><span class="p">]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">Annotation</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;subplots_title&quot;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">y_data_columns</span><span class="p">[</span><span class="n">plot_index</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_title&quot;</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_title&quot;</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">figure</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.plot_raw_MUF_comparison">
    <p>def <span class="ident">plot_raw_MUF_comparison</span>(</p><p>raw_directory=&#39;C:\\Share\\35CalComp\\35_ascii_results&#39;, measurement_names=[&#39;N101P1.L1_030716&#39;, &#39;N101P2.L1_030716&#39;], nominal_path=&#39;C:\\Share\\35CalComp\\MUF_results\\DUTs\\N101P1_Support\\N101P1_0.s2p&#39;, sensitivity_directory=&#39;C:\\Share\\35CalComp\\MUF_results\\DUTs\\N101P1_Support\\Covariance&#39;, montecarlo_directory=&#39;C:\\Share\\35CalComp\\MUF_results\\DUTs\\N101P1_Support\\MonteCarlo&#39;, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots a comparison of results form the Microwave Uncertainty Framework and calrep given a raw file, nominal file,
a sensitivity directory and a montecarlo directory.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.plot_raw_MUF_comparison', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.plot_raw_MUF_comparison" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_raw_MUF_comparison</span><span class="p">(</span><span class="n">raw_directory</span><span class="o">=</span><span class="s2">r&quot;C:\Share\35CalComp\35_ascii_results&quot;</span><span class="p">,</span>
                            <span class="n">measurement_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;N101P1.L1_030716&#39;</span><span class="p">,</span> <span class="s1">&#39;N101P2.L1_030716&#39;</span><span class="p">],</span>
                            <span class="n">nominal_path</span><span class="o">=</span><span class="s2">r&quot;C:\Share\35CalComp\MUF_results\DUTs\N101P1_Support\N101P1_0.s2p&quot;</span><span class="p">,</span>
                            <span class="n">sensitivity_directory</span><span class="o">=</span><span class="s2">r&quot;C:\Share\35CalComp\MUF_results\DUTs\N101P1_Support\Covariance&quot;</span><span class="p">,</span>
                            <span class="n">montecarlo_directory</span><span class="o">=</span><span class="s2">r&quot;C:\Share\35CalComp\MUF_results\DUTs\N101P1_Support\MonteCarlo&quot;</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a comparison of results form the Microwave Uncertainty Framework and calrep given a raw file, nominal file,</span>
<span class="sd">    a sensitivity directory and a montecarlo directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># deal with options</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;save_plots&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
    <span class="n">comparison_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">comparison_options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c1"># load files into python classes</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">sparameter_power_type</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raw_directory</span><span class="p">,</span> <span class="n">measurement_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">print</span> <span class="n">model_name</span>
    <span class="c1"># raw_type(os.path.join(raw_directory,&#39;M105P1.L1_030716&#39;))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">model_name</span><span class="p">]</span>
    <span class="n">measurements</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">model</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raw_directory</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span> <span class="n">measurement_names</span><span class="p">)</span>
    <span class="n">calrep_measurements</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">calrep</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">measurements</span><span class="p">)</span>
    <span class="n">montecarlo_reference_curve</span> <span class="o">=</span> <span class="n">create_monte_carlo_reference_curve</span><span class="p">(</span><span class="n">monte_carlo_directory</span><span class="o">=</span><span class="n">montecarlo_directory</span><span class="p">,</span>
                                                                    <span class="n">format</span><span class="o">=</span><span class="s2">&quot;MA&quot;</span><span class="p">)</span>
    <span class="n">sensitivity_reference_curve</span> <span class="o">=</span> <span class="n">create_sensitivity_reference_curve</span><span class="p">(</span><span class="n">nominal_file_path</span><span class="o">=</span><span class="n">nominal_path</span><span class="p">,</span>
                                                                     <span class="n">sensitivity_directory</span><span class="o">=</span><span class="n">sensitivity_directory</span><span class="p">,</span>
                                                                     <span class="n">format</span><span class="o">=</span><span class="s2">&quot;MA&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]))</span>

    <span class="c1"># update global preferences</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">)})</span>

    <span class="c1"># for one-port</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">combined_figure</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Now plot all of these together at once mag first</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="n">measurements</span> <span class="o">+</span> <span class="p">[</span><span class="n">sensitivity_reference_curve</span><span class="p">,</span> <span class="n">montecarlo_reference_curve</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Montecarlo&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Nominal&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Measurement {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

        <span class="c1"># now phase</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;argS11&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">combined_figure</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="n">measurements</span> <span class="o">+</span> <span class="p">[</span><span class="n">sensitivity_reference_curve</span><span class="p">,</span> <span class="n">montecarlo_reference_curve</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Montecarlo&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Nominal&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Measurement {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S11&quot;</span><span class="p">,</span> <span class="s2">&quot;S21&quot;</span><span class="p">,</span> <span class="s2">&quot;S22&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">plot_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="c1"># Now plot all of these together at once mag first</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="c1"># now phase</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;arg&quot;</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">plot_index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>


                <span class="c1"># plot the difference with uncertainties</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;One&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="c1"># now the difference of mag for measurement one</span>
        <span class="n">montecarlo_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">montecarlo_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;umagS11&quot;</span><span class="p">])</span>
        <span class="n">measurement_1_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">measurement_1_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;uMgS11&quot;</span><span class="p">])</span>
        <span class="n">nominal_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;magS11&quot;</span><span class="p">])</span>
        <span class="n">nominal_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;umagS11&quot;</span><span class="p">])</span>
        <span class="n">difference_figure</span><span class="p">,</span> <span class="n">difference_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                <span class="n">measurement_1_mag</span> <span class="o">-</span> <span class="n">nominal_mag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Nominal and Calrep&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">nominal_uncertainty</span><span class="p">,</span>
                                        <span class="n">nominal_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sensitivity Uncertainty&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">measurement_1_mag</span> <span class="o">-</span> <span class="n">montecarlo_mag</span><span class="p">,</span>
                                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Montecarlo mean and Calrep&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">montecarlo_uncertainty</span><span class="p">,</span>
                                        <span class="n">montecarlo_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Montecarlo Uncertainty&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">measurement_1_uncertainty</span><span class="p">,</span>
                                        <span class="n">measurement_1_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calrep Uncertainty&quot;</span><span class="p">)</span>
        <span class="n">montecarlo_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;argS11&quot;</span><span class="p">])</span>
        <span class="n">montecarlo_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;uargS11&quot;</span><span class="p">])</span>
        <span class="n">measurement_1_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;argS11&quot;</span><span class="p">])</span>
        <span class="n">measurement_1_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;uAgS11&quot;</span><span class="p">])</span>
        <span class="n">nominal_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;argS11&quot;</span><span class="p">])</span>
        <span class="n">nominal_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;uargS11&quot;</span><span class="p">])</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                <span class="n">measurement_1_arg</span> <span class="o">-</span> <span class="n">nominal_arg</span><span class="p">,</span>
                                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Nominal &quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">nominal_arg_uncertainty</span><span class="p">,</span>
                                        <span class="n">nominal_arg_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sensitivity Uncertainty&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">measurement_1_arg</span> <span class="o">-</span> <span class="n">montecarlo_arg</span><span class="p">,</span>
                                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Montecarlo &quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                        <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">montecarlo_arg_uncertainty</span><span class="p">,</span> <span class="n">montecarlo_arg_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Montecarlo Uncertainty&quot;</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                        <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">measurement_1_arg_uncertainty</span><span class="p">,</span> <span class="n">measurement_1_arg_uncertainty</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                        <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calrep Uncertainty&quot;</span><span class="p">)</span>

        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">difference_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-.</span><span class="mo">025</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=.</span><span class="mo">025</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S11&quot;</span><span class="p">,</span> <span class="s2">&quot;S21&quot;</span><span class="p">,</span> <span class="s2">&quot;S22&quot;</span><span class="p">]</span>
        <span class="n">difference_figure</span><span class="p">,</span> <span class="n">difference_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">plot_index</span><span class="p">,</span> <span class="n">plot_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">difference_axes</span><span class="p">):</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="n">plot_index</span><span class="p">]</span>
            <span class="n">montecarlo_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">montecarlo_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;umag&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">measurement_1_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;mag&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">measurement_1_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;uMg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">nominal_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">nominal_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;umag&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                             <span class="n">measurement_1_mag</span> <span class="o">-</span> <span class="n">nominal_mag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Nominal and Calrep&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">nominal_uncertainty</span><span class="p">,</span>
                                     <span class="n">nominal_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sensitivity Uncertainty&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">measurement_1_mag</span> <span class="o">-</span> <span class="n">montecarlo_mag</span><span class="p">,</span>
                             <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Montecarlo mean and Calrep&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">montecarlo_uncertainty</span><span class="p">,</span>
                                     <span class="n">montecarlo_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Montecarlo Uncertainty&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">measurement_1_uncertainty</span><span class="p">,</span>
                                     <span class="n">measurement_1_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calrep Uncertainty&quot;</span><span class="p">)</span>
            <span class="n">montecarlo_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;arg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">montecarlo_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;uarg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">measurement_1_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;arg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">measurement_1_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">calrep_measurements</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;uAg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">nominal_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;arg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">nominal_arg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;uarg&quot;</span> <span class="o">+</span> <span class="n">parameter</span><span class="p">])</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                             <span class="n">measurement_1_arg</span> <span class="o">-</span> <span class="n">nominal_arg</span><span class="p">,</span>
                             <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Nominal &quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">nominal_arg_uncertainty</span><span class="p">,</span>
                                     <span class="n">nominal_arg_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sensitivity Uncertainty&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">montecarlo_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span> <span class="n">measurement_1_arg</span> <span class="o">-</span> <span class="n">montecarlo_arg</span><span class="p">,</span>
                             <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference of Montecarlo &quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                     <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">montecarlo_arg_uncertainty</span><span class="p">,</span> <span class="n">montecarlo_arg_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Montecarlo Uncertainty&quot;</span><span class="p">)</span>
            <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sensitivity_reference_curve</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">],</span>
                                     <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">measurement_1_arg_uncertainty</span><span class="p">,</span> <span class="n">measurement_1_arg_uncertainty</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calrep Uncertainty&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plot_index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-.</span><span class="mo">0001</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=.</span><span class="mo">0001</span><span class="p">)</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mf">1.8</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">plot_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-.</span><span class="mo">025</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=.</span><span class="mo">025</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="c1"># Return files if you need them later</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">measurements</span><span class="p">,</span> <span class="n">calrep_measurements</span><span class="p">,</span> <span class="n">montecarlo_reference_curve</span><span class="p">,</span> <span class="n">sensitivity_reference_curve</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.plot_reference_curve">
    <p>def <span class="ident">plot_reference_curve</span>(</p><p>reference_curve, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots a frequency based reference curve by using the options
value_column_names and uncertainty_column_names.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.plot_reference_curve', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.plot_reference_curve" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_reference_curve</span><span class="p">(</span><span class="n">reference_curve</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a frequency based reference curve by using the options</span>
<span class="sd">    value_column_names and uncertainty_column_names.&quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Reference_Curve&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plots_per_column&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;plot_format&quot;</span><span class="p">:</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span>
                <span class="s2">&quot;fill_color&quot;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="s2">&quot;fill_opacity&quot;</span><span class="p">:</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span>
                <span class="s2">&quot;fill_edge_color&quot;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="s2">&quot;plot_size&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
                <span class="s2">&quot;independent_axis_column_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span>
                <span class="s2">&quot;share_x&quot;</span><span class="p">:</span> <span class="s2">&quot;col&quot;</span><span class="p">}</span>
    <span class="n">plot_options</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">value_columns</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;value_column_names&quot;</span><span class="p">]</span>
    <span class="n">uncertainty_columns</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;uncertainty_column_names&quot;</span><span class="p">]</span>
    <span class="n">number_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_columns</span><span class="p">)</span>
    <span class="n">number_columns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plots_per_column&quot;</span><span class="p">])</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_columns</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">reference_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">number_columns</span><span class="p">,</span>
                                       <span class="n">sharex</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;share_x&quot;</span><span class="p">],</span>
                                       <span class="n">figsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_size&quot;</span><span class="p">],</span>
                                       <span class="n">dpi</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;dpi&quot;</span><span class="p">])</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="p">[</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;independent_axis_column_name&quot;</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">axes_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reference_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reference_curve</span><span class="p">[</span><span class="n">value_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">]])</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reference_curve</span><span class="p">[</span><span class="n">uncertainty_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_format&quot;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">-</span> <span class="n">error</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">+</span> <span class="n">error</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">],</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_opacity&quot;</span><span class="p">],</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_edge_color&quot;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">value_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.plot_reference_curve_comparison">
    <p>def <span class="ident">plot_reference_curve_comparison</span>(</p><p>reference_curve_list, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots a list of frequency based reference curves
by using the options value_column_names and uncertainty_column_names.
Options</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.plot_reference_curve_comparison', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.plot_reference_curve_comparison" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_reference_curve_comparison</span><span class="p">(</span><span class="n">reference_curve_list</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a list of frequency based reference curves</span>
<span class="sd">     by using the options value_column_names and uncertainty_column_names.</span>
<span class="sd">     Options &quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Reference_Curve&quot;</span><span class="p">,</span>
                <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span> <span class="s2">&quot;Plot&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s2">&quot;plots_per_column&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;plot_format&quot;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                <span class="s2">&quot;fill_color&quot;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="s2">&quot;fill_opacity&quot;</span><span class="p">:</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span>
                <span class="s2">&quot;fill_edge_color&quot;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="s2">&quot;plot_size&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
                <span class="s2">&quot;independent_axis_column_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">,</span>
                <span class="s2">&quot;share_x&quot;</span><span class="p">:</span> <span class="s2">&quot;col&quot;</span><span class="p">,</span>
                <span class="s2">&quot;labels&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
    <span class="n">plot_options</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]:</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">reference_curve_list</span><span class="p">)</span>
    <span class="n">value_columns</span> <span class="o">=</span> <span class="n">reference_curve_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;value_column_names&quot;</span><span class="p">]</span>
    <span class="n">uncertainty_columns</span> <span class="o">=</span> <span class="n">reference_curve_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;uncertainty_column_names&quot;</span><span class="p">]</span>
    <span class="n">number_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_columns</span><span class="p">)</span>
    <span class="n">number_columns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plots_per_column&quot;</span><span class="p">])</span>
    <span class="n">number_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number_plots</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">number_columns</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">reference_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">number_columns</span><span class="p">,</span>
                                       <span class="n">sharex</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;share_x&quot;</span><span class="p">],</span>
                                       <span class="n">figsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_size&quot;</span><span class="p">],</span>
                                       <span class="n">dpi</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;dpi&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">reference_curve</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reference_curve_list</span><span class="p">[:]):</span>
        <span class="n">value_columns</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;value_column_names&quot;</span><span class="p">]</span>
        <span class="n">uncertainty_columns</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;uncertainty_column_names&quot;</span><span class="p">]</span>


        <span class="n">x_data</span> <span class="o">=</span> <span class="n">reference_curve</span><span class="p">[</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;independent_axis_column_name&quot;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">axes_index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reference_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
            <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reference_curve</span><span class="p">[</span><span class="n">value_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">]])</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reference_curve</span><span class="p">[</span><span class="n">uncertainty_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">]])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;plot_format&quot;</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">-</span> <span class="n">error</span><span class="p">,</span> <span class="n">y_data</span> <span class="o">+</span> <span class="n">error</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_color&quot;</span><span class="p">],</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_opacity&quot;</span><span class="p">],</span>
                            <span class="n">edgecolor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;fill_edge_color&quot;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">value_columns</span><span class="p">[</span><span class="n">axes_index</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c1"># Dealing with the save option</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">general_descriptor</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                              <span class="n">directory</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1"># print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.polar_average">
    <p>def <span class="ident">polar_average</span>(</p><p>complex_number_1, complex_number_2)</p>
    </div>
    

    
  
    <div class="desc"><p>Averages 2 complex numbers in polar coordinates and returns a single complex number</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.polar_average', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.polar_average" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">polar_average</span><span class="p">(</span><span class="n">complex_number_1</span><span class="p">,</span><span class="n">complex_number_2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Averages 2 complex numbers in polar coordinates and returns a single complex number&quot;&quot;&quot;</span>
    <span class="n">polar_number_1</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">complex_number_1</span><span class="p">)</span>
    <span class="n">polar_number_2</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">complex_number_2</span><span class="p">)</span>
    <span class="n">average_length</span><span class="o">=</span><span class="p">(</span><span class="n">polar_number_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">polar_number_2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">average_phase</span><span class="o">=</span><span class="p">(</span><span class="n">polar_number_1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">polar_number_2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">out_value</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">average_length</span><span class="p">,</span><span class="n">average_phase</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_value</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.polar_geometric_average">
    <p>def <span class="ident">polar_geometric_average</span>(</p><p>complex_number_1, complex_number_2)</p>
    </div>
    

    
  
    <div class="desc"><p>Averages 2 complex numbers in polar coordinates and returns a single complex number</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.polar_geometric_average', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.polar_geometric_average" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">polar_geometric_average</span><span class="p">(</span><span class="n">complex_number_1</span><span class="p">,</span><span class="n">complex_number_2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Averages 2 complex numbers in polar coordinates and returns a single complex number&quot;&quot;&quot;</span>
    <span class="n">polar_number_1</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">complex_number_1</span><span class="p">)</span>
    <span class="n">polar_number_2</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">complex_number_2</span><span class="p">)</span>
    <span class="n">average_length</span><span class="o">=</span><span class="p">(</span><span class="n">polar_number_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">polar_number_2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**.</span><span class="mi">5</span>
    <span class="n">average_phase</span><span class="o">=</span><span class="p">(</span><span class="n">polar_number_1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">polar_number_2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">out_value</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">average_length</span><span class="p">,</span><span class="n">average_phase</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_value</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.raw_comparison_plot_with_residuals">
    <p>def <span class="ident">raw_comparison_plot_with_residuals</span>(</p><p>raw_nist, mean_frame, difference_frame, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a comparison plot given a RawModel object and a pandas.DataFrame mean frame and difference frame</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.raw_comparison_plot_with_residuals', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.raw_comparison_plot_with_residuals" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">raw_comparison_plot_with_residuals</span><span class="p">(</span><span class="n">raw_nist</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">,</span><span class="n">difference_frame</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a comparison plot given a RawModel object and a pandas.DataFrame mean frame and difference frame&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;display_mean&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;display_difference&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;display_raw&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;display_legend&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
              <span class="s2">&quot;save_plot&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
              <span class="s2">&quot;directory&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
              <span class="s2">&quot;specific_descriptor&quot;</span><span class="p">:</span><span class="n">raw_nist</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;_Check_Standard&quot;</span><span class="p">,</span>
              <span class="s2">&quot;general_descriptor&quot;</span><span class="p">:</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span><span class="s2">&quot;file_name&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
    <span class="n">comparison_plot_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">comparison_plot_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="n">column_names</span><span class="o">=</span><span class="n">mean_frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">number_rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">compare_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">number_rows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">measurement_date</span><span class="o">=</span><span class="n">raw_nist</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Date&quot;</span><span class="p">]</span>
    <span class="n">diff_axes</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
        <span class="n">diff_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
    <span class="c1">#diff_axes=[diff_ax0,diff_ax1,diff_ax2,diff_ax3,diff_ax4,diff_ax5]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_difference&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">diff_axes</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">difference_frame</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">difference_frame</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="s1">&#39;r-x&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Difference&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-.</span><span class="mo">02</span><span class="p">,</span><span class="o">.</span><span class="mo">02</span><span class="p">)</span>
            <span class="c1">#ax.legend_.remove()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_raw&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">raw_nist</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">raw_nist</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s1">&#39;k-o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">measurement_date</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_mean&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_frame</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">mean_frame</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="s1">&#39;gs&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;display_legend&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;8&#39;</span><span class="p">)</span>
        <span class="c1">#ax.xaxis.set_visible(False)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|${\Gamma} $|&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="c1">#ax.sharex(diff_axes[index])</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">compare_axes</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">raw_nist</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">auto_name</span><span class="p">(</span><span class="n">specific_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;specific_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">general_descriptor</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;general_descriptor&quot;</span><span class="p">],</span>
                            <span class="n">directory</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span><span class="n">extension</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="n">padding</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
        <span class="c1">#print file_name</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comparison_plot_options</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">],</span><span class="n">file_name</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.raw_difference_frame">
    <p>def <span class="ident">raw_difference_frame</span>(</p><p>raw_model, mean_frame, **options)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a difference pandas.DataFrame given a raw NIST model and a mean pandas.DataFrame</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.raw_difference_frame', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.raw_difference_frame" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">raw_difference_frame</span><span class="p">(</span><span class="n">raw_model</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a difference pandas.DataFrame given a raw NIST model and a mean pandas.DataFrame&quot;&quot;&quot;</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;column_names&quot;</span><span class="p">:</span><span class="n">mean_frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
    <span class="n">difference_options</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">difference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">difference_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="n">difference_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">raw_model</span><span class="o">.</span><span class="n">data</span><span class="p">[:]:</span>
        <span class="c1">#print row[0]</span>
        <span class="n">mean_row</span><span class="o">=</span><span class="n">mean_frame</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">mean_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="nb">abs</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
        <span class="c1">#print mean_row</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mean_row</span><span class="o">=</span><span class="n">mean_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">difference_row</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">mean_row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_row</span><span class="p">))]</span>
            <span class="n">difference_row</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">difference_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">difference_row</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span><span class="k">pass</span>
    <span class="n">difference_data_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">difference_list</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">difference_options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">difference_data_frame</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.return_calrep_error_column_names">
    <p>def <span class="ident">return_calrep_error_column_names</span>(</p><p>calrep_model_value_columns, error_suffix=&#39;g&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the column names for errors in a calrep model. For example if the
calrep model value column names are ["magS11","argS11"], then it returns ["uMgS11","uAgS11"]</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.return_calrep_error_column_names', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.return_calrep_error_column_names" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">return_calrep_error_column_names</span><span class="p">(</span><span class="n">calrep_model_value_columns</span><span class="p">,</span><span class="n">error_suffix</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the column names for errors in a calrep model. For example if the</span>
<span class="sd">    calrep model value column names are [&quot;magS11&quot;,&quot;argS11&quot;], then it returns [&quot;uMgS11&quot;,&quot;uAgS11&quot;] &quot;&quot;&quot;</span>
    <span class="n">error_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">calrep_model_value_columns</span><span class="p">[:]:</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;mag&quot;</span><span class="p">,</span> <span class="s2">&quot;uM&quot;</span> <span class="o">+</span> <span class="n">error_suffix</span><span class="p">)</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span> <span class="s2">&quot;uA&quot;</span> <span class="o">+</span> <span class="n">error_suffix</span><span class="p">)</span>
        <span class="n">error_column</span> <span class="o">=</span> <span class="n">error_column</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Efficiency&quot;</span><span class="p">,</span> <span class="s2">&quot;uE&quot;</span> <span class="o">+</span> <span class="n">error_suffix</span><span class="p">)</span>
        <span class="n">error_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_column</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">error_columns</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.return_calrep_value_column_names">
    <p>def <span class="ident">return_calrep_value_column_names</span>(</p><p>calrep_model)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the column names for values in a calrep model. For example if the
calrep model is a 1-port, then it returns ["magS11","argS11"]</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.return_calrep_value_column_names', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.return_calrep_value_column_names" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">return_calrep_value_column_names</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the column names for values in a calrep model. For example if the</span>
<span class="sd">    calrep model is a 1-port, then it returns [&quot;magS11&quot;,&quot;argS11&quot;] &quot;&quot;&quot;</span>
    <span class="n">measurement_type</span> <span class="o">=</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1|one&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2|two&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;NR&#39;</span><span class="p">,</span> <span class="n">measurement_type</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS12&#39;</span><span class="p">,</span> <span class="s1">&#39;argS12&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;magS21&#39;</span><span class="p">,</span> <span class="s1">&#39;argS21&#39;</span><span class="p">,</span> <span class="s1">&#39;magS22&#39;</span><span class="p">,</span> <span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span> <span class="s1">&#39;argS11&#39;</span><span class="p">,</span> <span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">column_names</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.return_history_key">
    <p>def <span class="ident">return_history_key</span>(</p><p>calrep_model)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a key for the history dictionary given a calrep model</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.return_history_key', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.return_history_key" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">return_history_key</span><span class="p">(</span><span class="n">calrep_model</span><span class="p">):</span>
    <span class="s2">&quot;Returns a key for the history dictionary given a calrep model&quot;</span>
    <span class="n">model</span><span class="o">=</span><span class="n">calrep_model</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="c1">#print model</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Calrep|DUT&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;OnePortCalrep&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;1-port calrep&#39;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;TwoPortCalrep&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;2-port calrep&#39;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;PowerCalrep&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">POWER_3TERM_COLUMN_NAMES</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;power 3term calrep&#39;</span>
            <span class="k">elif</span> <span class="n">calrep_model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">POWER_4TERM_COLUMN_NAMES</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;power 4term calrep&#39;</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;OnePortDUT&#39;</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;power 3term calrep&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Must be a calrep model, such as OnePortCalrepModel, etc. &quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.test_average_one_port_sparameters">
    <p>def <span class="ident">test_average_one_port_sparameters</span>(</p><p>)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.test_average_one_port_sparameters', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.test_average_one_port_sparameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">test_average_one_port_sparameters</span><span class="p">():</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">TESTS_DIRECTORY</span><span class="p">)</span>
    <span class="n">table_list</span><span class="o">=</span><span class="p">[</span><span class="n">OnePortRawModel</span><span class="p">(</span><span class="s1">&#39;OnePortRawTestFileAsConverted.txt&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="n">out_data</span><span class="o">=</span><span class="n">average_one_port_sparameters</span><span class="p">(</span><span class="n">table_list</span><span class="p">)</span>
    <span class="n">out_table</span><span class="o">=</span><span class="n">OnePortRawModel</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="n">out_data</span><span class="p">})</span>
    <span class="c1">#table_list[0].show()</span>
    <span class="c1">#out_table.show()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">out_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">out_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;magS11&#39;</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">table_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">table_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;magS11&#39;</span><span class="p">),</span><span class="s1">&#39;bx&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Magnitude S11&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">out_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">out_table</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;argS11&#39;</span><span class="p">),</span><span class="s1">&#39;ro&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">table_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">table_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;argS11&#39;</span><span class="p">),</span><span class="s1">&#39;bx&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Phase S11&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">out_table</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.test_compare_s2p_plots">
    <p>def <span class="ident">test_compare_s2p_plots</span>(</p><p>file_list=[&#39;thru.s2p&#39;, &#39;20160301_30ft_cable_0.s2p&#39;, &#39;TwoPortTouchstoneTestFile.s2p&#39;])</p>
    </div>
    

    
  
    <div class="desc"><p>Tests the compare_s2p_plots function</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.test_compare_s2p_plots', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.test_compare_s2p_plots" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">test_compare_s2p_plots</span><span class="p">(</span><span class="n">file_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;thru.s2p&quot;</span><span class="p">,</span><span class="s1">&#39;20160301_30ft_cable_0.s2p&#39;</span><span class="p">,</span><span class="s1">&#39;TwoPortTouchstoneTestFile.s2p&#39;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Tests the compare_s2p_plots function&quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">TESTS_DIRECTORY</span><span class="p">)</span>
    <span class="n">tables</span><span class="o">=</span><span class="p">[</span><span class="n">S2PV1</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">]</span>
    <span class="n">format</span><span class="o">=</span><span class="s2">&quot;MA&quot;</span>
    <span class="n">compare_s2p_plots</span><span class="p">(</span><span class="n">tables</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="n">format</span><span class="p">)</span>
    <span class="n">format</span><span class="o">=</span><span class="s2">&quot;DB&quot;</span>
    <span class="n">compare_s2p_plots</span><span class="p">(</span><span class="n">tables</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="n">format</span><span class="p">,</span><span class="n">display_legend</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.test_comparison">
    <p>def <span class="ident">test_comparison</span>(</p><p>input_file=None)</p>
    </div>
    

    
  
    <div class="desc"><p>test_comparison tests the raw_mean,difference and comparison plot functionality</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.test_comparison', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.test_comparison" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">test_comparison</span><span class="p">(</span><span class="n">input_file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;test_comparison tests the raw_mean,difference and comparison plot functionality&quot;&quot;&quot;</span>
    <span class="c1"># Data sources, to be replaced as project_files in Django</span>
    <span class="c1"># Todo: These are not robust tests fix them?</span>
    <span class="n">TWO_PORT_NR_CHKSTD_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_Check_Standard\Two_Port_NR_Check_Standard.csv&quot;</span>
    <span class="n">COMBINED_ONE_PORT_CHKSTD_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_Check_Standard\Combined_One_Port_Check_Standard.csv&quot;</span>
    <span class="n">COMBINED_TWO_PORT_CHKSTD_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_Check_Standard\Combined_Two_Port_Check_Standard.csv&quot;</span>
    <span class="n">COMBINED_POWER_CHKSTD_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_Check_Standard\Combined_Power_Check_Standard.csv&quot;</span>
    <span class="n">ONE_PORT_CALREP_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_DUT\One_Port_DUT.csv&quot;</span>
    <span class="n">TWO_PORT_CALREP_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_DUT\Two_Port_DUT.csv&quot;</span>
    <span class="n">POWER_3TERM_CALREP_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_DUT\Power_3Term_DUT.csv&quot;</span>
    <span class="n">POWER_4TERM_CALREP_CSV</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Converted_DUT\Power_4Term_DUT.csv&quot;</span>
    <span class="n">history_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;1-port&#39;</span><span class="p">:</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">COMBINED_ONE_PORT_CHKSTD_CSV</span><span class="p">),</span>
         <span class="s1">&#39;2-port&#39;</span><span class="p">:</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">COMBINED_TWO_PORT_CHKSTD_CSV</span><span class="p">),</span>
         <span class="s1">&#39;2-portNR&#39;</span><span class="p">:</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">TWO_PORT_NR_CHKSTD_CSV</span><span class="p">),</span><span class="s1">&#39;power&#39;</span><span class="p">:</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">COMBINED_POWER_CHKSTD_CSV</span><span class="p">)}</span>
    <span class="k">if</span> <span class="n">input_file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\C07207.D1_030298&quot;</span>
        <span class="n">input_file</span><span class="o">=</span><span class="s2">r&quot;C:\Share\Ck_Std_raw_ascii\C07207.D9_042500&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\C07208.A10_081507&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\CTNP20.R1_032310&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\CN49.K2_050608&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\C22P13.H4_043015&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\C24N07.L1_070998&quot;</span>
        <span class="c1">#input_file=r&quot;C:\Share\Ck_Std_raw_ascii\CTN208.A1_011613&quot;</span>
    <span class="n">start_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">file_model</span><span class="o">=</span><span class="n">sparameter_power_type</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
    <span class="n">model</span><span class="o">=</span><span class="nb">globals</span><span class="p">()[</span><span class="n">file_model</span><span class="p">]</span>
    <span class="n">table</span><span class="o">=</span><span class="n">model</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
    <span class="c1">#print table</span>
    <span class="c1">#table.metadata[&quot;System_Id&quot;]</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">:</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">],</span> <span class="s2">&quot;System_Id&quot;</span><span class="p">:</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;System_Id&quot;</span><span class="p">],</span><span class="s2">&quot;Measurement_Timestamp&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                  <span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">:</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Connector_Type_Measurement&quot;</span><span class="p">],</span>
                 <span class="s2">&quot;Measurement_Date&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s2">&quot;Measurement_Time&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2-port&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2-portNR&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">history_key</span><span class="o">=</span><span class="s1">&#39;2-port&#39;</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;2-portNR&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">history_key</span><span class="o">=</span><span class="s1">&#39;2-portNR&#39;</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS12&#39;</span><span class="p">,</span><span class="s1">&#39;argS12&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;1-port&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">history_key</span><span class="o">=</span><span class="s1">&#39;1-port&#39;</span>
        <span class="k">if</span> <span class="n">COMBINE_S11_S22</span><span class="p">:</span>
             <span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Dry Cal|Thermistor|power&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Type&quot;</span><span class="p">],</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="n">history_key</span><span class="o">=</span><span class="s1">&#39;power&#39;</span>
        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;column_names&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;Efficiency&#39;</span><span class="p">,</span><span class="s1">&#39;Calibration_Factor&#39;</span><span class="p">]</span>
    <span class="c1">#print history[history_key][:5]</span>
    <span class="k">print</span> <span class="n">history_key</span>
    <span class="n">mean_frame</span><span class="o">=</span><span class="n">mean_from_history</span><span class="p">(</span><span class="n">history_dict</span><span class="p">[</span><span class="n">history_key</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="c1">#print mean_frame</span>
    <span class="n">difference_frame</span><span class="o">=</span><span class="n">raw_difference_frame</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">)</span>
    <span class="c1">#print difference_frame</span>
    <span class="n">stop_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">plot_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;display_difference&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s2">&quot;display_mean&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;display_raw&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span><span class="s2">&quot;display_legend&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>
    <span class="n">raw_comparison_plot_with_residuals</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">,</span><span class="n">difference_frame</span><span class="p">,</span><span class="o">**</span><span class="n">plot_options</span><span class="p">)</span>
    <span class="c1">#stop_time=datetime.datetime.now()</span>
    <span class="n">diff</span><span class="o">=</span><span class="n">stop_time</span><span class="o">-</span><span class="n">start_time</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;It took {0} seconds to process&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.two_port_comparison_plot_with_residuals">
    <p>def <span class="ident">two_port_comparison_plot_with_residuals</span>(</p><p>two_port_raw, mean_frame, difference_frame)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a comparison plot given a TwoPortRawModel object and a pandas.DataFrame mean frame</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.two_port_comparison_plot_with_residuals', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.two_port_comparison_plot_with_residuals" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">two_port_comparison_plot_with_residuals</span><span class="p">(</span><span class="n">two_port_raw</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">,</span><span class="n">difference_frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a comparison plot given a TwoPortRawModel object and a pandas.DataFrame mean frame&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">measurement_date</span><span class="o">=</span><span class="n">two_port_raw</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Measurement_Date&quot;</span><span class="p">]</span>
    <span class="n">ax0</span><span class="p">,</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">,</span><span class="n">ax5</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flat</span>
    <span class="n">compare_axes</span><span class="o">=</span><span class="p">[</span><span class="n">ax0</span><span class="p">,</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">,</span><span class="n">ax5</span><span class="p">]</span>
    <span class="n">diff_axes</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">compare_axes</span><span class="p">:</span>
        <span class="n">diff_axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
    <span class="c1">#diff_axes=[diff_ax0,diff_ax1,diff_ax2,diff_ax3,diff_ax4,diff_ax5]</span>
    <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">diff_axes</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">difference_frame</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">difference_frame</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="s1">&#39;r-x&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Difference&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-.</span><span class="mo">02</span><span class="p">,</span><span class="o">.</span><span class="mo">02</span><span class="p">)</span>
        <span class="c1">#ax.legend_.remove()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compare_axes</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">two_port_raw</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">),</span><span class="n">two_port_raw</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s1">&#39;k-o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">measurement_date</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_frame</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">mean_frame</span><span class="p">[</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="s1">&#39;gs&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;8&#39;</span><span class="p">)</span>
        <span class="c1">#ax.xaxis.set_visible(False)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;arg&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase(Degrees)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">,</span><span class="n">column_names</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;|${\Gamma} $|&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="c1">#ax.sharex(diff_axes[index])</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency(GHz)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">two_port_raw</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.two_port_complex_to_matrix_form">
    <p>def <span class="ident">two_port_complex_to_matrix_form</span>(</p><p>complex_data)</p>
    </div>
    

    
  
    <div class="desc"><p>two_port_complex_to_matrix_form takes a list of [[frequency,S11,S21,S12,S22],..] and
returns a list in the
form [[frequency,np.matrix([[S11,S12],[S21,S22]])]..], it is meant to prepare data for correction</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.two_port_complex_to_matrix_form', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.two_port_complex_to_matrix_form" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">complex_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;two_port_complex_to_matrix_form takes a list of [[frequency,S11,S21,S12,S22],..] and</span>
<span class="sd">    returns a list in the</span>
<span class="sd">    form [[frequency,np.matrix([[S11,S12],[S21,S22]])]..], it is meant to prepare data for correction&quot;&quot;&quot;</span>
    <span class="n">out_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">complex_data</span><span class="p">:</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">[</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">]</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">],[</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">]])</span>
        <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">m</span><span class="p">])</span>
    <span class="c1">#print out_list</span>
    <span class="k">return</span> <span class="n">out_list</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.two_port_difference_frame">
    <p>def <span class="ident">two_port_difference_frame</span>(</p><p>two_port_raw, mean_frame)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a difference pandas.DataFrame given a two port raw file and a mean pandas.DataFrame</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.two_port_difference_frame', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.two_port_difference_frame" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">two_port_difference_frame</span><span class="p">(</span><span class="n">two_port_raw</span><span class="p">,</span><span class="n">mean_frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a difference pandas.DataFrame given a two port raw file and a mean pandas.DataFrame&quot;&quot;&quot;</span>
    <span class="n">difference_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">two_port_raw</span><span class="o">.</span><span class="n">data</span><span class="p">[:]:</span>
        <span class="c1">#print row[0]</span>
        <span class="n">mean_row</span><span class="o">=</span><span class="n">mean_frame</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">mean_frame</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="nb">abs</span><span class="p">(</span><span class="o">.</span><span class="mo">01</span><span class="p">)]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
        <span class="c1">#print mean_row</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mean_row</span><span class="o">=</span><span class="n">mean_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">difference_row</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">mean_row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_row</span><span class="p">))]</span>
            <span class="n">difference_row</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">difference_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">difference_row</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span><span class="k">pass</span>
    <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="n">diff_data_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">difference_list</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">diff_data_frame</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.two_port_matrix_to_complex_form">
    <p>def <span class="ident">two_port_matrix_to_complex_form</span>(</p><p>matrix_form_data)</p>
    </div>
    

    
  
    <div class="desc"><p>two_port_matrix_to_complex_form takes a list of [[frequency,np.matrix([[S11,S12],[S21,S22]])]..]
and returns a list in the
form [[frequency,S11,S21,S12,S22],..] , it is meant to undo two_port_complex_to_matrix_form</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.two_port_matrix_to_complex_form', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.two_port_matrix_to_complex_form" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">two_port_matrix_to_complex_form</span><span class="p">(</span><span class="n">matrix_form_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;two_port_matrix_to_complex_form takes a list of [[frequency,np.matrix([[S11,S12],[S21,S22]])]..]</span>
<span class="sd">    and returns a list in the</span>
<span class="sd">    form [[frequency,S11,S21,S12,S22],..] , it is meant to undo two_port_complex_to_matrix_form&quot;&quot;&quot;</span>
    <span class="n">out_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matrix_form_data</span><span class="p">:</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">[</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out_list</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.two_port_mean_frame">
    <p>def <span class="ident">two_port_mean_frame</span>(</p><p>device_id, system_id=None, history_data_frame=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a Device_Id and a pandas data frame of the history creates a mean data_frame</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.two_port_mean_frame', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.two_port_mean_frame" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">two_port_mean_frame</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span><span class="n">system_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">history_data_frame</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a Device_Id and a pandas data frame of the history creates a mean data_frame&quot;&quot;&quot;</span>
    <span class="n">device_history</span><span class="o">=</span><span class="n">history_data_frame</span><span class="p">[</span><span class="n">history_data_frame</span><span class="p">[</span><span class="s2">&quot;Device_Id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">device_id</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">system_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">device_history</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;System_Id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">system_id</span><span class="p">]</span>
    <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="s1">&#39;magS11&#39;</span><span class="p">,</span><span class="s1">&#39;argS11&#39;</span><span class="p">,</span><span class="s1">&#39;magS21&#39;</span><span class="p">,</span><span class="s1">&#39;argS21&#39;</span><span class="p">,</span><span class="s1">&#39;magS22&#39;</span><span class="p">,</span><span class="s1">&#39;argS22&#39;</span><span class="p">]</span>
    <span class="n">unique_frequency_list</span><span class="o">=</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">mean_array</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_frequency_list</span><span class="p">):</span>
        <span class="n">row</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">:</span>
            <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">device_history</span><span class="p">[</span><span class="n">device_history</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">unique_frequency_list</span><span class="p">[</span><span class="n">index</span><span class="p">]][</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">())</span>
            <span class="c1">#print values</span>
            <span class="n">mean_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_value</span><span class="p">)</span>
        <span class="n">mean_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">mean_frame</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mean_array</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mean_frame</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.two_port_swap_ports">
    <p>def <span class="ident">two_port_swap_ports</span>(</p><p>complex_data)</p>
    </div>
    

    
  
    <div class="desc"><p>Accepts data in [[frequency, S11, S21, S12, S22]..] format and returns
[[frequency, S22, S12, S21, S11]..]</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.two_port_swap_ports', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.two_port_swap_ports" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">two_port_swap_ports</span><span class="p">(</span><span class="n">complex_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Accepts data in [[frequency, S11, S21, S12, S22]..] format and returns</span>
<span class="sd">    [[frequency, S22, S12, S21, S11]..]&quot;&quot;&quot;</span>
    <span class="n">out_data</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">complex_data</span><span class="p">:</span>
        <span class="p">[</span><span class="n">frequency</span><span class="p">,</span> <span class="n">S11</span><span class="p">,</span> <span class="n">S21</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S22</span><span class="p">]</span><span class="o">=</span><span class="n">row</span>
        <span class="n">new_row</span><span class="o">=</span><span class="p">[</span><span class="n">frequency</span><span class="p">,</span> <span class="n">S22</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S21</span><span class="p">,</span> <span class="n">S11</span><span class="p">]</span>
        <span class="n">out_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_data</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.uncorrect_sparameters_eight_term">
    <p>def <span class="ident">uncorrect_sparameters_eight_term</span>(</p><p>sparameters_complex, eight_term_correction, reciprocal=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Removes the eight term correction to sparameters_complex and returns
a uncorrected (reference plane is measurement)
 complex list in the form of [[frequency,S11,S21,S12,S22],..]. The eight term
correction should be in the form [[frequency,S1_11,S1_21,S1_12,S1_22,S2_11,S2_21,S2_12,S2_22]..]
Use s2p.sparameter_complex as input.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.uncorrect_sparameters_eight_term', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.uncorrect_sparameters_eight_term" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">uncorrect_sparameters_eight_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">eight_term_correction</span><span class="p">,</span><span class="n">reciprocal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Removes the eight term correction to sparameters_complex and returns</span>
<span class="sd">    a uncorrected (reference plane is measurement)</span>
<span class="sd">     complex list in the form of [[frequency,S11,S21,S12,S22],..]. The eight term</span>
<span class="sd">    correction should be in the form [[frequency,S1_11,S1_21,S1_12,S1_22,S2_11,S2_21,S2_12,S2_22]..]</span>
<span class="sd">    Use s2p.sparameter_complex as input.&quot;&quot;&quot;</span>
    <span class="c1"># first transform both lists to matrices</span>
    <span class="n">s2p_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span>
    <span class="n">s1_list</span><span class="o">=</span><span class="p">[[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">eight_term_correction</span><span class="p">]</span>
    <span class="n">s2_list</span><span class="o">=</span><span class="p">[[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">8</span><span class="p">]]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">eight_term_correction</span><span class="p">]</span>
    <span class="n">s1_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">s1_list</span><span class="p">)</span>
    <span class="n">s2_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">s2_list</span><span class="p">)</span>
    <span class="c1"># now transform to T matrices</span>
    <span class="n">t_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s2p_matrix_list</span><span class="p">)</span>
    <span class="n">x_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s1_matrix_list</span><span class="p">)</span>
    <span class="n">y_matrix_list</span><span class="o">=</span><span class="n">S_to_T</span><span class="p">(</span><span class="n">s2_matrix_list</span><span class="p">)</span>


    <span class="c1"># now apply the correction</span>
    <span class="n">t_uncorrected_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t_matrix_list</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t_corrected</span><span class="o">=</span><span class="n">x_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">y_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">t_uncorrected_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">t_corrected</span><span class="p">])</span>
    <span class="c1"># now transform back to S</span>
    <span class="n">s_uncorrected_matrix_list</span> <span class="o">=</span><span class="n">T_to_S</span><span class="p">(</span><span class="n">t_uncorrected_list</span><span class="p">)</span>
    <span class="c1"># now put back into single row form</span>
    <span class="n">s_uncorrected_list</span><span class="o">=</span><span class="n">two_port_matrix_to_complex_form</span><span class="p">(</span><span class="n">s_uncorrected_matrix_list</span><span class="p">)</span>
    <span class="c1"># now we take the geometric average and replace S12 and S21 with it</span>
    <span class="k">if</span> <span class="n">reciprocal</span><span class="p">:</span>
        <span class="n">s_averaged_corrected</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">phase_last</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s_uncorrected_list</span><span class="p">:</span>
            <span class="p">[</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">]</span><span class="o">=</span><span class="n">row</span>
            <span class="c1"># S12 and S21 are averaged together in a weird way that makes phase continuous</span>
            <span class="n">geometric_mean</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
            <span class="n">root_select</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">phase_new</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">geometric_mean</span><span class="p">)</span>
            <span class="c1"># if the phase jumps by &gt;180 but less than 270, then pick the other root</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&gt;</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">root_select</span><span class="o">=-</span><span class="mi">1</span>
            <span class="n">mean_S12_S21</span><span class="o">=</span><span class="n">root_select</span><span class="o">*</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
            <span class="n">s_averaged_corrected</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
            <span class="n">phase_last</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">mean_S12_S21</span><span class="p">)</span>
        <span class="n">s_uncorrected_list</span><span class="o">=</span><span class="n">s_averaged_corrected</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">s_uncorrected_list</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.uncorrect_sparameters_sixteen_term">
    <p>def <span class="ident">uncorrect_sparameters_sixteen_term</span>(</p><p>sparameters_complex, sixteen_term_correction)</p>
    </div>
    

    
  
    <div class="desc"><p>Removes the sixteen term correction to sparameters and returns a new sparameter list.
The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.
The sixteen term correction should be a list of
[frequency, S11, S12, S13,S14,S21, S22,S23,S24,S31,S32,S33,S34,S41,S42,S43,S44], etc are complex numbers
Designed to use S2P.sparameter_complex and SNP.sparameter_complex.
Inverse of correct_sparameters_sixteen_term</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.uncorrect_sparameters_sixteen_term', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.uncorrect_sparameters_sixteen_term" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">uncorrect_sparameters_sixteen_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">sixteen_term_correction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Removes the sixteen term correction to sparameters and returns a new sparameter list.</span>
<span class="sd">    The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.</span>
<span class="sd">    The sixteen term correction should be a list of</span>
<span class="sd">    [frequency, S11, S12, S13,S14,S21, S22,S23,S24,S31,S32,S33,S34,S41,S42,S43,S44], etc are complex numbers</span>
<span class="sd">    Designed to use S2P.sparameter_complex and SNP.sparameter_complex.</span>
<span class="sd">    Inverse of correct_sparameters_sixteen_term&quot;&quot;&quot;</span>

    <span class="c1"># first create 4 separate matrix lists for 16 term correction</span>
    <span class="n">s1_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s2_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s3_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s4_matrix_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1"># Then populate them with the right values</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">correction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sixteen_term_correction</span><span class="p">):</span>
        <span class="p">[</span><span class="n">frequency</span><span class="p">,</span> <span class="n">S11</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S13</span><span class="p">,</span><span class="n">S14</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span> <span class="n">S22</span><span class="p">,</span><span class="n">S23</span><span class="p">,</span><span class="n">S24</span><span class="p">,</span><span class="n">S31</span><span class="p">,</span><span class="n">S32</span><span class="p">,</span><span class="n">S33</span><span class="p">,</span><span class="n">S34</span><span class="p">,</span><span class="n">S41</span><span class="p">,</span><span class="n">S42</span><span class="p">,</span><span class="n">S43</span><span class="p">,</span><span class="n">S44</span><span class="p">]</span><span class="o">=</span><span class="n">correction</span>
        <span class="n">s1_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S11</span><span class="p">,</span><span class="n">S12</span><span class="p">],[</span><span class="n">S21</span><span class="p">,</span><span class="n">S22</span><span class="p">]])])</span>
        <span class="n">s2_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S13</span><span class="p">,</span><span class="n">S14</span><span class="p">],[</span><span class="n">S23</span><span class="p">,</span><span class="n">S24</span><span class="p">]])])</span>
        <span class="n">s3_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S31</span><span class="p">,</span><span class="n">S32</span><span class="p">],[</span><span class="n">S41</span><span class="p">,</span><span class="n">S42</span><span class="p">]])])</span>
        <span class="n">s4_matrix_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">S33</span><span class="p">,</span><span class="n">S34</span><span class="p">],[</span><span class="n">S43</span><span class="p">,</span><span class="n">S44</span><span class="p">]])])</span>
    <span class="n">sparameter_matrix_list</span><span class="o">=</span><span class="n">two_port_complex_to_matrix_form</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span>
    <span class="c1"># Apply the correction</span>
    <span class="n">sparameter_out</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">sparameter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sparameter_matrix_list</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">sparameter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s_matrix</span><span class="o">=</span><span class="n">sparameter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">[</span><span class="n">s11_matrix</span><span class="p">,</span><span class="n">s12_matrix</span><span class="p">,</span><span class="n">s21_matrix</span><span class="p">,</span><span class="n">s22_matrix</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">s1_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">s2_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">s3_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">s4_matrix_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">uncorrected_s_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">s21_matrix</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">s_matrix</span><span class="p">)</span><span class="o">-</span><span class="n">s22_matrix</span><span class="p">)</span><span class="o">*</span>\
                                            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">s12_matrix</span><span class="p">))</span><span class="o">+</span><span class="n">s11_matrix</span>

        <span class="c1"># This flips S12 and S21</span>
        <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">uncorrected_s_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">uncorrected_s_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">uncorrected_s_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">uncorrected_s_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">sparameter_out</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.uncorrect_sparameters_twelve_term">
    <p>def <span class="ident">uncorrect_sparameters_twelve_term</span>(</p><p>sparameters_complex, twelve_term_correction, reciprocal=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Removes the twelve term correction to sparameters and returns a new sparameter list.
The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.
The twelve term correction should be a list of
[frequency,Edf,Esf,Erf,Exf,Elf,Etf,Edr,Esr,Err,Exr,Elr,Etr] where Edf, etc are complex numbers</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.uncorrect_sparameters_twelve_term', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.uncorrect_sparameters_twelve_term" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">uncorrect_sparameters_twelve_term</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">,</span><span class="n">twelve_term_correction</span><span class="p">,</span><span class="n">reciprocal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Removes the twelve term correction to sparameters and returns a new sparameter list.</span>
<span class="sd">    The sparameters should be a list of [frequency, S11, S21, S12, S22] where S terms are complex numbers.</span>
<span class="sd">    The twelve term correction should be a list of</span>
<span class="sd">    [frequency,Edf,Esf,Erf,Exf,Elf,Etf,Edr,Esr,Err,Exr,Elr,Etr] where Edf, etc are complex numbers&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">twelve_term_correction</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;s parameter and twelve term correction must be the same length&quot;</span><span class="p">)</span>
    <span class="n">sparameter_out</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phase_last</span><span class="o">=</span><span class="mf">0.</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sparameters_complex</span><span class="p">):</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Sa</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">[</span><span class="n">frequency</span><span class="p">,</span><span class="n">Edf</span><span class="p">,</span><span class="n">Esf</span><span class="p">,</span><span class="n">Erf</span><span class="p">,</span><span class="n">Exf</span><span class="p">,</span><span class="n">Elf</span><span class="p">,</span><span class="n">Etf</span><span class="p">,</span><span class="n">Edr</span><span class="p">,</span><span class="n">Esr</span><span class="p">,</span><span class="n">Err</span><span class="p">,</span><span class="n">Exr</span><span class="p">,</span><span class="n">Elr</span><span class="p">,</span><span class="n">Etr</span><span class="p">]</span><span class="o">=</span><span class="n">twelve_term_correction</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="c1">#        frequency Edf Esf Erf Exf Elf Etf Edr Esr Err Exr Elr Etr.</span>
<span class="c1">#         print [frequency,Edf,Esf,Erf,Exf,Elf,Etf,Edr,Esr,Err,Exr,Elr,Etr]</span>
<span class="c1">#         print Sm[0,0]</span>
        <span class="n">delta</span><span class="o">=</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#         print D</span>
        <span class="n">S11</span> <span class="o">=</span><span class="n">Edf</span><span class="o">+</span><span class="p">(</span><span class="n">Erf</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Elf</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Esf</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Elf</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Esf</span><span class="o">*</span><span class="n">Elf</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">S21</span> <span class="o">=</span><span class="n">Etf</span><span class="o">*</span><span class="p">(</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Esf</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Elf</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Esf</span><span class="o">*</span><span class="n">Elf</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">S12</span> <span class="o">=</span> <span class="n">Etr</span><span class="o">*</span><span class="p">(</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Elr</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Esr</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Esr</span><span class="o">*</span><span class="n">Elr</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">S22</span> <span class="o">=</span> <span class="n">Edr</span><span class="o">+</span><span class="n">Err</span><span class="o">*</span><span class="p">(</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Elr</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Elr</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Esr</span><span class="o">*</span><span class="n">Sa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Esr</span><span class="o">*</span><span class="n">Elr</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span>
        <span class="c1"># S12 and S21 are averaged together in a weird way that makes phase continuous</span>
        <span class="n">geometric_mean</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
        <span class="n">root_select</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">phase_new</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">geometric_mean</span><span class="p">)</span>
        <span class="c1"># if the phase jumps by &gt;180 but less than 270, then pick the other root</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&gt;</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_new</span><span class="o">-</span><span class="n">phase_last</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">root_select</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">mean_S12_S21</span><span class="o">=</span><span class="n">root_select</span><span class="o">*</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">S21</span><span class="o">*</span><span class="n">S12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reciprocal</span><span class="p">:</span>
            <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">mean_S12_S21</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sparameter_out</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">frequency</span><span class="p">,</span><span class="n">S11</span><span class="p">,</span><span class="n">S21</span><span class="p">,</span><span class="n">S12</span><span class="p">,</span><span class="n">S22</span><span class="p">])</span>
        <span class="n">phase_last</span><span class="o">=</span><span class="n">cmath</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">mean_S12_S21</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sparameter_out</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="pyMez.Code.Analysis.SParameter.unwrap_phase">
    <p>def <span class="ident">unwrap_phase</span>(</p><p>phase_list)</p>
    </div>
    

    
  
    <div class="desc"><p>unwrap_phase returns an unwraped phase list given a wraped phase list,
assumed units are degrees</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pyMez.Code.Analysis.SParameter.unwrap_phase', this);">Show source &equiv;</a></p>
  <div id="source-pyMez.Code.Analysis.SParameter.unwrap_phase" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">unwrap_phase</span><span class="p">(</span><span class="n">phase_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;unwrap_phase returns an unwraped phase list given a wraped phase list,</span>
<span class="sd">    assumed units are degrees &quot;&quot;&quot;</span>
    <span class="n">unwrapped_phase_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phase_list_copy</span><span class="o">=</span><span class="n">phase_list</span><span class="p">[:]</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">phase_list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phase_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">phase_list</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">phase_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">phase_list</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span><span class="o">-=</span><span class="mi">1</span>
            <span class="n">phase_list_copy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">phase_list_copy</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="mi">360</span>
        <span class="n">phase_list_copy</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">phase_list_copy</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="mi">360</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">phase_list_copy</span>
</pre></div>

  </div>
</div>

  </div>
  



	
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.COMBINE_S11_S22" class="name">var <span class="ident">COMBINE_S11_S22</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.COMMENT_PATTERN" class="name">var <span class="ident">COMMENT_PATTERN</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.CONNECTOR_TYPES" class="name">var <span class="ident">CONNECTOR_TYPES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.CONVERT_S21" class="name">var <span class="ident">CONVERT_S21</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.DEFAULT_FILE_NAME" class="name">var <span class="ident">DEFAULT_FILE_NAME</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.DEFAULT_INSTRUMENT_SHEET_STYLE" class="name">var <span class="ident">DEFAULT_INSTRUMENT_SHEET_STYLE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.DEFAULT_INSTRUMENT_STATE_STYLE" class="name">var <span class="ident">DEFAULT_INSTRUMENT_STATE_STYLE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.DEFAULT_LOG_STYLE" class="name">var <span class="ident">DEFAULT_LOG_STYLE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.DEFAULT_MEASUREMENT_STYLE" class="name">var <span class="ident">DEFAULT_MEASUREMENT_STYLE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.DEFAULT_METADATA_STYLE" class="name">var <span class="ident">DEFAULT_METADATA_STYLE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.DEFAULT_REGISTER_STYLE" class="name">var <span class="ident">DEFAULT_REGISTER_STYLE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.DEFAULT_STYLE" class="name">var <span class="ident">DEFAULT_STYLE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.DRIVER_FILE_EXTENSIONS" class="name">var <span class="ident">DRIVER_FILE_EXTENSIONS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.DUT_COLUMN_NAMES" class="name">var <span class="ident">DUT_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.EXIF_AVAILABLE" class="name">var <span class="ident">EXIF_AVAILABLE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.EXTENSION_PATTERN" class="name">var <span class="ident">EXTENSION_PATTERN</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.FORMATS" class="name">var <span class="ident">FORMATS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.FREQUENCY_UNITS" class="name">var <span class="ident">FREQUENCY_UNITS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.GET_STATS_FIELDS" class="name">var <span class="ident">GET_STATS_FIELDS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.HTML_TEMPLATE_DIRECTORY" class="name">var <span class="ident">HTML_TEMPLATE_DIRECTORY</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.IMAGE_FILE_EXTENSIONS" class="name">var <span class="ident">IMAGE_FILE_EXTENSIONS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.INKSCAPE_PATH" class="name">var <span class="ident">INKSCAPE_PATH</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.INSTRUMENT_SHEETS" class="name">var <span class="ident">INSTRUMENT_SHEETS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.METHOD_ALIASES" class="name">var <span class="ident">METHOD_ALIASES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.MINIMUM_DB" class="name">var <span class="ident">MINIMUM_DB</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.MINIMUM_DB_ARG_VALUE" class="name">var <span class="ident">MINIMUM_DB_ARG_VALUE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.MINIMUM_DB_VALUE" class="name">var <span class="ident">MINIMUM_DB_VALUE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.NODE_TYPE_DICTIONARY" class="name">var <span class="ident">NODE_TYPE_DICTIONARY</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.NUMBER_MATCH_STRING" class="name">var <span class="ident">NUMBER_MATCH_STRING</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.ONE_PORT_COLUMN_NAMES" class="name">var <span class="ident">ONE_PORT_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.ONE_PORT_DUT" class="name">var <span class="ident">ONE_PORT_DUT</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.OPTION_LINE_PATTERN" class="name">var <span class="ident">OPTION_LINE_PATTERN</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.OS_STAT_FIELDS" class="name">var <span class="ident">OS_STAT_FIELDS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.PARAMETERS" class="name">var <span class="ident">PARAMETERS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.PDF_CONVERT" class="name">var <span class="ident">PDF_CONVERT</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.PIL_AVAILABLE" class="name">var <span class="ident">PIL_AVAILABLE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.POWER_3TERM_COLUMN_DESCRIPTIONS" class="name">var <span class="ident">POWER_3TERM_COLUMN_DESCRIPTIONS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.POWER_3TERM_COLUMN_NAMES" class="name">var <span class="ident">POWER_3TERM_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.POWER_4TERM_COLUMN_DESCRIPTIONS" class="name">var <span class="ident">POWER_4TERM_COLUMN_DESCRIPTIONS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.POWER_4TERM_COLUMN_NAMES" class="name">var <span class="ident">POWER_4TERM_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.PYMEASURE_ROOT" class="name">var <span class="ident">PYMEASURE_ROOT</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.RESULTS_FILE_ONE_PORT_COLUMN_NAMES" class="name">var <span class="ident">RESULTS_FILE_ONE_PORT_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.RESULTS_FILE_POWER_COLUMN_NAMES" class="name">var <span class="ident">RESULTS_FILE_POWER_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.RESULTS_FILE_TWO_PORT_COLUMN_NAMES" class="name">var <span class="ident">RESULTS_FILE_TWO_PORT_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.S1P_DB_COLUMN_NAMES" class="name">var <span class="ident">S1P_DB_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.S1P_MA_COLUMN_NAMES" class="name">var <span class="ident">S1P_MA_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.S1P_RI_COLUMN_NAMES" class="name">var <span class="ident">S1P_RI_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.S2P_COMPLEX_COLUMN_NAMES" class="name">var <span class="ident">S2P_COMPLEX_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.S2P_DB_COLUMN_DESCRIPTION" class="name">var <span class="ident">S2P_DB_COLUMN_DESCRIPTION</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.S2P_DB_COLUMN_NAMES" class="name">var <span class="ident">S2P_DB_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.S2P_MA_COLUMN_DESCRIPTION" class="name">var <span class="ident">S2P_MA_COLUMN_DESCRIPTION</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.S2P_MA_COLUMN_NAMES" class="name">var <span class="ident">S2P_MA_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.S2P_NOISE_PARAMETER_COLUMN_NAMES" class="name">var <span class="ident">S2P_NOISE_PARAMETER_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.S2P_RI_COLUMN_DESCRIPTION" class="name">var <span class="ident">S2P_RI_COLUMN_DESCRIPTION</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.S2P_RI_COLUMN_NAMES" class="name">var <span class="ident">S2P_RI_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.SMITHPLOT" class="name">var <span class="ident">SMITHPLOT</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.SOLUTION_VECTOR_COLUMN_NAMES" class="name">var <span class="ident">SOLUTION_VECTOR_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.StringTypes" class="name">var <span class="ident">StringTypes</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.TESTS_DIRECTORY" class="name">var <span class="ident">TESTS_DIRECTORY</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.TOUCHSTONE_KEYWORDS" class="name">var <span class="ident">TOUCHSTONE_KEYWORDS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.TWELVE_TERM_ERROR_COLUMN_NAMES" class="name">var <span class="ident">TWELVE_TERM_ERROR_COLUMN_NAMES</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.WINDOWS_COM" class="name">var <span class="ident">WINDOWS_COM</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.WINDOWS_WRAPPER" class="name">var <span class="ident">WINDOWS_WRAPPER</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.WKHTML_PATH" class="name">var <span class="ident">WKHTML_PATH</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.XSLT_CAPABLE" class="name">var <span class="ident">XSLT_CAPABLE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="pyMez.Code.Analysis.SParameter.XSLT_REPOSITORY" class="name">var <span class="ident">XSLT_REPOSITORY</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
